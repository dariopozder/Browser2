"use strict";function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get;}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _classCallCheck(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left);}else{return left instanceof right;}}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}(function(){window.Warp={instances:{}};function Root(opts){opts=extend({el:false,debug:true,scope:false,name:false,win:false,propOf:window},opts);if(!Boolean(opts.name)){throw new Error('app initiated with no name');}var app=this,scope={},isBusy;if(opts.el){app.el=opts.el;}else{if(window.warp){app.el=warp.dom.node('div');}app.el=document.createElement('div');}if(opts.scope){app.scope(opts.scope);}if(opts.winOpts){var defaultWin={name:opts.name+'-window',backdrop:false};extend(defaultWin,opts.winOpts);app.win=new gui.Window(app.el,defaultWin);app.show=app.win.show;app.hide=app.win.hide;app.menu=app.win.menu;app.win.caption(app.name);app.win.hide();}app.name=opts.name;app.scope=function(prop,val){if(prop===undefined&&val===undefined)return scope;if(val===undefined){if(typeof prop=='string'){return scope[prop];}else{if(_typeof(prop)!='object')throw new Error('cant be scope');scope=prop;}}else{scope[prop]=val;return true;}return scope;};app.log=function(cont,level){if(!app.debug)return;if(!level)level=0;if(warp)if(warp.log){warp.log(cont,level,app.name);}else{console.log(cont,level,app.name);}};app.options=function(prop,val){if(prop){if(val!==null||val!==undefined){opts[prop]=val;return true;}return opts[prop];}return opts;};app.destroy=function(){if(app.win){app.win.destroy();}try{app.el.parentNode.removeChild(app.el);}catch(e){}if(opts.propOf){delete opts.propOf[app.name];}app=undefined;app=null;return true;};app.busy=function(state,dontPassToWindow){if(state!==undefined){if(state){app.el.classList.remove('disabled');}else{app.el.classList.add('disabled');}if(app.win&&!dontPassToWindow){app.win.busy(state);}isBusy=state;return;}return isBusy;};app.html=function(content){if(content){if(typeof content=='string'){app.el.innerHTML=content;}else{app.el.innerHTML='';app.el.appendChild(content);}app.el.querySelectorAll('*[scope]').forEach(function(el){if(app.scope[el.getAttribute('scope')])log(' exists, current value : '+app.scope[el.getAttribute('scope')].toString());});return true;}else{return app.el.innerHTML;}};app.context=function(functions){gui.context.add(app.win.el,functions,app.name);};app.query=function(selector){var res=app.el.querySelectorAll(selector);if(res&&res.length>1)return res;if(res&&res[0])return res[0];app.error(selector+' query cant find any nodes');};app.error=function(text){error('Error in App "'+app.name+'" execution : '+text);};app.event=function(node,eventType,handler){if(typeof selector=='string')node=app.query(node);node.addEventListener(eventType,handler);};}function App(opts){var app=extend(this,new Root(opts));if(opts.winOpts)app.win.caption(app.name);}function List(options){options=extend({name:'ItemsListApp',winOpts:{backdrop:true,showCentered:true}},options,true);var app=extend(this,new App(options));var selectOptions={html:'',multiple:false,item:function item(data){var item=warp.dom.node('item',{click:function click(){}},{data:data});item.style.height='50px';item.style.display='block';setTimeout(function(){item.querySelector('.item').style.maxWidth='400px';item.querySelector('.item').style.fontSize='10px';},100);return item;}};function handleArgs(caption,data){if(!caption||!data){throw new Error(app.name+' List SELECT didnt recive enough ergs');}if(!data.forEach){throw new Error(app.name+' List SELECT RECIVED DATA THAT IS NOT ARRAY');}else app.scope(data);}app.select=function(caption,data,options){handleArgs(caption,data);options=extend(selectOptions,options,true);return new Promise(function(resolve,reject){if(options&&options.html){app.el.innerHTML=options.html;}else app.el.innerHTML='';if(data){data.forEach(function(v){var it=options.item(v);it.addEventListener('click',function(e){e.preventDefault();app.win.hide().then(function(){resolve(v);});});app.el.append(it);});}app.win.caption(caption);app.win.show();});};var editOptions={html:'',move:true,delete:true,new:function _new(){app.scope().push(Array.from(app.scope()[0]));},multiple:true,item:selectOptions.item};app.edit=function(caption,data,options){handleArgs(caption,data);options=extend(editOptions,options,true);return new Promise(function(resolve,reject){if(options&&options.html){app.el.innerHTML=options.html;}else app.el.innerHTML='';if(data){data.forEach(function(v){var it=options.item(v);it.addEventListener('click',function(e){e.preventDefault();resolve(v);});app.el.append(it);});}app.win.caption(caption);app.win.show();});};}function BlockingApp(options){options=extend({close:false,show:false},options,true);var _ba=this;_ba=extend(this,new App({layer:gui.layers.blockers,name:options.name+' App',propOf:gui,winOpts:extend({close:false,centerBody:true,layer:gui.layers.blockers,keepCentered:true,headless:true,width:410,height:'auto',scrollable:false,backdrop:true,backdropOpacity:0.8,beforeShow:function beforeShow(w){if(!gui.mobile())w.el.style.marginTop='-200px';w.el.querySelector('.app').style.backgroundColor='rgba(0,0,0,0)';w.el.style.backgroundColor='rgba(0,0,0,0)';w.content.style.backgroundColor='rgba(0,0,0,0.9)';w.body.style.overflowY='hidden';_ba.el.style.backgroundColor='rgba(0,0,0,0)';},onHide:function onHide(w){setTimeout(function(){_ba.next();},200);}},options)}));_ba.el.classList.add('m20');if(options.show)_ba.show=options.show;_ba.list=[];_ba.next=function(){_ba.busy(false,true);if(_ba.list.length){var args=_ba.list[0];_ba.list.shift();_ba.show(args[0],args[1],args[2]);}};_ba.type='BlockingApp';return _ba;}function ProfileApp(options){if(!options.name)throw new Error('no name provided in options for ProfileApp');if(!options.profile)throw new Error('no profile ID provided in options for ProfileApp');if(!options.icon)throw new Error('no icon provided in options for ProfileApp');var app=extend(this,new App({name:'ProfileApp-'+options.name+'-'+options.profile,winOpts:{}}));app.load=async function(id){options.profile=id;var profile=gui.storage('profiles.'+options.profile);if(!profile){profile=await warp.api.call('profiles/read',options.profile);profile=profile[0];}if(!profile)throw new Error('Profile with ID '+options.profile+' for Wall app doesnt exist');if(!profile.logo){profile.logo=main.envVars.url+'resources/images/man.png';}app.profile=profile;render(profile);};async function render(profile){app.win.caption(" \n          \n            <div class=\"profile hxs profiles-".concat(profile.id,"\">\n            \n                <div class=\"image fl round inline-block\" style=\" \n                        background-image : url('").concat(profile.logo,"');\n                        border:1px lightgrey solid;\n                        width: 23px;\n                        height: 23px;\n                        margin-top: -2px;\n                        margin-left: -5px;\n                        margin-right: 5px;\n                    \"> </div>\n                    \n                 ").concat(profile.name.split(' ')[0],"-").concat(options.name," \n                 \n            <div>\n        "));}app.load(options.profile);}Warp.Factory=function(){this.App=App;this.List=List;this.ProfileApp=ProfileApp;this.WallApp=WallApp;};Warp.Api=function Api(options,_warp){options=Object.assign({url:'https://some.thing/',error:function error(result){_warp.log(result,1,'error');},debug:function debug(result){_warp.log(result,0,'debug');},news:function news(result){if('home'in main){main.nottApp.createFromResponse(result);}else{if('nottBuffer'in window!=true){window.nottBuffer=[];}nottBuffer.concat(result);}},default:function _default(result){}},options);var app=this;Object.assign(this,{timings:{},debug:options.debug,test:async function test(){}});this.call=async function call(path,data){if(path.includes('drive/read')){var fname=data.path.split('/').at(-1);}if(path.includes('drive/write')&&data.file){var fileToSend=data.file;delete data.file;}if(path.slice(-1)!='/')path=path+'/';var timingData={};timingData.time=performance.now();data=_warp.do.json(data);var formData=new FormData();formData.append('data',data);if(path.includes('drive/write')){formData.append('file',fileToSend);}var response=await fetch(options.url+path,{method:'POST',body:formData});var result=false;if(path.includes('drive/read')){responseType='file';result=await response.blob();var file=new File([result],fname,{type:result.type,lastModified:new Date().getTime()});var ext=fname.split('.').at(-1);var binExtensions=['o','xls','xlsx','ods','glb','hgl','hgt','docx','doc','webm','webp','cap','pcap','collada','obj','mp3','wav','bmp','jpg','jpeg','png','tga','tiff','mp2','mp4','zip','7z','tar'];if(binExtensions.includes(ext)){return result;}else{return await file.text();}}else result=await response.json();console.log(response);console.log(result);return responseRouter(result);function responseRouter(result){timingData.incomingSize=response.length;timingData.clientTiming=performance.now()-timingData.time;timingData.serverTiming=response.t;timingData.time=new Date();if(!app.timings[path])app.timings[path]=[];app.timings[path].push(timingData);if(result.errors){result.errors.forEach(function(error){options.error(error);});}if(result.n){options.news(result.n);}if(result.debug){result.debug.forEach(function(msg){options.debug(msg);});}options.default(result.d);return result.d;}};};Warp.Sound=function(){function Mic(){var options={'sampleSize':8,'sampleRate':8000,'channelCount':1,'noiseSuppression':false,'echoCancellation':false};var mic=this;var mediaRecorder=null;var chunks=[];mic.isRecording=false;mic.start=async function(){navigator.mediaDevices.getUserMedia({audio:options}).then(function(stream){mediaRecorder=new MediaRecorder(stream);chunks=[];mediaRecorder.ondataavailable=function(e){chunks.push(e.data);};mediaRecorder.start();}).catch(function(error){alert('Seems you don\'t have permission to use the microphone');});};mic.stop=function(){return new Promise(function(res,rej){mediaRecorder.stop();mediaRecorder.onstop=function(){var blob=new Blob(chunks,{type:'audio/ogg'});res(blob);};});};this.events=function(){app.button=document.createElement('div');app.button.addEventListener('click',function(){if(mediaRecorder&&mediaRecorder.state==='recording'){app.stop();}else{app.start();}});};this.inspect=function(subject){app.show();};}function secsToMins(seconds){var minutes=Math.floor(seconds/60);var extraSeconds=seconds%60;minutes=minutes<10?'0'+minutes:minutes;extraSeconds=extraSeconds<10?'0'+extraSeconds:extraSeconds;return minutes+' : '+parseInt(extraSeconds).toString().padStart(2,'0');}this.recording=new Mic();this.record=function(){return new Promise(function(resolve,reject){warp.sound.recording.start();confirm("\n            Recording is in progress...\n            <br><br>\n            Press OK to finish\n            ",function(){warp.sound.recording.stop().then(function(rec){resolve(rec);});},function(){warp.sound.recording.stop();resolve(null);toast('recording canceled');});});};this.play=async function(subject){var name='audio'+parseInt(Math.random()*143*Math.random());var t='';window[name]=new Audio(subject);window[name].addEventListener('ended',function(){window[name].currentTime=0;delete window[name];t.destroy('Finished');});window[name].addEventListener('loadedmetadata',function(){t=toast('Playing '+secsToMins(window[name].duration),0);window[name].play();});};};function prompter(){var VOICE_MIN_DECIBELS=-35;var DELAY_BETWEEN_DIALOGS=400;var DIALOG_MAX_LENGTH=60*1000;var MEDIA_RECORDER=null;var IS_RECORDING=false;function startRecording(){IS_RECORDING=true;record();}function stopRecording(){IS_RECORDING=false;if(MEDIA_RECORDER!==null)MEDIA_RECORDER.stop();}function record(){navigator.mediaDevices.getUserMedia({audio:true}).then(function(stream){MEDIA_RECORDER=new MediaRecorder(stream);MEDIA_RECORDER.start();var audioChunks=[];MEDIA_RECORDER.addEventListener('dataavailable',function(event){audioChunks.push(event.data);});var audioContext=new AudioContext();var audioStreamSource=audioContext.createMediaStreamSource(stream);var analyser=audioContext.createAnalyser();analyser.minDecibels=VOICE_MIN_DECIBELS;audioStreamSource.connect(analyser);var bufferLength=analyser.frequencyBinCount;var domainData=new Uint8Array(bufferLength);var time=new Date(),currentTime;var startTime,lastDetectedTime=time.getTime();var anySoundDetected=false;var detectSound=function detectSound(){if(!IS_RECORDING)return;time=new Date();currentTime=time.getTime();if(currentTime>startTime+DIALOG_MAX_LENGTH){MEDIA_RECORDER.stop();return;}if(anySoundDetected===true&&currentTime>lastDetectedTime+DELAY_BETWEEN_DIALOGS){MEDIA_RECORDER.stop();return;}analyser.getByteFrequencyData(domainData);for(var _i=0;_i<bufferLength;_i++){if(domainData[_i]>0){anySoundDetected=true;time=new Date();lastDetectedTime=time.getTime();}}setTimeout(function(){detectSound();},100);};detectSound();MEDIA_RECORDER.addEventListener('stop',function(){stream.getTracks().forEach(function(track){return track.stop();});if(!anySoundDetected)return;var audioBlob=new Blob(audioChunks,{'type':'audio/ogg'});doWhateverWithAudio(audioBlob);record();});});}function doWhateverWithAudio(audioBlob){var reader=new FileReader();reader.onload=function(){var dataURL=reader.result;app.busy(true);};reader.readAsDataURL(audioBlob);}startRecording();}Warp.Threads=function(allowConcurent){var app=this;app.el=document.createElement('div');this.list=[];function createScript(js){return"(function() {\n\n            //bind an alert()  to window.alert(), and b.inspect() through postMessage\n            alert = function(e) { \n                postMessage({type:'window', method : 'alert', args : [e]}); \n            };\n            var warp = {};\n            warp.inspect = function(a1) { \n                postMessage({type:'warp', method : 'inspect', args : a1}); \n            };\n            call= function(method,args){ \n                //can be called with one arg, not array\n                if(!Array.isArray(args))args=[args];\n                postMessage({type:'window', method : method, args : args}); \n             }\n            //test\n            //alert(\"hello() from worker-window bridge\");\n            //b.inspect(\"hello from worker window bridge\");\n            //call('alert','worker call() test with call(\"alert\") and this message as argument')\n             \n             /* handler */\n             onmessage = msgHandler = function (e) {\n                            var msgData = e.data\n                            //alert(\"you called method : \"+msgData.args)\n                            //handles 1 type of messages\n                            //for 1  scope, global\n                            \n                            if (msgData.type === 'global') {\n                            var fun =  eval(msgData.method)\n                            fun(msgData.args)\n                              //  self[msgData.method](msgData.args);\n                            }\n                        };\n                        \n             /* fps */ \n             fps= function fps(tick, e, h, scope) {\n        //e = runTime in ms \n        //h = boolean, switch to return the samples list also,\n        //if we want to see trends \n        //scope not implented yet, we would execute as poperty \n        //scope[tempPropName] = function(){   \n        //    eval(fps())\n        //}\n        //scope[tempPropName]()\n        return new Promise((resolve, reject) => {\n            var f, d, c, a, b, raf, _vsync = 60;\n            // if (requestAnimationFrame) {\n            //    raf = requestAnimationFrame;\n            // } else {\n            raf = function (callback, element) {\n                setTimeout(function () {\n                    callback(new Date().getTime());\n                }, 1000 / _vsync);\n            };\n            //   }\n            if (!e)\n                e = 1000;\n            //start\n            f = Date.now();\n            //before from now()\n            d = Date.now();\n            //last fps\n            a = 0;\n            //samples\n            b = [];\n            function g() {\n                c = Date.now();\n                if (-1 * (f - c) > e) {\n                    a = 0;\n                    b.forEach(function (b) {\n                        a += b;\n                    });\n                    a = Math.round(a / b.length);\n                    // if (a > 60)\n                    //    a = 60;\n                    if (h)\n                        return resolve({\n                            fps: a,\n                            list: b\n                        });\n                    return resolve(a);\n                }\n                a = Math.round(1000 / (c - d));\n                b.push(a);\n                d = c;\n                if (tick) {\n                    a = 0;\n                    b.forEach(function (b) {\n                        a += b;\n                    });\n                    a = Math.round(a / b.length);\n                    \n                    tick(a);\n                }console.log(a)\n                raf(g);\n            }\n            raf(g);\n        });\n    }\n             \n             \n            //user script\n            ".concat(js,"\n})();");}this.inspect=function(js){if(js.path){if(!js.data)return;js=fromJson(js.data);}app.show();app.create(js);};this.stop=function(thread){thread.running=false;thread.worker.terminate();app.update();};this.create=function(js,options){if(!warp.lists.threads){warp.lists.threads=app.list;}if(!options)options={};options=Object.assign({'allowConcurent':false,'shared':false,'module':false},options);if(typeof js=='function'){js=js.toString();}var ind=0;var thread=false;var existed=false;if(!options.allowConcurent)app.list.forEach(function(thr){if(thr.code==js){thread=app.list[ind];alert('code exists in a thread, replacing');existed=ind;}ind++;});if(thread){thread.worker.terminate();}thread={code:js,workerCode:createScript(js),worker:false,errors:[],running:false};app.list[existed]=thread;var blob=new Blob([thread.workerCode],{type:'text/javascript'});if(options.module)blob=new Blob([js],{type:'text/javascript'});var url=window.URL.createObjectURL(blob);if(options.shared){thread.worker=new SharedWorker(url,'testno ime').port;}else{if(options.module){thread.worker=new Worker(url,{type:'module'});}else thread.worker=new Worker(url);}thread.shared=options.shared;thread.worker.onmessage=function(e){msgHandler(e.data,thread);};thread.worker.onerror=function(e){thread.errors.push(e);throw new Error(e.message);app.update();};thread.post=function(m){thread.worker.postMessage(m);};thread.call=function(method,args){if(!Array.isArray(args))args=[args];thread.post({type:'global',method:method,args:args});};thread.running=true;if(!existed){app.list.push(thread);app.update();return app.list[app.list.length-1];}app.update();return app.list[existed];};var msgHandler=function msgHandler(msgData,thread){if(msgData.type==='window'){window[msgData.method](msgData.args);}if(msgData.type==='warp'){warp[msgData.method](msgData.args);}};this.update=function(){app.el.innerHTML='';var ind=0;app.list.forEach(function(thr){ind++;});};this.clean=function(){app.list.forEach(function(thr){app.stop(thr);});app.update();};this.test=function(){function test(str){alert(str);}var t=warp.thread(test,{shared:false});t.call('test','test Worker');var sh=warp.thread(test,{shared:true});sh.call('test','test Shared');};};Warp.Editors=function(_warp){var _editors=this;_editors.layer=new _warp.gui.HTMLLayer({name:'editors'});this.Text=function(){var _text=this;Object.assign(this,new _warp.factory.App({layer:_editors.layer,name:'textEditor',winOpts:{close:false,centerBody:true,layer:_warp.gui.layers.blockers,keepCentered:true,headless:true,width:380,height:'auto',backdrop:true,onShow:function onShow(w){_text.el.querySelector('button').classList.add('active');_text.el.querySelector('input').select();_text.el.querySelector('input').focus();if(!gui.mobile())w.el.style.marginTop='-200px';}}}));_text.el.style.backgroundColor='rgba(0,0,0,0)';_text.el.style.borderRadius='5px';_text.win.content.style.backgroundColor='rgba(0,0,0,0.9)';_text.win.el.style.backgroundColor='rgba(0,0,0,0)';this.caption=false;this.text='';this.onComplete=false;this.apply=function(){_text.onComplete(_text.el.querySelector('input').value);_text.hide();_text.caption=false;_text.text='';_text.onComplete=false;};this.edit=function(caption,onComplete,text,options){if(!caption||!onComplete){_text.log('argument missing',1);return;}else{_text.caption=caption;_text.onComplete=onComplete;_text.text=text;}var fieldType='text';if(options&&options.password)fieldType='password';_text.el.innerHTML="\n                        <div class = \"form cap-first tj mtmd mbmd\" \n                             style = \"max-width:250px;margin-left:auto;margin-right:auto\">\n                            <p>\n                                ".concat(caption,"\n                            </p>\n                            <input  type=\"").concat(fieldType,"\" value=\"").concat(empty(text),"\"/>\n                        </div>\n                        <div  class=\"m20 mtmd mbmd buttons\">\n                           <button  onclick=\"warp.editors.textApp.apply()\" class=\"sm primary\">\n                             Ok      \n                            </button>\n                           <button class=\"sm\" onclick=\"warp.editors.textApp.hide()\" >\n                                 Cancel    \n                           </button>\n                        </div>\n                        ");_text.win.show();};};this.Date=function(){var app=this;Object.assign(this,new _warp.factory.App({name:'dateEditor',winOpts:{'onShow':function onShow(){}},layer:_editors.layer}));this.caption=false;this.select=function(date){app.log(date);if(app.onComplete)app.onComplete(date);app.hide();app.caption=false;app.onComplete=false;app.hide();};this.onComplete=false;this.onSelect=function(el){var serverDate=app.c.currYear+'-'+el.getAttribute('m').padStart(2,'0')+'-'+el.getAttribute('d').padStart(2,'0');app.select(serverDate);};this.apply=function(){app.onComplete(app.el.querySelector('input').value);app.hide();app.caption=false;app.onComplete=false;};var Cal=function Cal(sel){this.sel=sel;this.DaysOfWeek=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];this.Months=['January','February','March','April','May','June','July','August','September','October','November','December'];var d=new Date();this.currMonth=d.getMonth();this.currYear=d.getFullYear();this.currDay=d.getDate();this.selected=false;};Cal.prototype.nextMonth=function(){if(this.currMonth==11){this.currMonth=0;this.currYear=this.currYear+1;}else{this.currMonth=this.currMonth+1;}this.showcurr();};Cal.prototype.previousMonth=function(){if(this.currMonth==0){this.currMonth=11;this.currYear=this.currYear-1;}else{this.currMonth=this.currMonth-1;}this.showcurr();};Cal.prototype.showcurr=function(){this.showMonth(this.currYear,this.currMonth);};Cal.prototype.showMonth=function(y,m){var dest=document.querySelector(this.sel);var d=new Date();var firstDayOfMonth=new Date(y,m,1).getDay();var lastDateOfMonth=new Date(y,m+1,0).getDate();var lastDayOfLastMonth=m==0?new Date(y-1,11,0).getDate():new Date(y,m,0).getDate();var html='<table class="tc" style="font-size: 0.9em;">';html+='<thead class="tb"><tr>';html+='<td colspan="7">'+this.Months[m]+' '+y+'</td>';html+='</tr></thead>';html+='<tr class="days" >';for(var i=0;i<this.DaysOfWeek.length;i++){html+='<td>'+this.DaysOfWeek[i]+'</td>';}html+='</tr>';var i=1;do{var dow=new Date(y,m,i).getDay();if(dow==0){html+='<tr>';}else if(i==1){html+='<tr>';var k=lastDayOfLastMonth-firstDayOfMonth+1;for(var j=0;j<firstDayOfMonth;j++){html+='<td class="ripple not-current" d="'+k+'" m="'+parseInt(this.currMonth)+'" onclick="warp.editors.dateApp.onSelect(this)"><div class="ripple">'+k+'</div></td>';k++;}}var chk=new Date();var chkY=chk.getFullYear();var chkM=chk.getMonth();if(chkY==this.currYear&&chkM==this.currMonth&&i==this.currDay){html+="\n                    <td class=\"tb text-primary\" d=\"".concat(i,"\" m=\"").concat(parseInt(this.currMonth)+1,"\" onclick=\"warp.editors.dateApp.onSelect(this)\">\n                  <div>  \n                  <div style=\"\n                    height:auto;\n                    width:auto; font-weight:normal; font-size:0.7em; margin-top: -11px;\" class=\"\">Today</div>\n                    ").concat(i,"\n                    </div>\n                    </td>\n                    ");}else{html+='<td class="normal ripple" d="'+i+'" m="'+(parseInt(this.currMonth)+1)+'"  onclick="warp.editors.dateApp.onSelect(this)"><div class="ripple">'+i+'</div></td>';}if(dow==6){html+='</tr>';}else if(i==lastDateOfMonth){var k=1;for(dow;dow<6;dow++){html+='<td class="not-current" d="'+k+'" m="'+(parseInt(this.currMonth)+2)+'" onclick="warp.editors.dateApp.onSelect(this)"><div class="ripple">'+k+'</div></td>';k++;}}i++;}while(i<=lastDateOfMonth);html+='</table>';var dest=document.querySelector(this.sel);dest.innerHTML=html;};this.edit=function(date,caption,onComplete){app.caption=caption;app.onComplete=onComplete;app.selected=date;app.el.innerHTML="\n<style>\n            .calendar {\n                width: 300px;\n                margin: 10px auto;\n                padding: 10px;\n                background: var(--pageBg);\n            }\n             .calendar td.normal ,.calendar td.not-current ,.calendar td.today {\n                padding-bottom: 5px;\n                padding-top: 5px;\n                cursor:pointer\n            }\n            .calendar td.normal div,.calendar td.not-current div,.calendar td.today>div {\n                height: 36px;\n                width: 36px;\n           \n                border-radius:20px;\n                display:inline-block;\n                padding-top: 10px;\n            }\n            .calendar a {\n                margin-bottom: -20px;\n            }\n            .calendar .days {\n                opacity: 0.9;\n            }\n            .not-current {\n                opacity: 0.8;\n            }\n            .calendar td.normal div:hover,.calendar td.not-current div:hover,.calendar td.today>div:hover {\n              background-color:var(--primaryBg);\n              color:var(--primaryColor);\n              opacity:1\n            }\n</style>\n<div class=\"calendar mtmd\">\n        <a class=\"prev fl ml0 mt20\">Prev</a>\n        <a class=\"next fr mr0 mt20\">Next</a>\n        <div class=\"body\"></div>\n</div>\n";app.show();app.c=new Cal('.calendar .body');app.onSelect=function(el){var serverDate=app.c.currYear+'-'+el.getAttribute('m').padStart(2,'0')+'-'+el.getAttribute('d').padStart(2,'0');app.select(serverDate);};app.c.showcurr();document.querySelector('.calendar .next').onclick=function(){app.c.nextMonth();};document.querySelector('.calendar .prev').onclick=function(){app.c.previousMonth();};app.win.show();app.win.caption('Date');};};this.Address=function(){var app=this;Object.assign(this,new _warp.factory.App({layer:_editors.layer,name:'addressEditor',winOpts:{close:false,draggable:true,'onShow':function onShow(w){var f=app.el.querySelector('.form');if(app.onComplete){warp.dom.show(f);}else{warp.dom.hide(f);}app.el.appendChild(main.geo.el);warp.dom.height(main.geo.el,warp.dom.height(w.content));app.centerMap();},'onHide':function onHide(w){if(app.clean)app.clean();}}}));this.address=false;this.onComplete=false;this.clean=function(){var f=app.el.querySelector('.form');if(f)warp.dom.hide(f);app.caption=false;app.address=false;app.onComplete=false;};this.geocode=function(){main.geo.geocode(app.string(),function(latLng){if(latLng){app.centerMap();}else{main.geo.clean();app.address.lat=false;app.address.lng=false;toast('Cant geocode address');}});};this.centerMap=function(){main.geo.clean(function(){if(!Boolean(app.address.lat)){main.geo.geocode(app.string(),function(latLng){if(latLng){main.geo.zoom(13);main.geo.center(latLng,0,-100);var opts={image:app.obj.logo};main.geo.marker({lat:app.address.lat,lng:app.address.lng},opts);app.address.lat=latLng.lat;app.address.lng=latLng.lng;}});}else{main.geo.zoom(13);main.geo.center({lat:app.address.lat,lng:app.address.lng},0,-100);main.geo.marker({lat:app.address.lat,lng:app.address.lng});}});};this.string=function(){return app.address.address1+', '+app.address.address2+', '+app.address.city+' '+app.address.zip+', '+app.address.country;};this.apply=function(){if(app.onComplete){app.onComplete(app.address);app.clean();}app.hide();};this.edit=function(obj,options){app.clean();app.obj=obj;app.address={address1:obj.address1,address2:obj.address2,city:obj.city,country:obj.country,zip:obj.zip,lat:obj.lat,lng:obj.lng};if(app.address.lat==''||!Boolean(app.address.lat)){app.address.lat=false;}else{app.address.lat=parseFloat(app.address.lat);}if(app.address.lng==''||!Boolean(app.address.lng)){app.address.lng=false;}else{app.address.lng=parseFloat(app.address.lng);}if(options){app.win.caption(options.caption);app.onComplete=options.onComplete;}else{app.win.caption('Address in '+obj.country);}app.el.innerHTML="\n                        <div class=\"tl raised form\" style=\"background-color:var(--pageBg); position:fixed; bottom:0px; right:0px;  width:205px; border-top-left-radius:15px; z-index:2\">\n                           <div class=\"m10\">\n                                <input  type=\"text\" onblur=\"warp.editors.addressApp.geocode()\" placeholder=\"address1\" value=\"".concat(empty(app.address.address1),"\" oninput=\"warp.editors.addressApp.address.address1 = this.value\" class=\"sm m5 \"/>\n                                <input  type=\"text\" onblur=\"warp.editors.addressApp.geocode()\"  placeholder=\"address2\" value=\"").concat(empty(app.address.address2),"\" oninput=\"warp.editors.addressApp.address.address2 = this.value\" class=\"sm m5 hidden\"/>\n                                <input  type=\"text\" onblur=\"warp.editors.addressApp.geocode()\"  placeholder=\"city\" value=\"").concat(empty(app.address.city),"\" oninput=\"warp.editors.addressApp.address.city = this.value\" class=\"sm m5 \"/>\n                                <input  type=\"text\" onblur=\"warp.editors.addressApp.geocode()\"  placeholder=\"zip\" value=\"").concat(empty(app.address.zip),"\" oninput=\"warp.editors.addressApp.address.zip = this.value\" class=\"sm m5 \"/>\n                                <br>\n                                <div class=\"m5 small\" >\n                                 Country : ").concat(empty(app.address.country),"\n                                </div>\n                                 ").concat(Boolean(app.address.lat)?'<div class="text-success small m5 strong">Confirmed on map</div>':'<div class="text-danger small  m5  strong">Not onfirmed on map</div>',"\n                                <button onclick=\"warp.editors.addressApp.apply()\" class=\"fl primary mb10 mt5\">\n                                     Apply\n                                </button>\n                                <button onclick=\"warp.editors.addressApp.hide()\" class=\"clear round raised mt5  fr\" >\n                                    <svg class=\"icon ts1 text-primary\" style=\"fill:var(--primaryBg)\">\n                                        <use href=\"#icon-close\" />\n                                    </svg>\n                                </button>\n                            </div>    \n                        </div>\n        ");app.win.show();};};_editors.addressApp=new _editors.Address();_editors.textApp=new _editors.Text();_editors.dateApp=new _editors.Date();_editors.text=_editors.textApp.edit;_editors.date=_editors.dateApp.edit;_editors.address=_editors.addressApp.edit;return _editors;};Warp.Bridge=function Bridge(scope,workerPath,options){options=Object.assign({forceRegister:false},options);var client;var version=14;var isWindow,isWorker;if(self.window){client=window;isWindow=true;isWorker=false;}else{client=false;isWindow=false;isWorker=true;}var br=this;this.registration=false;this.debug=true;function log(cont,level){if(!br.debug)return;var col;var source;if(isWorker){col='darkorange';source='service.worker : ';}if(isWindow){col='blue';source='window : ';}if(!level)level=0;if(level==0){console.log('%c'+source,'color: '+col,cont);}if(level==1){console.error('%c'+source,'color: '+col,cont);}}this.log=log;this.kill=function(onComplete){log('Unregistering...');navigator.serviceWorker.getRegistrations().then(function(registrations){if(registrations.length){log('...'+registrations.length+' registations.');var _iterator=_createForOfIteratorHelper(registrations),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var registration=_step.value;log('..unregistered');registration.unregister();}}catch(err){_iterator.e(err);}finally{_iterator.f();}}else log('...0 registrations. ');return;}).then(function(){log('Finished unregistration.');if(onComplete)onComplete();});};this.register=function(swPath,onComplete){if(swPath){log('Registering : '+swPath);navigator.serviceWorker.register(swPath+'?v='+Math.random()*6).then(function(registration){br.registration=registration;if(onComplete){if(registration.active){onComplete(registration.active);}else{log('no active registrations to return',1);}}log('Service Worker registration finished');return registration.active;});}else{log('No path to worker provided. Getting registrations...');navigator.serviceWorker.getRegistrations().then(function(registrations){if(registrations.length){log('...'+registrations.length+' registations.');var _iterator2=_createForOfIteratorHelper(registrations),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var registration=_step2.value;br.registration=registration;log(registration);return registration.active;}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}else{log('...0 registrations. ');return false;}}).then(function(worker){if(!worker)log('No active worker returned from registration.., registration failed !!!');log('Finished registration.');if(onComplete)onComplete(worker);});}};this.post=function(msgObj,clientId){if(isWorker){if(clientId){log('.post to window : '+clientId);clients.get(clientId).then(function(client){client.postMessage(msgObj);});}else{log('no clientId, sending to... ');clients.matchAll({type:'window'}).then(function(clientList){log('...'+clientList.length+' clients');for(var i=0;i<clientList.length;i++){client=clientList[i];client.postMessage(msgObj);}if(!client){log(' no clients in .matchAll()...message was not send : ');log(msgObj);}});}}else{log('.post to worker');br.registration.active.postMessage({});br.registration.active.postMessage(msgObj);}};this.notify=function(title,notObj,clientId){if(!notObj)notObj={};var i;if(isWorker)i='resources/favicon/mstile-150x150.png';if(isWindow)i=main.envVars.url+'resources/favicon/mstile-150x150.png';Object.assign(notObj,{body:'notification from ...',icon:i,tag:'notification-for-order',data:'data'});if(isWorker){scope.registration.showNotification(title,notObj);}if(isWindow){br.registration.showNotification(title,notObj);}};function router(event){log('routing : '+event.data.type);switch(event.data.type){case'call':recivedCall(event);break;case'info':recivedInfo(event);break;case'myId':recivedMyId(event);break;case'test':log(event.data);break;default:log('router with unrecognised "type" in data',1);log(event);}}this.call=function(method,args,clientId){log('.call('+method+') '+' has been envoked');br.post({type:'call',data:{'method':method,'args':args}},clientId);};function recivedCall(ev){var data=ev.data.data;log(' recivedCall() method : '+data.method);if(!scope[data.method]){log(data.method+' does not exist');return;}try{scope[data.method](data.args);}catch(err){log(err,1);log(' recivedCall() : '+data.method+'() failed',1);return;}}this.myId=function(callbackName){br.post({type:'info',data:{'callback':callbackName}});};function recivedMyId(ev){var data=ev.data.data;if(data.callback){br.call(data.callback,ev.clientId,ev.clientId);}}this.active=async function activeWorker(){var worker=await navigator.serviceWorker.getRegistrations().then(function(registrations){if(registrations.length){var _iterator3=_createForOfIteratorHelper(registrations),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var registration=_step3.value;if(registration.active)return registration.active;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}else return false;});};this.info=function(callbackName){log('requesting info()');br.post({type:'info',data:{'callback':callbackName}});};function recivedInfo(ev){var data=ev.data.data;clients.matchAll().then(function(clients){var newMap=clients.map(function(cl){return cl.id;});if(data.callback){br.call(data.callback,newMap,ev.clientId);}});}function init(){if(!scope&&!workerPath){log('Bridge(), no scope passed');if(isWorker){scope=self;}if(isWindow){scope=window;}}if(isWorker){scope.addEventListener('message',function(event){router(event);});}if(isWindow){if(options.forceRegister&&workerPath!==undefined){br.register(workerPath,function(worker){log(worker);br.registration.active.onmessage=function(event){router(event);};});}else{br.register(false,function(workerWTFDoesntWork){if(br.registration.active){br.registration.active.onmessage=function(event){router(event);};}else{if(workerPath!==undefined){br.register(workerPath);}else{log('Service worker wasn\'t registered! no path provided and no existing registrations found',1);}}});}}var bridgeType=isWindow?'window':'worker';log('Bridge() v. '+version+' is a '+bridgeType+', scope : ');}init();};function Tab(tabOpts){extend(this,{'id':tabOpts.id,'url':tabOpts.url,'win':tabOpts.winId,'el':false,'active':false,'ready':false,'favicon':tabOpts.favicon,'eval':async function _eval(code){if(typeof code=='function')code='return ('+code.toString()+')()';return await warp.invoke('Tabs','Eval',[tabOpts.id,code]);},'destroy':async function destroy(){if(tabOpts.id==warp.native.activeTab)await warp.invoke('Tabs','Deactivate',[tabOpts.id]);return await warp.invoke('Tabs','Destroy',[tabOpts.id]);},'back':async function back(){return await warp.invoke('Tabs','Back',[tabOpts.id]);},'forward':async function forward(){return await warp.invoke('Tabs','Forward',[tabOpts.id]);},'navigate':async function navigate(url){return await warp.invoke('Tabs','Navigate',[tabOpts.id,url]);},'agent':async function agent(_agent){if(!_agent)_agent=null;return await warp.invoke('Tabs','Agent',[tabOpts.id,_agent]);}});}if(window.native){window.native={hostWin:window.native.hostWin,messages:{},tabs:{},activeTab:false,invoke:function invoke(className,methodName,args){if(args==null)args=[];var messageId=Math.random().toString().split('.')[1];var p=new Promise(function(resolve,reject){native.messages[messageId]={id:messageId,resolve:resolve,reject:reject,endpoint:className,method:methodName,args:args};});var message=JSON.stringify({endpoint:className,method:methodName,id:messageId,args:args,invoker:window.native.hostWin.id});chrome.webview.postMessage(message);native.messages[messageId].promise=p;return p;},trigger:function trigger(className,methodName,data,invoker){var eventName='native'+className+methodName;warp.trigger(eventName,warp.un.json(data));},resolve:function resolve(messageId,result){console.log('resolving with result : '+result);result=warp.un.json(result);native.messages[messageId].resolve(result);delete native.messages[messageId];},reject:function reject(messageId,result){error(result,null,'Native promise rejected');native.messages[messageId].reject(result).then(function(){},function(){delete native.messages[messageId];});},version:0.21,fetch:function(_fetch){function fetch(_x){return _fetch.apply(this,arguments);}fetch.toString=function(){return _fetch.toString();};return fetch;}(async function(url){var dataURL=await window.native.invoke('Network','Fetch',[url]);var blob=await(await fetch(dataURL)).blob();blob.json=async function(){return JSON.parse(await this.text());};return blob;}),drive:{read:function read(path){return warp.invoke('Drives','Read',[path]);},scan:function scan(path){return warp.invoke('Drives','Scan',[path]);}},port:{open:function open(type,portNr,onPacket){return warp.native.call('Port.open',[type,portNr,onPacket]);},close:function close(type,portNr){return warp.native.call('Port.close',[type,portNr]);}},tab:async function tab(url,winId,tabId){if(!winId)winId=warp.native.hostWin.id;if(!tabId)tabId=Math.random().toString().split('.')[1];var tabData=await warp.invoke('Tabs','Create',[tabId,url,winId]);async function waitTabReady(tabId,interval){if(!interval)interval=17;return new Promise(function(resolve,reject){var checkReady=function checkReady(){var tab=tabs[tabId];if(tab&&tab.ready){resolve();}else{setTimeout(checkReady,interval);}};checkReady();});}await waitTabReady(tabData.id);warp.constructors.check('TabOptions',tabData);var tab=new Tab(tabData);if(!warp.lists.native)warp.lists.native={tabs:{},windows:{}};warp.lists.native.tabs[tabData.id]=tab;return tab;}};}function empty(s){if(s=='0'||s=='false')return'';if(!Boolean(s))return'';return s;}function each(ob,fun){if(!Boolean(ob)||_typeof(ob)!=='object'){throw new Error('not an object for .each()');}for(var _i2 in ob){fun(_i2,ob[_i2]);}return ob;}function extend(ob,ob2,evenIfFalse){if(!ob&&evenIfFalse)ob={};if(!ob2&&evenIfFalse)ob2={};if(!Boolean(ob)||_typeof(ob)!=='object'){ob={};}ob=Object.assign(ob,ob2);return ob;}function safeName(n){if(!n)throw new Error('safe name cant be nothing');if(n.includes(' ')){n=n.split(' ');n.forEach(function(part){part.toUpperCase();});n=n.join('');}n=n.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(camelCaseMatch,i){if(+camelCaseMatch===0)throw new Error('camel case failed');return i===0?camelCaseMatch.toLowerCase():camelCaseMatch.toUpperCase();});return n.charAt(0).toUpperCase()+n.slice(1);}function objToStr(obj){var ret='{';for(var k in obj){var v=obj[k];if(typeof v==='function'){v=v.toString();}else if(_instanceof(v,Array)){v=JSON.stringify(v,null,4);}else if(_typeof(v)==='object'){v=objToStr(v);}else{v="\"".concat(v,"\"");}ret+="\n  ".concat(k,": ").concat(v,",");}ret+='\n}';return ret;}function pathIndex(obj,path,value,limiter){if(!limiter)limiter='/';var r=false;if(typeof path=='string'){if(path.startsWith(limiter)){path=path.substring(1);}if(path.endsWith(limiter)){path=path.substring(0,path.length-1);}if(path==''||path.trim()==''){return obj;}r=pathIndex(obj,path.split(limiter),value);}else if(path.length==1&&value!==undefined){try{r=obj[path[0]]=value;}catch(err){throw new Error('Property \''+path[0]+'\' in path '+path.join(limiter)+' is invalid');}}else if(path.length==0){r=obj;}else try{r=pathIndex(obj[path[0]],path.slice(1),value);}catch(er){throw new Error('Property \''+path[0]+'\' in path '+path.join(limiter)+' is invalid');}if(r===undefined)r=false;return r;}function escapeHTML(text){return text.replace(/\&/g,'&amp;').replace(/\</g,'&lt;').replace(/\>/g,'&gt;');}function eachLayout(toDo){var promises=[];each(warp.lists.user.layouts,async function(i,layout){promises.push(toDo(layout));});return Promise.all(promises);}function rand(min,max){if(!min)min=1;if(!max)max=10000000;return Math.floor(Math.random()*(max-min+1)+min);}function toTitleCase(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});}function rectContains(rect,x,y){return rect.x<=x&&x<=rect.x+rect.width&&rect.y<=y&&y<=rect.y+rect.height;}function functionConsoleItem(obj,funName,_commit){var ref=obj[funName];if(!ref)ref=function ref(file){};return warp.gui.item(obj[funName],{'text':funName+' function','brands':['Function'],'confirmText':'Replace '+funName+' function?','confirm':function confirm(newFun){obj[funName]=newFun;obj.manager.needsUpdate();},'click':function click(e){warp.edit({'name':funName+' function','type':'js','drive':false,'path':funName+' function',data:ref.toString(),commit:function commit(file){eval("\n                                 obj[funName] = ".concat(file.data,"\n                                "));_commit(file);}});}});}function editorItem(arg){arg=extend({object:null,prop:null,brand:'Function',type:'js',commit:false,text:arg.prop+' editor item'},arg);var reference=arg.object[arg.prop];return warp.gui.item(reference,{'text':arg.text,'brand':arg.brand,'confirmText':'Replace '+arg.prop+' function?','confirm':function confirm(droppedData){arg.object[arg.prop]=droppedData;},'click':function click(e){warp.edit({'name':arg.text,'type':arg.type,'drive':false,'path':arg.text,data:arg.object[arg.prop].toString(),commit:function commit(file){var newData;eval(" newData= ".concat(file.data,";"));arg.object[arg.prop]=newData;if(arg.commit)arg.commit(file);}});}});}function formatBytes(bytes){var decimals=2;if(!+bytes)return'0 Bytes';var k=1024;var dm=decimals<0?0:decimals;var sizes=['B','KB','MB','GB','TB'];var i=Math.floor(Math.log(bytes)/Math.log(k));return"".concat(parseFloat((bytes/Math.pow(k,i)).toFixed(dm))," ").concat(sizes[i]);}var api,toJson,fromJson;function User(){Object.assign(this,new App({name:'user'}));var app=this;this.afterLogin=function(userData){if(userData){main.data.user=userData;gui.storage('user.prefs',warp.un.json(userData.preferences));delete userData.preferences;gui.storage('user',userData);gui.storage('version',main.envVars.version);localStorage.setItem('userId',userData.profile.id);}else{userData=gui.storage('user');if(!userData){error('no user data provided, but you seem to be logged in...stoping Home load. <br> Try clearing your browwsers history and log in again.');return;}main.data.user=userData;}app.private=new WarpDrive({name:'Private',path:'/',url:'storage/profiles/privateDrive.php'});app.private.auth('user','user').then(function(){new Warp.Drive.App({drive:app.private});});app.public=new WarpDrive({name:'Public',path:'/',url:'storage/profiles/publicDrive.php'});app.public.auth('user','user').then(function(){new Warp.Drive.App({drive:app.public});});if(!userData.active){app.log('user account is not active');main.setup.show();return;}if(!userData.confirmed){setTimeout(function(){$('.warp .main').style.display='none';},200);app.log('user account is not confirmed');alert("\n            Your user account e-mail is not confirmed!\n            <br>\n            Please find Account Confirmation e-mail in your inbox and click on the activation link to continue...\n            <br>\n            You will be automaticaly logged out, please log in when the account is confirmed!\n            ");setTimeout(function(){main.account.logOut();},5000);return;}if(document.querySelector('.wp-site-blocks')){warp.dom.remove(document.querySelector('.wp-site-blocks'));warp.dom.remove(document.querySelector('.skip-link'));var css=document.querySelector('head .win-sizes');document.querySelector('head').innerHTML="\n                    <meta charset=\"UTF-8\" />\n    <title>Bemjax</title>\n    <meta name=\"title\" content=\"Bemjax\" />\n    <meta name=\"description\" content=\"A technology research lab invested in human data relationship\" />\n    <meta name=\"keywords\" content=\"\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0,\n    user-scalable=no\" />\n    <meta name=\"application-name\" content=\"Warp\" />\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n    <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"resources/favicon/apple-touch-icon.png\">\n    <link rel=\"mask-icon\" href=\"resources/favicon/safari-pinned-tab.svg\" color=\"#3498db\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"resources/favicon/favicon-32x32.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"resources/favicon/favicon-16x16.png\">\n    <link rel=\"shortcut icon\" href=\"resources/favicon/favicon.ico\" />\n    <meta name=\"msapplication-TileColor\" content=\"rgb(5, 5, 5)\" />\n    <meta name=\"msapplication-config\" content=\"resources/favicon/browserconfig.xml\">\n    <meta name=\"theme-color\" content=\"rgb(5, 5, 5)\" />\n    <link rel=\"manifest\" href=\"manifest.json\" />\n    <link rel=\"stylesheet\"  href=\"https://bemjax.com/cdn/production/warp.css\">\n    <link rel=\"stylesheet\" class=\"dark\" href=\"https://bemjax.com/cdn/production/dark.skin.css\">\n                \n                ";document.querySelector('head').append(css);document.querySelector('body').setAttribute('class',' ');}if(document.querySelector('.warp .page')){warp.dom.remove(document.querySelector('.warp .page'));}var contacts=warp.un.json(userData.profile.contacts);if(!contacts['push'])contacts=Object.values(contacts);warp.factory.Drive=Warp.Drive;warp.user.drive=new WarpDrive({url:'drive/',debug:false,name:'User'});warp.user.drive.auth('guest','guest').then(function(){var driveApp=new warp.user.drive.App({drive:warp.user.drive});});contacts.push(userData.id);api('profiles/read',{id:contacts}).then(function(profiles){profiles.forEach(function(profile){gui.storage('profiles.'+profile.id,profile);});main.home=new Home();var expDate=gui.storage('user').expires;function hasExpired(){if(main.date.tense(expDate)<0){return true;}return false;}if(hasExpired()){setTimeout(function(){$('.warp .main').style.display='none';},200);app.log('user account expired');toast("Your account expired  <button class=\"m10 primary xs\" onclick=\"main.account.logOut()\">Logout</button>",0);alert("\n                Your user account has expired on ".concat(main.date.format(expDate),"!\n                <br>\n                Please make a payment in Billing to prolong Your subscription period and continue using this app.\n                <br>\n                <br>\n                <button class=\"primary\" onclick=\"warp.gui.confirm.hide();main.billing.show()\">Billing</button>\n                \n            "));setInterval(function(){if(!main.billing.win.visible())main.billing.show();main.home.win.hide();main.menu.hide();},2000);}});};this.notify=function(title,body,onclick,args){try{app.notifications.show({title:title,body:body},onclick,args);}catch(e){}try{if(main.serviceWorker.registration.showNotification)main.serviceWorker.notify(title,{tag:'notification-for-message',data:{title:title,body:body}});}catch(e){}try{chrome.webview.postMessage(toJson({method:'Notify',args:[title]}));}catch(e){}};this.notifications={list:[],id:0,compatible:function compatible(){if(typeof Notification==='undefined'){toast('Notifications are not available for your browser.');return false;}return true;},authorize:function authorize(){if(app.notifications.compatible()){Notification.requestPermission(function(permission){});}},show:function show(data,onclick,args){if(typeof Notification==='undefined'){return;}if(app.notifications.compatible()){app.notifications.id++;var id=app.notifications.id;app.notifications.list[id]=new Notification(data.title,{body:data.body,tag:id,icon:'../resources/images/logo.svg',lang:'',dir:'auto'});app.notifications.list[id].onclick=function(){if(onclick)onclick([args,id]);};app.notifications.list[id].onshow=function(){app.log(id+'showed');};app.notifications.list[id].onerror=function(){app.log(id+'errored',1);};app.notifications.list[id].onclose=function(){console.log(id,'closed');};return app.notifications.list[id];}}};if('Notification'in window){if(Notification.permission!='granted'){Notification.requestPermission(function(permission){});}}}var appTypes={'Constructor':{description:' just initialises the apps constructor, doesnt create a window, all logic is inside app. used to run current mobile sized apps '},'App':{description:'just initialises the apps constructor, creates a mobile sized window'},'Inspector':{description:'small sized window, implemens .inspect and init methods, suiatble for Vector inspection'}};var constructors={Profile:{'id':'100000001','user':'pozder.dario@gmail.com','parent':'000000000','cca3':'','members':[],'memberOf':[],'contacts':[],'prefix':'','name':'','about':'','slug':'','type':0,'public':0,'deleted':0,'lat':'','lng':'','address1':'','address2':'','nr':'','zip':'','city':'','vat':'','logo':'','country':'','web':'','email':'','phone':''},App:{name:'Test',brands:[],deps:[],inspect:function inspect(subject){},init:function init(){},clean:function clean(){}},Layout:{name:'',type:'',deps:[],apps:{},brands:{},fileTypes:{},events:{beforeLoad:function beforeLoad(fileData){},onLoad:function onLoad(fileData){}}},Brand:{name:'Test',short:'Test',description:'this is a test brand',family:'Object',colors:{body:{bg:'navy',color:'lightgrey'},label:{bg:'darkorange',color:'lightgrey'}},toJson:false,fromJson:false,item:false,display:false,test:function test(subject){}},FileType:{type:'test',mode:'json',color:'rgb(122,100,110)',mime:'application/json',open:false,edit:false,commit:false,save:false},File:{'name':'name','type':'file extension, jpg for example','commit':'custom commit','mode':'force custom editing mode on this file, disregard fileType definition mode','data':null,'path':'','drive':false,'size':false},Folder:{'name':'name','type':'folder','path':'','size':false,'drive':'drive','changed':false,'loaded':false},Gui:{App:{},Layer:{},Window:{},Display:{Graphics:{},DOM:{},HTML:{}}},Drive:{Http:{'url':''},Profile:{'url':'','profile':'profileId'}},Item:{el:'element to be used for item, overides default item el',data:null,text:'caption of the item',click:function click(data){},brands:['forced','brands','if','any'],brand:'forced',confirm:'gets passed to slot',confirmText:'passed to slot',recive:function recive(data){},buttons:{'x':function x(){}},badges:{'!':'This has changed'},context:{},commit:function commit(){}},Thread:{'code':false,'allowConcurent':false,'shared':false,'module':false},Message:{'id':'index of the message in the list','type':'type','reference':'reference','data':'data','date':'','profile':'profile thats posting the message','as':'.profile alias, as owner of a team for example','attachments':[{'data':'brand.toJson()','text':'something about the attachment'}]},News:{},TabOptions:{'id':'tab id','url':'','ready':'','active':'','favicon':'','title':'','winId':'','back':'','forward':''},Tab:{'id':'tab id','el':'dom el of the tab','url':'','ready':'','active':'','favicon':'','title':'','win':'','hide':async function hide(){},'show':async function show(){},'destroy':async function destroy(){},'eval':async function _eval(){},'back':async function back(){},'forward':async function forward(){},'navigate':async function navigate(url){},'agent':async function agent(_agent2){}}};Warp.create=async function(usrOpts){async function instance(options){var warp={};warp.constructors={check:function checkPropNames(constructorName,propObj){each(propObj,function(propName,data){if(!Object.keys(warp.constructors.list[constructorName]).includes(propName)&&propName!=='manager'){throw new Error('Property '+propName+' is not an allowed property of '+constructorName+' constructor');}});},required:function required(constructorName){var final={};var list=warp.constructors.requiredList[constructorName];list.forEach(function(propName){final[propName]=warp.constructors.list[constructorName][propName];});return final;},list:constructors,requiredList:{Profile:['parent','members','memberOf','name','type'],App:['name','brands'],Layout:['name'],Brand:['name','short','family','description','test','colors'],FileType:['type','mime','color'],File:[],Folder:[],Item:[],Slot:[],Gui:{App:[],Layer:[],Window:[],Display:{Graphics:[],DOM:[],HTML:[]}},Drive:{Object:[],HTTP:[]}}};warp.lists={tickers:{},blockers:{},events:{},instances:{},doFunctions:{'loadJS':function loadJS(url){return new Promise(function(resolve,reject){if(warp.dom){var scrEl=document.querySelector('[src=\''+url+'\']');if(scrEl){scrEl.parentNode.removeChild(scrEl);}var _rand=Math.floor(Math.random()*10001);scrEl=document.createElement('script');scrEl.setAttribute('src',url);scrEl.setAttribute('async','true');scrEl.setAttribute('defer','true');scrEl.setAttribute('crossorigin','anonymous');scrEl.addEventListener('load',function(){resolve(true);});scrEl.addEventListener('error',function(e){reject(e);});warp.dom.scriptsEl.appendChild(scrEl);}else{fetch(url,{method:'GET'}).then(function(response){return response.text();}).then(function(result){eval(result);resolve(true);});}});},'don':function don(jsObj){return JSON.stringify(jsObj,function(key,value){if(typeof value==='function'){return'@function:'+value.toString();}return value;},4);},'json':function json(jsObj){return JSON.stringify(jsObj,function(key,value){if(typeof value==='function'){return'@function:'+value.toString();}return value;},4);}},unFunctions:{'loadJS':function loadJS(url){return new Promise(function(resolve,reject){for(var ind in document.scripts){var script=document.scripts[ind];if(script.src==url){delete document.scripts[ind];warp.log(url+' removed',0,'un.loadJS');}}resolve(true);});},'json':function json(jsonString){return JSON.parse(jsonString,function(key,value){if(typeof value==='string'){if(value.startsWith('/Function(')&&value.endsWith(')/')){value=value.substring(10,value.length-2);return eval('('+value+')');}if(value.startsWith('@function:')){value=value.substring(10,value.length);return eval('('+value+')');}if(value.startsWith('@import:')){}}return value;});},'don':async function don(jsonString){var parsed=JSON.parse(jsonString);async function processValue(value){if(typeof value==='string'){if(value.startsWith('@function:')){var functionString=value.substring(10);return eval('('+functionString+')');}if(value.startsWith('@import:')){var url=value.substring(8);var response=await fetch(url);var text=await response.text();return await warp.un.json(text);}}return value;}async function processObject(obj){var keys=Object.keys(obj);for(var _i3=0,_keys=keys;_i3<_keys.length;_i3++){var key=_keys[_i3];if(typeof obj[key]==='string'){obj[key]=await processValue(obj[key]);}else if(obj[key]!==null&&_typeof(obj[key])==='object'){obj[key]=await processObject(obj[key]);}}return obj;}return await processObject(parsed);}}};warp.user=new User();warp.lists.user={layouts:{},apps:{},brands:{},fileTypes:{},files:{},drives:{},history:[],bots:{},searches:{}};warp.name=options.name;warp.debug=options.debug;warp.clipboard={write:async function write(data){return await navigator.clipboard.writeText(data);},read:async function read(){return await navigator.clipboard.readText();}};warp.native=window.native;warp.log=function(txt,lev,app){var n=warp.name+'.';if(!app){n=warp.name;app='';}if(warp.debug===true){if(lev){console.error(n+app+' : ',txt);}else{console.log(n+app+' : ',txt);}return;}if(warp.debug==='errorsSilent'){if(lev){console.log(n+app+' silentError: ',txt);}return;}};warp.on=function(type,listener){if(type.includes(',')){var arr=type.split(',');arr.forEach(function(t){warp.on(t.trim(),listener);});}if(!warp.lists.events[type]){warp.lists.events[type]=[listener];}else{warp.lists.events[type].push(listener);}var ob={};ob[type]=listener;warp.trigger('eventHandlerAdded',ob);};warp.off=function(type,listener){warp.lists.events[type].forEach(function(fun,ind){if(listener==fun){warp.lists.events[type].splice(ind,1);}});};warp.trigger=function(eventType,data){var events=warp.lists.events[eventType];if(events){if(events[0])events.forEach(function(fun){return fun(data);});}};warp.create=async function(obj){};warp.remove=async function(obj){if(obj.manager){var man=obj.manager;if(typeof man=='string')man=await warp.layout(obj.manager);man.remove(obj);}else error('Cant remove, no manager/layout reference in the object!');};warp.invoke=function(className,methodName,args){return warp.native.invoke(className,methodName,args);};warp.fetch=function(url){if(warp.native)return warp.native.fetch(url);return fetch(url);};warp.get=warp.fetch;warp.isOpen=function(file){var drive;if(file.drive){drive=file.drive.name;}else drive='consoles';if(!warp.lists.user.files[drive]){return false;}if(!warp.lists.user.files[drive][file.path]){return false;}return warp.lists.user.files[drive][file.path];};warp.open=async function(file){var drive;if(file.drive){var readAs='text';if(['jpg','png','warp','jpeg','mpg','mp3','mp4','mpeg','pdf','zip','7z','rar','doc','xls','docx','xlsx','webm','webp'].includes(file.type))readAs='arrayBuffer';file.data=await file.drive.read(file.path,readAs);drive=file.drive.name;}else drive='consoles';if(!warp.lists.user.files[drive])warp.lists.user.files[drive]={};warp.lists.user.files[drive][file.path]=file;warp.trigger('fileListChanged',warp.lists.user.files);return file;};warp.save=async function(file){if(!file.drive){var path=await input(file.name,'Path for Private drive');file.drive=warp.user.private;file.path=path;}var res=await file.drive.write(file.path,file.data);toast(file.name+' <br> saved!');file.changed=false;return res;};warp.edit=async function(file){var open=warp.isOpen(file);if(!open){file=await warp.open(file);}else file=open;var type=warp.lists.user.fileTypes[file.type];warp.trigger('fileEdited',file);if(type){var thereIsSomething;if(type.edit){thereIsSomething=true;type.edit(file);}if(type.mode&&!thereIsSomething){thereIsSomething=true;warp.editor.edit(file);}if(!thereIsSomething){confirm('File type doesnt have a mode or edit function but the mime type could be json,  edit as JSON?',function(){warp.editor.edit(file);warp.editor.mode('json');});}else warp.inspect(file);}else confirm('File type doesnt exist, treat as text and edit?',function(){warp.editor.edit(file);});};warp.close=async function(file){var listName;if(file.drive){listName=file.drive.name;}else listName='consoles';if(warp.editor.file.path==file.path&&warp.editor.file.drive==file.drive){warp.editor.hide();warp.editor.file=null;}if(warp.lists.user.files[listName][file.path]){delete warp.lists.user.files[listName][file.path];warp.trigger('fileListChanged',warp.lists.user.files);}return;};warp.delete=async function(file){var o=warp.isOpen(file);if(o){confirm('Delete '+file.path+'?',async function(){await warp.close(o);if(file.drive){return file.drive.delete(file.path);}});}};warp.commit=async function(file){if(file.data){if(file.commit){try{file.commit(file);}catch(err){warp.inspect(err);throw new Error('Custom commit function failed on file : '+file.name+' with error '+err);}return;}else{var listName;if(file.drive){listName=file.drive.name;}else listName='consoles';if(!warp.lists.user.files[listName]){file=await warp.open(file);}if(warp.lists.user.fileTypes[file.type].commit){try{warp.lists.user.fileTypes[file.type].commit(file);}catch(err){warp.inspect(err);throw new Error('FileType '+file.type+' commit function failed on file : '+file.name+' with error '+err);}return;}}}else toast('File data is not loaded, load the file to commit');};warp.download=async function(file){function downloadBlob(blob,name){var blobUrl=URL.createObjectURL(blob);var link=document.createElement('a');link.href=blobUrl;link.download=name;document.body.appendChild(link);link.dispatchEvent(new MouseEvent('click',{bubbles:true,cancelable:true,view:window}));document.body.removeChild(link);}if(file.drive){var blob=await file.drive.read(file.path,'blob');downloadBlob(blob,file.name);}else{if(file.data){var _blob=new Blob([file.data]);downloadBlob(_blob,file.name);}else throw new Error('file has no drive and data present');}};warp.upload=async function(drive,path){var input=document.createElement('input');input.type='file';input.onchange=async function(e){var file=e.target.files[0];var buff=await file.arrayBuffer();var type=file.name.split('.')[1];if(path){if(!path.endsWith('/'))path=path+'/';}else path='';var f={name:file.name,path:path+file.name,type:type,drive:drive};await drive.write(f.path,buff,'arrayBuffer');return warp.edit(f);};input.click();};warp.file=async function(data,options){warp.constructors.check('File',options);if(_instanceof(data,Blob)){data=await data.text();if(!options)return warp.console.file(data,{type:'get the type from mime, create a function fro this'});if(!options.path&&options.drive)throw new Error('We need a path in options to create a file from blob and drive ');}if(typeof data=='string'){if(data.startsWith('https')){data=await fetch(data);data=await data.text();}}var f=new Warp.File(data,options);warp.constructors.check('File',f);return f;};warp.app=async function(arg){if(_typeof(arg)==='object'){if(arg.manager){if(typeof arg.manager==='string')arg.manager=await warp.layout(arg.manager);return await arg.manager.app(arg.name,arg);}else return await warp.lists.user.layouts[0].app(arg.name,arg);}else{var foundManager=false;var appName=arg;if(arg.includes('.')){var manName=arg.split('.')[0];appName=arg.split('.')[1];if(!warp.lists.user.layouts[manName]){error('No layout with name '+manName+' loaded');return false;}else foundManager=warp.lists.user.layouts[manName];}each(warp.lists.user.layouts,function(i,manager){if(!foundManager&&manager.data.apps[appName]){foundManager=manager;}});if(foundManager){if(!foundManager.data.apps[appName]){error('Layout '+foundManager.name+' does not contain app '+appName);}else return await foundManager.app(appName);}else error('No manager loaded');}};warp.brand=async function(arg){if(_typeof(arg)==='object'){if(arg.manager){if(typeof arg.manager==='string')arg.manager=await warp.layout(arg.manager);return await arg.manager.brand(arg.name,arg);}else return await warp.lists.user.layouts[0].brand(arg.name,arg);}else{var man=false;eachLayout(async function(layout){if(!man&&layout.forwardOriented[arg])man=layout;});if(man)return man.forwardOriented[arg];return false;}};warp.fileType=async function(arg){if(_typeof(arg)==='object'){if(arg.manager){if(typeof arg.manager==='string')arg.manager=await warp.layout(arg.manager);return await arg.manager.fileType(arg.type,arg);}else return await warp.lists.user.layouts[0].fileType(arg.name,arg);}else{var man=false;eachLayout(async function(layout){if(!man&&layout.data.fileTypes[arg])man=layout;});if(man)return man.data.fileTypes[arg];return false;}};warp.layout=async function(arg){if(_typeof(arg)==='object'){toast('not implemented');return;}else{var man=false;eachLayout(async function(layout){if(!man&&layout.data.name==arg)man=layout;});return man;}};warp.drive=async function(arg){if(_typeof(arg)==='object'){if(warp.lists.user.drives[arg.type+'-'+arg.name]&&warp.lists.user.drives[arg.type+'-'+arg.name].token)return warp.lists.user.drives[arg.type+'-'+arg.name];var cons=arg.type+'Drive';var drive;eval("drive = new ".concat(cons,"(").concat(warp.do.json(arg),") "));await drive.auth(arg.username,arg.password);return drive;}else if(warp.lists.user.drives[arg])return warp.lists.user.drives[arg];throw new Error('cant create drive from '+warp.do.json(arg));};warp.scope=async function(){var x=new Warp.Number(10);var timeCreated=Date.now();alert(x.at(timeCreated));alert(x.at(Date.now()));x=4;alert(x.at(timeCreated));alert(x);alert(x.at(timeCreated));var timeChanged=Date.now();alert(x.at(timeChanged));alert(x.at(timeChanged+1000000));alert(x.at(timeCreated-1000));alert(x.at(timeCreated+1));x=15;alert(x.at(now+second));};warp.bot=async function(){};warp.list=async function(name,prop,value){if(value!==undefined)warp.lists[name][prop]=value;return;if(prop!==undefined)return warp.lists[name][prop];if(name!==undefined)return warp.lists[name][prop];return warp.lists;};warp.explicit=async function(name,subject){var app=await warp.app(name);app.explicit(subject);};warp.inspected=null;warp.test=function(subject){if(subject===null){return{'Null':['null']};}if(subject===undefined){return{'Undefined':['undefined']};}var totalA=performance.now();var positives={};var results={};var a,b;var family=Object.prototype.toString.call(subject).slice(8,-1);if(subject!==null||subject!==undefined||subject!==false||subject!==''){try{if(subject.namespaceURI){if(subject.namespaceURI=='http://www.w3.org/1999/xhtml'){family='HTMLElement';}else{family='SVGElement';}}}catch(e){throw e;return;}}if(!warp.lists.user.brands[family]){confirm("This family :  ".concat(family," is not in the brands list...\n                do you want to add it to brand types?"),function(){warp.lists.user.brands[family]=[{test:function test(subject){return false;},'name':family+' family','short':family,colors:{'caption':'rgb(215,169,239)','bg':'rgb(42,63,115)','labelCaption':'rgb(238,224,239)','labelBg':'rgb(138,138,138)'}}];});}positives[family]=[];results['Prototype']=[family,b-a];var _loop=function _loop(_name){var item=warp.lists.user.brands[family][_name];a=performance.now();testResult=null;try{testResult=item.test(subject);}catch(err){confirm("\n                    <small>\n                        Test function failed for brand ".concat(_name,"!\n                        <br>\n                        ").concat(err.message,"\n                        <br>\n                        The test function code is opened in the console, execute it to update after editing the errors\n                        <br>\n                        Remove brand ").concat(_name," from layout for this session?\n                    </small>"),function(){delete warp.lists.user.brands[family][_name];});warp.console.show(item.test.toString());}b=performance.now();if(testResult){positives[family].push(_name);}results[_name]=[testResult,b-a];};for(var _name in warp.lists.user.brands[family]){var testResult;_loop(_name);}warp.lastTestResults=[results,b-totalA];return positives;};warp.inspect=function(subject){if(warp.vector.paused)return;if(warp.vector.win){warp.vector.win.show();warp.vector.process(subject);}warp.inspected=subject;console.log(subject);};warp.is=async function(subject,brandNames){var found=false;if(Array.isArray(brandNames)){for(var ind in brandNames){var brand=warp.brands(brandNames[ind]);if(!brand)return;found=brand.test(subject);}return found;}else{var brand=await warp.brand(brandNames);if(!brand)return false;found=brand.test(subject);return found;}};warp.parse=function(string){};warp.try=function(code){function ScopeConstructor(code){var window=undefined;var warp=undefined;var gui=undefined;try{this.scope=eval(code);}catch(error){error(error);}this.warp={desc:'scope object',type:'scope'};return this;}return new ScopeConstructor();};warp.reset=function(){if(!window.parent){alert('Cant reset in this mode, no parent..., going for reboot..');warp.reboot();return;}confirm('Reset?',function(){if(warp.vector){window.parent.vector=warp.vector;warp.vector.okToRestart=true;}location.reload();});};warp.reboot=function(stage){confirm('Really, reboot?',function(){if(warp.vector){warp.vector.okToRestart=true;}location.reload();});};warp.shutdown=function(){function shutdown(){if(window.native){chrome.webview.postMessage('close');}else{open(location,'_self').close();}}if(main.envVars.loggedIn){confirm('Log out and close the app?',function(){main.account.logOut().then(shutdown);});}else shutdown();};warp.console={file:async function file(data,options){options=extend({type:'js',name:'Console -'+Math.random(),mode:false,commit:false,brand:false},options,true);if(!data)data=' ';var f=await warp.file({data:data,type:options.type,commit:options.commit,drive:false,path:options.path,name:options.name});if(f.type=='js'){f.commit=function(){gui.storage('console',warp.do.json(f.data));options.commit(f);};}warp.edit(f).then(function(file){if(options.mode)warp.editor.mode(options.mode);});return f;},item:function item(data,brand,options){},show:function show(code){if(!code)code=warp.un.json(gui.storage('console'));var name='CONSOLE - '+rand(100,999)+'.js';warp.edit({name:name,drive:false,data:code,type:'js',path:name,commit:function commit(file){gui.storage('console',warp.do.json(file.data));warp.eval(file.data);}});},hide:function hide(){warp.editor.hide();}};warp.eval=function(code){var limits="\n                //limit access to outside vars\n                let window = undefined;\n                let document = undefined;\n                let inspect = warp.inspect;\n\n                //shorthand user drive methods\n                let drive = warp.user.drive;\n                ";try{eval("\n                        ".concat(limits,"\n                        //wrap it in async so we can use top level 'await' in console code\n                        async function consoleEval(){\n                        ").concat(code,"\n                        }\n                        consoleEval();\n                        "));}catch(err){warp.inspect(err);throw new Error('Warp.console.eval failed with error '+err);}};warp.load=function(subject,type){if(Array.isArray(subject)){var loadScripts=async function loadScripts(list,useSync){if(!Array.isArray(list)){throw new Error('Invalid input in warp.load');}try{if(useSync){await Promise.all(list.map(function(url){return warp.do.loadJS(url);}));}else{var _iterator4=_createForOfIteratorHelper(list),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var url=_step4.value;await warp.do.loadJS(url);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}return true;}catch(error){throw error;}};return loadScripts(subject);}if(typeof subject=='string')return warp.do.loadJS(subject);return warp.do['load'+type](subject);};warp.unload=function(subject,type){return warp.un['load'+type](subject);};warp.tab=async function(url,options){options=extend({width:600,height:600},options,true);if(warp.native){if(typeof url=='string'){if(url.startsWith('ar://')||url.startsWith('web3://')||url.startsWith('https://')||url.startsWith('http://')){var tabId,winId;if(options){tabId=options.id;winId=options.win;}return warp.native.tab(url,winId,tabId);}else{if(!tabs[url]){throw new Error('Tab "'+url+'" does not exist ');}return new Tab(tabs[url]);}}else{return warp.native.tab(url.url,url.win,url.id);}}else{return window.open(url,'newwindow','width='+options.width+', height='+options.height+'');}};warp.tick={fps:function fps(speed){}};warp.do={};warp.un={};var _loop2=function _loop2(_name2){if(warp.do[_name2]){log(new Error('warp.do '+_name2+' function is ovwerrruning something in dom'));}warp.do[_name2]=function(arg1,arg2){return warp.lists.doFunctions[_name2](arg1,arg2);};};for(var _name2 in warp.lists.doFunctions){_loop2(_name2);}var _loop4=function _loop4(_name4){if(warp.un[_name4]){log(new Error('warp.un '+_name4+' function is ovwerrruning something in dom'));}warp.un[_name4]=function(arg1,arg2){if(arg2===undefined){return warp.lists.unFunctions[_name4](arg1);}else{return warp.lists.unFunctions[_name4](arg1,arg2);}};};for(var _name4 in warp.lists.unFunctions){_loop4(_name4);}warp.on('warp.ready',function(instance){warp.log(' instance\''+instance.name+'\' of Warp is ready');});warp.factory=new Warp.Factory();warp.gui=new Warp.Gui(warp);warp.sound=new Warp.Sound();warp.editors=new Warp.Editors(warp);window.addEventListener('error',function(event){if(!window.error)return warp.log(event.message,1);error(event.message,event.error,'onError');event.preventDefault();});window.onunhandledrejection=function(event){if(!window.error)return warp.log(event.message,1);error(event.reason.message,event.reason.stack,'promise rejection');event.preventDefault();};if(options.api)warp.api=new Warp.Api(options.api,warp);if(options.css){warp.css=Warp.css;warp.css[options.css]('body');}warp.trigger('warp.ready',warp);if(options.vector){warp.vector=new Warp.Vector();}if(options.drive){warp.drive=new WarpDrive(options.drive);}warp.threads=new Warp.Threads();warp.thread=warp.threads.create;window[options.name]=warp;Warp.instances[warp.name]=warp;if(options.editor)warp.editor=new Warp.Editor();return warp;}var options=extend({name:'warp',api:{url:'../'},debug:false,css:false,vector:false,editor:true},usrOpts,true);if(options.name=='warp'&&Warp.instances['warp']){options.name='warp'+Object.keys(Warp.instances).length;console.log('warp instance with same name exists, renaming to : "'+options.name+'"');}return instance(options);};Warp.Gui=function Gui(_w,options){options=extend({speedFactor:1,scaleFactor:1,clientSizeAffectsScale:0,debug:true},options);this.options=function(prop,val){if(val===undefined)return options[prop];options[prop]=val;};var _gui=this;_gui.warp=_w;window.gui=this;this.framerate=100;this.winSize={width:360,height:616};_w.dom=new Warp.Dom(_w);function Picker(){var selectPromise,interval,selectedColor,input,trigger;var app=Object.assign(this,new App({layer:_gui.layers.blockers,name:'ColorPicker',propOf:_gui,winOpts:{close:false,bottomClose:false,layer:_gui.layers.blockers,headless:false,width:235,height:360,scrollable:false,backdrop:true,beforeShow:function beforeShow(w){},onHide:function onHide(w){if(interval){clearInterval(interval);}}}}));app.el.innerHTML="\n        <input type=\"color\" value=\"\" style=\"width:100%; border:none; padding:0px; background: none;\" class=\"trigger xs block\"/>\n        <input type=\"text\" value=\"\" style=\"width:100%; margin:0px; position:absolute; bottom:0px\" class=\"col lg tc tlg block\"/>\n        <button class=\"xs primary m5 \" style=\"margin:0px; position:absolute; right:5px; bottom:5px\">OK</button>\n        ";app.event(app.query('button'),'click',function(){selectedColor=input.value;});input=app.query('.col');trigger=app.query('.trigger');app.event(trigger,'input',function(e){input.value=this.value;input.select();});app.select=async function(color,x,y){if(x)app.win.x(x);if(y)app.win.y(y);input.value=color;trigger.value=color;if(interval){clearInterval(interval);selectPromise=false;}await app.show();setTimeout(function(){trigger.click();},150);selectPromise=new Promise(function(resolve,rej){interval=setInterval(function(){if(selectedColor){clearInterval(interval);resolve(selectedColor);selectedColor=false;app.hide();}},200);});return selectPromise;};}function Scaler(){var scaler=this;var mainDraggable;var el=_w.dom.node('div',{},{class:'scaler hidden'});var options={};var defaultOptions={'onScale':function onScale(rect){toast(toJson(rect));},'hideOnLeave':true,'allowMove':false};Object.assign(scaler,{rect:{},show:function show(rect,oneTimeOpts){scaler.hide();options=defaultOptions;if(oneTimeOpts){Object.assign(options,oneTimeOpts);}if(!rect)throw new Error('gui.scaler needs a Rect as argument');if(scaler.visible)return;_w.dom.show(el);scaler.set(rect);if(!options.allowMove){mainDraggable.disable();el.style.background='rgba(200,200,200,0)';}else{el.style.background='rgba(200,200,200,0.2)';mainDraggable.enable();}scaler.visible=true;},set:function set(data){TweenMax.set(scaler.rect,data);delete scaler.rect['_gsap'];gsap.to(el,{duration:0,height:parseInt(scaler.rect.height),width:parseInt(scaler.rect.width),x:parseInt(scaler.rect.x),y:parseInt(scaler.rect.y)});options.onScale(scaler.rect);},hide:function hide(){if(!scaler.visible)return;scaler.visible=false;_w.dom.hide(el);},init:function init(){el.innerHTML="\n  <div class=\"long right\"></div>\n  <div class=\"long bottom\"></div>\n  <div class=\"long top\"></div>\n  <div class=\"long left\"></div>\n  <div data-clickable=\"true\" class=\"bottomRight\"></div>\n  <div data-clickable=\"true\" class=\"topLeft\"></div>\n  <div data-clickable=\"true\" class=\"topRight\"></div>\n  <div data-clickable=\"true\" class=\"bottomLeft\"></div>\n";_gui.el.append(el);mainDraggable=new Draggable(el,{onDrag:function onDrag(e){e.preventDefault();if(options.allowMove)scaler.set({x:this.x,y:this.y});}});var isScaling=false;var rightLastX=0;var rightDraggable=new Draggable(document.createElement('div'),{trigger:'.right, .topRight, .bottomRight',onDrag:updateRight,onPress:function onPress(){rightLastX=this.x;isScaling=true;mainDraggable.disable();},onRelease:function onRelease(){isScaling=false;if(options.hideOnLeave&&!isScaling)scaler.hide();if(options.allowMove)mainDraggable.enable();}});function updateRight(){var diffX=this.x-rightLastX;scaler.set({width:'+='+diffX});rightLastX=this.x;}var bottomLastY=0;var bottomDraggable=new Draggable(document.createElement('div'),{trigger:'.bottom, .bottomRight, .bottomLeft',onDrag:updateBottom,onPress:function onPress(){bottomLastY=this.y;isScaling=true;mainDraggable.disable();},onRelease:function onRelease(){isScaling=false;if(options.hideOnLeave&&!isScaling)scaler.hide();if(options.allowMove)mainDraggable.enable();}});function updateBottom(){var diffY=this.y-bottomLastY;scaler.set({height:'+='+diffY});bottomLastY=this.y;}var topLastY=0;var topDraggable=new Draggable(document.createElement('div'),{trigger:'.top, .topRight, .topLeft',onDrag:updateTop,onPress:function onPress(){topLastY=this.y;mainDraggable.disable();isScaling=true;},onRelease:function onRelease(){isScaling=false;if(options.hideOnLeave&&!isScaling)scaler.hide();if(options.allowMove)mainDraggable.enable();}});function updateTop(){var diffY=this.y-topLastY;scaler.set({height:'-='+diffY,y:'+='+diffY});topLastY=this.y;}var leftLastX=0;var leftDraggable=new Draggable(document.createElement('div'),{trigger:'.left, .topLeft, .bottomLeft',onDrag:updateLeft,onPress:function onPress(){leftLastX=this.x;mainDraggable.disable();isScaling=true;},onRelease:function onRelease(){if(options.allowMove)mainDraggable.enable();isScaling=false;if(options.hideOnLeave&&!isScaling)scaler.hide();}});function updateLeft(){var diffX=this.x-leftLastX;scaler.set({width:'-='+diffX,x:'+='+diffX});leftLastX=this.x;}el.querySelectorAll('*').forEach(function(el){el.addEventListener('mouseleave',function(e){if(options.hideOnLeave)scaler.hide();});});}});scaler.init();}var pointer={dragg:function dragg(comp){this.dragged=comp;this.dragOffsetX=this.x-comp.x;this.dragOffsetY=this.y-comp.y;},dragOffsetX:0,dragOffsetY:0,dragged:false,x:0,y:0,speed:0,direction:0,b0:false,b1:false,b2:false,lastX:0,lastY:0,debug:{click:true,trail:true,context:false},data:{timestamp:null,lastMouseX:null,lastMouseY:null}};this.pointer=function(prop){if(prop)return pointer[prop];return pointer;};var popup={el:_w.dom.node('div',{},{class:'popup hidden'}),showAt:function showAt(el,html){if(popup.last!=el)popup.hide();popup.el.querySelector('.body').innerHTML=html;_gui.layers.blockers.el.prepend(popup.el);popup.el.style.pointerEvents='none';popup.el.classList.remove('hidden');var rect=el.getBoundingClientRect();var height=_w.dom.height(popup.el);var x=rect.width/2+rect.x-_w.dom.width(popup.el)/2;var y=rect.y-5-height;if(height>y)y=rect.y+rect.height+5;gsap.to(popup.el,{duration:0,opacity:0,x:x,y:y,onComplete:function onComplete(){var duration=0.2;if(popup.last==el)duration=0;gsap.to(popup.el,{duration:duration,opacity:1,onComplete:function onComplete(){popup.el.style.pointerEvents='initial';}});}});popup.last=el;},hide:function hide(){popup.el.classList.add('hidden');},target:false,last:false,timeout:false,add:function add(el,html){popup.target=el;if(popup.timeout)clearTimeout(popup.timeout);popup.timeout=setTimeout(function(){if(_w.dom.underPointer(el)){popup.showAt(el,html);el.addEventListener('mouseleave',function(){setTimeout(function(){if(!_w.dom.underPointer(popup.el))popup.hide();},200);});}else popup.hide();},1000);}};this.popup=popup.showAt;this.getCtx=function getCtx(canvas,w,h){if(!w)w=document.body.clientWidth;if(!h)h=document.body.clientHeight;canvas.style.width="".concat(w,"px");canvas.style.height="".concat(h,"px");var scale=window.devicePixelRatio;canvas.width=Math.floor(w*scale);canvas.height=Math.floor(h*scale);var ctx=canvas.getContext('2d');ctx.scale(scale,scale);return ctx;};this.scale=function scale(factor){factor=parseFloat(factor);if(factor){if(factor<0.8)return;options.scaleFactor=factor;if(main&&main.preferences)main.preferences.set('gui','scaleFactor',factor);gsap.to('.w',{scale:factor});}else return options.scaleFactor;};this.dark=function dark(state){if(state===undefined){return window.matchMedia('(prefers-color-scheme: dark)').matches;}if(state){if(!document.querySelector('link.dark')){var _dark=_w.dom.node('link',{},{class:'dark',rel:'stylesheet',href:'https://bemjax.com/cdn/development/Warp/dist/dark.skin.css'});document.querySelector('head').append(_dark);}}else{document.querySelector('head').removeChild(document.querySelector('link.dark'));}};this.speed=function speed(factor){if(factor){options.speedFactor=factor;}else return options.speedFactor;};this.log=function log(text,level){_w.log(text,level,'gui');};this.mobile=function mobile(){if(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return true;}else{return false;}};this.full=function full(state){function doit(){if(window.native){chrome.webview.postMessage('fullscreen');}else{document.documentElement.requestFullscreen();}}function undo(){if(window.native){chrome.webview.postMessage('restore');}else{document.exitFullscreen();}}if(state===undefined){var h1,h2;if(!document.fullscreenElement){if(window.native){doit();return;}h1=_w.dom.height();document.documentElement.requestFullscreen();setTimeout(function(){h2=_w.dom.height();if(h2-h1>0){}},50);}else if(document.exitFullscreen){document.exitFullscreen();}}if(state==true){doit();}if(state==false){undo();}};this.storage=function(name,val){if(val===undefined){if(!localStorage.getItem(name)){return null;}return _w.un.json(localStorage.getItem(name));}localStorage.setItem(name,_w.do.json(val));};{this.Drawer=function Drawer(text,userOpts){var opts=Object.assign({name:false,'class':'','beforeHide':false,'onHide':false,'beforeOpen':false,'onOpen':false,'onClose':false,'width':false,'height':false,'dom':false,'parent':false,'size':'xs','bg':'default2','usePrefs':false},userOpts);var drawer=this,_caption='';this.visible=false;function construct(){var serialNr=Math.random();var name;if(opts.name){name=opts.name;}else{name='drawer-'+serialNr;}drawer=Object.assign(drawer,new App({name:name,type:'Drawer',win:false,winOpts:false}));drawer.el.innerHTML="\n            <div class=\"head h".concat(opts.size," ").concat(opts.bg," ripple\">\n            <div class=\"caption ml10 fl\"></div>\n            <svg class=\"fr xs default inverted clear mr5 p0 icon\" style=\"opacity:0.8;width:15px\">\n            <use href=\"#icon-angle-down\"></use>\n            </svg>\n            </div>\n            <div class=\"body hidden inset xs\">\n            </div>\n            ");drawer.el.classList.add('drawer');if(opts.class)drawer.el.setAttribute('class',drawer.el.getAttribute('class')+' '+opts.class);drawer.body=drawer.el.querySelector('.body');drawer.head=drawer.el.querySelector('.head');var methods={caption:function caption(v){if(v!==undefined){_caption=v;if(typeof v=='string'){drawer.el.querySelector('.caption').innerHTML=v;}else{drawer.el.querySelector('.caption').append(v);}}return _caption;},toggle:function toggle(){if(!drawer.visible){drawer.open();return;}drawer.close();},open:function open(){return new Promise(function(res,rej){if(opts.beforeOpen)opts.beforeOpen(drawer);drawer.body.classList.remove('hidden');var duration=0.2/options.speedFactor;gsap.to(drawer.head.querySelector('.icon'),{transformOrigin:'75% 50%',duration:duration,rotation:0});if(opts.onOpen)opts.onOpen(drawer);drawer.visible=true;if(main.preferences)if(opts.usePrefs){main.preferences.set('drawer',drawer.name,true);}});},close:function close(){return new Promise(function(res,rej){if(opts.beforeHide)opts.beforeHide(drawer);drawer.body.classList.add('hidden');var duration=0.2/options.speedFactor;gsap.to(drawer.head.querySelector('.icon'),{transformOrigin:'75% 50%',duration:duration,rotation:90,onComplete:function onComplete(){if(opts.onClose)opts.onClose(drawer);}});drawer.visible=false;if(main.preferences)if(opts.usePrefs){main.preferences.set('drawer',drawer.name,false);}});},options:function options(prop,val){if(val!==undefined){return opts[prop];}else opts[prop]=val;}};drawer.type='Drawer';Object.assign(drawer,methods);drawer.show=drawer.open;drawer.hide=drawer.close;drawer.head.addEventListener('click',function(e){e.preventDefault();drawer.toggle();});if(opts.parent)opts.parent.append(drawer.el);if(opts.dom)drawer.body.append(opts.dom);drawer.caption(text);if(opts.usePrefs){if(main.preferences)if(main.preferences.get('drawer',drawer.name)){drawer.open();}else drawer.close();}return drawer;}return construct();};this.drawer=function(text,userOpts){return new _gui.Drawer(text,userOpts);};this.Items=function Items(name,items,itemOptions,drawerOptions){var data={name:name+'-list',beforeOpen:function beforeOpen(drawer){drawer.body.innerHTML='';var keys=false;var itemsArray=false;if(_typeof(items)=='object'){keys=Object.keys(items);itemsArray=Object.values(items);}else{itemsArray=items;}if(!itemsArray.forEach){return;}itemsArray.forEach(function(subject,i){var opts={};if(itemOptions){Object.assign(opts,itemOptions);}if(keys&&opts.text===undefined){if(_typeof(items)=='object')opts.text=keys[i];}else{opts.text=subject.slice(0,10);}drawer.body.append(_gui.item(subject,opts));});},usePrefs:true};if(drawerOptions){if(drawerOptions.beforeOpen){throw new Error('Gui.items() recived \'beforeshow\' in drawerOptions and this wuld over run the used beforeShow');}Object.assign(data,drawerOptions);}return _gui.drawer(name,data);};this.items=function(name,items,itemOptions,drawerOptions){return new _gui.Items(name,items,itemOptions,drawerOptions);};this.item=function(data,options){var attrs={data:data};if(options)extend(attrs,options);return _w.dom.node('item',{},attrs);};this.slot=function(options){return _w.dom.node('slot',{},options);};_w.item=this.item;_w.slot=this.slot;this.Buttons=function Buttons(obj,options){if(!options)options={};options=Object.assign({'class':''},options);var d=_w.dom.node('div',{},{class:'form'});for(var caption in obj){var fun=obj[caption];if(typeof fun==='string'){d.append(fun);}else if(typeof fun==='function'){var b=_w.dom.node('button',{click:fun},{'class':options.class});b.textContent=caption;d.append(b);}else{d.append(fun);}}return d;};this.buttons=function(obj,options){if(!options)options={};options=Object.assign({'class':''},options);return _gui.Buttons(obj,options);};this.listItem=function(data){if(!data){debug('No data passed to gui.listItem',true);return error('No data passed to gui.listItem');}var cont="\n        <div class=\"lines col\">\n        <div class=\"line\">\n        <div class=\"fl tlg\">\n        ".concat(data.big,"\n        </div>\n        <div class=\"fl small hidden\">\n        ").concat(data.fistSmall,"\n        </div>\n        </div>\n        <div class=\"line\">\n        <div class=\"pull-left tmd\">\n        ").concat(data.medium,"\n        </div>\n        <div class=\"fr small hidden\">\n        ").concat(data.secondSmall,"\n\n        </div>\n        </div>\n        </div>\n        <button class=\"btn btn-link round mt10 fr clear\">\n        <svg class=\"icon\">\n        <use href=\"#icon-angle-right\"></use>\n        </svg>\n        </button>\n        ");if(data.image){cont="\n            <div class=\"image mr5\"  style=\"background-image : url('".concat(data.image,"')\"></div>\n            ")+cont;}var template=document.createElement('div');template.innerHTML=cont;template.setAttribute('class','item hlg');if(data.click)template.addEventListener('click',data.click);return template;};this.listSeparator=function(text){var cont="\n        <span>\n        ".concat(text,"\n        </span>\n        ");var template=document.createElement('div');template.innerHTML=cont;template.setAttribute('class','separator hxs pl15 pt5 cap-first');return template;};this.profile={name:function name(id){return gui.storage('profiles.'+id).name;},link:function link(id,onClick){var data=gui.storage('profiles.'+id);var a=_w.dom.node('a');a.textContent=data.name;if(onClick){a.addEventListener('click',function(){onClick(data);});}return a;},small:function small(id,asText,onClick,clss){var data=gui.storage('profiles.'+id);if(!data)return id;var el=_w.dom.node('div');var classList='profile-small inline';if(clss)classList=classList+' '+clss;el.setAttribute('class',classList);var pref='';if(data.prefix){pref="<small class='prefix'> ".concat(data.prefix,"</small>");el.classList.add('profile-small-prefix');}if(data.logo==''||!data.logo){data.logo=data.type?main.envVars.url+'resources/images/team.png':main.envVars.url+'resources/images/man.png';}el.innerHTML="\n            <div class='picture' style=\"background-image : url('".concat(data.logo,"')\">\n\n            </div>\n            <div class='name'>\n            ").concat(toTitleCase(data.name),"\n            <div>\n            ");if(onClick){el.addEventListener('click',function(){onClick(data);});}if(asText){var dummy=_w.dom.node('span');dummy.append(el);return dummy.innerHTML;}else{return el;}},list:function list(id,asText,onClick,clss){var data=gui.storage('profiles.'+id);var type=parseInt(data.type);if(type==0){if(data.logo==''||!data.logo){data.logo=main.envVars.url+'resources/images/man.png';}var members='Members : '+data.members.length;var el=gui.listItem({image:data.logo,big:data.name,fistSmall:data.public?'public':'private',medium:members,secondSmall:type?'team':'personal'});el.classList.add(clss);return respond(el);}if(type==1||type==2||type==3){if(data.logo==''||!data.logo){data.logo=main.envVars.url+'resources/images/man.png';}var _el=gui.listItem({image:data.logo,big:data.name,fistSmall:data.public?'public':'private',medium:data.user,secondSmall:type?'team':'personal'});return respond(_el);}function respond(domEl){domEl.classList.add('profiles-'+id);if(asText){var wr=_w.dom.node('div');wr.append(domEl);return wr.innerHTML;}else{if(onClick){domEl.addEventListener('click',function(){onClick(data);});}return domEl;}}},vertical:function vertical(id,asText,onClick,clss){var data=gui.storage('profiles.'+id);var type=parseInt(data.type);if(type==0){if(data.logo==''||!data.logo){data.logo=main.envVars.url+'resources/images/man.png';}var el=gui.listItem({image:data.logo,big:data.name,fistSmall:data.public?'public':'private',medium:data.user,secondSmall:type?'team':'personal'});el.classList.add(clss);return respond(el);}if(type==1||type==2||type==3){if(data.logo==''||!data.logo){data.logo=main.envVars.url+'resources/images/team.png';}var members;if(!Boolean(data.members)){members=0;}else{members=parseInt(data.members.split(',').length);}var _el2=gui.listItem({image:data.logo,big:data.name,fistSmall:data.public?'public':'private',medium:"<span loc>Members : ".concat(members,"  </span>"),secondSmall:type?'team':'personal'});_el2.classList.add(clss);return respond(_el2);}function respond(domEl){if(asText){var wr=_w.dom.node('div');wr.append(domEl);return wr.innerHTML;}else{if(onClick){domEl.addEventListener('click',function(){onClick(data);});}return domEl;}}}};}this.animate={};function construct(){function createLoader(){var wrapper=document.createElement('svg');wrapper.style.width='100%';wrapper.style.height='100vh';wrapper.style.top='0px';wrapper.style.display='flex';wrapper.style.justifyContent='center';wrapper.style.alignItems='center';wrapper.style.position='absolute';wrapper.style.margin='-1px';wrapper.style.visibility='hidden';_gui.layers.main.el.append(wrapper);var $circles='';for(var i=0;i<7;i++){$circles+='<circle  class="circle" cx="0" cy="0" r="'.concat(i*3,'"></circle>');}wrapper.innerHTML='\n            <svg id="warp-loader">\n                '.concat($circles,'\n            </svg>\n ');var circles=wrapper.querySelectorAll('.circle');TweenMax.set(circles,{drawSVG:'35% 35%'});var tl=new TimelineMax({repeat:-1,repeatDelay:-0.3});tl.staggerTo(circles,0.5,{drawSVG:'5% 95%',ease:Sine.easeInOut},0.25,0);tl.staggerTo(circles,0.4,{drawSVG:'75% 75%',ease:Sine.easeInOut},0.25,0.5);}function scaleBody(){document.body.style.height=window.innerHeight+'px';_gui.height=window.innerHeight;_gui.width=window.innerWidth;if(main.preferences)if(!main.preferences.get('gui','scaleFactor')){if(gui.options('clientSizeAffectsScale')){_gui.scale((_gui.height-200)/main.home.win.height());}}else _gui.scale(main.preferences.get('gui','scaleFactor'));for(var layerName in _w.lists.gui.layers){_w.lists.gui.layers[layerName].dims(_gui.width,_gui.height);}}{popup.el.innerHTML='<div class=\'body\'></div>';popup.el.addEventListener('click',popup.hide);_w.dom.addPopup=popup.add;_w.dom.hidePopup=popup.hide;}var existingWarpElement=document.querySelector('body > .warp');if(!existingWarpElement){_gui.warpEl=_w.dom.node('div',{},{'class':'warp'});document.body.append(_gui.warpEl);}else _gui.warpEl=existingWarpElement;_w.dom.scriptsEl=_w.dom.node('div',{},{'class':'scripts'});_gui.warpEl.append(_w.dom.scriptsEl);var existingGuiElement=_gui.warpEl.querySelector('.gui');if(!existingGuiElement){_gui.el=_w.dom.node('div',{},{class:'gui'});_gui.warpEl.append(_gui.el);}else _gui.el=existingGuiElement;{var chain=function chain(result){return result;};var animations={bounce:function bounce(el){var duration=0.44/options.speedFactor;gsap.to(el,duration,{y:'-=100',yoyo:true,repeat:1,ease:'Back.easeOut'});return el;},shake:function shake(el){var duration=0.1/options.speedFactor;gsap.to(el,0,{x:0});gsap.to(el,duration,{x:'+=20',yoyo:true,repeat:3,ease:Back.easeInOut,onComplete:function onComplete(){gsap.to(el,0,{x:0});}});return el;},ripple:function ripple(e){var el=e;if(e.target){el=e.target;}var duration=0.25/options.speedFactor;gsap.to(el,{duration:0,scale:0.95,onComplete:function onComplete(){}});var oldCol=window.getComputedStyle(el,null).getPropertyValue('background-color');var point=_w.dom.clickedWhere(e);el.style.backgroundImage='radial-gradient(circle at '.concat(point.x,'px ').concat(point.y,'px, rgba(200,200,200,0.2) 1%, rgba(255,255,255,0.6))');gsap.to(el,{duration:duration/4,delay:0.05,ease:Elastic.easeOut,scale:1});gsap.to(el,{duration:duration,backgroundImage:'radial-gradient(circle at '.concat(point.x,'px ').concat(point.y,'px,  ').concat(oldCol,' 1%, rgba(200,200,200,0.2) 70%,rgba(255,255,255,0.3) 80%, ').concat(oldCol,' 100%)'),onComplete:function onComplete(){el.style.backgroundImage='none';}});return el;},strokes:function strokes(el){var paths=el.querySelectorAll('path,polygon');paths.forEach(function(clip){length=clip.getTotalLength();var tl=new TimelineMax({repeat:0});var style=window.getComputedStyle(clip);clip.style.stroke=style.fill;clip.style.fill='none';clip.style.strokeWidth=3;clip.style.strokeOpacity=1;tl.set(clip,{strokeDasharray:length});tl.fromTo(clip,1,{attr:{'stroke-dashoffset':length},autoAlpha:1},{attr:{'stroke-dashoffset':0}});});return el;},blur:function blur(el,val){if(val==undefined){console.log('no value for blur animation');val=0;}val=parseInt(val);var duration=0.5/options.speedFactor;gsap.to(el,{duration:duration,css:{filter:'blur('+val+'px)'},ease:Quad.easeOut});return el;},blurIn:function blurIn(el){var duration=0.5/options.speedFactor;var dispVal='default';if(!el.hasAttribute('display-bak')){dispVal=el.getAttribute('display-bak');}el.style.opacity='0';el.style.filter='blur(20px)';el.style.display=dispVal;gsap.to(el,{duration:duration,css:{opacity:1,filter:'blur(0px)'},ease:Quad.easeOut,onComplete:function onComplete(){}});return el;},blurOut:function blurOut(el){var duration=1/options.speedFactor;if(!el.hasAttribute('display-bak')){el.setAttribute('display-bak',el.style.display);}gsap.to(el,{duration:duration,css:{opacity:0,filter:'blur(20px)'},ease:Quad.easeOut,onComplete:function onComplete(){el.style.display=='none';}});return el;},drawIn:function drawIn(el){gsap.to(el.querySelectorAll('path'),0,{drawSVG:'0% 0%'});var duration=0.3/options.speedFactor;gsap.to(el.querySelectorAll('path'),duration,{css:{},drawSVG:'0% 100%',ease:Sine.easeInOut},0.25,0.5);},drawOut:function drawOut(el){var duration=0.3/options.speedFactor;gsap.to(el.querySelectorAll('path'),duration,{css:{},drawSVG:'0% 0%',ease:Sine.easeInOut},0.25,0.5);},flip:function flip(el){var duration=0.88/options.speedFactor;gsap.to(el,duration,{rotationY:180,ease:'Back.easeOut'});return el;},flipBack:function flipBack(el){var duration=0.88/options.speedFactor;gsap.to(el,duration,{rotationY:0,ease:'Back.easeOut'});return el;}};_w.lists.gui={layers:{},overlays:{toast:false}};var _loop3=function _loop3(_name3){_gui.animate[_name3]=function(arg1,arg2,arg3){if(arg1){arg1=_w.dom.select(arg1);if(arg1.forEach){if(arg1.length>1){arg1.forEach(function(el){return animations[_name3](el,arg2,arg3);});return chain(arg1,arg2,arg3);}else{return chain(arg1[0],arg2,arg3);}}else{return chain(animations[_name3](arg1,arg2,arg3));}}else{return chain(animations[_name3]());}};};for(var _name3 in animations){_loop3(_name3);}}_gui.icons=new _gui.Icons();var myFont=new FontFace('Montserrat','url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Hw0aXpsog.woff2)');myFont.load().then(function(font){document.fonts.add(font);console.log('Font Montserrat loaded');});{_gui.layers=_w.lists.gui.layers;if(!_gui.mobile())new _gui.CanvasLayer({name:'context2D',debug:true});_gui.layer=new _gui.HTMLLayer({name:'main'});new _gui.HTMLLayer({name:'home',backdrop:true});if(!_gui.mobile())new _gui.CanvasLayer({name:'helpers'});new _gui.HTMLLayer({name:'blockers',backdrop:true});}{_gui.listApp=new List();_gui.select=_gui.listApp.select;window.select=_gui.select;_gui.edit=_gui.listApp.edit;window.edit=_gui.edit;}{_w.lists.gui.overlays.toast=_w.dom.node('div',{},{class:'toast-container'});_w.lists.gui.overlays.error=_w.dom.node('div',{},{style:'width:250px; right:0;',class:'toast-container'});_w.lists.gui.overlays.notification=_w.dom.node('div',{},{style:'width:250px; ',class:'toast-container'});_gui.layers.blockers.el.append(_w.lists.gui.overlays.toast);_gui.layers.blockers.el.append(_w.lists.gui.overlays.error);_gui.layers.blockers.el.append(_w.lists.gui.overlays.notification);_gui.toast=function(text,duration,overlay){var finalOpacity=1;if(!overlay)overlay='toast';if(overlay=='error')finalOpacity=0.9;var onShow,onShowArgs,onHide,onHideArgs;if(duration===undefined)duration=1500;if(duration===0)duration=false;var clone=_w.dom.node('div',{},{'class':'toast'});clone.innerHTML='<div class="body">\n<span>'.concat(text,'</span>\n</div>');_w.lists.gui.overlays[overlay].append(clone);clone.style.opacity=finalOpacity;gsap.from(clone,0.5,{x:200,opacity:0,ease:Bounce.easeOut,onComplete:function onComplete(){if(onShow)onShow();clone.style.display='visible';}});if(duration)clone.click=function(e){if(clone.parentNode)clone.parentNode.removeChild(clone);e.preventDefault();clone.click=null;};if(duration){setTimeout(function(){gsap.to(clone,1,{x:-200,opacity:0,ease:Back.easeIn,onComplete:function onComplete(){if(onHide)onHide();if(clone!=null){clone.style.display='none';if(clone.parentNode){clone.parentNode.removeChild(clone);}}}});},duration);}return{destroy:function destroy(destroyText){if(onHide){if(onHideArgs){onHide(onHideArgs);}else{onHide();}}gsap.to(clone,1,{x:-200,opacity:0,ease:Back.easeIn,onComplete:function onComplete(){if(clone.parentNode)clone.parentNode.removeChild(clone);}});if(destroyText){toast(destroyText);}},el:clone,body:clone.querySelector('.body'),caption:function caption(textOrHtml){clone.querySelector('.body').innerHTML=textOrHtml;}};};var lastError=false;var lastErrorToast=false;_gui.error=function(str,dataOrStack,handler){if(lastErrorToast&&lastError==str&&lastErrorToast.el.parentNode){var badge=lastErrorToast.body.querySelector('.badge');_w.dom.show(badge);badge.innerHTML=parseInt(badge.innerHTML)+1;_w.log(dataOrStack,1);}else{var t=toast("\n                        <p class=\"tl mb10 txs\">\n                            <span class=\"badge round hidden tb inline-block tc\" style=\"padding-top:2px; font-size:12px; position:absolute; right:-5px; top:-5px; width:20px; height:20px;\">0</span> \n                            ".concat(handler," : <br>\n                            <strong> ").concat(str,"</strong>\n                        </p>\n                        <button class=\"fr stack xs round p0 default inverted mt-20\" style=\"padding-top:2px; font-weight:normal; color:white\">\n                            <svg class=\"icon\">\n                                <use href=\"#icon-attachment\"/>\n                            </svg>\n                        </button>\n                        \n                        "),5000,'error');t.body.style.backgroundColor='darkred';t.body.querySelector('button.stack').addEventListener('click',function(){_w.vector.toggle(true);_w.inspect(dataOrStack);});t.body.addEventListener('mouseenter',function(){t.el.style.opacity=1;});t.body.addEventListener('mouseleave',function(){t.el.style.opacity=0.9;});lastError=str;lastErrorToast=t;_w.log(dataOrStack,1);}};window.error=_gui.error;_gui.notify=function(news){var data=news;var profile=gui.storage('profiles.'+data.profile);var avatar;if(profile)avatar=profile.logo;var t=toast("\n                        <p class=\"tl mb10 tsm\">\n                            <span class=\"badge round hidden tb inline-block tc\" style=\"padding-top:2px; font-size:12px; position:absolute; right:-5px; top:-5px; width:20px; height:20px;\">\n                                0\n                            </span>\n                            <span class=\"image hmd round inline-block fl mr5 mt-10 default\" style=\"width :50px; background-image:url(".concat(avatar,")\">\n                            </span>\n                            Entity : ").concat(data.entity," \n                            <br> \n                            Action : ").concat(data.action,"\n                            <span style=\"width:35px\" class=\"fr small ml20 inline-block\">\n                                    ").concat(main.date.time(data.date).slice(0,-3),"\n                            </span>\n                        </p>\n                        "),0,'notification');t.el.classList.add('news');t.el.setAttribute('news',news.id);t.body.style.backgroundColor='rgba(10,10,10,0.6)';t.body.style.cursor='pointer';t.body.addEventListener('click',function(){t.destroy();});};_w.on('news',function(news){if(news.profile!=main.data.user.id){_gui.notify(news);_w.user.notify('Changes in '+news.entity);}});_gui.confirm=new BlockingApp({name:'confirm',show:function show(contentStr,toDo,onCancel){return new Promise(function(res,rej){if(_gui.confirm.busy()){_gui.confirm.list.push([contentStr,toDo,onCancel]);return;}_gui.confirm.busy(true,true);_gui.confirm.el.innerHTML="\n                        <div class=\"inline-block form cap-first tj mtmd mbmd mla mra\">\n                            <p>".concat(contentStr,"</p>\n                        </div>\n                        <div  class=\"m20 mtmd mbmd buttons\">\n                           <button class=\"sm m5 ok\">Ok</button>\n                           <button class=\"sm primary m5 cancel\">Cancel</button> \n                        </div>\n                        ");_gui.confirm.win.el.style.borderRadius='15px';_gui.confirm.win.body.style.overflowY='hidden';var okBtn=_gui.confirm.win.el.querySelector('.buttons>.ok');var cancelBtn=_gui.confirm.win.el.querySelector('.buttons>.cancel');if(!toDo&&!onCancel){okBtn.addEventListener('click',function(){_gui.confirm.hide();});_w.dom.remove(cancelBtn);_gui.confirm.win.show();setTimeout(function(){_w.dom.activate(okBtn);},100);}else{okBtn.addEventListener('click',function(){if(toDo){toDo();res();}_gui.confirm.hide();});cancelBtn.addEventListener('click',function(){if(onCancel)onCancel();_gui.confirm.hide();});_gui.confirm.win.show();setTimeout(function(){_w.dom.activate(cancelBtn);},100);}return;});}});window.confirm=_gui.confirm.show;window.alert=window.confirm;window.toast=_gui.toast;window.input=function(text,caption,options){if(!text)text='';options=extend({password:false},options,true);return new Promise(function(res,rej){_w.editors.text(caption?caption:'Input text',function(resultText){res(resultText);},text,options);var _app=_w.editors.textApp;_app.el.querySelector('input').addEventListener('keydown',function(e){if(e.key==='Escape'){_app.hide();}if(e.key==='Enter'){res(_app.el.querySelector('input').value);_app.hide();}});});};_gui.input=window.input;}_gui.picker=new Picker();_gui.scaler=new Scaler();_w.display=async function(subject,options){if(!_w.lists['displays']){setupDiplays();return _w.display(subject);}if(await _w.is(subject,'File'))return _w.lists['displays']['General'].open(subject);var urlRegex=/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/;if(typeof subject==='string'&&urlRegex.test(subject)){return _w.lists['displays']['General'].set(subject);}var htmlRegex=/<([A-Za-z][A-Za-z0-9]*)\b[^>]*>(.*?)<\/\1>/;if(typeof subject==='string'&&htmlRegex.test(subject)){return _w.lists['displays']['General'].set(subject);}if(_instanceof(subject,Element)){return _w.lists['displays']['DOM'].set(subject,options);}if(_instanceof(subject,ImageData)){return _w.lists['displays']['General'].set(subject);}throw new Error('Unknown subject type for .display()');};function setupDiplays(){_w.lists['displays']={DOM:new _gui.DOMDisplay(),General:new Display()};}setTimeout(setupDiplays,100);window.addEventListener('popstate',function(event){event.preventDefault();},false);window.addEventListener('online',function(){_w.gui.confirmApp.hide();});window.addEventListener('offline',function(){});window.addEventListener('resize',function(){scaleBody();},true);document.body.addEventListener('mousedown',function(e){pointer['b'+e.button]=true;if(!_gui.mobile())_gui.layers['context2D'].cast(e.clientX,e.clientY).then(function(comp){pointer.dragg(comp);});});document.body.addEventListener('mousemove',function(e){pointer.x=e.clientX;pointer.y=e.clientY;pointer.lastX=pointer.x-e.movementX;pointer.lastY=pointer.y-e.movementY;if(pointer.b0){if(!pointer.dragging){_w.trigger('pointer.dragStart',{pointer:pointer,event:e});}_w.trigger('pointer.drag',{pointer:pointer,event:e});pointer.dragging=true;if(pointer.dragged){pointer.dragged.x=pointer.x-pointer.dragOffsetX;pointer.dragged.y=pointer.y-pointer.dragOffsetY;pointer.dragged.needsUpdate=true;_gui.layers['context2D'].needUpdate.push(pointer.dragged);}}var vDir='N';var hDir='W';if(e.movementY>0)vDir='S';if(e.movementX>0)hDir='E';pointer.direction=vDir+hDir;if(pointer.data.timestamp===null){pointer.data.timestamp=Date.now();pointer.data.lastMouseX=pointer.x;pointer.data.lastMouseY=pointer.y;return;}var now=Date.now();var dt=now-pointer.data.timestamp;var dx=pointer.x-pointer.data.lastMouseX;var dy=pointer.y-pointer.data.lastMouseY;var speedX=Math.round(dx/dt*100);var speedY=Math.round(dy/dt*100);pointer.speed=(speedX+speedY)/2;pointer.data.timestamp=now;pointer.data.lastMouseX=pointer.x;pointer.data.lastMouseY=pointer.y;});document.body.addEventListener('mouseup',function(e){pointer['b'+e.button]=false;if(pointer.dragging){_w.trigger('pointer.dragEnd',{pointer:pointer,event:e});pointer.dragging=false;pointer.dragged=false;}});document.body.addEventListener('dblclick',function(e){if(e.target.tagName=='BODY')_gui.full();});_w.dom.on('body','click','button, .ripple, .item, .slot',function(e){e.stopPropagation();animations.ripple(e);});_w.vector={load:async function load(){_w.vector=new Vector(_w);return;}};window.gui=_gui;var ctx={'Refresh screen':function RefreshScreen(){warp.reboot();},'Close this screen':function CloseThisScreen(){warp.shutdown();},'Fullscreen':function Fullscreen(){warp.gui.full(true);}};setTimeout(function(){_w.dom.context.add(document.body,ctx,'System');},100);scaleBody();createLoader();var style=_w.dom.node('style',{},{'class':'win-sizes'});style.textContent="\n        div.w{\n        width : ".concat(gui.winSize.width,"px;\n        height : ").concat(gui.winSize.height,"px ;\n\n        }\n        div.w > div.c,\n        div.w > .o {\n        width : 100%;\n        height : ").concat(gui.winSize.height-30,"px;\n        }\n        div.w > div.c > .b {\n        width : 100%;\n        max-width : 600px;\n        height : auto ;\n        max-height : ").concat(gui.winSize.height-30,"px\n        }\n        ");document.head.append(style);}construct();};Warp.Gui.prototype.Keyboard=function Keyboard(options){var defaultOptions={width:window.innerWidth,height:window.innerHeight*0.3,onInput:function onInput(key){return toast("Key pressed: ".concat(key));}};if(!options)options=defaultOptions;options=Object.assign(options,defaultOptions);var app=this;var warp=gui.warp;Object.assign(this,new App({name:'keyboard',winOpts:{bottomClose:false}}));this.isShiftActive=false;this.canvas=document.createElement('canvas');this.el.append(this.canvas);this.ctx=gui.getCtx(this.canvas,options.width,options.height);var keyLayout=[['1','2','3','4','5','6','7','8','9','0','+','-','*','/','='],['q','w','e','r','t','y','u','i','o','p'],['shift','a','s','d','f','g','h','j','k','l','del'],['z','x','c','v','b','n','m',',','.'],['?','!','space','enter','@','/']];var components=[];this.toggleShift=function(){var _iterator5=_createForOfIteratorHelper(components),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var comp=_step5.value;if(comp.value!=='shift'&&isNaN(comp.value)&&comp.value.length===1){comp.value=this.isShiftActive?comp.value.toUpperCase():comp.value.toLowerCase();}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}this.isShiftActive=!this.isShiftActive;render();};function render(){app.ctx=_gui.getCtx(app.canvas,options.width,options.height);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var keyMargin=5;var keyHeight=(this.canvas.height-keyMargin*2-keyMargin)/keyLayout.length;components=[];var x=keyMargin;var y=keyMargin;app.win.height(this.canvas.height+35);app.win.width(this.canvas.width+25);for(var rowIndex=0;rowIndex<keyLayout.length;rowIndex++){var row=keyLayout[rowIndex];var keyWidth=(this.canvas.width-(row.length+1)*keyMargin)/row.length;var _iterator6=_createForOfIteratorHelper(row),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var key=_step6.value;var keyComponent={x:x,y:y,width:key==='space'?keyWidth*1:keyWidth,height:keyHeight,value:key};this.ctx.fillStyle='rgba(68, 68, 68, 0.3)';this.ctx.beginPath();this.ctx.moveTo(x+3,y);this.ctx.lineTo(x+keyComponent.width-3,y);this.ctx.quadraticCurveTo(x+keyComponent.width,y,x+keyComponent.width,y+3);this.ctx.lineTo(x+keyComponent.width,y+keyHeight-3);this.ctx.quadraticCurveTo(x+keyComponent.width,y+keyHeight,x+keyComponent.width-3,y+keyHeight);this.ctx.lineTo(x+3,y+keyHeight);this.ctx.quadraticCurveTo(x,y+keyHeight,x,y+keyHeight-3);this.ctx.lineTo(x,y+3);this.ctx.quadraticCurveTo(x,y,x+3,y);this.ctx.closePath();this.ctx.fill();this.ctx.fillStyle='white';this.ctx.font="".concat(keyHeight/2,"px Arial");this.ctx.textAlign='center';this.ctx.textBaseline='middle';this.ctx.fillText(key,x+keyComponent.width/2,y+keyHeight/2);components.push(keyComponent);x+=keyComponent.width+keyMargin;}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}y+=keyHeight+keyMargin;x=keyMargin;}}this.canvas.addEventListener('click',function(e){var _iterator7=_createForOfIteratorHelper(components),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var comp=_step7.value;if(e.offsetX>comp.x&&e.offsetX<comp.x+comp.width&&e.offsetY>comp.y&&e.offsetY<comp.y+comp.height){var key=comp.value;if(key==='shift'){this.toggleShift();}else if(key==='del'){key='backspace';options.onInput(key);}else{options.onInput(key);}break;}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}});this.width=function(w){if(typeof w==='undefined'){return this.canvas.width;}options.width=w;render();};this.height=function(h){if(typeof h==='undefined'){return this.canvas.height;}options.height=h;render();};render();};Warp.Gui.prototype.Anchor=function Anchor(opts){if(opts===undefined)opts={};return Object.assign(opts,{x:'mid',y:'min',to:{component:'parent',x:'mid',y:'min'}});};Warp.Gui.prototype.Layer=function(options){var _w=gui.warp;//chldren renderers should inherit from this
var width=0,height=0,visible=true,box=20;var _l=this;_l.activeWin=false;_l.lastActive=false;options=Object.assign({name:options.type+'-'+Object.keys(_w.lists.gui.layers).length,type:'div',parent:gui.el,passEvents:true,backdrop:true//this ,means layer  w,h is going to be 0,0
},options);_l.el=_w.dom.node(options.type,{},{'class':'l'});options.parent.appendChild(this.el);//this will give layer stage.children
_l.stage={width:0,height:0,children:[]};//newstuff
_l.windows={};this.create=function(data){var name='win'+Math.random();this.windows[name]=data;return name;};function renderWindows(){each(_l.windows,async function(id,w){if(w.changed){//rendering simulated here
w.changed=false;}});requestAnimationFrame(renderWindows);}requestAnimationFrame(renderWindows);//newstugff ends
_w.lists.gui.layers[options.name]=this;this.width=function(v){if(v!==undefined){width=parseInt(v);_l.update();}return width;};this.height=function(v){if(v!==undefined){height=parseInt(v);_l.update();}return height;};this.dims=function(w,h){width=parseInt(w);height=parseInt(h);_l.update();return{width:width,height:height};};this.visible=function(v){if(v!==undefined){visible=v;_l.update();}return visible;};this.activate=function(win){if(typeof win=='string')return;//something left leakded, shit
if(!win.el)return;if(win.active){win.el.focus();return;}if(_l.activeWin){if(!_l.activeWin.el)return;_l.activeWin.el.classList.remove('a');_l.activeWin.active=false;_l.activeWin.update();}win.priorActive=_l.activeWin;win.active=true;win.el.focus();win.el.style.zIndex=Draggable.zIndex+1;win.el.classList.add('a');// toast("firing")
if(win.options('useGuard')){warp.dom.hide(win.guard);}_l.activeWin=win;};this.deactivate=function(){_l.lastActive=_l.activeWin;_l.activeWin.active=false;_l.activeWin.el.classList.remove('a');_l.activeWin=false;};this.toPng=function(win){return warp.dom.toPng(win.body);};this.test=function(nr){if(!nr)nr=100;var rnd=function rnd(max,min){return Math.floor(Math.random()*(max-min+1)+min);};var createGroup=function createGroup(nr){var st=performance.now();var els=[];for(var i=0;i<nr-1;i++){var _win=_l.window({x:i*100,y:0,width:100,height:100,backdrop:false});_win.show();_win.x(i*100);_win.y(0);els.push(_win.el);}gsap.to(els,{duration:0.6,yoyo:true,repeat:1,x:20+i*2,y:20,stagger:0.03});var win=_l.window({x:0,y:0,width:200,height:350,backdrop:false,onDrag:function onDrag(pos){gsap.to(els,{duration:0.2,stagger:0.07,x:pos.x-120,y:pos.y-120});}}).show();var took=parseInt(performance.now()-st);console.log('took : '+took);};createGroup(nr);/*  gsap.to(layer.instances, {
            x: 0,
            y: 0,
            ease: Linear.easeInOut,
            yoyo: true,
            repeat: -1,
            duration: 1,
            stagger: 0.051,
            onUpdate: function () {
                if (layer.selected) {
                    layer.selected.x = dummy.x;
                    layer.selected.y = dummy.y;
                }
                layer.tick();
            },
            onComplete: function () {
                alert('gotov');
            }
        });*/};//seems not used
this.window=function(options){options.layer=_l;options.parent=_l.el;//thi should only add an object to children, not create a new win instance, win is just an interface, created if needed
var w=gui.window(_w.dom.node('div'),options);_l.stage.children.push(w);return w;};this.destroyWindow=function(win){_l.stage.children.forEach(function(w,i){if(w==win){_l.stage.children.splice(i,1);}});};function render(){if(options.backdrop){_l.backdrop=_w.dom.node('div',{},{'class':'backdrop hidden'});_l.backdrop.addEventListener('click',function(){if(_l.activeWin)if(_l.activeWin.options('backdropCloses'))_l.activeWin.hide();});_l.el.appendChild(_l.backdrop);}_l.stage.width=_w.dom.width();_l.stage.height=_w.dom.height();_l.update();}this.update=function(){this.stage.children.forEach(function(comp){//the windowsare beeing updated twice
//from here and fom them
comp.update();});};render();};Warp.Gui.prototype.HTMLLayer=function(options){options=Object.assign({type:'div',debug:true},options);var _layer=this;Object.assign(this,new gui.Layer(options));return this;};Warp.Gui.prototype.CanvasLayer=function(options){if(!options)options={};options=Object.assign({name:'context2D'},options);var classes={//stylable caption node with o events
'Text':{},'Element':{},'Button':{},//stylable node with click and input event
'Input':{},'Buttons':{},'Drawer':{},'Window':{selected:{trigger:[{'desc':'main trigger rect override, yellow when selected',fill:'darkred'//'rgb(229,145,0)'
}],body:[{fill:'white',stroke:'black',shadow:15},{'desc':'inset body rect, so window body has a double border',fill:'pink'}]}}};var Factory=function Factory(layer){var Chain={prototypeOf:{'Rect':{props:{//simplest  component,
//a rect with fill and border
//props is rect data to create it
//and a  style property (these two can create classes)
x:0,y:0,width:'100%',height:'100%',rect:function rect(data){if(data){Object.assign(this,data);this.needsUpdate=true;layer.needUpdate.push(this);}else{return{x:this.x,y:this.y,width:this.width,height:this.height};}},set:function set(prop,val){this[prop]=val;if(!this.needsUpdate){this.needsUpdate=true;layer.needUpdate.push(this);}}},prototypeOf:{'Component':{props:{//an component
name:'',parent:layer.stage,index:0,visible:true,needsUpdate:true,//default
children:[],anchor:{component:'parent, stage, previous, index (this is a sibling index, can be int then its index of parents child. if string than its relative from this component so "=-1" would e previous component)',to:{x:0,y:0},at:{x:0,y:0}}},prototypeOf:{'caption':{props:{caption:''},//it inerited x,y,w,h, and style(just prop, not propss)
//its a captionbox, only thing differing
//from button is that
//its not using pointer events
prototypeOf:{}},//a basic element has styling, blocks to build bitmap and pointer
'Element':{props:{visible:true,classes:[],//a tree of objects to draw a bitmap representation
//a block can be a rendered bitmap
//x/y are relative to components x and y
blocks:[{main:{'desc':'main body rect',x:0,y:0,width:'100%',heigh:'100%',fill:'blue',stroke:'red',line:2}}],//imageData or uint8 array to hold predrawed interface or blocks of interface
bitmap:[]},events:{pointer:['move','in','out']},prototypeOf:{'Button':{props:{click:function click(){}},blocks:{mainBody:[{'desc':'main buton body rect',x:0,y:0,width:0,height:30,stroke:'pink',fill:'grey',line:2,r:0}]},events:{pointer:['click']},prototypeOf:{//comp with children buttons
Buttons:{//same as buttons, shows in right click
props:{functions:{}},prototypeOf:{Concaption:{}}},//comp with child button and container, simple reduced api like window
Drawer:{open:function open(){},close:function close(){},events:{before:['open','close'],after:['open','close']},prototypeOf:{// like drawer, but can be dragged
Window:{}}}}},'Input':{props:{value:''}},'Buttons':{//same as buttons, shows in right click
props:{functions:{}},prototypeOf:{Concaption:{}}},//comp with child button and container, simple reduced api like window
'Drawer':{props:{open:function open(){},close:function close(){}},events:{before:['open','close'],after:['open','close']},prototypeOf:{// like drawer, but can be dragged
'Window':{blocks:{trigger:[{'desc':'main trigger rect',x:0,y:0,width:0,height:25,stroke:'#171514',fill:'#0B0A0A',line:1,r:0}],body:[{'desc':'main body rect',x:0,y:25,width:0,height:0,fill:'rgb(70,70,70)',stroke:'black',shadow:15,line:1,r:0},{'desc':'inset body rect, so window body has a double border',x:1,y:26,width:'-2',height:'-2',fill:'#1c1b1b',stroke:false,line:0,r:0}]}},'HeadlessWindow':{blocks:{body:[{'desc':'main body rect',x:0,y:25,width:0,height:0,fill:'rgba(5,5,5,0.8)',stroke:'black',shadow:15,line:1,r:5}]}}}}}}}}}},'Line':{props:{//simplest  component,
//an component
name:'',index:0,visible:true,needsUpdate:true,//default
children:[],fill:'darkorange',width:1,x1:10,y1:10,x2:100,y2:100,onTick:function onTick(ins,ctx){ctx.beginPath();// Start a new path
ctx.moveTo(ins.x1,ins.y1);ctx.lineTo(ins.x2,ins.y2);ctx.strokeStyle=ins.fill;ctx.stroke();},length:function length(){return Math.hypot(this.x2-this.x1,this.y2-this.y1);},to:function to(x,y){if(x!=undefined&&y!=undefined){this.x2=x;this.y2=y;this.needsUpdate=true;layer.needUpdate.push(this);}else if(y===undefined&&x.x!=undefined){this.x2=x.x;this.y2=x.y;this.needsUpdate=true;layer.needUpdate.push(this);}else{return{x2:this.x2,y2:this.y2};}},from:function from(x,y){if(x!=undefined&&y!=undefined){this.x1=x;this.y1=y;this.needsUpdate=true;layer.needUpdate.push(this);}else if(y===undefined&&x.x!=undefined){this.x1=x.x;this.y1=x.y;this.needsUpdate=true;layer.needUpdate.push(this);}else{return{x1:this.x1,y1:this.y1};}},set:function set(prop,val){this[prop]=val;if(!this.needsUpdate){this.needsUpdate=true;layer.needUpdate.push(this);}}},prototypeOf:{'TaperedArrow':{props:{onTick:function onTick(ins,ctx){function taperedArrow(_ref){var ctx=_ref.ctx,fromX=_ref.fromX,fromY=_ref.fromY,toX=_ref.toX,toY=_ref.toY,_ref$arrowHeadLength=_ref.arrowHeadLength,arrowHeadLength=_ref$arrowHeadLength===void 0?15:_ref$arrowHeadLength,_ref$width=_ref.width,width=_ref$width===void 0?10:_ref$width,_ref$baseWidth=_ref.baseWidth,baseWidth=_ref$baseWidth===void 0?20:_ref$baseWidth,_ref$headWidth=_ref.headWidth,headWidth=_ref$headWidth===void 0?20:_ref$headWidth,_ref$stroke=_ref.stroke,stroke=_ref$stroke===void 0?{color:'black',width:2,opacity:1}:_ref$stroke,_ref$fill=_ref.fill,fill=_ref$fill===void 0?null:_ref$fill;var dx=toX-fromX;var dy=toY-fromY;var len=Math.hypot(dx,dy);var angle=Math.atan2(dy,dx);var shaftLength=len-arrowHeadLength;var halfBase=baseWidth/2;var halfShaftTip=width/2;var halfHead=headWidth/2;var curveInset=Math.min(halfBase-halfShaftTip,10);var controlOffset=shaftLength/2;var points=[{x:0,y:-halfBase},{x:shaftLength,y:-halfShaftTip},{x:shaftLength,y:-halfHead},{x:len,y:0},{x:shaftLength,y:halfHead},{x:shaftLength,y:halfShaftTip},{x:0,y:halfBase}];var controlLeft={x:controlOffset,y:-curveInset};var controlRight={x:controlOffset,y:curveInset};var rotate=function rotate(p){var x=p.x*Math.cos(angle)-p.y*Math.sin(angle)+fromX;var y=p.x*Math.sin(angle)+p.y*Math.cos(angle)+fromY;return{x:x,y:y};};var rp=points.map(rotate);var ctrlL=rotate(controlLeft);var ctrlR=rotate(controlRight);ctx.beginPath();ctx.moveTo(rp[0].x,rp[0].y);ctx.quadraticCurveTo(ctrlL.x,ctrlL.y,rp[1].x,rp[1].y);ctx.lineTo(rp[2].x,rp[2].y);ctx.lineTo(rp[3].x,rp[3].y);ctx.lineTo(rp[4].x,rp[4].y);ctx.lineTo(rp[5].x,rp[5].y);ctx.quadraticCurveTo(ctrlR.x,ctrlR.y,rp[6].x,rp[6].y);ctx.closePath();// Fill
if(fill&&fill.color){ctx.save();ctx.globalAlpha=fill.opacity??1;ctx.fillStyle=fill.color;ctx.fill();ctx.restore();}// Stroke
if(stroke&&stroke.color){ctx.save();ctx.globalAlpha=stroke.opacity??1;ctx.strokeStyle=stroke.color;ctx.lineWidth=stroke.width??2;ctx.stroke();ctx.restore();}}taperedArrow({ctx:ctx,fromX:ins.x1,fromY:ins.y1,toX:ins.x2,toY:ins.y2,arrowHeadLength:40,width:ins.width,baseWidth:30,headWidth:50,fill:{color:ins.fill,opacity:0.6},stroke:{color:'black',width:3,opacity:0.9}});}},prototypeOf:{}},'Arrow':{props:{onTick:function onTick(ins,ctx){function arrow(fromx,fromy,tox,toy,arrowWidth,color){var headlen=10;var angle=Math.atan2(toy-fromy,tox-fromx);//    ctx.save();
ctx.strokeStyle=color;//starting path of the arrow from the start square to the end square
//and drawing the stroke
ctx.beginPath();ctx.moveTo(fromx,fromy);ctx.lineTo(tox,toy);ctx.lineWidth=arrowWidth;ctx.stroke();//starting a new path from the head of the arrow to one of the sides of
//the point
ctx.beginPath();ctx.moveTo(tox,toy);ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/7),toy-headlen*Math.sin(angle-Math.PI/7));//path from the side point of the arrow, to the other side point
ctx.lineTo(tox-headlen*Math.cos(angle+Math.PI/7),toy-headlen*Math.sin(angle+Math.PI/7));//path from the side point back to the tip of the arrow, and then
//again to the opposite side point
ctx.lineTo(tox,toy);ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/7),toy-headlen*Math.sin(angle-Math.PI/7));//draws the paths created above
ctx.fillStyle=color;ctx.fill();}arrow(ins.x1,ins.y1,ins.x2,ins.y2,ins.width,ins.fill);}},prototypeOf:{}}}},'Box':{props:{//simplest  component,
name:'',index:0,visible:true,needsUpdate:true,//default
children:[],fill:'none',stroke:'darkorange',strokeWidth:1,x:10,y:10,width:100,height:100,onTick:function onTick(ins,ctx){ctx.setLineDash([5,2]);ctx.lineWidth=this.strokeWidth;ctx.strokeStyle=this.stroke;ctx.strokeRect(this.x,this.y,this.width,this.height);ctx.setLineDash([]);},to:function to(x,y){if(x!=undefined&&y!=undefined){this.x=x;this.y=y;this.needsUpdate=true;layer.needUpdate.push(this);}else{return{x:this.x,y:this.y};}},set:function set(prop,val){this[prop]=val;if(!this.needsUpdate){this.needsUpdate=true;layer.needUpdate.push(this);}}},prototypeOf:{}},'Ellipse':{props:{name:'',index:0,visible:true,needsUpdate:true,//default
children:[],stroke:'none',fill:'none',x:10,y:10,r:100,r2:100,onTick:function onTick(ins,ctx){ctx.beginPath();ctx.strokeStyle=ins.stroke;ctx.fillStyle=ins.fill;ctx.arc(ins.x,ins.y,ins.r,0,2*Math.PI);ctx.fill();ctx.stroke();},set:function set(prop,val){this[prop]=val;if(!this.needsUpdate){this.needsUpdate=true;layer.needUpdate.push(this);}}},prototypeOf:{}}},'Box':{from:'Box',classes:{selected:{blocks:{}}}},'Line':{from:'Line',classes:{selected:{blocks:{}}}},'Arrow':{from:'Line.Arrow'},'TaperedArrow':{from:'Line.TaperedArrow'},//stylable caption node with o events
'Text':{from:'Rect.Component.Text',classes:{}},//stylable node with  events and children
'Element':{from:'Rect.Component.Element',classes:{}},//stylable node with click event
'Button':{from:'Rect.Component.Element.Button',classes:{}},//stylable node with click and input event
'Input':{from:'Rect.Component.Element.Input',classes:{}},'Buttons':{from:'Rect.Component.Element.Buttons',classes:{}},'Drawer':{from:'Rect.Component.Element.Drawer',classes:{}},'Window':{from:'Rect.Component.Element.Drawer.Window',classes:{selected:{blocks:{trigger:[{'desc':'main trigger rect override, yellow when selected',fill:'rgb(229,145,0)'}]}}}},'Toast':{from:'Rect.Component.Element.Drawer.HeadlessWindow',classes:{selected:{blocks:{}}}},'Ellipse':{from:'Ellipse'}};var prototypeOf=Chain.prototypeOf;if(!layer)layer={stage:{children:[]}};var f=this;var _loop5=function _loop5(type){f[type]=function(options){var comp=this;options=Object.assign({parent:layer.stage},options);var level=Chain;var chain=Chain[type].from.split('.');chain.forEach(function(name){level=level['prototypeOf'][name];comp=Object.assign(comp,level);comp=Object.assign(comp,level.props);});if(comp.prototypeOf){delete comp.prototypeOf;}if(comp.props){delete comp.props;}Object.assign(comp,options);comp.type=type;//give the compement
//shorthand create function
comp.add=function(type,options){if(options){options=Object.assign({parent:this},options);//again!!!
options.parent=this;}else{options={parent:this};}return new f[type](options);};if(options.onTick)comp.onTick=options.onTick;//user defined on update
comp.remove=function(index){comp.children.splice(index,1);};comp.destroy=function(){layer.destroy(comp.index);};options.parent.children.push(comp);return comp;};};for(var type in Chain){_loop5(type);}return f;};var CompsLayer=function CompsLayer(options){var Renderer=function Renderer(layer){var canvas,ctx,bgData;function drawBlock(data,i,cls){if(cls)data=Object.assign(data,cls);//shold add radius to blocks
var clone=Object.assign({},data);if(typeof data.width=='string'){clone.width=i.width+parseInt(data.width);}if(clone.width===0){clone.width=i.width;}if(typeof data.height=='string'){clone.height=i.height+parseInt(data.height);}if(clone.height===0){clone.height=i.height;}clone.x=i.x+data.x;clone.y=i.y+data.y;/*                if (clone.shadow) {
           //                                   ctx.shadowOffsetX = 0-clone.shadow;
//ctx.shadowOffsetY = 0-clone.shadow;
ctx.shadowBlur = clone.shadow;
ctx.shadowColor = 'rgba(21, 24, 20, 0.3)';
                  
                } else ctx.shadowBlur =0;*/if(clone.stroke){ctx.lineWidth=clone.line;ctx.strokeStyle=clone.stroke;ctx.strokeRect(clone.x+0.5,clone.y+0.5,clone.width,clone.height);}if(clone.fill){ctx.fillStyle=clone.fill;ctx.fillRect(clone.x+0.5,clone.y+0.5,clone.width,clone.height);}}var r=this;r.bitmaps=[];r.elements=[];r.background=function(url){if(!url){ctx.clearRect(0,0,layer.stage.width,layer.stage.height);bgData=false;//ctx.save();
return;}var img=new Image();img.src=url;img.onload=function(){ctx.drawImage(img,0,0);bgData=ctx.getImageData(0,0,layer.stage.width,layer.stage.height);ctx.save();};};r.beforeTick=function(delta){r.clear();};r.clear=function(){ctx.restore();if(bgData){ctx.putImageData(bgData,0,0);}else ctx.clearRect(0,0,canvas.width,canvas.height);//  ctx.fillStyle = 'rgb(20,103,91)';
//  ctx.fillRect(0, 0, layer.stage.width, layer.stage.height);
r.render(layer.instances);};r.render=function(list){list.forEach(function(i,ind){if(i.visible){var _loop6=function _loop6(segment){i.blocks[segment].forEach(function(block,index){var cls=false;if(layer.selected.index==i.index)if(segment=='trigger')if(index==0){cls=classes.Window.selected.trigger[0];}drawBlock(block,i,cls);});};for(var segment in i.blocks){_loop6(segment);}if(i.onTick)i.onTick(i,ctx);i.needsUpdate=false;/*   i.children.forEach(child => {
                                        for (let segment in child.blocks) {
                                            child.blocks[segment].forEach((block, index) => {
                                                drawBlock(block, i);
                                            });
                                        }
                                    });*/}});r.afterTick();};r.afterTick=function(){layer.needUpdate=[];//pointer direction debug
//  arrow(ctx, gui.pointer.lastX, gui.pointer.lastY, gui.pointer.x, gui.pointer.y, 2, 'red');
layer.rendererReady();};r.update=function(){//gets called by layer.update when change in size happens 
gui.getCtx(canvas);};function construct(){canvas=document.createElement('canvas');layer.parent.appendChild(canvas);canvas.classList.add('l');ctx=gui.getCtx(canvas);ctx.fillStyle='rgb(20,103,91)';ctx.fillRect(0,0,layer.stage.width,layer.stage.height);ctx.save();r.clear();//layer.dims calles laye.update wich calles this renderers update which reizes canvas
layer.dims(document.body.clientWidth,document.body.clientHeight);layer.rendererReady();}if(layer.debug){var dbg=function dbg(ins,ctx){/*     ins.rect({
                    x: 800,
                    y: 20,
                    width: 155,
                    height: 450    })
                    */var y=ins.y+50+0.5;//trigger and topmargin
var x=ins.x+10+0.5;//left margin
var tab=80;ctx.font='10px small-caption';ctx.fillStyle='white';var lineHeight=20;var stats=layer.info();var i=0;for(var _name5 in stats){ctx.font='10px Arial';ctx.fillText(_name5,x,y+lineHeight*i);ctx.font='20px Arial';ctx.fillText(stats[_name5],x+tab,y+lineHeight*i);i++;}};layer.select(layer.create({name:'debug',x:800,y:20,width:155,height:450,onTick:dbg}));}construct();return r;};var layer=this;//keeps new, small, basic instances with only rect data in array
this.instances=[];this.parent=options.parent;this.name=options.name;//references to components from instances that need update, this is passed to renderer on tick
this.needUpdate=[];this.renderer=false;this.stage={width:0,height:0,children:[]};this.paused=false;this.debug=false;this.lastFrameTime=0;this.frameTiming=0;this.selected=false;this.hovered=false;var factory=new Factory(layer);this.factory=factory;var fps=60;this.tick=function(){layer.renderer.beforeTick();};this.create=function(options,type){if(!type)type='Window';var st=performance.now();options.parent=layer.stage;var instance=new factory[type](options);instance.index=layer.instances.length;layer.instances.push(instance);layer.needUpdate.push(instance);return instance;};this.cast=function(x,y){return new Promise(function(resolve,reject){function contains(instance,x,y){return instance.x<=x&&x<=instance.x+instance.width&&instance.y<=y&&y<=instance.y+instance.height;}function triggers(instance,x,y){//just intersecting the trigger for now
var rect={x:instance.x,y:instance.y,width:instance.width,height:instance.blocks.trigger[0].height};return rect.x<=x&&x<=rect.x+rect.width&&rect.y<=y&&y<=rect.y+rect.height;}var st=performance.now();var foundIndex=undefined;var checked=0;layer.instances.every(function(ins,index){checked++;if(contains(ins,x,y))layer.select(layer.instances[foundIndex]);if(ins.blocks)if(triggers(ins,x,y)){foundIndex=index;toast('checked '+checked+' of '+layer.instances.length+', <br>match @ "'+foundIndex+'", in '+(performance.now()-st)+' ms');return false;}// Make sure you return true. If you don't return a value, `every()` will stop.
return true;});if(foundIndex!==undefined){layer.select(layer.instances[foundIndex]);resolve(layer.instances[foundIndex]);}});};this.select=function(i){if(!i){layer.selected=false;return;}if(layer.selected){var index=layer.selected.classes.indexOf('selected');if(index!==-1){layer.selected.classes.splice(index,1);}}layer.selected=i;layer.selected.classes.push('selected');console.log('selecting : '+i.index);layer.instances.push(i);};this.fps=function(val){if(val)fps=parseInt(val);return fps;};this.dims=function(w,h){//sets dimensions of layer
if(w){layer.stage.width=w;layer.stage.height=h;layer.update();}return{width:layer.stage.width,height:layer.stage.height};};this.update=function(){//tell renderer size has changeg
// console.log(layer.renderer.update)
if(layer.renderer.update)layer.renderer.update();};this.rendererReady=function(){};this.pointer=function(){return gui.pointer();};this.info=function(){return{fps:fps,actualFps:parseInt(1000/layer.frameTiming),expectedTime:parseInt(1000/fps)+'ms',actualTime:layer.frameTiming+'ms',instances:layer.instances.length,stage:this.stage.children.length,width:this.stage.width,height:this.stage.height,needUpdate:this.needUpdate.length,selected:layer.selected.index,hovered:Boolean(layer.hovered.index),pointer:this.pointer().x+' , '+this.pointer().y};};this.background=function(url){this.renderer.background(url);};this.close=function(ind){if(ind){ind=layer.instances[ind];}else ind=layer.instances;gsap.to(ind,{x:0,height:2,duration:0.9,ease:Back.easeIn,yoyo:true,repeat:-1,stagger:0.001,onUpdate:function onUpdate(){layer.tick();},onComplete:function onComplete(){}});};this.open=function(ind){if(ind){ind=layer.instances[ind];}else ind=layer.instances;gsap.to(ind,{x:200,height:200,duration:0.9,ease:Back.easeOut,// yoyo: true,
//   repeat: -1,
onUpdate:function onUpdate(){layer.tick();},onComplete:function onComplete(){}});};this.destroy=function(ind){if(ind){layer.instances.splice(ind,1);layer.stage.children.splice(ind,1);}else{layer.instances.splice(0,layer.instances.length);layer.stage.children.splice(0,layer.stage.children.length);}};this.animate=function(ind){var _gsap$to;if(ind){ind=layer.instances[ind];}else ind=layer.instances;gsap.to(ind,(_gsap$to={x:0,y:0,duration:0.5,ease:Elastic.easeInOut},_defineProperty(_gsap$to,"duration",1),_defineProperty(_gsap$to,"stagger",0.011),_defineProperty(_gsap$to,"onUpdate",function onUpdate(){}),_defineProperty(_gsap$to,"onComplete",function onComplete(){}),_gsap$to));};this.toast=function(text){//  var v = new gui.CanvasLayer({name:"dubravko"})
var bottomMargin=25;var instance=layer.create({x:window.innerWidth/2-70,y:window.innerHeight-90-bottomMargin*2,width:200,height:90,onTick:function onTick(ins,ctx){//automaticaly move up
ins.y=window.innerHeight-90-bottomMargin*4-ins.index*ins.height;var size=ctx.measureText(text);ctx.font='14px Montserrat';ctx.fillStyle='rgb(220,220,220)';var x=ins.x+(ins.width-size.width)/2;var y=ins.y+80;ctx.fillText(text,x,y);}},'Toast');gsap.from(instance,{duration:0.5,x:'+=400',opacity:0,ease:Bounce.easeOut,onComplete:function onComplete(){setTimeout(function(){gsap.to(instance,{duration:0.2,x:'-=200',opacity:0,ease:Quad.easeIn,onComplete:function onComplete(){layer.destroy(instance.index);}});},5000);}});return instance;};this.line=function(data){if(!data)data={};data=Object.assign({x1:10,y1:10,x2:100,y2:100,width:2,fill:'black',stroke:'white',strokeWidth:1,onTick:function onTick(ins,ctx){ctx.beginPath();// Start a new path
ctx.moveTo(ins.x1,ins.y1);ctx.lineTo(ins.x2,ins.y2);ctx.strokeStyle=ins.stroke;ctx.stroke();}},data);var instance=layer.create(data,'Line');instance.set('x1',376);instance.set('x2',700);return instance;};this.renderer=new Renderer(layer);this.run=function(){if(!layer.paused)setTimeout(function(){if(layer.lastFrameTime){layer.frameTiming=parseInt(performance.now()-layer.lastFrameTime);}layer.lastFrameTime=performance.now();layer.tick();layer.run();},1000/fps);};gui.warp.lists.gui.layers[options.name]=this;this.run();// this.background('resources/images/973068.jpg');
this.background(false);};var layer=new CompsLayer({colors:{selected:'rgb(229,145,0)'},stage:{w:1624,h:1300},name:options.name,parent:document.querySelector('div.gui')});function testWins(nr){var rnd=function rnd(max,min){return Math.floor(Math.random()*(max-min+1)+min);};var createGroup=function createGroup(nr){var st=performance.now();var a=50,x=0,y=0;for(var i=0;i<nr-1;i++){layer.create({name:'comp-'+i,x:rnd(0,layer.stage.width),y:rnd(0,layer.stage.height),width:a*5,height:a*3,onTick:false});}var took=parseInt(performance.now()-st);console.log('creating '+nr+' wins took :'+took);};createGroup(nr);}function testLines(nr){var rnd=function rnd(max,min){return Math.floor(Math.random()*(max-min+1)+min);};var createGroup=function createGroup(nr){var st=performance.now();var a=50,x=0,y=0;var pnt=layer.pointer();for(var i=0;i<nr-1;i++){layer.create({name:'line-'+i,width:1,fill:'cyan',x1:pnt.x,y1:pnt.y,x2:rnd(0,layer.stage.width),y2:rnd(0,layer.stage.height)},'Arrow');}var took=parseInt(performance.now()-st);toast('creating '+nr+' lines took :'+took);setInterval(function(){var p=gui.pointer();layer.instances.forEach(function(ins){return ins.from(p.x,p.y);});},10);};createGroup(nr);}layer.test=testWins;layer.testLines=testLines;return layer;};/*
//ostalo je provjeriti kko warp thread radi post 
class Layer {
    constructor(options) {
        
        this.type = options.type;
        this.width = gui.width;
        this.height = gui.height;
        this.el = warp.dom.node('div', {}, { class: 'l' });
        gui.el.append(this.el);
    }
}
class OffscreenLayer extends Layer {
    constructor(options) {
        options.type="offscreen";
        super(options);
        this.canvas = warp.dom.node('canvas',{},{width:this.width,height:this.height});
        this.el.append(this.canvas);
        var offscreen = this.canvas.transferControlToOffscreen();
        this.thread = warp.threads.create(function konvaWorker() {
            // load konva 
            importScripts('https://unpkg.com/konva@9/konva.min.js');
            // monkeypatch Konva for offscreen canvas usage
            Konva.Util.createCanvasElement = () => {
                const canvas = new OffscreenCanvas(1, 1);
                canvas.style = {};
                return canvas;
            };
            // now we can create our canvas content
            var stage = new Konva.Stage({
                width: 200,
                height: 200
            });
            var layer = new Konva.Layer();
            stage.add(layer);
            var topGroup = new Konva.Group();
            layer.add(topGroup);
            // counter will show number of bunnies
            var counter = new Konva.Text({
                x: 5,
                y: 35
            });
            topGroup.add(counter);
            // "add more bunnies" button
            var button = new Konva.Label({
                x: 5,
                y: 5,
                opacity: 0.75
            });
            topGroup.add(button);
            button.add(new Konva.Tag({ fill: 'black' }));
            button.add(new Konva.Text({
                text: 'Push me to add bunnies',
                fontFamily: 'Calibri',
                fontSize: 18,
                padding: 5,
                fill: 'white'
            }));
            // draggable circle to show interactivity
            var circle = new Konva.Circle({
                x: stage.width() / 2,
                y: stage.height() / 2,
                radius: 20,
                fill: 'red',
                draggable: true
            });
            topGroup.add(circle);
            self.onmessage = function (evt) {
                // when canvas is passes we can start our worker
                // we can try to use that canvas for the layer with some manual replacement (and probably better performance)
                // but for simplicity we will just copy layer content into passed canvas
                if (evt.data.canvas) {
                    var canvas = evt.data.canvas;
                    // adapt stage size
                    // we may need to add extra event to resize stage on a fly
                    stage.setSize({
                        width: canvas.width,
                        height: canvas.height
                    });
                    const ctx = canvas.getContext('2d');
                    // Konva.Layer has support for "draw" event
                    // so every time the layer is re-rendered we need to update the canvas
                    layer.on('draw', () => {
                        // clear content
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        // draw layer content
                        ctx.drawImage(layer.getCanvas()._canvas, 0, 0);
                    });
                }
                // emulate some drag&drop events
                if (evt.data.eventName === 'mouseup') {
                    Konva.DD._endDragBefore(evt.data.event);
                }
                if (evt.data.eventName === 'touchend') {
                    Konva.DD._endDragBefore(evt.data.event);
                }
                if (evt.data.eventName === 'mousemove') {
                    Konva.DD._drag(evt.data.event);
                }
                if (evt.data.eventName === 'touchmove') {
                    Konva.DD._drag(evt.data.event);
                }
                if (evt.data.eventName === 'mouseup') {
                    Konva.DD._endDragAfter(evt.data.event);
                }
                if (evt.data.eventName === 'touchend') {
                    Konva.DD._endDragAfter(evt.data.event);
                }
                // pass incoming events into the stage
                if (evt.data.eventName) {
                    const event = evt.data.eventName.replace('mouse', 'pointer');
                    stage['_' + event](evt.data.event);
                }
            };
            function requestAnimationFrame(cb) {
                setTimeout(cb, 16);
            }
            // that function is large and adapted from bunnies demo
            // the only interesting part here is how to load images to use for Konva.Image
            async function runBunnies() {
                const imgBlob = await fetch('https://konvajs.org/assets/bunny.png').then(r => r.blob());
                // use "createImageBitmap" instead of "new window.Image()"
                const img = await createImageBitmap(imgBlob);
                var bunnys = [];
                var gravity = 0.75;
                var startBunnyCount = 100;
                var isAdding = false;
                var count = 0;
                var amount = 10;
                button.on('mousedown', function () {
                    isAdding = true;
                });
                button.on('mouseup', function () {
                    isAdding = false;
                });
                for (var i = 0; i < startBunnyCount; i++) {
                    var bunny = new Konva.Image({
                        image: img,
                        transformsEnabled: 'position',
                        x: 10,
                        y: 10,
                        listening: false
                    });
                    bunny.speedX = Math.random() * 10;
                    bunny.speedY = Math.random() * 10 - 5;
                    bunnys.push(bunny);
                    counter.text('Bunnies number: ' + bunnys.length);
                    layer.add(bunny);
                }
                topGroup.moveToTop();
                function update() {
                    var maxX = stage.width() - 10;
                    var minX = 0;
                    var maxY = stage.height() - 10;
                    var minY = 0;
                    if (isAdding) {
                        for (var i = 0; i < amount; i++) {
                            var bunny = new Konva.Image({
                                image: img,
                                transformsEnabled: 'position',
                                x: 0,
                                y: 0,
                                listening: false
                            });
                            bunny.speedX = Math.random() * 10;
                            bunny.speedY = Math.random() * 10 - 5;
                            bunnys.push(bunny);
                            layer.add(bunny);
                            counter.text('Bunnies number: ' + bunnys.length);
                            count++;
                        }
                        topGroup.moveToTop();
                    }
                    for (var i = 0; i < bunnys.length; i++) {
                        var bunny = bunnys[i];
                        bunny.setX(bunny.getX() + bunny.speedX);
                        bunny.setY(bunny.getY() + bunny.speedY);
                        bunny.speedY += gravity;
                        if (bunny.getX() > maxX - img.width) {
                            bunny.speedX *= -1;
                            bunny.setX(maxX - img.width);
                        } else if (bunny.getX() < minX) {
                            bunny.speedX *= -1;
                            bunny.setX(minX);
                        }
                        if (bunny.getY() > maxY - img.height) {
                            bunny.speedY *= -0.85;
                            bunny.setY(maxY - img.height);
                            if (Math.random() > 0.5) {
                                bunny.speedY -= Math.random() * 6;
                            }
                        } else if (bunny.getY() < minY) {
                            bunny.speedY = 0;
                            bunny.setY(minY);
                        }
                    }
                    layer.drawScene();
                    requestAnimationFrame(update);
                }
                update();
            }
            runBunnies();
        });
        this.thread.worker.postMessage({ canvas: offscreen }, [offscreen]);
        var EVENTS = [
            'mouseenter',
            'mousedown',
            'mousemove',
            'mouseup',
            'mouseout',
            'wheel',
            'contextmenu',
            'pointerdown',
            'pointermove',
            'pointerup',
            'pointercancel',
            'lostpointercapture'
        ];
        EVENTS.forEach(eventName => {
            this.canvas.addEventListener(eventName, e => {
                this.thread.worker.postMessage({
                    eventName,
                    event: {
                        clientX: e.clientX,
                        clientY: e.clientY,
                        type: e.type
                    }
                });
            });
        });
    }
    instances = []
    dims(width,height){
          
    }   
    create(){}
    destroy(){}
}
//warp.inspect(new OffscreenLayer({}));
*/Warp.Gui.prototype.Window=function Window(domEl,userOpts){var defaultWidth=gui.winSize.width;var defaultHeight=gui.winSize.height;domEl.classList.add('app');var _w=gui.warp;var opts={'close':true,'headClose':true,'class':'','layer':gui.layer,'parent':false,'destroyOnHide':false,'keepCentered':false,'startCentered':true,'showCentered':false,'centerBody':false,'width':false,'height':false,'maxWidth':false,'maxHeight':false,'minWidth':160,'minHeight':0,'backdrop':true,'headless':false,'backdropCloses':true,'backdropOpacity':0.1,'draggable':true,'caption':'','activateOnShow':true,'out':true,'in':true,'allowMinimize':false,'scrollable':true,'usePrefs':false,'scale':false,'useGuard':false};var events={'beforeHide':false,'onHide':false,'beforeShow':false,'onShow':false,'onDrag':false,'onResize':false,'onMinimize':false,'onRestore':false};Object.assign(opts,events);if(userOpts){opts=Object.assign(opts,userOpts);}var win=this,_x2=0,_y=0,_width=0,_height=0,_visible=false,isBusy=false,_caption2='',_locked=false;win.active=false;function triggerEvent(what){if(opts['backdrop']&&opts['backdropCloses']){if(what=='Shown'||what=='Moved'){warp.trigger('GUI.Window'+what,{id:win.name,x:0,y:0,width:window.innerWidth,height:window.innerHeight});}else if(what=='Hidden'){warp.trigger('GUI.WindowHidden',{id:win.name,x:win.x(),y:win.y(),width:0,height:0});}}else{var rect=win.el.getBoundingClientRect();warp.trigger('GUI.Window'+what,{id:win.name,x:parseInt(rect.x),y:parseInt(rect.y),width:parseInt(rect.width),height:parseInt(rect.height)});}}var methods={caption:function caption(v){if(v!==undefined){_caption2=v;update();}return _y;},x:function x(v){if(v!==undefined){v=parseInt(v);_x2=v;if(_visible)triggerEvent('Moved');update();}return _x2;},y:function y(v){if(v!==undefined){v=parseInt(v);if(v<0)v=0;_y=v;if(_visible)triggerEvent('Moved');update();}return _y;},width:function width(v){if(v!==undefined){_width=parseInt(v);if(opts.onResize)opts.onResize(win);if(_visible)triggerEvent('Moved');update();}return _width;},height:function height(v){if(v!==undefined){if(v=='auto'){_height='auto';}else{_height=parseInt(v);}if(opts.onResize)opts.onResize(win);if(_visible)triggerEvent('Moved');update();}if(_height=='auto'){return warp.dom.height(win.el);}else{return _height;}},rect:function rect(v){if(v!==undefined){}return win.el.getBoundingClientRect();},visible:function visible(v){if(v!==undefined){_visible=Boolean(v);update();}return _visible;},locked:function locked(v){if(v!==undefined){_locked=Boolean(v);if(_locked){win.el.classList.add('locked');}win.el.classList.remove('locked');update();}return _locked;},activate:function activate(){if(!win.active)win.layer.activate(win);},center:function center(){var actualHeight=_height;if(_height=='auto')actualHeight=win.body.offsetHeight;_y=parseInt(window.innerHeight/2-actualHeight/2);_x2=parseInt(window.innerWidth/2-_width/2);},centerBody:function centerBody(){var head=0;if(!opts.headless)head=_w.dom.height(win.head);var topMargin=parseInt(_w.dom.height(win.el)/2-_w.dom.height(win.body)/2-head);if(topMargin>0){win.body.style.marginTop=topMargin+'px';win.body.style.overflowY='hidden';}if(_w.dom.height(win.body)<_w.dom.height(win.content)){win.body.style.overflowY='hidden';}else{win.body.style.overflowY='scroll';}},toogle:function toogle(){if(!win.visible()){win.show();return;}win.hide();},open:function open(){return new Promise(function(res,rej){if(win.visible()){if(opts.beforeShow)opts.beforeShow(win);if(opts.onShow)opts.onShow(win);if(opts.activateOnShow){setTimeout(win.activate,50);}if(opts.backdrop){win.layer.backdrop.classList.remove('hidden');win.layer.el.appendChild(win.layer.backdrop);Draggable.zIndex=Draggable.zIndex+1;win.layer.backdrop.style.zIndex=Draggable.zIndex;Draggable.zIndex=Draggable.zIndex+1;}else win.layer.backdrop.classList.add('hidden');win.layer.el.appendChild(win.el);win.el.style.zIndex=Draggable.zIndex;triggerEvent('Shown');}else{if(opts.backdrop){win.layer.backdrop.classList.remove('hidden');win.layer.el.appendChild(win.layer.backdrop);Draggable.zIndex=Draggable.zIndex+1;win.layer.backdrop.style.zIndex=Draggable.zIndex;Draggable.zIndex=Draggable.zIndex+1;}else win.layer.backdrop.classList.add('hidden');win.layer.el.appendChild(win.el);win.el.style.zIndex=Draggable.zIndex;gsap.set(win.close,{scaleX:1,y:150});if(opts.showCentered)win.center();gsap.set(win.el,{x:_width/2});update();win.el.style.display='block';if(opts.centerBody)win.centerBody();if(opts.beforeShow)opts.beforeShow(win);gsap.to(win.el,{duration:0,x:0,autoAlpha:1,scale:gui.scale(),onComplete:function onComplete(){if(opts.activateOnShow){setTimeout(win.activate,50);}win.visible(true);if(opts.onShow)opts.onShow(win);triggerEvent('Shown');gsap.to(win.close,{delay:0.4,duration:0.3,y:0,ease:Cubic.easeOut});res(win);}});}});},close:function close(){return new Promise(function(res,rej){if(!win.visible()){if(opts.beforeHide)opts.beforeHide(win);if(opts.onHide)opts.onHide(win);return;}if(opts.close){gsap.to(win.close,{duration:0.2,scaleX:0.3,y:150,ease:Back.easeIn,onComplete:function onComplete(){doHiding();}});}else{doHiding();}function doHiding(){if(opts.beforeHide)opts.beforeHide(win);if(opts.backdrop){win.layer.backdrop.classList.add('hidden');}var wdt=win.width();var aniOut=0.35;if(!opts.out)aniOut=0;var duration=aniOut/opts.speedFactor;gsap.to(win.el,{duration:duration,ease:Cubic.easeOut,x:win.x()-wdt/5,autoAlpha:0,onComplete:function onComplete(){win.visible(false);triggerEvent('Hidden');win.el.setAttribute('style','display:none;');if(opts.onHide)opts.onHide(win);if(opts.destroyOnHide){win.destroy();}try{win.layer.el.removeChild(win.el);}catch(er){console.log(win);}res(win);}});if(win.priorActive){if(win.priorActive.visible())win.layer.activate(win.priorActive);}}});},destroy:function destroy(){try{win.el.innerHTML='';win.el.parentNode.removeChild(win.el);if(win.active)win.layer.deactivate();win.layer.destroyWindow(win);}catch(err){}if(opts.propOf)delete opts.propOf[win.name];win=undefined;win=null;triggerEvent('Hidden');return true;},busy:function busy(state){if(state===undefined){return isBusy;}isBusy=Boolean(state);if(isBusy){win.el.appendChild(win.overlay);win.body.querySelector('.app').classList.add('disabled');}else{win.body.querySelector('.app').classList.remove('disabled');try{win.el.removeChild(win.overlay);}catch(e){}}return isBusy;},toPng:function toPng(){return _w.dom.toPng(win.body);},full:function full(){_width=_w.dom.width();_height=_w.dom.height();_x2=0;_y=0;if(opts.onResize)opts.onResize(win);update();},minimize:function minimize(){if(!win.minimized){win.minimized=true;warp.dom.hide(win.content);warp.dom.hide(win.close);if(opts.onResize)opts.onResize(win);if(opts.onMinimize)opts.onMinimize(win);}},restore:function restore(){if(win.minimized){win.minimized=false;warp.dom.show(win.content);if(opts.close)warp.dom.show(win.close);if(opts.onRestore)opts.onRestore(win);if(opts.onResize)opts.onResize(win);}triggerEvent('Moved');},options:function options(prop,val){if(prop){if(val===undefined){if(opts[prop]===undefined){throw new Error('Property\''+prop+'\' doesnt exist in Window options ');}return opts[prop];}opts[prop]=val;return opts[prop];}else return opts;},toBack:function toBack(){win.el.parentNode.prepend(win.el);win.el.style.zIndex='1';}};var ctxFuncs={'Inspect':function Inspect(){warp.inspect(win);},'Create a screenshot':function CreateAScreenshot(){win.toPng().then(warp.inspect);}};var dbgCtx={'Toggle busy':function toggleBusy(){if(win.busy()){win.busy(false);}else{win.busy(1);}},'Scale':function scale(){},'Destroy':function DestroyWin(){win.destroy();},'fullscreen':function fullscreen(){win.full();}};win.menu={el:false,show:function show(funcs){win.menu.hide();win.menu.el=_w.dom.node('div',{},{style:"\n                height:".concat(win.height()-30,"px;\n                "),class:'menu'});var bd=_w.dom.node('div',{},{style:"\n                top:30px;\n                height:".concat(win.height()-30,"px;\n                position:fixed;\n                width:100%;\n                "),class:''});bd.addEventListener('click',function(e){e.preventDefault();win.menu.hide();});win.menu.el.append(bd);win.content.append(win.menu.el);var btns=gui.buttons(funcs,{class:'xs'});btns.setAttribute('class','form mtxl');btns.setAttribute('style','width:220px; margin-left:auto; margin-right:auto ');win.menu.el.append(btns);gsap.set(win.menu.el,{opacity:0});gsap.set(btns.children,{'x':0,opacity:1});gsap.to(win.menu.el,{duration:0.2,opacity:1,onComplete:function onComplete(){}});gsap.from(btns.children,{duration:0.2,'x':50,'opacity':0,ease:Back.easeOut,stagger:0.07,onComplete:function onComplete(){}});if(opts.menuShow)opts.menuShow(win);},hide:function hide(){var menu=win.content.querySelector('.menu');if(menu)win.content.removeChild(menu);if(opts.menuHide)opts.menuHide(win);}};win.guard=false;function update(){if(gui.mobile()){_width=_w.dom.width();_height=_w.dom.height();win.center();}var head=0;try{if(!opts.headless){_w.dom.show(win.head);head=_w.dom.height(win.head);}else{_w.dom.hide(win.head);}}catch(e){console.error('win.update firing on a window that should be destroyed..still referenced somewhere');console.log(e);}if(_width!=defaultWidth){win.el.style.width=_width+'px';win.overlay.style.width=_width-2+'px';win.body.style.width=_width+'px';win.body.style.maxWidth=_width+'px';if(win.body.querySelector('.app')){win.body.querySelector('.app').style.width='auto';win.body.querySelector('.app').style.maxWidth='initial';}}win.overlay.style.top=head+1+'px';if(_height!='auto'&&_height!=defaultHeight){win.el.style.height=_height+'px';win.overlay.style.height=_height-head+'px';win.content.style.height=_height-head+'px';win.content.style.maxHeight=_height-head+'px';win.body.style.height=win.content.style.height;win.body.style.maxHeight=win.content.style.height;var appel=win.body.querySelector('.app');if(appel){appel.style.maxHeight=win.content.style.height;appel.style.height=win.content.style.height;}}else if(_height=='auto'){win.el.style.height='auto';win.content.style.height='auto';win.body.style.height='auto';win.el.style.maxHeight='auto';win.content.style.maxHeight='auto';win.body.style.maxHeight='auto';win.overlay.style.height=win.content.offsetHeight;}if(opts.useGuard){win.guard.style.height=win.content.style.height;}win.head.querySelector('.caption').innerHTML=_caption2;if(opts.keepCentered)win.center();if(opts.centerBody)win.centerBody();gsap.to(win.el,{duration:0,x:_x2,y:_y});if(opts.onResize){opts.onResize(win);}if(_locked){win.el.classList.add('locked');}else win.el.classList.remove('locked');if(!opts.close){win.close.classList.add('hidden');}else win.close.classList.remove('hidden');}function construct(){var serialNr=Math.random()*Math.random();win=Object.assign(win,new App({name:'window-'+serialNr,type:'Window',win:false,winOpts:false}));win.anchor=new gui.Anchor();win.type='Window';win.layer=opts.layer;Object.assign(win,methods);win.show=win.open;win.hide=win.close;win.el.innerHTML="\n        <div class=\"h\">\n            <div class=\"caption\">\n                CAPTION\n            </div>\n            <button class=\"close inverted clear\">\n                <svg class=\"icon\">\n                    <use href=\"#icon-close\"></use>\n                </svg>\n            </button>\n        </div>\n        <div class=\"c\">\n            <div class=\"b\">\n            </div>\n            <div class=\"handle\" >\n            </div>\n        </div>\n        <button class=\"close primary round inverted raised\">\n            <svg class=\"icon\">\n                <use href=\"#icon-close\" />\n            </svg>\n        </button>\n        \n        <svg class=\"o\">\n            <use  href=\"#warp-loader\" />\n        </svg>\n        ";var userClass='';if(opts.class)userClass=opts.class;win.el.setAttribute('class','w raised '+userClass);win.content=win.el.querySelector('.c');win.body=win.el.querySelector('.b');if(opts.scrollable){win.body.style.overflowY='scroll';}else win.body.style.overflowY='hidden';win.close=win.el.querySelector('button.close.raised');win.overlay=win.el.querySelector('.o');win.close.addEventListener('click',function(){win.hide();});win.head=win.el.querySelector('.h');if(!opts.headClose){win.head.removeChild(win.head.querySelector('button.close'));}else{win.head.querySelector('button.close').addEventListener('click',function(){win.hide();});}if(opts.headless)_w.dom.hide(win.head);win.body.appendChild(domEl);if(!opts.close){win.close.classList.add('hidden');}if(!opts.backdrop){win.back=false;}win.el.setAttribute('style','display:none;');if(opts.layer){win.layer=opts.layer;win.layer.el.appendChild(win.el);win.layer.stage.children.push(win);win.parent=win.layer.el;}if(opts.parent){win.parent=opts.parent;}if(gui.mobile()){_width=_w.dom.width();_height=_w.dom.height();}else{_width=defaultWidth;_height=defaultHeight;}if(opts.startCentered){win.center();}if(opts.draggable){_w.dom.show(win.head);}if(opts.height){_height=opts.height;}if(opts.width){_width=opts.width;}if(opts.useGuard){win.guard=warp.dom.node('div',{},{style:' width: 100%; top:30px; left:0;position:absolute',class:'hidden'});win.el.append(win.guard);warp.dom.hide(win.guard);}if(opts.scale){Draggable.create(win.el.querySelector('.handle'),{onDragStart:function onDragStart(e){if(opts.useGuard){win.busy(true);warp.dom.show(win.guard);}win.originalDimensions={width:win.width(),height:win.height()};},onDrag:function onDrag(e){_height=win.originalDimensions.height+parseInt(this.endY-this.startY);if(opts.maxHeight&&_width>opts.maxHeight){_height=opts.maxHeight;}if(opts.minHeight&&_width<opts.minHeight){_height=opts.minHeight;}_width=win.originalDimensions.width+parseInt(this.endX-this.startX);if(opts.maxWidth&&_width>opts.maxWidth){_width=opts.maxWidth;}if(opts.minWidth&&_width<opts.minWidth){_width=opts.minWidth;}if(opts.useGuard){win.guard.style.height=win.content.style.height;}gsap.to(win.el.querySelector('.handle'),{duration:0,x:0,y:0});update();},onDragEnd:function onDragEnd(e){if(opts.useGuard){win.busy(false);warp.dom.hide(win.guard);}gsap.to(win.el.querySelector('.handle'),{duration:0,x:0,y:0});delete win.originalDimensions;update();}});}else{_w.dom.hide(win.el.querySelector('.handle'));}if(opts.caption){win.caption(opts.caption);}if(opts.usePrefs){var pref=main.preferences.get('winPositions',win.name);if(pref){win.x(pref.x);win.y(pref.y);}}win.busy(false);update();win.update=update;win.hide();win.el.addEventListener('mousedown',function(e){win.activate();});win.el.addEventListener('mouseenter',function(e){if(opts.useGuard&&!win.active){warp.dom.show(win.guard);}if(opts.useGuard&&win.active){warp.dom.hide(win.guard);}if(opts.scale){}});win.el.addEventListener('mouseleave',function(e){if(opts.useGuard){warp.dom.show(win.guard);}});if(opts.allowMinimize){win.head.addEventListener('dblclick',function(e){if(win.minimized){win.restore();}else win.minimize();});win.head.addEventListener('click',function(e){if(win.minimized){win.restore();}});}if(opts.draggable&&!gui.mobile()){Draggable.create(win.el,{'trigger':win.head,onPress:function onPress(e){win.activate();_x2=parseInt(this.x);_y=parseInt(this.y);update();},onDragStart:function onDragStart(e){if(opts.useGuard)warp.dom.show(win.guard);win.busy(true);_x2=parseInt(this.x);_y=parseInt(this.y);},onDrag:function onDrag(e){_x2=parseInt(this.x);_y=parseInt(this.y);if(_y<0)_y=0;if(opts.onDrag)opts.onDrag(this);},onDragEnd:function onDragEnd(e){if(opts.useGuard)warp.dom.hide(win.guard);win.busy(false);triggerEvent('Moved');update();}});}return win;}return construct();};Warp.createCssMethods=function(){var res={};['reset','resetExt','colors','sizes','grid','typo','helpers','gui','webApps','homeApps','inputs','buttons','all'].forEach(function(f){res[f]=async function(destSelector){var url='https://bemjax.com/cdn/development/Warp/sources/css/'+f+'.css';if(f=='all')url='https://bemjax.com/cdn/development/Warp/dist/warp.min.css?d='+Date();var el2=document.createElement('link');el2.setAttribute('href','https://bemjax.com/cdn/development/Warp/dist/dark.skin.css?d='+Date());el2.setAttribute('rel','stylesheet');document.querySelector('head').prepend(el2);var el=document.createElement('link');el.setAttribute('id','injected-'+f);el.setAttribute('href',url);el.setAttribute('rel','stylesheet');document.querySelector('head').prepend(el);};});delete Warp.createCssMethods;return res;};Warp.css=Warp.createCssMethods();Warp.Gui.prototype.Icons=function(options){var _w=gui.warp;if(!options)options={};options=Object.assign({name:'icons'},options);var icons=_w.dom.node('svg');icons.setAttribute('class','template icons');icons.innerHTML="\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 800 800\">\n    <rect fill=\"#1c1b1b\" x=\"0\" y=\"0\" height=\"100%\" width=\"100%\"></rect>\n    <path\n        fill=\"#ff981c\"\n        fill-rule=\"evenodd\"\n        stroke=\"#fff\"\n        stroke-width=\"15\"\n        d=\"M278 437V247c0-20.1 17.9-38 40-38s40 17.9 40 40v58c104.586-51 196 48.414 190 123 0 74.586-60.414 135-135 135s-135-60.414-135-135Zm90-10c0-25.414 20.586-46 46-46s46 20.586 46 46-20.586 46-46 46-46-20.586-46-46Z\"\n        />\n</svg>\n<svg viewBox=\"0 -256 1792 1792\" id=\"icon-plus\">\n    <path d=\"M 1408,800 V 608 q 0,-40 -28,-68 -28,-28 -68,-28 H 896 V 96 Q 896,56 868,28 840,0 800,0 H 608 Q 568,0 540,28 512,56 512,96 V 512 H 96 Q 56,512 28,540 0,568 0,608 v 192 q 0,40 28,68 28,28 68,28 h 416 v 416 q 0,40 28,68 28,28 68,28 h 192 q 40,0 68,-28 28,-28 28,-68 V 896 h 416 q 40,0 68,-28 28,-28 28,-68 z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 512 512\" id=\"icon-bulb\">\n    <path d=\"m256,92.3c-74.2,0-127.8,55.3-136.3,114.7-5.3,39.6 7.5,78.2 34.1,107.4 23.4,25 36.2,58.4 36.2,92.8l-.1,54.2c0,21.9 18.1,39.6 40.5,39.6h52.2c22.4,0 40.5-17.7 40.5-39.6l.1-54.2c0-35.4 11.7-67.8 34.1-90.7 24.5-25 37.3-57.3 37.3-90.7-0.1-74.1-63-133.5-138.6-133.5zm46.8,369.1c0,10.4-8.5,18.8-19.2,18.8h-52.2c-10.7,0-19.2-8.3-19.2-18.8v-24h90.5v24zm39.6-159.5c-26.6,27.1-40.5,64.6-40.5,105.3v9.4h-90.5v-9.4c0-38.6-16-77.1-42.6-106.3-23.4-25-33-57.3-28.8-90.7 7.5-50 54-97 116.1-97 65,0 117.2,51.1 117.2,112.6 0,28.1-10.7,55.2-30.9,76.1z\">\n    </path>\n    <rect width=\"21.3\" x=\"245.3\" y=\"11\" height=\"50\">\n    </rect>\n    <polygon points=\"385.1,107.4 400,122.3 436.5,87.2 421.5,72.3   \">\n    </polygon>\n    <rect width=\"52.2\" x=\"448.8\" y=\"236.2\" height=\"20.9\">\n    </rect>\n    <rect width=\"52.2\" x=\"11\" y=\"236.2\" height=\"20.9\">\n    </rect>\n    <polygon points=\"90.1,72.2 75.1,87.1 111.6,122.2 126.5,107.3   \">\n    </polygon>\n</svg>\n<svg viewBox=\"0 0 28 28\" id=\"icon-barcode\">\n    <rect y=\"4.877\" width=\"3.161\" height=\"18.292\">\n    </rect>\n    <rect x=\"20.631\" y=\"4.877\" width=\"3.165\" height=\"18.292\">\n    </rect>\n    <rect x=\"5.141\" y=\"4.877\" width=\"1.579\" height=\"18.292\">\n    </rect>\n    <rect x=\"14.995\" y=\"4.877\" width=\"1.581\" height=\"18.292\">\n    </rect>\n    <rect x=\"17.766\" y=\"4.877\" width=\"1.576\" height=\"18.292\">\n    </rect>\n    <rect x=\"24.486\" y=\"4.877\" width=\"1.584\" height=\"18.292\">\n    </rect>\n    <rect x=\"27.255\" y=\"4.877\" width=\"0.791\" height=\"18.292\">\n    </rect>\n    <rect x=\"8.765\" y=\"4.877\" width=\"4.746\" height=\"18.292\">\n    </rect>\n</svg>\n<svg viewBox=\"0 0 24 24\" id=\"icon-fb\">\n    <path d=\"M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 24 24\" id=\"icon-linkedin\">\n    <path d=\"M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 56 54\" id=\"icon-pdf\">\n    <path d=\"M45,31.2c-2.6-2.7-9.7-1.6-11.4-1.4c-2.5-2.4-4.2-5.3-4.8-6.3c0.9-2.7,1.5-5.4,1.6-8.3                     c0-2.5-1-5.2-3.8-5.2c-1,0-1.9,0.6-2.4,1.4c-1.2,2.1-0.7,6.3,1.2,10.6c-1.1,3.1-2.1,6.1-4.9,11.4c-2.9,1.2-9,4-9.5,7                     c-0.2,0.9,0.1,1.8,0.8,2.5c0.7,0.6,1.6,0.9,2.5,0.9c3.7,0,7.3-5.1,9.8-9.4c2.1-0.7,5.4-1.7,8.7-2.3c3.9,3.4,7.3,3.9,9.1,3.9                     c2.4,0,3.3-1,3.6-1.9C46,33.1,45.7,32,45,31.2z M42.5,32.9c-0.1,0.7-1,1.4-2.6,1c-1.9-0.5-3.6-1.4-5.1-2.6                     c1.3-0.2,4.2-0.5,6.3-0.1C41.9,31.4,42.7,31.9,42.5,32.9z M25.8,12.3c0.2-0.3,0.5-0.5,0.8-0.5c0.9,0,1.1,1.1,1.1,2                     c-0.1,2.1-0.5,4.2-1.2,6.2C25,16,25.3,13.2,25.8,12.3z M25.6,31.7c0.8-1.6,1.9-4.4,2.3-5.6c0.9,1.5,2.4,3.3,3.2,4.1                     C31.1,30.3,28,30.9,25.6,31.7z M19.7,35.7c-2.3,3.8-4.7,6.2-6,6.2c-0.2,0-0.4-0.1-0.6-0.2c-0.3-0.2-0.4-0.5-0.3-0.9                     C13.1,39.4,15.7,37.5,19.7,35.7z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 64 64\" id=\"icon-print\">\n    <path d=\"M57.7881012,14.03125H52.5v-8.0625c0-2.2091999-1.7909012-4-4-4h-33c-2.2091999,0-4,1.7908001-4,4v8.0625H6.2119002   C2.7871001,14.03125,0,16.8183498,0,20.2431507V46.513649c0,3.4248009,2.7871001,6.2119026,6.2119002,6.2119026h2.3798995   c0.5527,0,1-0.4472008,1-1c0-0.5527-0.4473-1-1-1H6.2119002C3.8896,50.7255516,2,48.8359489,2,46.513649V20.2431507   c0-2.3223,1.8896-4.2119007,4.2119002-4.2119007h51.5762024C60.1102982,16.03125,62,17.9208508,62,20.2431507V46.513649   c0,2.3223-1.8897018,4.2119026-4.2118988,4.2119026H56c-0.5527992,0-1,0.4473-1,1c0,0.5527992,0.4472008,1,1,1h1.7881012   C61.2128983,52.7255516,64,49.9384499,64,46.513649V20.2431507C64,16.8183498,61.2128983,14.03125,57.7881012,14.03125z    M13.5,5.96875c0-1.1027999,0.8971996-2,2-2h33c1.1027985,0,2,0.8972001,2,2v8h-37V5.96875z\">\n    </path>\n    <path d=\"M44,45.0322495H20c-0.5517998,0-0.9990005,0.4472008-0.9990005,0.9990005S19.4482002,47.0302505,20,47.0302505h24   c0.5517006,0,0.9990005-0.4472008,0.9990005-0.9990005S44.5517006,45.0322495,44,45.0322495z\">\n    </path>\n    <path d=\"M44,52.0322495H20c-0.5517998,0-0.9990005,0.4472008-0.9990005,0.9990005S19.4482002,54.0302505,20,54.0302505h24   c0.5517006,0,0.9990005-0.4472008,0.9990005-0.9990005S44.5517006,52.0322495,44,52.0322495z\">\n    </path>\n    <circle cx=\"7.9590998\" cy=\"21.8405495\" r=\"2\">\n    </circle>\n    <circle cx=\"14.2856998\" cy=\"21.8405495\" r=\"2\">\n    </circle>\n    <circle cx=\"20.6121998\" cy=\"21.8405495\" r=\"2\">\n    </circle>\n    <path d=\"M11,62.03125h42v-26H11V62.03125z M13.4036999,38.4349518h37.1925964v21.1925964H13.4036999V38.4349518z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 493.497 493.497\" id=\"icon-email\">\n    <path d=\"M444.556,85.218H48.942C21.954,85.218,0,107.171,0,134.16v225.177c0,26.988,21.954,48.942,48.942,48.942h395.613                     c26.988,0,48.941-21.954,48.941-48.942V134.16C493.497,107.171,471.544,85.218,444.556,85.218z M460.87,134.16v225.177                     c0,2.574-0.725,4.924-1.793,7.09L343.74,251.081l117.097-117.097C460.837,134.049,460.87,134.096,460.87,134.16z M32.628,359.336                     V134.16c0-0.064,0.033-0.11,0.033-0.175l117.097,117.097L34.413,366.426C33.353,364.26,32.628,361.911,32.628,359.336z                     M251.784,296.902c-2.692,2.691-7.378,2.691-10.07,0L62.667,117.846h368.172L251.784,296.902z M172.827,274.152l45.818,45.819                     c7.512,7.511,17.493,11.645,28.104,11.645c10.61,0,20.592-4.134,28.104-11.645l45.82-45.819l101.49,101.499H71.327L172.827,274.152z                     \">\n    </path>\n</svg>\n<svg viewBox=\"0 0 36 36\" id=\"icon-camera\">\n    <path d=\"M23.921,20.528c0,3.217-2.617,5.834-5.834,5.834s-5.833-2.617-5.833-5.834s2.616-5.834,5.833-5.834                     S23.921,17.312,23.921,20.528z M36.174,12.244v16.57c0,2.209-1.791,4-4,4H4c-2.209,0-4-1.791-4-4v-16.57c0-2.209,1.791-4,4-4h4.92                     V6.86c0-1.933,1.566-3.5,3.5-3.5h11.334c1.934,0,3.5,1.567,3.5,3.5v1.383h4.92C34.383,8.244,36.174,10.035,36.174,12.244z                     M26.921,20.528c0-4.871-3.963-8.834-8.834-8.834c-4.87,0-8.833,3.963-8.833,8.834s3.963,8.834,8.833,8.834                     C22.958,29.362,26.921,25.399,26.921,20.528z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 512 512\" id=\"icon-close\">\n    <path d=\"M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4  L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1  c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1  c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 100 100\" id=\"icon-menu\">\n    <rect y=\"5\" width=\"100\" height=\"20\" ry=\"6\" rx=\"6\">\n    </rect>\n    <rect y=\"40\" width=\"100\" height=\"20\" ry=\"6\" rx=\"6\">\n    </rect>\n    <rect y=\"75\" width=\"100\" height=\"20\" ry=\"6\" rx=\"6\">\n    </rect>\n</svg>\n<svg viewBox=\"0 0 100 100\" id=\"icon-menu-dots\">\n    <rect y=\"16\" x=\"43\" width=\"14\" height=\"14\" ry=\"7\" rx=\"7\">\n    </rect>\n    <rect y=\"40\" x=\"43\" width=\"14\" height=\"14\" ry=\"7\" rx=\"7\">\n    </rect>\n    <rect y=\"66\" x=\"43\" width=\"14\" height=\"14\" ry=\"7\" rx=\"7\">\n    </rect>\n</svg>\n<svg viewBox=\"0 0 100 100\" id=\"icon-locate\">\n    <line x1=\"50\" y1=\"0\" x2=\"50\" y2=\"20\" stroke-width=\"7\">\n    </line>\n    <circle cx=\"50\" cy=\"50\" r=\"40\" fill-opacity=\"0\" stroke-width=\"7\">\n    </circle>\n    <circle cx=\"50\" cy=\"50\" r=\"15\" stroke-opacity=\"0\">\n    </circle>\n    <line x1=\"0\" y1=\"50\" x2=\"20\" y2=\"50\" stroke-width=\"7\">\n    </line>\n    <line x1=\"100\" y1=\"50\" x2=\"80\" y2=\"50\" stroke-width=\"7\">\n    </line>\n    <line x1=\"50\" y1=\"100\" x2=\"50\" y2=\"80\" stroke-width=\"7\">\n    </line>\n</svg>\n<svg viewBox=\"0 0 32 32\" id=\"icon-search\">\n    <path d=\"M11,22A10,10,0,1,1,21,12,10,10,0,0,1,11,22ZM11,4a8,8,0,1,0,8,8A8,8,0,0,0,11,4Z\">\n    </path>\n    <path d=\"M28,29.74a3,3,0,0,1-1.93-.7L19.94,23.9a3,3,0,0,1,3.86-4.6l6.13,5.14A3,3,0,0,1,28,29.74ZM21.87,20.6h-.09a1,1,0,0,0-.55,1.77l6.13,5.14a1,1,0,0,0,1.41-.12,1,1,0,0,0,.23-.73,1,1,0,0,0-.36-.68l-6.13-5.15A1,1,0,0,0,21.87,20.6Z\">\n    </path>\n    <path d=\"M20,21a1,1,0,0,1-.64-.23L17,18.82a1,1,0,0,1,1.28-1.54l2.34,1.95a1,1,0,0,1,.13,1.41A1,1,0,0,1,20,21Z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 24 24\" id=\"icon-settings\">\n    <path d=\"M22.2,14.4L21,13.7c-1.3-0.8-1.3-2.7,0-3.5l1.2-0.7c1-0.6,1.3-1.8,0.7-2.7l-1-1.7c-0.6-1-1.8-1.3-2.7-0.7   L18,5.1c-1.3,0.8-3-0.2-3-1.7V2c0-1.1-0.9-2-2-2h-2C9.9,0,9,0.9,9,2v1.3c0,1.5-1.7,2.5-3,1.7L4.8,4.4c-1-0.6-2.2-0.2-2.7,0.7   l-1,1.7C0.6,7.8,0.9,9,1.8,9.6L3,10.3C4.3,11,4.3,13,3,13.7l-1.2,0.7c-1,0.6-1.3,1.8-0.7,2.7l1,1.7c0.6,1,1.8,1.3,2.7,0.7L6,18.9   c1.3-0.8,3,0.2,3,1.7V22c0,1.1,0.9,2,2,2h2c1.1,0,2-0.9,2-2v-1.3c0-1.5,1.7-2.5,3-1.7l1.2,0.7c1,0.6,2.2,0.2,2.7-0.7l1-1.7   C23.4,16.2,23.1,15,22.2,14.4z M12,16c-2.2,0-4-1.8-4-4c0-2.2,1.8-4,4-4s4,1.8,4,4C16,14.2,14.2,16,12,16z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 91 91\" id=\"icon-locate2\">\n    <path d=\"M53.1,49.9V35.4c0.8,1.1,1.3,2.4,1.3,3.8v8.2h3.4v-8.2c0-4-2.4-7.5-5.9-9.1c1.4-1.5,2.3-3.5,2.3-5.6c0-4.5-3.7-8.2-8.1-8.2   s-8.1,3.7-8.1,8.2c0,2.2,0.9,4.2,2.3,5.6c-3.5,1.6-5.9,5-5.9,9.1v8.2h3.4v-8.2c0-1.4,0.5-2.7,1.3-3.8v14.5   c-9,1.4-15.2,5.4-16.3,10.3h-2.7v3.4h2.8c1.6,5.8,10.4,10.1,21.7,10.5v3.6h3.4v-3.6c11.3-0.4,20.1-4.8,21.7-10.5h3v-3.4h-2.9   C68.3,55.3,62.1,51.4,53.1,49.9z M47.6,70.8V69h-3.4v1.8c-7.9-0.4-16.2-3.1-18.1-7.2h5.6v-3.4h-5.7c1.3-3,6.3-5.7,12.8-6.9V61   c0,2.4,2,4.4,4.4,4.4c0.5,0,1-0.1,1.5-0.3V50.9h2.5v14.2c0.5,0.2,1,0.3,1.5,0.3c2.4,0,4.4-2,4.4-4.4v-7.6   c6.5,1.2,11.5,3.8,12.8,6.9h-5.5v3.4h5.4C63.8,67.6,55.6,70.4,47.6,70.8z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 100 100\" id=\"icon-filter\">\n    <rect y=\"10\" width=\"100\" height=\"7\">\n    </rect>\n    <circle cx=\"70\" cy=\"14\" r=\"15\">\n    </circle>\n    <rect y=\"45\" width=\"100\" height=\"7\">\n    </rect>\n    <circle cx=\"30\" cy=\"47\" r=\"15\">\n    </circle>\n    <rect y=\"80\" width=\"100\" height=\"7\">\n    </rect>\n    <circle cx=\"70\" cy=\"82\" r=\"15\">\n    </circle>\n</svg>\n<svg viewBox=\"0 0 576 512\" id=\"icon-home\">\n    <path d=\"M488 312.7V456c0 13.3-10.7 24-24 24H348c-6.6 0-12-5.4-12-12V356c0-6.6-5.4-12-12-12h-72c-6.6 0-12 5.4-12 12v112c0 6.6-5.4 12-12 12H112c-13.3 0-24-10.7-24-24V312.7c0-3.6 1.6-7 4.4-9.3l188-154.8c4.4-3.6 10.8-3.6 15.3 0l188 154.8c2.7 2.3 4.3 5.7 4.3 9.3zm83.6-60.9L488 182.9V44.4c0-6.6-5.4-12-12-12h-56c-6.6 0-12 5.4-12 12V117l-89.5-73.7c-17.7-14.6-43.3-14.6-61 0L4.4 251.8c-5.1 4.2-5.8 11.8-1.6 16.9l25.5 31c4.2 5.1 11.8 5.8 16.9 1.6l235.2-193.7c4.4-3.6 10.8-3.6 15.3 0l235.2 193.7c5.1 4.2 12.7 3.5 16.9-1.6l25.5-31c4.2-5.2 3.4-12.7-1.7-16.9z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 40 40\" id=\"icon-angle-right\">\n    <path d=\"M27.128997802734375,20.989999771118164l-8.599998474121094,8.600000381469727a1.4,1.4,0,1,1,-1.9810028076171875,-1.9799995422363281l7.6100006103515625,-7.6100006103515625L16.54900360107422,12.390999794006348A1.4,1.4,0,0,1,18.529998779296875,10.40999984741211l8.599998474121094,8.600000381469727a1.4,1.4,0,0,1,0,1.9799995422363281Z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 40 40\" id=\"icon-angle-left\">\n    <g transform=\"translate(0 0) rotate(180)\">\n        <path d=\"M27.128997802734375,20.989999771118164l-8.599998474121094,8.600000381469727a1.4,1.4,0,1,1,-1.9810028076171875,-1.9799995422363281l7.6100006103515625,-7.6100006103515625L16.54900360107422,12.390999794006348A1.4,1.4,0,0,1,18.529998779296875,10.40999984741211l8.599998474121094,8.600000381469727a1.4,1.4,0,0,1,0,1.9799995422363281Z\">\n        </path>\n    </g>\n</svg>\n<svg viewBox=\"0 0 40 40\" id=\"icon-angle-up\">\n    <g transform=\"translate(50 0) rotate(270)\">\n        <path d=\"M27.128997802734375,20.989999771118164l-8.599998474121094,8.600000381469727a1.4,1.4,0,1,1,-1.9810028076171875,-1.9799995422363281l7.6100006103515625,-7.6100006103515625L16.54900360107422,12.390999794006348A1.4,1.4,0,0,1,18.529998779296875,10.40999984741211l8.599998474121094,8.600000381469727a1.4,1.4,0,0,1,0,1.9799995422363281Z\">\n        </path>\n    </g>\n</svg>\n<svg viewBox=\"0 0 40 40\" id=\"icon-angle-down\">\n    <g transform=\"translate(50 0) rotate(90)\">\n        <path d=\"M27.128997802734375,20.989999771118164l-8.599998474121094,8.600000381469727a1.4,1.4,0,1,1,-1.9810028076171875,-1.9799995422363281l7.6100006103515625,-7.6100006103515625L16.54900360107422,12.390999794006348A1.4,1.4,0,0,1,18.529998779296875,10.40999984741211l8.599998474121094,8.600000381469727a1.4,1.4,0,0,1,0,1.9799995422363281Z\">\n        </path>\n    </g>\n</svg>\n<svg viewBox=\"0 0 455 455\" id=\"icon-chat\">\n    <path d=\"M419.967,162.004c-21.894-21.728-52.521-37.201-86.24-43.57c-4.069-0.766-7.993,1.908-8.762,5.978                     c-0.769,4.07,1.907,7.993,5.978,8.762C395.154,145.302,440,189.928,440,241.696c0,42.636-30.352,80.956-79.21,100.006                     c-2.494,0.973-4.281,3.201-4.688,5.847c-2.964,19.25,1.082,38.841,10.969,55.161c-21.588-5.766-39.074-22.333-45.875-44.782                     c-1.028-3.394-4.302-5.61-7.827-5.297c-5.297,0.46-10.636,0.694-15.869,0.694c-46.659,0-90.456-18-117.157-48.151                     c-2.745-3.101-7.485-3.389-10.587-0.643c-3.101,2.746-3.389,7.486-0.643,10.587c29.504,33.316,77.5,53.207,128.387,53.207                     c3.738,0,7.524-0.11,11.313-0.328c5.437,14.023,14.79,26.508,26.772,35.604c14.075,10.685,30.851,16.332,48.512,16.332                     c3.027,0,5.757-1.82,6.922-4.614s0.536-6.014-1.594-8.165c-13.83-13.961-20.775-33.575-19.005-53.169                     c24.22-10.168,44.756-25.233,59.594-43.76C446.36,289.816,455,266.12,455,241.696C455,212.727,442.559,184.425,419.967,162.004z\">\n    </path>\n    <path d=\"M315,161.696c0-34.155-16.61-66.156-46.771-90.109c-29.653-23.55-68.978-36.519-110.729-36.519                     c-41.754,0-81.08,12.969-110.731,36.519C16.609,95.54,0,127.541,0,161.696c0,24.424,8.64,48.121,24.985,68.529                     c14.838,18.526,35.375,33.592,59.594,43.76c1.77,19.594-5.175,39.208-19.005,53.169c-2.13,2.15-2.759,5.371-1.594,8.165                     s3.896,4.614,6.922,4.614c17.662,0,34.437-5.647,48.512-16.332c11.982-9.095,21.335-21.581,26.772-35.604                     c3.789,0.218,7.575,0.328,11.313,0.328c41.752,0,81.077-12.969,110.729-36.519C298.39,227.852,315,195.851,315,161.696z   \">\n    </path>\n</svg>\n<svg viewBox=\"0 0 489.776 489.776\" id=\"icon-mail\">\n    <path d=\"M469.075,64.488h-448.2c-10.3,0-18.8,7.5-20.5,17.3c-0.6,2.4-0.3,322.7-0.3,322.7c0,11.4,9.4,20.8,20.8,20.8h447.1                     c11.4,0,20.8-8.3,21.8-19.8v-320.2C489.875,73.788,480.475,64.488,469.075,64.488z M404.275,106.088l-159.8,114.4l-159.8-114.4                     H404.275z M40.675,384.788v-259.9l192.4,137.2c7.8,6.3,17.2,4.4,22.9,0l192.4-137.8v260.5L40.675,384.788L40.675,384.788z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 466 466\" id=\"icon-map-route\">\n    <path d=\"M462.361,88.299c-29.226-19.007-60.248-28.246-94.839-28.246c-46.24,0-92.504,16.737-137.244,32.924                     c-43.443,15.717-88.365,31.97-131.801,31.97c-31.398,0-59.567-8.393-86.116-25.659c-2.461-1.6-5.599-1.724-8.176-0.325                     C1.606,100.361,0,103.06,0,105.994v265c0,2.707,1.369,5.23,3.639,6.707c29.226,19.008,60.238,28.246,94.815,28.246                     c0.007,0,0.018,0,0.024,0c46.236-0.005,92.495-16.74,137.232-32.924c43.447-15.717,88.374-31.97,131.812-31.97                     c31.398,0,59.567,8.393,86.116,25.659c2.46,1.6,5.598,1.724,8.176,0.325c2.579-1.399,4.186-4.098,4.186-7.032v-265                     C466,92.299,464.631,89.775,462.361,88.299z M85,389.393c-24.67-1.979-47.392-9.48-69-22.801V120.098                     c21.685,11.867,44.46,18.568,69,20.347v47.799C73.368,198.425,66,213.364,66,230c0,12.655,8.791,29.701,19,45.232V389.393z                     M82,230c0-21.78,17.72-39.5,39.5-39.5c21.78,0,39.5,17.72,39.5,39.5c0,15.058-22.226,46.622-39.502,67.255                     C104.223,276.631,82,245.077,82,230z M225,359.881c-40.954,14.792-83.109,29.447-124,30.036v-92.565                     c7.082,9.033,12.883,15.626,14.529,17.472c1.518,1.702,3.69,2.676,5.971,2.676c2.28,0,4.453-0.974,5.971-2.676                     C132.54,309.14,177,258.46,177,230c0-30.603-24.898-55.5-55.5-55.5c-7.24,0-14.153,1.408-20.5,3.941v-37.522                     c41.716-0.544,83.427-14.443,124-29.026V359.881z M365,325.082c-41.716,0.544-83.428,14.441-124,29.022V106.115                     c40.954-14.793,83.108-29.447,124-30.032v41.753c-6.616-2.791-13.881-4.336-21.5-4.336c-30.603,0-55.5,24.897-55.5,55.5                     c0,28.46,44.46,79.14,49.529,84.824c1.518,1.702,3.69,2.676,5.971,2.676c2.28,0,4.453-0.974,5.971-2.676                     c1.723-1.932,7.998-9.065,15.529-18.753V325.082z M343.498,236.255C326.223,215.631,304,184.077,304,169                     c0-21.78,17.72-39.5,39.5-39.5c21.78,0,39.5,17.72,39.5,39.5C383,184.058,360.774,215.622,343.498,236.255z M450,345.902                     c-21.686-11.868-44.462-18.568-69.003-20.347c0-0.018,0.003-0.036,0.003-0.055V212.699c9.776-15.112,18-31.459,18-43.699                     c0-16.158-6.944-30.72-18-40.872v-51.52c24.675,1.981,47.395,9.481,69,22.799V345.902z\">\n    </path>\n    <path d=\"M147,230c0-14.061-11.44-25.5-25.5-25.5c-14.061,0-25.5,11.439-25.5,25.5c0,14.061,11.439,25.5,25.5,25.5                     C135.56,255.5,147,244.061,147,230z M112,230c0-5.238,4.262-9.5,9.5-9.5s9.5,4.262,9.5,9.5c0,5.238-4.262,9.5-9.5,9.5                     S112,235.238,112,230z\">\n    </path>\n    <path d=\"M343.5,143.5c-14.061,0-25.5,11.439-25.5,25.5c0,14.061,11.439,25.5,25.5,25.5c14.06,0,25.5-11.439,25.5-25.5                     C369,154.939,357.56,143.5,343.5,143.5z M343.5,178.5c-5.238,0-9.5-4.262-9.5-9.5c0-5.238,4.262-9.5,9.5-9.5                     c5.238,0,9.5,4.262,9.5,9.5C353,174.238,348.738,178.5,343.5,178.5z\">\n    </path>\n    <path d=\"M125.459,332.209c-1.295,0.254-2.591,0.499-3.887,0.734c-4.347,0.788-7.232,4.952-6.444,9.299                     c0.701,3.865,4.069,6.574,7.863,6.574c0.473,0,0.954-0.043,1.436-0.13c1.37-0.249,2.742-0.508,4.113-0.777                     c4.336-0.851,7.16-5.056,6.31-9.392C133.998,334.183,129.788,331.356,125.459,332.209z\">\n    </path>\n    <path d=\"M193.404,328.958c0.876,0,1.767-0.145,2.641-0.45c2.397-0.838,4.795-1.685,7.191-2.538                     c4.162-1.479,6.336-6.054,4.855-10.217c-1.48-4.163-6.055-6.337-10.219-4.856c-2.369,0.843-4.739,1.68-7.109,2.508                     c-4.171,1.458-6.369,6.021-4.911,10.192C187.005,326.894,190.098,328.958,193.404,328.958z\">\n    </path>\n    <path d=\"M269.894,285.949c-2.449,0.742-4.897,1.504-7.347,2.282c-4.211,1.337-6.54,5.836-5.203,10.046                     c1.082,3.405,4.23,5.58,7.623,5.58c0.803,0,1.618-0.122,2.424-0.377c2.381-0.756,4.763-1.497,7.144-2.218                     c4.229-1.282,6.617-5.748,5.336-9.977C278.589,287.056,274.122,284.668,269.894,285.949z\">\n    </path>\n    <path d=\"M162.268,322.81c-2.383,0.727-4.767,1.435-7.15,2.122c-4.245,1.223-6.695,5.657-5.472,9.902                     c1.011,3.506,4.209,5.787,7.684,5.787c0.733,0,1.479-0.102,2.22-0.315c2.462-0.709,4.924-1.441,7.385-2.191                     c4.226-1.288,6.607-5.759,5.319-9.985C170.964,323.904,166.494,321.523,162.268,322.81z\">\n    </path>\n    <path d=\"M311.572,275.629c-1.37,0.249-2.742,0.508-4.113,0.777c-4.336,0.851-7.16,5.056-6.31,9.392                     c0.75,3.814,4.095,6.459,7.842,6.459c0.511,0,1.03-0.049,1.55-0.151c1.295-0.254,2.591-0.499,3.887-0.734                     c4.347-0.788,7.233-4.952,6.444-9.299C320.083,277.726,315.926,274.838,311.572,275.629z\">\n    </path>\n    <path d=\"M346.572,267.629c-1.37,0.249-2.742,0.508-4.113,0.777c-4.336,0.851-7.16,5.056-6.31,9.392                     c0.75,3.814,4.095,6.459,7.842,6.459c0.511,0,1.03-0.049,1.55-0.151c1.295-0.254,2.591-0.499,3.887-0.734                     c4.347-0.788,7.233-4.952,6.444-9.299C355.084,269.726,350.923,266.838,346.572,267.629z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 486 486\" id=\"icon-plane\">\n    <path d=\"M481.883,61.238l-474.3,171.4c-8.8,3.2-10.3,15-2.6,20.2l70.9,48.4l321.8-169.7l-272.4,203.4v82.4c0,5.6,6.3,9,11,5.9                     l60-39.8l59.1,40.3c5.4,3.7,12.8,2.1,16.3-3.5l214.5-353.7C487.983,63.638,485.083,60.038,481.883,61.238z\">\n    </path>\n</svg>\n<svg viewBox=\"0 0 15 15\" id=\"icon-calendar\">\n    <path d=\"M3.669,3.71h0.696c0.256,0,0.464-0.165,0.464-0.367V0.367C4.829,0.164,4.621,0,4.365,0H3.669    C3.414,0,3.206,0.164,3.206,0.367v2.976C3.205,3.545,3.413,3.71,3.669,3.71z\" />\n    <path d=\"M10.95,3.71h0.696c0.256,0,0.464-0.165,0.464-0.367V0.367C12.11,0.164,11.902,0,11.646,0H10.95    c-0.256,0-0.463,0.164-0.463,0.367v2.976C10.487,3.545,10.694,3.71,10.95,3.71z\" />\n    <path d=\"M14.512,1.42h-1.846v2.278c0,0.509-0.458,0.923-1.021,0.923h-0.696    c-0.563,0-1.021-0.414-1.021-0.923V1.42H5.384v2.278c0,0.509-0.458,0.923-1.021,0.923H3.669c-0.562,0-1.02-0.414-1.02-0.923V1.42    H0.803c-0.307,0-0.557,0.25-0.557,0.557V14.76c0,0.307,0.25,0.555,0.557,0.555h13.709c0.308,0,0.557-0.248,0.557-0.555V1.977    C15.069,1.67,14.82,1.42,14.512,1.42z M14.316,9.49v4.349c0,0.096-0.078,0.176-0.175,0.176H7.457H1.174    c-0.097,0-0.175-0.08-0.175-0.176V10.31V5.961c0-0.096,0.078-0.176,0.175-0.176h6.683h6.284l0,0c0.097,0,0.175,0.08,0.175,0.176    V9.49z\" />\n    <rect x=\"2.327\" y=\"8.93\" width=\"1.735\" height=\"1.736\" />\n    <rect x=\"5.28\" y=\"8.93\" width=\"1.735\" height=\"1.736\" />\n    <rect x=\"8.204\" y=\"8.93\" width=\"1.734\" height=\"1.736\" />\n    <rect x=\"11.156\" y=\"8.93\" width=\"1.736\" height=\"1.736\" />\n    <rect x=\"2.363\" y=\"11.432\" width=\"1.736\" height=\"1.736\" />\n    <rect x=\"5.317\" y=\"11.432\" width=\"1.735\" height=\"1.736\" />\n    <rect x=\"8.241\" y=\"11.432\" width=\"1.734\" height=\"1.736\" />\n    <rect x=\"11.194\" y=\"11.432\" width=\"1.735\" height=\"1.736\" />\n    <rect x=\"8.215\" y=\"6.47\" width=\"1.735\" height=\"1.735\" />\n    <rect x=\"11.17\" y=\"6.47\" width=\"1.734\" height=\"1.735\" />\n</svg>\n<svg viewBox=\"0 0 24 24\" id=\"icon-upload\">\n    <path fill-rule=\"evenodd\" d=\"M21,11 L21,20 C21,21.1045695 20.1045695,22 19,22 L5,22 C3.8954305,22 3,21.1045695 3,20 L3,11 L5,11 L5,20 L19,20 L19,11 L21,11 Z M13,5.41421356 L13,16 L11,16 L11,5.41421356 L7.70710678,8.70710678 L6.29289322,7.29289322 L12,1.58578644 L17.7071068,7.29289322 L16.2928932,8.70710678 L13,5.41421356 Z\" />\n</svg>\n<svg viewBox=\"0 0 64 64\" id=\"icon-avatar\">\n    <path d=\"M32,32.86a9.22,9.22,0,1,1,9.21-9.22A9.23,9.23,0,0,1,32,32.86Zm0-15.43a6.22,6.22,0,1,0,6.21,6.21A6.21,6.21,0,0,0,32,17.43Z\" />\n    <path d=\"M32,56.64a24.68,24.68,0,0,1-15.22-5.27,1.52,1.52,0,0,1-.57-1.06c0-.16,0-.31,0-.47a15.8,15.8,0,1,1,31.6,0c0,.16,0,.31,0,.47a1.52,1.52,0,0,1-.57,1.06A24.68,24.68,0,0,1,32,56.64ZM19.21,49.45a21.62,21.62,0,0,0,25.58,0,12.8,12.8,0,0,0-25.58,0Zm27.08.74h0Z\" />\n    <path d=\"M32,56.64a24.65,24.65,0,1,1,15.22-5.27A24.68,24.68,0,0,1,32,56.64Zm0-46.28A21.63,21.63,0,0,0,18.64,49a21.64,21.64,0,0,0,35-17A21.67,21.67,0,0,0,32,10.36Z\" />\n</svg>\n<svg viewBox=\"0 0 118 122\" id=\"icon-cart\">\n    <path d=\"M3.92,22.79C1.81,22.79,0,20.98,0,18.77c0-2.11,1.81-3.92,3.92-3.92h5.43c0.1,0,0.3,0,0.41,0c3.62,0.1,6.84,0.8,9.54,2.51 c3.01,1.91,5.22,4.82,6.43,9.15c0,0.1,0,0.2,0.1,0.3l1,4.03h19.02v7.83h-16.8l0,0l8.94,33.67h63.4l8.34-33.67h-9.85v-7.83h13.92 h0.96c2.21,0,3.92,1.81,3.92,3.92c0,0.41-0.11,0.8-0.2,1.21l-10.25,41.3c-0.4,1.81-2.01,3.01-3.81,3.01l0,0H40.09 c1.41,5.22,2.81,8.04,4.72,9.35c2.31,1.51,6.34,1.6,13.07,1.51h0.1l0,0h45.42c2.21,0,3.92,1.81,3.92,3.92 c0,2.21-1.8,3.92-3.92,3.92H57.98l0,0c-8.34,0.1-13.46-0.1-17.59-2.81c-4.22-2.81-6.43-7.64-8.64-16.38l0,0L18.29,28.83 c0-0.1,0-0.1-0.1-0.2c-0.6-2.21-1.6-3.72-3.01-4.52c-1.41-0.91-3.31-1.3-5.52-1.3c-0.1,0-0.2,0-0.3,0L3.92,22.79L3.92,22.79 L3.92,22.79L3.92,22.79z M72.92,1.07l16.26,13.35c1.99,1.6,2.31,4.53,0.71,6.52c-1.6,1.99-4.53,2.31-6.52,0.71l-8.77-7.3l0.01,26.2 c0,2.56-2.07,4.63-4.63,4.63c-2.55,0-4.63-2.07-4.63-4.63l-0.01-26.21l-8.78,7.3c-1.99,1.6-4.91,1.28-6.52-0.71 c-1.6-1.99-1.28-4.91,0.71-6.52L67.02,1.07l0.05-0.04c1.71-1.33,3.94-1.43,5.79,0L72.92,1.07L72.92,1.07L72.92,1.07z M81.49,58.08 c0-1.24,1.23-2.24,2.73-2.24c1.51,0,2.73,1,2.73,2.24v4.71c0,1.24-1.23,2.24-2.73,2.24c-1.51,0-2.73-1-2.73-2.24V58.08L81.49,58.08 L81.49,58.08z M65.12,58.08c0-1.24,1.23-2.24,2.73-2.24c1.51,0,2.73,1,2.73,2.24v4.71c0,1.24-1.23,2.24-2.73,2.24 c-1.51,0-2.73-1-2.73-2.24V58.08L65.12,58.08L65.12,58.08z M48.76,58.08c0-1.24,1.23-2.24,2.73-2.24c1.51,0,2.73,1,2.73,2.24v4.71 c0,1.24-1.23,2.24-2.73,2.24c-1.51,0-2.73-1-2.73-2.24V58.08L48.76,58.08L48.76,58.08z M91.64,103.58c5.33,0,9.65,4.32,9.65,9.65 s-4.32,9.65-9.65,9.65c-5.32,0-9.65-4.32-9.65-9.65S86.32,103.58,91.64,103.58L91.64,103.58L91.64,103.58L91.64,103.58z M49.34,103.58c5.32,0,9.65,4.32,9.65,9.65s-4.32,9.65-9.65,9.65s-9.65-4.32-9.65-9.65S44.01,103.58,49.34,103.58L49.34,103.58 L49.34,103.58L49.34,103.58z\" />\n</svg>\n<svg viewBox=\"0 0 48 48\" id=\"icon-attachment\">\n    <path d=\"M33 12v23c0 4.42-3.58 8-8 8s-8-3.58-8-8v-25c0-2.76 2.24-5 5-5s5 2.24 5 5v21c0 1.1-.89 2-2 2-1.11 0-2-.9-2-2v-19h-3v19c0 2.76 2.24 5 5 5s5-2.24 5-5v-21c0-4.42-3.58-8-8-8s-8 3.58-8 8v25c0 6.08 4.93 11 11 11s11-4.92 11-11v-23h-3z\" />\n    <path d=\"M0 0h48v48h-48z\" fill=\"none\" />\n</svg>\n<svg viewBox=\"0 0 372 372\" id=\"icon-products\">\n    <path d=\"M368.712,219.925c-5.042-8.951-14.563-14.511-24.848-14.511c-4.858,0-9.682,1.27-13.948,3.672l-83.024,46.756\n        c-1.084,0.61-1.866,1.642-2.163,2.85c-1.448,5.911-4.857,14.164-12.865,19.911c-8.864,6.361-20.855,7.686-35.466,3.939\n        c-0.088-0.022-0.175-0.047-0.252-0.071L148.252,267.6c-2.896-0.899-4.52-3.987-3.621-6.882c0.72-2.316,2.83-3.872,5.251-3.872\n        c0.55,0,1.101,0.084,1.634,0.249l47.645,14.794c0.076,0.023,0.154,0.045,0.232,0.065c11.236,2.836,20.011,2.047,26.056-2.288\n        c7.637-5.48,8.982-15.113,9.141-16.528c0.006-0.045,0.011-0.09,0.014-0.136c0.003-0.023,0.004-0.036,0.005-0.039\n        c0.001-0.015,0.002-0.03,0.003-0.044c0.001-0.01,0.001-0.019,0.002-0.029c0.909-11.878-6.756-22.846-18.24-26.089l-0.211-0.064\n        c-0.35-0.114-35.596-11.626-58.053-18.034c-2.495-0.711-9.37-2.366-19.313-2.366c-13.906,0-34.651,3.295-54.549,19.025\n        L1.67,292.159c-1.889,1.527-2.224,4.278-0.758,6.215l44.712,59.06c0.725,0.956,1.801,1.584,2.99,1.744\n        c0.199,0.027,0.398,0.04,0.598,0.04c0.987,0,1.954-0.325,2.745-0.935l57.592-44.345c1.294-0.995,3.029-1.37,4.619-0.995\n        l93.02,21.982c6.898,1.63,14.353,0.578,20.523-2.9l130.16-73.304C371.555,251.012,376.418,233.61,368.712,219.925z\" />\n    <path d=\"M316.981,13.155h-170c-5.522,0-10,4.477-10,10v45.504c0,5.523,4.478,10,10,10h3.735v96.623c0,5.523,4.477,10,10,10h142.526\n        c5.523,0,10-4.477,10-10V78.658h3.738c5.522,0,10-4.477,10-10V23.155C326.981,17.632,322.503,13.155,316.981,13.155z\n        M253.016,102.417h-42.072c-4.411,0-8-3.589-8-8c0-4.411,3.589-8,8-8h42.072c4.411,0,8,3.589,8,8\n        C261.016,98.828,257.427,102.417,253.016,102.417z M306.981,58.658h-3.738H160.716h-3.735V33.155h150V58.658z\" />\n</svg>\n<svg viewBox=\"0 0 100 100\" id=\"icon-file\">\n    <path d=\"M 77.474 17.28 L 61.526 1.332 C 60.668 0.473 59.525 0 58.311 0 H 15.742 c -2.508 0 -4.548 2.04 -4.548 4.548 v 80.904 c 0 2.508 2.04 4.548 4.548 4.548 h 58.516 c 2.508 0 4.549 -2.04 4.549 -4.548 V 20.496 C 78.807 19.281 78.333 18.138 77.474 17.28 z M 61.073 5.121 l 12.611 12.612 H 62.35 c -0.704 0 -1.276 -0.573 -1.276 -1.277 V 5.121 z M 15.742 3 h 42.332 v 13.456 c 0 2.358 1.918 4.277 4.276 4.277 h 13.457 v 33.2 H 14.194 V 4.548 C 14.194 3.694 14.888 3 15.742 3 z M 74.258 87 H 15.742 c -0.854 0 -1.548 -0.694 -1.548 -1.548 V 56.934 h 61.613 v 28.519 C 75.807 86.306 75.112 87 74.258 87 z\" style=\"stroke: none;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n    <text y=\"75\" x=\"47\" text-anchor=\"middle\"></text>\n</svg>\n<svg viewBox=\"0 0 1000 1000\" id=\"icon-contacts\">\n    <path d=\"M835.3,35.8H267.9c-85.3,0-154.7,69.4-154.7,154.7v51.6H61.6c-28.5,0-51.6,23.1-51.6,51.6c0,28.5,23.1,51.6,51.6,51.6h51.6v103.2H61.6C33.1,448.4,10,471.5,10,500c0,28.5,23.1,51.6,51.6,51.6h51.6v103.2H61.6c-28.5,0-51.6,23.1-51.6,51.6c0,28.5,23.1,51.6,51.6,51.6h51.6v51.6c0,85.3,69.4,154.7,154.7,154.7h567.4c85.3,0,154.7-69.4,154.7-154.7V190.5C990,105.2,920.6,35.8,835.3,35.8L835.3,35.8z M216.3,190.5c0-28.4,23.2-51.6,51.6-51.6v103.2h-51.6V190.5L216.3,190.5z M216.3,345.3h51.6v103.2h-51.6V345.3z M216.3,551.6h51.6v103.2h-51.6V551.6z M216.3,809.5v-51.6h51.6V861C239.5,861,216.3,837.9,216.3,809.5L216.3,809.5z M886.8,809.5c0,28.4-23.2,51.6-51.6,51.6H319.5V138.9h515.8c28.4,0,51.6,23.2,51.6,51.6V809.5L886.8,809.5z\" />\n    <path d=\"M680.5,422.6c0,57-46.2,103.2-103.2,103.2s-103.2-46.2-103.2-103.2s46.2-103.2,103.2-103.2S680.5,365.7,680.5,422.6z\" />\n    <path d=\"M577.4,569.9c-80.6,0-128.9,36.9-128.9,73.7c0,18.4,48.4,36.9,128.9,36.9c75.6,0,128.9-18.4,128.9-36.9C706.3,606.8,655.8,569.9,577.4,569.9z\" />\n</svg>\n<svg viewBox=\"0 0 1024 1024\" id=\"icon-speak\">\n    <path d=\"M438.279 874.891H190.054V826.76h200.094v-77.44l-92.539-65.993a31.874 31.874 0 0 1-13.325-25.547c-.106-10.13 4.676-19.788 12.785-25.828l93.079-69.424v-104.7l74.595-5.924L303.79 153.856l42.35-22.89 196.064 363.102-103.925 8.225v68.413c0 9.989-4.77 19.506-12.762 25.476l-81.716 60.964 81.151 57.862c8.367 5.993 13.326 15.652 13.326 25.875V874.89zm-264.72-592.51a43.988 43.988 0 1 0 87.976 0 43.988 43.988 0 1 0-87.976 0zm381.183 448.772c-10.54 0-20.21-6.98-23.172-17.626-3.56-12.809 3.936-26.064 16.733-29.636 12.15-3.36 20.635-14.524 20.635-27.144 0-12.503-8.015-23.338-19.941-26.957-12.726-3.878-19.894-17.32-16.04-30.035 3.877-12.738 17.38-19.86 30.023-16.028 32.35 9.847 54.089 39.177 54.089 73.02 0 34.147-22.973 64.37-55.863 73.536-2.163.589-4.337.87-6.464.87z\" /><path d=\"M625.635 820.53c-8.66 0-17.015-4.676-21.328-12.878-6.18-11.751-1.656-26.298 10.107-32.48 44.3-23.29 71.821-68.813 71.821-118.802 0-49.19-26.886-94.36-70.152-117.885-11.68-6.345-16.005-20.963-9.648-32.643 6.345-11.68 20.94-15.981 32.632-9.66 58.778 31.963 95.3 93.35 95.3 160.19 0 67.919-37.38 129.776-97.556 161.386a23.945 23.945 0 0 1-11.176 2.773z\" /><path d=\"M697.727 893.034c-8.66 0-17.016-4.676-21.328-12.88-6.18-11.75-1.656-26.298 10.106-32.479C757.94 810.12 802.31 736.7 802.31 656.09c0-79.342-43.35-152.174-113.114-190.106-11.68-6.37-16.005-20.964-9.648-32.644 6.345-11.703 20.963-15.98 32.632-9.659 85.288 46.37 138.261 135.418 138.261 232.41 0 98.567-54.23 188.296-141.54 234.171a23.94 23.94 0 0 1-11.174 2.773z\" />\n</svg>\n<svg viewBox=\"0 0 1024 1024\" id=\"icon-bot\">\n    <path d=\"M683.11 286.72h115.61a81.92 81.92 0 0 1 81.92 81.92v40.96h40.96a40.96 40.96 0 0 1 40.96 40.96v143.36a40.96 40.96 0 0 1-40.96 40.96h-40.96v20.48c0 135.721-110.039 245.76-245.76 245.76H389.12c-135.721 0-245.76-110.039-245.76-245.76v-20.48H102.4a40.96 40.96 0 0 1-40.96-40.96V450.56a40.96 40.96 0 0 1 40.96-40.96h40.96v-40.96a81.92 81.92 0 0 1 81.92-81.92h115.61l-23.47-41.82a61.44 61.44 0 1 1 63.856-30.515l40.612 72.335h180.224l40.591-72.335A61.44 61.44 0 1 1 706.56 244.9l-23.43 41.82zM430.08 675.84a40.96 40.96 0 1 0 0 81.92h163.84a40.96 40.96 0 1 0 0-81.92H430.08zm-92.16-102.4a71.68 71.68 0 1 0 0-143.36 71.68 71.68 0 0 0 0 143.36zm348.16 0a71.68 71.68 0 1 0 0-143.36 71.68 71.68 0 0 0 0 143.36z\" />\n</svg>\n<svg viewBox=\"0 0 32 32\" id=\"icon-arrow-vector\">\n    <path d=\"M17.1 11.2 5.5 22.8l4.9 4.9L22 16.1l4 3.9.4-13.2-13.2.5 3.9 3.9zm8 6.5-3-3-11.6 11.6L7 22.8l11.6-11.6-3-3 9.8-.3-.3 9.8z\" />\n</svg>\n<svg viewBox=\"-7 0 32 32\" id=\"icon-media-play\">\n  <path d=\"M0 6.688v18.906c0 .344.156.625.469.813.125.094.344.125.5.125s.281-.031.438-.125l16.375-9.438c.313-.219.5-.5.5-.844 0-.313-.188-.594-.5-.813L1.407 5.874c-.563-.406-1.406.094-1.406.813z\"/>\n</svg>\n<svg  viewBox=\"0 0 24 24\" id=\"icon-media-stop\">\n  <path  fill-rule=\"evenodd\" d=\"M4 18a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v12z\" clip-rule=\"evenodd\"/>\n</svg>\n<svg  viewBox=\"0 0 24 24\" id=\"icon-media-record\">\n  <path  d=\"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z\"/>\n</svg>\n<svg  viewBox=\"0 0 24 24\" id=\"icon-media-pause\">\n  <path fill-rule=\"evenodd\" d=\"M5.163 3.819C5 4.139 5 4.559 5 5.4v13.2c0 .84 0 1.26.163 1.581a1.5 1.5 0 0 0 .656.655c.32.164.74.164 1.581.164h.2c.84 0 1.26 0 1.581-.163a1.5 1.5 0 0 0 .656-.656c.163-.32.163-.74.163-1.581V5.4c0-.84 0-1.26-.163-1.581a1.5 1.5 0 0 0-.656-.656C8.861 3 8.441 3 7.6 3h-.2c-.84 0-1.26 0-1.581.163a1.5 1.5 0 0 0-.656.656zm9 0C14 4.139 14 4.559 14 5.4v13.2c0 .84 0 1.26.164 1.581a1.5 1.5 0 0 0 .655.655c.32.164.74.164 1.581.164h.2c.84 0 1.26 0 1.581-.163a1.5 1.5 0 0 0 .655-.656c.164-.32.164-.74.164-1.581V5.4c0-.84 0-1.26-.163-1.581a1.5 1.5 0 0 0-.656-.656C17.861 3 17.441 3 16.6 3h-.2c-.84 0-1.26 0-1.581.163a1.5 1.5 0 0 0-.655.656z\" clip-rule=\"evenodd\"/>\n</svg>\n<svg viewBox=\"0 0 32 32\" id=\"icon-create\">\n    <path d=\"M27.2,8.22H23.78V5.42A3.42,3.42,0,0,0,20.36,2H5.42A3.42,3.42,0,0,0,2,5.42V20.36a3.42,3.42,0,0,0,3.42,3.42h2.8V27.2A2.81,2.81,0,0,0,11,30H27.2A2.81,2.81,0,0,0,30,27.2V11A2.81,2.81,0,0,0,27.2,8.22ZM5.42,21.91a1.55,1.55,0,0,1-1.55-1.55V5.42A1.54,1.54,0,0,1,5.42,3.87H20.36a1.55,1.55,0,0,1,1.55,1.55v2.8H11A2.81,2.81,0,0,0,8.22,11V21.91ZM28.13,27.2a.93.93,0,0,1-.93.93H11a.93.93,0,0,1-.93-.93V11a.93.93,0,0,1,.93-.93H27.2a.93.93,0,0,1,.93.93Z\"></path><path d=\"M24.09,18.18H20v-4a.93.93,0,1,0-1.86,0v4h-4a.93.93,0,0,0,0,1.86h4v4.05a.93.93,0,1,0,1.86,0V20h4.05a.93.93,0,1,0,0-1.86Z\"></path>\n</svg>\n<svg  viewBox=\"0 0 48 48\" id=\"icon-folder\">\n    <path fill=\"grey\" d=\"M40,12H22l-4-4H8c-2.2,0-4,1.8-4,4v8h40v-4C44,13.8,42.2,12,40,12z\"/>\n    <path fill=\"darkgrey\" d=\"M40,12H8c-2.2,0-4,1.8-4,4v20c0,2.2,1.8,4,4,4h32c2.2,0,4-1.8,4-4V16C44,13.8,42.2,12,40,12z\"/>\n</svg>\n\n<svg viewBox=\"0 0 512 512\" id=\"icon-drive\">\n\t<circle cx=\"256\" cy=\"256\" r=\"32\"/>\n\t<path d=\"M256,0C114.617,0,0,114.617,0,256s114.617,256,256,256s256-114.617,256-256S397.383,0,256,0z M443.852,167.281\n\t\tl-59.492,23.797c-13.867-27.305-36.133-49.57-63.438-63.437l23.797-59.492C388.141,88.746,423.25,123.859,443.852,167.281z\n\t\t M186.93,213.723c5.969-11.352,15.445-20.828,26.797-26.797c75.438-39.684,151.031,35.918,111.344,111.352\n\t\tc-5.969,11.348-15.445,20.824-26.797,26.797C222.836,364.758,147.242,289.156,186.93,213.723z M68.148,344.719l59.492-23.797\n\t\tc13.867,27.305,36.133,49.57,63.437,63.438l-23.797,59.492C123.859,423.254,88.742,388.141,68.148,344.719z\"/>\n</svg>\n\n\n\n";try{$('.warp .gui').append(icons);}catch(e){console.log('autogenerated error from build of icons gui : no \'.main\', icons going to \'.gui\'');}};function createDisplayGUI(app){function ev(sel,type,listener){app.el.querySelector(sel).addEventListener(type,listener);}{app.el.innerHTML="\n<div class=\"display\" style=\"background-color:rgb(10,10,10)\">      \n    <div class=\"toolbar hmd tl hidden\">\n        <div class=\"fl ml5 hidden\">\n            <span class=\"small\"> \n                Current : \n                <br>\n            </span>\n            <div  class=\"current\" style=\"width:160px\">\n            </div>\n        </div>\n        <div class=\"fl hidden\">\n            <span class=\"small\"> \n                History : \n                <br>\n            </span>\n            <div  class=\"history\">\n            </div>\n        </div>\n    \n        <div class=\"zoom fr mr5\">\n            <small> \n                Zoom : \n                <br>\n            </small>\n            <button class=\"xs minus\" style=\"padding:0px;width:25px; margin-right:1px; border-radius:2px\">-</button>\n            <input type=\"text\" class=\"xs mr5 disabled\" style=\"width:50px; margin-right:1px;\" value=\"100%\"/> \n            <button class=\"xs plus\" style=\"padding:0px;width:25px; margin-right:1px; border-radius:2px\">+</button>\n            \n        </div>\n        <div class=\"fr\" >\n            <span class=\"small\"> \n                Tool : \n                <br>\n            </span>\n            <div  class=\"tool \" >\n                <select class=\"xs\" style=\"width:160px\" onchange=\"toast('drop a Tool on the display!')\">\n                    <option value=\"select\">select</option>\n                     <option value=\"custom\">custom</option>\n                </select>\n            </div>\n        </div>\n        <div class=\"fr hidden\">\n            <span class=\"small\"> \n                Custom : \n                <br>\n            </span>\n            <div  class=\"custom block\">\n            </div>\n        </div>\n    </div>\n    <div class=\"stage\" style=\" background-color:rgb(10,10,10)\">\n        <div class=\"body\" style=\"margin-left:auto;margin-right:auto;\">\n        </div>\n    </div>\n</div>\n    ";}app.toolbar={toggle:async function toggle(){if(app.el.querySelector('.toolbar').getAttribute('class').contains('hidden')){app.show();}else app.hide();},show:async function show(){app.el.querySelector('.toolbar').classList.remove('hidden');},hide:async function hide(){app.el.querySelector('.toolbar').classList.add('hidden');}};app.zoom={set:async function set(level){app.zoom.level=level;if(level>100){app.el.querySelector('.stage').style.overflow='scroll';}else{app.el.querySelector('.stage').style.overflow='initial';}},get:async function get(){return app.zoom.level;},level:100};app.tool={set:async function set(tool){if(tool.type!==app.type){alert('This tool was not created for this type of Display.');}else app.tool.current=tool;},get:async function get(){return app.tool.current;},current:false};ev('button.plus','click',function(e){if(app.zoom.level+10>300)return toast(app.zoom.level+'% is maximum zoom level');app.zoom.set(app.zoom.level+10);app.el.querySelector('.zoom input').value=app.zoom.level+'%';app.el.querySelector('.stage > .body').style.transform='scale('+app.zoom.level/100+')';});ev('button.minus','click',function(e){if(app.zoom.level-10<30)return toast(app.zoom.level+'% is minimum zoom level');app.zoom.set(app.zoom.level-10);app.el.querySelector('.zoom input').value=app.zoom.level+'%';app.el.querySelector('.body').style.transform='scale('+app.zoom.level/100+')';});}Warp.Gui.prototype.DOMDisplay=function(el){var app=this;var current;app=Object.assign(this,new warp.factory.App({winOpts:{close:false,scale:true,height:'auto',width:'auto',backdrop:false,onResize:function onResize(w){}},name:'DOMDisplay'}));createDisplayGUI(app);warp.dom.context.add(app.el.querySelector('.body'),{'inspect':function inspect(){warp.inspect(app);},'inspect element':function inspectElement(){warp.inspect(current);}},'Display');app.get=function(){};app.set=function(subject){current=subject;app.el.querySelector('.body').innerHTML='';app.el.querySelector('.body').append(subject);app.show();var r=subject.getBoundingClientRect();app.win.width(r.width+5);return app;};if(el)app.set(el);return app;};function Display(subject,options){options=extend({width:700,height:700,wrapper:{width:100,height:100}},options,true);var app=extend(this,new App({name:'Display',winOpts:{minWidth:500,minHeight:500,width:options.width,height:options.height,scale:true,onShow:function onShow(){resizeGui();}}}));var lastWinPosition={};function ev(sel,type,listener){if(typeof sel=='string')sel=app.el.querySelector(sel);sel.addEventListener(type,listener);}function resizeGui(){var stageH=warp.dom.height(app.el)-warp.dom.height(app.query('.toolbar'));stage.height(stageH);if(app.current){if(app.current.height+100>stageH){wrapper.height(stageH-100);}else wrapper.height(app.current.height);if(app.current.width+100>stage.width()){wrapper.width(stage.width()-100);}else wrapper.width(app.current.width);var marginT=warp.dom.height(app.el)/2-wrapper.height()/2+warp.dom.height(app.query('.toolbar'));wrapper.el.style.top=marginT+'px';var marginL=warp.dom.width(app.el)/2-wrapper.width()/2;stage.rulerTop.style.left=marginL+'px';wrapper.el.style.left=marginL+'px';wrapper.ruler.style.left=marginL+'px';wrapper.ruler.style.top=marginT-7+'px';wrapper.ruler.style.width=wrapper.width()+'px';stage.el.querySelector('.dims').innerHTML="\n        Stage :  ".concat(stage.width()," /  ").concat(stageH,"  <br>\n        Content :  ").concat(app.current.width," /  ").concat(app.current.height,"  <br>\n        Wrapper :  ").concat(wrapper.width(),"  /  ").concat(wrapper.height(),"  \n        ");}}async function handleSession(session){app.current=session;async function handleFile(file){switch(file.type){case'jpg':case'jpeg':case'webp':case'svg':case'png':if(!file.data)file=await warp.open(file);var ft=warp.fileType(file.type);app.current.el=new Image();app.current.el.onload=function(){app.current.width=app.current.el.naturalWidth;app.current.height=app.current.el.naturalHeight;app.current.el.setAttribute('style',' width:100%;');app.current.el.style.pointerEvents='none';wrapper.width(app.current.height);wrapper.height(app.current.height);setEl(app.current.el);};app.current.el.src=URL.createObjectURL(new Blob([file.data],{type:ft.mime}));break;default:var el=warp.dom.node('div');el.innerHTML='<h1 class="m20">'+file.type+'</h1>';setEl(el);}}handleFile(session.subject);}app.current;var sessions={};var stage={width:function width(val){if(val){warp.dom.width(stage.el,val);}return warp.dom.width(stage.el);},height:function height(val){if(val){warp.dom.height(stage.el,val);}return warp.dom.height(stage.el);},ruler:false,el:false};var wrapper={width:function width(val){if(val){warp.dom.width(wrapper.el,val);}return warp.dom.width(wrapper.el);},height:function height(val){if(val){warp.dom.height(wrapper.el,val);}return warp.dom.height(wrapper.el);},rulerTop:false,rulerLeft:false,el:false};var body={width:function width(val){if(val){warp.dom.width(body.el,val);warp.dom.width(wrapper.ruler,val);}return warp.dom.width(body.el);},height:function height(val){if(val){warp.dom.height(body.el,val);}return warp.dom.height(body.el);},el:false};var toolbar={toggle:async function toggle(){if(app.el.querySelector('.toolbar').getAttribute('class').contains('hidden')){app.show();}else app.hide();},show:async function show(){app.el.querySelector('.toolbar').classList.remove('hidden');},hide:async function hide(){app.el.querySelector('.toolbar').classList.add('hidden');}};var tool={set:async function set(tool){if(tool.type!==app.type){alert('This tool was not created for this type of Display.');}else tool.current=tool;},get:async function get(){return tool.current;},current:false};var zoom={set:async function set(level){if(level>800){toast('max zoom');return;}if(level<5){toast('min zoom');return;}zoom.level=level;app.el.querySelector('.zoom input').value=zoom.level+'%';resizeGui();},get:async function get(){return zoom.level;},level:100};app.zoom=function(val){if(val){zoom.level=parseInt(val);}else return zoom.level;};function setEl(el){wrapper.el.innerHTML='';wrapper.el.append(el);setTimeout(resizeGui,10);}app.open=function(file){var s={id:rand(),subject:file,zoom:100,destroy:function destroy(){delete sessions[this.id];},display:app};file.display=app;sessions[s.id]=s;handleSession(s);var c=app.query('.current');c.innerHTML='';c.append(warp.dom.node('item',{},{data:file,text:file.name}));app.show();return s;};function construct(){{var style="\n        <style>\n            .display {  \n          \n            }\n            .display > .stage {\n              background-image: linear-gradient(45deg,rgba(0,0,0,.4) 25%,rgba(0,0,0,.3) 25%,rgba(0,0,0,.3) 50%,rgba(0,0,0,.4) 50%,rgba(0,0,0,.4) 75%,rgba(0,0,0,.3) 75%,rgba(0,0,0,.3) 100%);\n                background-size: 30.57px 30px;\n                box-shadow :  0px 0px 100px 20px black inset;\n                overflow : hidden;\n                \n            }\n             .display > .stage >.dims {\n             margin:20px;\n              float:right;\n              display:inline-block;\n              text-align:right}\n             .display > .stage .ruler{\n                position:absolute;\n                text-align:left;\n            \n                opacity:0.3;\n                display: inline-block;\n                background-image: url(https://bemjax.com/storage/profiles/_1/_0/_0/100000001/private/ruler.png);\n                background-size: 100px 5px;\n                  width :100%;\n              left:0px; height :5px;\n               \n            }\n            .display > .stage  .ruler.top{\n                transform : scale(1, -1);\n               \n            }\n            .display > .stage  .ruler.bottom{\n                 height:5px;\n                width:0px;\n                left:0px\n            }\n            .display > .stage > .wrapper {  \n               position : absolute;\n                margin-left:auto;\n                margin-right:auto;\n                background-color:none;\n                box-shadow : 0px 0px 100px rgb(5,5,5);\n                overflow:hidden;\n                background-color:rgba(200,200,200,.1);\n                         user-drag: none;\n    -webkit-user-drag: none;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n            }  \n            .display > .stage > .wrapper > .body {  \n               /*position : absolute;*/\n                margin:0px;\n            background-color:white;\n             background-image:\n      linear-gradient(45deg, #ccc 25%, transparent 25%), \n      linear-gradient(135deg, #ccc 25%, transparent 25%),\n      linear-gradient(45deg, transparent 75%, #ccc 75%),\n      linear-gradient(135deg, transparent 75%, #ccc 75%);\n    background-size:25px 25px; /* Must be a square */\n    background-position:0 0, 12.5px 0, 12.5px -12.5px, 0px 12.5px; /* Must be half of one side of the square */\n               overflow:visible;\n            } \n            .display > .toolbar {  \n              /*background-color:rgb(10,10,10);*/\n                color : rgb(180,180,180);\n                border-bottom: 1px solid rgb(20,20,20)\n            }\n            .display > .toolbar .current {  \n              width:160px;\n              display:inline-block\n            }\n            .display > .toolbar .zoom .minus {  \n                padding:0px;\n                width:25px; \n                margin-right:1px; \n                border-radius:2px\n            }\n            .display > .toolbar .zoom .plus {  \n                padding:0px;\n                width:25px; \n                margin-right:1px; \n                border-radius:2px\n            }\n            .display > .toolbar .zoom input {  \n                width:50px; \n                margin-right:1px;\n            }\n        </style>\n        ";app.el.innerHTML=style+"\n<div class=\"display\">      \n    <div class=\"toolbar hmd tl\">\n        <div class=\"fl ml10\">\n            <span class=\"small\"> \n                Current : \n                <br>\n            </span>\n            <div  class=\"current\">\n            </div>\n            <button class=\"xs ml5 open mr20\">Open...</button>\n        </div>\n         \n        <div class=\"fl hidden\">\n            <span class=\"small\"> \n                History : \n                <br>\n            </span>\n            <div  class=\"history\">\n            </div>\n        </div>\n    \n        <div class=\"zoom fr mr5 hidden\">\n            <small> \n                Zoom : \n                <br>\n            </small>\n            <button class=\"xs clear minus\">-</button>\n            <input type=\"text\" class=\"xs mr5\" value=\"100%\"/> \n            <button class=\"xs clear plus\">+</button>\n        </div>\n        \n        <div class=\"fr  hidden\" >\n            <span class=\"small\"> \n                Tool : \n                <br>\n            </span>\n            <div  class=\"tool\" >\n                <select class=\"xs mr15\" style=\"width:160px\" onchange=\"toast('drop a Tool on the display!')\">\n                    <option value=\"select\">select</option>\n                     <option value=\"custom\">custom</option>\n                </select>\n            </div>\n        </div>\n        \n        <div class=\"fr hidden\">\n            <span class=\"small\"> \n                Custom : \n                <br>\n            </span>\n            <div  class=\"custom block\">\n            </div>\n        </div>\n    </div>\n    <div class=\"stage\"> \n       \n        <div class=\"ruler top\"></div>\n        <div class=\"ruler bottom\"></div>\n        <div class=\"wrapper\">\n            <div class=\"body\">\n    \n            </div>\n        </div>\n         <p class=\"dims small op2\"> </p>\n    </div>\n</div>\n    ";}app.query('.current').append(warp.dom.node('slot',{},{recive:function recive(f){app.open(f);},brands:['File','*.jpg','*.html','*.png']}));stage.el=app.query('.stage');stage.rulerTop=app.query('.ruler.top');wrapper.el=app.query('.wrapper');wrapper.ruler=app.query('.ruler.bottom');body.el=app.query('.body');ev(stage.el,'dblclick',function(e){e.preventDefault();if(app.fullscreen){app.win.options('scale',true);app.fullscreen=false;app.win.options('headless',false);app.win.restore();app.win.width(options.width);app.win.height(options.height);app.win.x(lastWinPosition.x);app.win.y(lastWinPosition.y);}else{app.fullscreen=true;lastWinPosition.x=app.win.x();lastWinPosition.y=app.win.y();app.win.options('scale',false);app.win.options('headless',true);app.win.full();}});ev('button.open','click',function(e){warp.user.private.apps[0].select('Select a file to open in the Display').then(function(file){app.open(file);});});ev('button.plus','click',function(e){if(zoom.level+10>800)return toast(zoom.level+'% is maximum zoom level');zoom.set(zoom.level+10);});ev('button.minus','click',function(e){if(zoom.level-10<30)return toast(zoom.level+'% is minimum zoom level');zoom.set(zoom.level-10);});ev('input','change',function(e){var z=app.query('.toolbar input').value;zoom.set(z);});app.win.options('onResize',function(){resizeGui();});wrapper.width(0);wrapper.height(0);}construct();}Warp.Drive={icon:function icon(path,size){var type='folder';if(path.includes('.')){type='file '+path.split('.').at(-1);}if(type!='folder'){size=formatBytes(size);}var ft=false;ft=warp.lists.user.fileTypes[path.split('.').at(-1)];var color='rgb(22,22,22)';if(ft)if(ft.color)color=ft.color;if(type=='folder'){return warp.dom.node('folder',{},{path:path,size:size});}else{return warp.dom.node('file',{},{path:path,type:type,color:color,size:size});}},Object:function ObjectDrive(options){options=Object.assign({type:'ObjectDrive',url:'ObjectMounted',name:'ObjectDrive',scope:{},password:'xdt27vrk',path:false},options);function pathIndex(obj,path,value){var r=false;if(typeof path=='string'){if(path.startsWith('/')){path=path.substring(1);}if(path.endsWith('/')){path=path.substring(0,path.length-1);}if(path==''||path==' '){return obj;}r=pathIndex(obj,path.split('/'),value);}else if(path.length==1&&value!==undefined){try{r=obj[path[0]]=value;}catch(err){throw new Error('folder parent\''+path[0]+'\' in path '+path.join('/')+' is invalid');}}else if(path.length==0)r=obj;else r=pathIndex(obj[path[0]],path.slice(1),value);if(r===undefined)r=false;return r;}var scope=options.scope;if(!scope)scope={};var dr=this;this.apps=[];if(!options.name){this.name='Drive #'+Math.floor(Math.random()*1000);}else{this.name=options.name;}this.scope=function scope(){return scope;};Object.assign(this,{exists:async function exists(path){var res=false;if(pathIndex(scope,path))res=true;return res;},refresh:async function refresh(path){var data=pathIndex(scope,path);dr.apps.forEach(function(a){return a.update(path,data);});if(onComplete)onComplete(data);return data;},write:async function write(path,file,onComplete){pathIndex(scope,path,file);if(onComplete)onComplete(true);return true;},read:async function read(path,onComplete){var data=pathIndex(scope,path);if(onComplete)onComplete(data);return data;},delete:async function _delete(path,onComplete){if(onComplete)onComplete(true);return true;},scan:async function scan(path,onComplete){var data=pathIndex(scope,path);if(onComplete)onComplete(data);return data;},create:async function create(path,onComplete){var type='folder';var last=path.split('/').at(-1);if(last.includes('.')){type=last.split('.').at(-1);}var res;if(type=='folder'){res=pathIndex(scope,path,{});}else{res=pathIndex(scope,path,'');}if(!res){res=false;}if(onComplete)onComplete(res);return res;}});this.file=async function(path){var exist=await dr.exists(path);if(!exist){dr.error(path+' Path does not exist');return;}var f=new Warp.File(path,{drive:dr});if(exist)await dr.read(path).then(function(data){return f.data=data;});return f;};this.folder=async function(path){var exist=await dr.exists(path);if(!exist)dr.error(path+' Path does not exist');var fo=new Warp.Folder({path:path,drive:dr});if(exist)dr.scan(path).then(function(data){return fo.data=data;});return fo;};this.app=new Warp.Drive.App({drive:dr});this.apps.push(this.app);return this;}};Warp.Drive.App=function DriveApp(options){options=extend({'destroyOnClose':false,'drive':null,'scanOnStart':true},options);var selection;var defaultSelection={promise:false,text:false,mask:{enable:false,disable:false},finished:false,data:false,set:function set(data){selection.data=data;app.query('.select').classList.remove('disabled');var item=warp.gui.item(data,{text:data.name});app.query('.selected').innerHTML='';app.query('.selected').append(item);if(selection.promise){app.query('.select').classList.remove('hidden');app.query('.selected').classList.remove('op4');if(selection.mask.enable)app.query('.mask').value=selection.mask.enable.toString();app.query('.mask').classList.remove('hidden');}else{app.query('.select').classList.add('hidden');app.query('.selected').classList.add('op4');app.query('.mask').value='';warp.dom.hide(app.query('.mask'));}},kill:function kill(){if(selection.promise){if(selection.toast)selection.toast.destroy();app.query('.selected').classList.add('op4');app.query('.select').classList.add('hidden');app.query('.select').classList.add('disabled');app.win.options('backdrop',false);app.win.options('backdropCloses',false);app.win.options('keepCentered',false);app.win.options('showCentered',false);selection=extend({},defaultSelection);}}};selection=extend({},defaultSelection);var app=extend(this,new App({name:'driveApp '+options.drive.name+' '+options.drive.apps.length,winOpts:{onHide:function onHide(w){selection.kill();},onShow:function onShow(w){render(currentPath);},showCentered:true,close:false,backdrop:false,scrollable:false}}));if(!gui.mobile()){app.win.width(491);app.win.height(335);}var dblClickEntersDir=false,clickInspects=false,context=false,fm=app.win.body,inputSearch,fileList,history;var currentPath=false,previousPath=false;app.refresh=function(){if(app.win.visible())render(currentPath);};app.select=function(text,mask,path){selection.kill();selection.promise=new Promise(function(resolve,rej){app.win.options('backdrop',true);app.win.options('backdropCloses',true);app.win.options('keepCentered',true);app.win.options('showCentered',true);selection.text=text;extend(selection.mask,mask,true);if(path)currentPath=path;app.show().then(selection.toast=toast(text,0));var interval=setInterval(function(){if(selection.finished){clearInterval(interval);resolve(selection.data);app.hide();}},100);});return selection.promise;};function _newFile(){input('newFile.txt',currentPath+'/').then(function(filename){app.drive.create(currentPath+'/'+filename).then(function(res){if(res){toast('Created');}});});}function _newDir(){warp.editors.text('Provide a name for new dir...',function(path){app.drive.create(path).then(function(res){if(res){toast('Created');}else{toast('Failed');}});},currentPath+'/newDir');}function upload(){warp.upload(app.drive,currentPath);}async function render(path){if(!fileList)return;var driveNameCaption=app.drive.name;if(app.drive.type=='Public'||app.drive.type=='Private'){driveNameCaption=gui.storage('profiles.'+driveNameCaption);if(!driveNameCaption)driveNameCaption=await warp.api.call('profiles/read',app.drive.name);driveNameCaption=driveNameCaption.name;}function renderPills(path){function pill(text,fun,root){var el=warp.dom.node('div',{click:function click(e){fun(e);}},{class:'pill'});el.innerHTML="<a>".concat(text,"</a> /");if(root)el.innerHTML="<a>".concat(text,"</a> :");if(text=='Mounted drives')el.innerHTML="<a> Drives </a> : ";history.appendChild(el);return el;}function renderDrives(title){history.innerHTML='';pill('Mounted drives',function(){renderDrives('Mounted');});if(title=='Mounted'){obj=warp.lists.user.drives;}else obj=warp.user.preferences('Drives');fileList.innerHTML='<div class="m5 ml10 mb10 o9"> <span class="mounted-drives m5 o9">Mounted drives [ '+Object.keys(warp.lists.user.drives).length+' ]</span>  | <span class="history-drives m5 o9">History</span>  </div>';var link;var el;if(title=='Mounted'){link=warp.dom.node('a',{click:function click(){renderDrives('History');}},{});el=app.el.querySelector('.history-drives');}else{link=warp.dom.node('a',{click:function click(){renderDrives('Mounted');}},{});el=app.el.querySelector('.mounted-drives');}link.innerHTML=el.innerHTML;el.innerHTML='';el.append(link);el.classList.remove('o9');var list=[];if(!obj)return;each(obj,function(i,d){var icon;if(title=='Mounted'){icon=warp.dom.node('drive',{},{drive:d,context:{inspect:function inspect(){warp.inspect(d);}}});icon.addEventListener('click',function(){if(app.drive==d){render(currentPath);return;}options.drive=d;app.drive=d;if(options.scanOnStart){app.drive.scan('/').then(function(){construct();});}else construct();});}else{if(warp.lists.user.drives[d.type+'-'+d.name]){icon=warp.dom.node('drive',{},{drive:warp.lists.user.drives[d.type+'-'+d.name],context:{inspect:function inspect(){warp.inspect(d);}}});}else icon=warp.dom.node('drive',{},{drive:d,context:{inspect:function inspect(){warp.inspect(d);}}});icon.addEventListener('click',async function(){var type=d.type;var drive;if(type=='Warp')drive=new WarpDrive({name:d.name,scanOnStart:false,url:d.url,username:d.username,password:d.password});if(type=='HTTP')drive=new HttpDrive({name:d.name,scanOnStart:false,url:d.url,username:d.username,password:d.password});if(type=='Legacy')drive=new LegacyDrive({name:d.name,scanOnStart:false,url:d.url,password:d.password});if(type=='Private'||type=='Public'){drive=new ProfileDrive({scanOnStart:false,username:d.username,password:d.password,url:d.url,profile:d.profile});}await drive.auth(d.username,d.password);if(app.drive==drive){render(currentPath);return;}options.drive=drive;app.drive=drive;if(options.scanOnStart){app.drive.scan('/').then(function(){construct();});}else construct();});}icon.classList.add('m5');fileList.append(icon);list.push(icon);});gsap.from(list,{x:30,opacity:0,ease:Quad.easeOut,stagger:0.08,duration:0.15});}history.innerHTML='';var rebuilt=[];pill('Mounted drives',function(){renderDrives('Mounted');});pill(driveNameCaption,function(){render('');},true);path=path.trim();path.split('/').forEach(function(folderName,ind){if(folderName=='')return;rebuilt.push(folderName);var joined=rebuilt.join('/');pill(folderName,function(){render(joined);selection.set(app.drive.folder(path));});});}if(!path)path='';app.win.caption(driveNameCaption+' <span class=\'op4\'> ['+app.drive.type+'Drive]</span>');warp.dom.height(app.win.body.querySelector('.data'),app.win.height()-warp.dom.height(app.win.body.querySelector('.history'))-80);if(window.main&&main.preferences){dblClickEntersDir=main.preferences.get('drive','double click enters dir');clickInspects=main.preferences.get('drive','single click inspects file');}var obj=app.drive.scope(path);path=path.trim();if(path.startsWith('/'))path=path.substring(1);fileList.innerHTML='';previousPath=currentPath;currentPath=path;var _loop7=function _loop7(childName){var childPath=currentPath+'/'+childName;if(childPath.startsWith('/'))childPath=childPath.substring(1);var size=obj[childName];if(_typeof(obj[childName])=='object'){size=Object.keys(obj[childName]).length;}var el=Warp.Drive.icon(childPath,size);if(main)if(main.context){main.context.add(el,{'open':function open(){warp.open(app.drive.file(childPath));},'edit':function edit(){warp.edit(app.drive.file(childPath));},'commit':function commit(){if(file.data){warp.commit(app.drive.file(childPath));}else toast('File data is not loaded, load the file to commit');},'delete':function _delete(){var file=app.drive.file(childPath);confirm('Delete '+file.name+'?',function(){file.drive.delete(file.path).then(function(res){toast('Deleted');});});},'download':async function download(){var f=app.drive.file(childPath);f=await warp.open(f);warp.download(f);},'inspect':function inspect(){warp.inspect(app.drive.file(childPath));}},'Filesys item : ');}el.addEventListener('dblclick',function open(e){e.preventDefault();if(childName.includes('.')){var f=app.drive.file(childPath);if(selection.promise){selection.set(f);selection.finished=true;}else warp.edit(f);}else{if(dblClickEntersDir)render(childPath);render(childPath);}});el.addEventListener('click',async function inspectFile(e){e.preventDefault();if(childName.includes('.')){if(selection.promise){selection.set(app.drive.file(childPath));}else{var f=app.drive.file(childPath);var _open=warp.isOpen(f);if(!_open){warp.inspect(f);selection.set(f);}else{warp.inspect(_open);selection.set(_open);}}}else{if(!dblClickEntersDir)render(childPath);selection.set(app.drive.folder(childPath));}});el.addEventListener('mouseenter',function(e){e.preventDefault();var f=app.drive.file(childPath);warp.dom.addPopup(el,"\n              <p>\n                <span class=\"op7\">  Name :</span>".concat(f.name,"<br>\n                <span class=\"op7\">   Type :</span>").concat(f.type,"<br>\n                 <span class=\"op7\">  Size :</span>").concat(f.size,"<br> \n               <span class=\"op7\">    Path :</span>").concat(f.path,"<br>\n                <span class=\"op7\">   Drive : </span>").concat(f.drive.name+' ( type : '+f.drive.type+' )',"<br>\n              </p>\n              "));});if(_typeof(obj[childName])=='object'){fileList.prepend(el);}else fileList.append(el);};for(var childName in obj){_loop7(childName);}renderPills(path);if(selection.promise){if(selection.mask.enable)app.query('.mask').value=selection.mask.enable.toString();app.query('.mask').classList.remove('hidden');}else{app.query('.mask').value='';app.query('.mask').classList.add('hidden');}}function construct(){app.busy(true);app.html("\n                <div class=\"drive\">\n                    <div class=\"tl hsm\">\n                        <div class=\"history mt10 ml5 fl hxs\">\n                        </div>\n                        <button onclick=\"let i= this.parentNode.querySelector('input'); i.classList.remove('hidden'); i.focus();i.select()\" class=\"icon xs c1 fr clear m5 mr0 ml0\">\n                            <svg class=\"icon\">\n                                <use href=\"#icon-search\"></use>\n                            </svg>\n                        </button>\n                        <button class=\"icon add xs fr clear m5 mr0 ml0\" style=\"opacity:0.6\">\n                            new...\n                        </button>\n                        <input type=\"text\" class=\"search xs hidden\" onblur=\"this.classList.add('hidden')\" style=\"position:absolute; right:30px; top:35px\" placeholder=\"search in this folder\" />\n                    </div>\n                    \n                    <div class=\"data mt5 p10\">\n                    </div>\n                    \n                    <button class=\"select hidden primary xs fr m5 mr10 disabled\">\n                        Select\n                    </button>\n                    \n                    <input type=\"text\" class=\"inline-block mask xs disabled fr m5 small\" style=\"width:70px\" placeholder=\"Mask :\"\n                       value=\"*.*\" />\n                    <div class=\"inline-block selected fr mr5 op4\" style=\"margin-top:4px; max-height:22px; width:140px\"></div>\n                         \n                    <small class=\"inline-block fr mt10 op4 mr5\" style=\"height:22px;\">Selected :</small>\n                    \n               \n                    \n                    <button onclick=\"\" class=\"prefs xs fl clear m5 mr0 ml0\" style=\"opacity:0.4\">\n                            <svg class=\"icon\">\n                                <use href=\"#icon-settings\"></use>\n                            </svg>\n                    </button>                \n                </div>\n                ");fileList=app.query('.data');history=app.query('.history');inputSearch=app.query('input.search');inputSearch.addEventListener('keyup',function(e){var items=fileList.querySelectorAll('.fs');each(items,function(index,el){var text=el.textContent;if(text){text=text.toLowerCase();if(text.includes(inputSearch.value.toLowerCase())){if(el.classList)warp.dom.show(el);}else{if(el.classList)warp.dom.hide(el);}}});});app.event(app.query('.select'),'click',function(){selection.finished=true;});app.event(app.query('.prefs'),'click',function(){main.preferences.select(['drive']);});previousPath=false;currentPath=false;app.event(app.query('.add'),'click',function(){app.menu.show({'upload from local drive':upload,'create new File...':_newFile,'create new Folder...':_newDir});});context={'back':function back(){render(previousPath,previous);},'refresh':function refresh(){app.refresh();},'inspect drive':function inspectDrive(){warp.inspect(app.drive);},'new browser':function newBrowser(){var br=new Warp.Drive.App({drive:app.drive,'scanOnStart':true});br.show();},'upload file...':function uploadFile(){upload();},'new file...':function newFile(){_newFile();},'new dir...':function newDir(){_newDir();}};if(main)if(main.context)main.context.add(fm,context,'Drive App');app.win.busy(false);app.drive.apps.push(app);app.event(app.el,'mouseleave',function(){warp.dom.hidePopup();});warp.on('drive.created',function(){if(fileList&&fileList.querySelector('.mounted-drives')){app.el.querySelector('.pill').click();}});render('');}if(options.drive){app.drive=options.drive;}else{throw new Error('No drive in options for driveApp');return;}if(options.drive&&options.scanOnStart){app.busy(true);app.drive.scan('').then(function(data){app.busy(false);construct();});}return app;};Warp.File=function File(data,options){var optionsPresent=true;if(!options){options={};optionsPresent=false;}options=Object.assign({drive:null,data:null,commit:undefined,name:null,path:null,type:null},options);var file=this;var drive,size,name,path,type;drive=options.drive;if(options.path){path=options.path.trim();name=path.split('.');type=name.pop();name=name.join('.');name=name+'.'+type;var arr=name.split('/');name=arr[arr.length-1];}else{if(options.name){name=options.name;type=name.pop();}}if(options.type)type=options.type;if(typeof data=='string'){var _fromJson=function _fromJson(data,options){var fileData=warp.un.json(data);path=fileData.name;name=fileData.name;type=fileData.type;file.data=fileData.data;};var fromPath=function fromPath(data,options){path=data;name=path.split('.');type=name.pop();name=name.join('.');name=name+'.'+type;var arr=name.split('/');name=arr[arr.length-1];};var fromDrive=function fromDrive(data,drive){file.data=data;file.drive=drive;};data=data.trim();if(!optionsPresent){if(data.startsWith('{')||data.startsWith('[')){_fromJson(data,options);}}if(options.drive&&options.path){fromDrive(data,options.drive);}else fromPath(data,options);}if(_typeof(data)=='object'){}if(drive)size=drive.scope(path);Object.assign(file,{'name':name,'type':type,'path':path,'size':size,'commit':options.commit,'drive':drive});return file;};Warp.Folder=function Folder(options){if(!options)options={};options=Object.assign({drive:null,path:null},options);var path=options.path.trim();return Object.assign(this,{'name':path.split('/').at(-1),'type':'folder','path':path,'drive':options.drive});};var Drive=/*#__PURE__*/function(){function Drive(options){_classCallCheck(this,Drive);if(!options)options={};options=Object.assign({'name':false,'url':false,'path':'','debug':true,'useXHR':true,'headerToken':true,'type':'blob'},options);this.options=function(name,val){if(name===undefined&&val==undefined)return options;if(val==undefined)return options[name];options[name]=val;};this.version='v0.2';this.token=false;this.apps=[];this.uploads=[];this.downloads=[];this.name=options.name;this.scopeObject={};}_createClass(Drive,[{key:"debug",value:function debug(data){if(this.options('debug')){console.log('%cDrive : ','color: magenta',data);}}},{key:"error",value:function error(data){if(this.options('debug')){}throw new Error('Drive : '+data);return;}},{key:"scope",value:function scope(path,value){if(path&&typeof path!=='string'&&value===undefined){this.scopeObject=path;return;}try{if(value===undefined){if(path){return pathIndex(this.scopeObject,path);}else{return this.scopeObject;}}return pathIndex(this.scopeObject,path,value);}catch(e){throw new Error('Drive '+this.name+' cant process path : '+path);}}},{key:"post",value:function post(method,argsArray,responseType){var _this=this;if(!responseType)responseType='arraybuffer';var start=performance.now();var dbgString='';return new Promise(function(resolve,reject){var formData=new FormData();formData.append('method',method);if(_this.options('legacy')){formData.append('token',_this.options('legacy'));formData.append('function',method);for(var i=0;i<argsArray.length;i++){formData.append('functionArguments[]',argsArray[i]);}formData.append('secure',true);}else formData.append('token',_this.token);if(_this.options('profile')){formData.append('profile',_this.options('profile'));}switch(method){case'auth':formData.append('username',argsArray[0]);formData.append('password',argsArray[1]);break;case'deauth':formData.append('killToken',argsArray[0]);break;case'scan':case'read':case'delete':case'create':case'info':formData.append('path',argsArray[0]);break;case'write':formData.append('path',argsArray[0]);formData.append('blob',new Blob([argsArray[1]]));break;case'rename':case'move':case'copy':case'unzip':formData.append('path',argsArray[0]);formData.append('pathTo',argsArray[1]);break;case'shell':formData.append('path',argsArray[0]);break;case'session':break;case'fastDir':case'loadFile':case'saveFile':break;default:throw new Error('Method '+method+' not present in drive.post()');}{dbgString+="REQUEST\n\ntransport   :   ".concat(_this.options('useXHR')?'XHR':'Fetch',"\n\nheaders     :   ").concat(_this.token?'"Authorization" : "Bearer '+_this.token+'"':'',"\n\nPOST FormData fields :");var len=0;var _iterator8=_createForOfIteratorHelper(formData.entries()),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var pair=_step8.value;dbgString+="\n    ".concat(pair[0]," : '").concat(pair[1],"'");len+=typeof pair[1]==='string'?pair[1].length:pair[1].size;}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}dbgString+='\n\nContent size : '+len;}if(_this.options('useXHR')){var xhr=new XMLHttpRequest();var inst=_this;xhr.onreadystatechange=function(){if(xhr.readyState!=4){return;}dbgString+='\n\nDuration : '+parseInt(performance.now()-start)+' ms\n\n\n';inst.debug(dbgString);resolve(xhr);};xhr.responseType=responseType;if(method=='read'){_this.debug('Reading : '+argsArray[0]);_this.downloads.push(xhr);xhr.addEventListener('progress',function handleXHRProgress(evt){if(evt.lengthComputable){var percentComplete=parseInt(evt.loaded/evt.total*100);console.log('Complete : '+percentComplete+'%');if(evt.loaded==evt.total){console.log('finished');}}});}if(method=='write'){_this.uploads.push(xhr);}xhr.open('POST',_this.options('url'));if(_this.options('headerToken')&&_this.token)xhr.setRequestHeader('Authorization','Bearer '+_this.token);xhr.send(formData);}else{fetch(_this.options('url'),{body:formData,method:'post',headers:{'Authorization':'Bearer '+_this.token}}).then(function(response){dbgString+='\n\nDuration : '+parseInt(performance.now()-start)+' ms\n\n\n';_this.debug(dbgString);resolve(response);});}});}},{key:"handleResponse",value:async function handleResponse(responseOrXHR){if(this.options('useXHR')){var xhr=responseOrXHR;var dbgString='RESPONSE  \n\nContent-Type : '+xhr.getResponseHeader('Content-Type');dbgString+=' \n\nStatus code : '+xhr.status;dbgString+=' \n\ncontent-length : '+xhr.getResponseHeader('content-length');if(xhr.status!=200){if(xhr.responseType=='blob'){return this.error(xhr.status+' - '+JSON.parse(await xhr.response.text()));}if(xhr.responseType=='arraybuffer'){return this.error(xhr.status+' - '+JSON.parse(new TextDecoder('utf-8').decode(xhr.response)));}return this.error(xhr.status+' - '+JSON.parse(xhr.responseText));}this.debug(dbgString);if(xhr.responseType=='text'){return xhr.responseText;}if(xhr.responseType=='blob'){return xhr.response;}}else{var response=responseOrXHR;var _dbgString='RESPONSE  \n\nContent-Type : '+response.headers.get('Content-Type');_dbgString+=' \n\nStatus code : '+response.status;_dbgString+=' \n\ncontent-length : '+response.headers.get('content-length');if(response.status!=200){this.error(response.status+' - '+JSON.parse(await response.text()));return;}this.debug(_dbgString);if(response.headers.get('Content-Type')=='application/json; charset=UTF-8'){return response.text();}else return response.arrayBuffer();}}},{key:"auth",value:async function auth(usernameOrToken,password){var response=await this.post('auth',[usernameOrToken,password],'text');if(response.status!=200){if(this.options('useXHR')){this.error(response.status+' - '+JSON.parse(response.responseText));}else{this.error(response.status+' - '+(await response.text()));}return;}var token;if(this.options('useXHR')){token=JSON.parse(response.responseText);}else{token=JSON.parse(await response.text());}if(token){this.debug('Auth is success, token recived : '+token);this.token=token;return token;}else this.error('Token parsing failed in Drive');}},{key:"scan",value:async function scan(path){if(!path)path='';if(path=='/')path='';var response=await this.post('scan',[path],'text');var result=await this.handleResponse(response);result=JSON.parse(result);if(path==''){this.scope(result);}else{this.scope(path,result);}this.debug(result);return result;}},{key:"read",value:async function read(path,responseType){if(!responseType)responseType='arraybuffer';var xhr=await this.post('read',[path],'blob');var result=await this.handleResponse(xhr);this.debug(result);return result;}},{key:"write",value:async function write(path,data){var response=await this.post('write',[path,data]);var result=await this.handleResponse(response);pathIndex(this.scopeObject,path,data.toString().length);this.debug(result);return result;}},{key:"delete",value:async function _delete(path){var response=await this.post('delete',[path]);var result=await this.handleResponse(response);this.debug(result);var ar=path.split('/');var name=ar.pop();var parent=pathIndex(this.scopeObject,ar.join('/'));delete parent[name];return result;}},{key:"move",value:async function move(path,pathTo){var response=await this.post('move',[path,pathTo]);var result=await this.handleResponse(response);this.debug(result);return result;}},{key:"copy",value:async function copy(path,pathTo){var response=await this.post('copy',[path,pathTo]);var result=await this.handleResponse(response);this.debug(result);return result;}},{key:"rename",value:async function rename(path,pathTo){var response=await this.post('rename',[path,pathTo]);var result=await this.handleResponse(response);this.debug(result);return result;}},{key:"info",value:async function info(path){var response=await this.post('info',[path]);var result=await this.handleResponse(response);this.debug(result);return result;}},{key:"create",value:async function create(path){var dest=pathIndex(this.scopeObject,path);if(dest)return true;var response=await this.post('create',[path]);var result=await this.handleResponse(response);var ar=path.split('/');var name=ar.pop();if(name.includes('.')){pathIndex(this.scopeObject,path,1);}else pathIndex(this.scopeObject,path,{});this.debug(result);return result;}},{key:"unzip",value:async function unzip(path,pathTo){var response=await this.post('unzip',[path,pathTo]);var result=await this.handleResponse(response);this.debug(result);var to=path.split('/');to.pop();to=to.join('/');var parent=pathIndex(this.scopeObject,to);parent=result;return result;}},{key:"shell",value:async function shell(command){var response=await this.post('shell',[command]);var result=await this.handleResponse(response);this.debug(result);return result;}},{key:"sessions",value:async function sessions(){var response=await this.post('sessions',[]);var result=await this.handleResponse(response);this.debug(result);return result;}},{key:"update",value:async function update(){var response=await this.post('update',[],'text');var result=await this.handleResponse(response);return JSON.parse(result);}}]);return Drive;}();var HttpDrive=/*#__PURE__*/function(_Drive){_inherits(HttpDrive,_Drive);var _super=_createSuper(HttpDrive);function HttpDrive(options){var _this2;_classCallCheck(this,HttpDrive);if(!options.name)options.name='Drive-'+Math.random();_this2=_super.call(this,options);_this2.type='HTTP';if(options.type)_this2.type=options.type;if(options.legacy)_this2.type='Legacy';_this2.apps=[];_this2.App=Warp.Drive.App;if(warp.lists.user.drives[_this2.type+'-'+options.name]){return _possibleConstructorReturn(_this2,warp.lists.user.drives[_this2.type+'-'+options.name]);}warp.lists.user.drives[_this2.type+'-'+options.name]=_assertThisInitialized(_this2);warp.trigger('drive.created',_assertThisInitialized(_this2));return _this2;}_createClass(HttpDrive,[{key:"auth",value:async function auth(usernameOrToken,password){this.options('username',usernameOrToken);this.options('password',password);var pr=_get(_getPrototypeOf(HttpDrive.prototype),"auth",this).call(this,usernameOrToken,password);if(warp.user.preferences){warp.user.preferences('Drives',this.type+'-'+this.options('name'),{url:this.options('url'),username:usernameOrToken,password:password,type:this.type,name:this.name,profile:this.options('profile')});}return pr;}},{key:"post",value:function post(method,argsArray,responseType){var pr=_get(_getPrototypeOf(HttpDrive.prototype),"post",this).call(this,method,argsArray,responseType);var thisDrive=this;setTimeout(function(){if(['delete','write','create','rename','unzip','move'].includes(method)){each(thisDrive.apps,function(i,app){if(app.drive=thisDrive)app.refresh(argsArray[0]);});}},600);return pr;}},{key:"read",value:async function read(path,returnType){if(!returnType)returnType='text';var blob=await _get(_getPrototypeOf(HttpDrive.prototype),"read",this).call(this,path,'blob');if(returnType=='blob')return blob;if(returnType=='arrayBuffer')return blob.arrayBuffer();return blob.text();}},{key:"file",value:function file(path){return new Warp.File(path,{drive:this});}},{key:"folder",value:function folder(path){return new Warp.Folder({path:path,drive:this});}},{key:"toJson",value:function toJson(){return warp.do.json({url:this.options('url'),username:this.options('username'),password:this.options('password'),type:this.type,name:this.name});}}]);return HttpDrive;}(Drive);var WarpDrive=/*#__PURE__*/function(_HttpDrive){_inherits(WarpDrive,_HttpDrive);var _super2=_createSuper(WarpDrive);function WarpDrive(options){_classCallCheck(this,WarpDrive);if(!options.type)options.type='Warp';return _super2.call(this,options);}return WarpDrive;}(HttpDrive);var ProfileDrive=/*#__PURE__*/function(_WarpDrive){_inherits(ProfileDrive,_WarpDrive);var _super3=_createSuper(ProfileDrive);function ProfileDrive(options){_classCallCheck(this,ProfileDrive);if(!options.profile){throw new Error('No profile data in options for Public Drive');}var type='Private';if(options.url.includes('ublic'))type='Public';options.type=type;options.name=options.profile;options.path='/';return _super3.call(this,options);}_createClass(ProfileDrive,[{key:"toJson",value:function toJson(){return warp.do.json({url:this.options('url'),username:this.options('username'),password:this.options('password'),type:'Profile',name:this.name,profile:this.options('profile')});}}]);return ProfileDrive;}(WarpDrive);var LegacyDrive=/*#__PURE__*/function(_HttpDrive2){_inherits(LegacyDrive,_HttpDrive2);var _super4=_createSuper(LegacyDrive);function LegacyDrive(options){var _this3;_classCallCheck(this,LegacyDrive);options.legacy=options.password;options.debug=false;options.type='Legacy';_this3=_super4.call(this,options);if(warp.user.preferences)warp.user.preferences('Drives','Legacy-'+_this3.name,{url:options.url,password:options.password,type:'Legacy',name:_this3.name});return _this3;}_createClass(LegacyDrive,[{key:"auth",value:async function auth(usernameOrToken,password){this.token=usernameOrToken;return password;}},{key:"handleResponse",value:async function handleResponse(response){var result=await _get(_getPrototypeOf(LegacyDrive.prototype),"handleResponse",this).call(this,response);var obj=await warp.un.don(result);if(Boolean(obj.e)){throw new Error(obj.e);}return obj.payload;}},{key:"read",value:async function read(path,as){if(!as)as='text';var response=await this.post('loadFile',[path],as);var result=await this.handleResponse(response);return JSON.parse(result);}},{key:"scan",value:async function scan(path){if(!path)path='';if(path=='/')path='';var response=await this.post('fastDir',[path],'text');var result=await this.handleResponse(response);result=JSON.parse(result);if(path==''){this.scope(result);}else{this.scope(path,result);}return result;}},{key:"write",value:async function write(path,data){var response=await this.post('saveFile',[path,data],'text');var result=await this.handleResponse(response);return result;}},{key:"delete",value:async function _delete(path){var response;if(path.includes('.')){response=await this.post('deleteFile',[path]);}else{response=await this.post('deleteDir',[path]);}var result=await this.handleResponse(response);return result;}},{key:"rename",value:async function rename(path,pathTo){var response=await this.post('_rename',[path,pathTo]);var result=await this.handleResponse(response);return result;}},{key:"create",value:async function create(path){var response;if(path.includes('.')){response=await this.post('saveFile',[path,' ']);}else{response=await this.post('createDir',[path]);}var result=await this.handleResponse(response);return result;}}]);return LegacyDrive;}(HttpDrive);window.WarpDrive=WarpDrive;Warp.Editor=function(){var app=Object.assign(this,new warp.factory.App({winOpts:{onResize:onResize,backdrop:false,height:'auto',width:'auto',maxWidth:false,maxHeight:false,scale:true,scroll:false,activateOnShow:true,useGuard:true},name:'codeEditor'}));app.file=false;var iframeApp,btnSave,btnCommit,divCurrent,divHistory;app.edit=async function(file){var open=warp.isOpen(file);if(open)file=open;if(app.file){app.file.data=app.file.session.getValue();}if(!Boolean(file.data))file.data=" ";var fileType;if(!file.session){fileType=warp.lists.user.fileTypes[file.type];if(!fileType){toast('No fileType definition for *.'+file.type+', editing as plain text');fileType=warp.lists.user.fileTypes['txt'];}file.session=iframeApp.createSession(file.data,fileType.mode);iframeApp.aceEdit.setSession(file.session);app.fold();}else iframeApp.aceEdit.setSession(file.session);app.file=file;if(file.drive){btnSave.classList.remove('disabled');}else{btnSave.classList.add('disabled');file.session.setUseWorker(false);iframeApp.aceEdit.selectAll();}if(file.commit&&warp.lists.user.fileTypes[file.type]){btnCommit.classList.remove('disabled');}if(file.commit){btnCommit.innerHTML='Commit <span style="badge" class="primary xs"> custom </span>';}else btnCommit.innerHTML='Commit';app.win.caption(file.name);divCurrent.innerHTML='';divCurrent.append(warp.gui.item(file,{text:file.path}));app.show();app.win.activate();if(!file.drive)file.session.setUseWorker(false);if(file.data.length>100000){toast('file size > 100kB, disabling linting to improve Ace performance');file.session.setUseWorker(false);}onResize();warp.trigger('editorEditing',file);};app.save=async function(){if(app.file.session){app.file.data=app.file.session.getValue();}if(!Boolean(app.file.data)){var e=new Error('File data seems to be missing or corrupted');warp.inspect(e);throw e;}await warp.save(app.file);toast(app.file.name+' saved!');};app.commit=async function(){app.file.data=app.file.session.getValue();warp.commit(app.file);app.selectAll();toast(app.file.name+' commited!');};app.get=function(){return fromJson(iframeApp.get());};app.set=function(data){if(!data){throw new Error('data in editor.set(data) is '+_typeof(data));}iframeApp.set(data);};app.fold=function(){if(app.file.session)try{app.file.session.foldAll(1,20000);}catch(er){}};app.beautify=function(){iframeApp.beautify();};app.search=function(){iframeApp.search();};app.selectAll=function(data){iframeApp.selectAll();iframeApp.aceEdit.container.focus();};app.show=function(){warp.dom.show(app.win.el);var rect=app.win.el.getBoundingClientRect();rect={id:app.win.name,x:parseInt(rect.x),y:parseInt(rect.y),width:parseInt(rect.width),height:parseInt(rect.height)};warp.trigger('GUI.WindowShown',rect);};app.hide=function(){warp.dom.hide(app.win.el);var rect=app.win.el.getBoundingClientRect();rect={id:app.win.name,x:parseInt(rect.x),y:parseInt(rect.y),width:parseInt(rect.width),height:parseInt(rect.height)};warp.trigger('GUI.WindowHidden',rect);};app.ready=function(){iframeApp=app.win.body.querySelector('iframe').contentWindow.window.codeEditor;function q(sel){var doc=app.win.body.querySelector('iframe').contentWindow.window.document;return doc.querySelector(sel);}btnCommit=q('button.commit');btnCommit.addEventListener('click',function(){app.commit();});btnSave=q('button.save');btnSave.addEventListener('click',function(){app.save();});q('button.fold').addEventListener('click',function(){app.fold();});divCurrent=q('.current');divHistory=q('.history');q('button.beautify').addEventListener('click',function(){app.beautify();});};function onResize(w){if(!w)w=app.win;var height=warp.dom.height(w.body);warp.dom.height(w.body.querySelector('iframe'),height-4);if(w.body.querySelector('iframe')){if(iframeApp)iframeApp.resize();}}function render(){var editorURL='https://bemjax.com/resources/editor?v='+Date();if(warp.native)editorURL='https://hostWin/editor/index.html';app.html("\n            <iframe  \n                onload=\"warp.editor.ready()\" \n                style=\"width:100%;\" \n                src=\"".concat(editorURL,"\"\n            >\n            \n            </iframe>\n            "));app.win.width(850);app.win.height(850);app.win.show();app.hide();app.win.hide=app.hide;}render();return app;};Warp.NativeEditor=Warp.Editor;function Vector(warp){var lists=warp.lists;var vector=extend(this,new App({name:'Vector',winOpts:{backdrop:false,width:160,height:'auto',close:false,activateOnShow:false,class:'inspector',onShow:function onShow(win){win.x(warp.dom.width()-170);win.y(10);var wl=warp.lists.user.layouts.Warp;wl.win.x(win.x());wl.win.y(win.y()+margin*2+win.height());},onHide:function onHide(win){eachLayout(async function(l){l.hide();});},onDrag:function onDrag(draggable){eachLayout(async function(l){l.win.x(l.win.x()+draggable.deltaX);l.win.y(l.win.y()+draggable.deltaY);each(l.instances,function(index,i){i.win.x(i.win.x()+draggable.deltaX);i.win.y(i.win.y()+draggable.deltaY);});});}}}));var currentHistory=0;var margin=5;var history=warp.gui.items('History',warp.lists.user.history,false,{usePrefs:true,onClose:function onClose(){var wl=warp.lists.user.layouts.Warp;if(wl){var x=vector.win.x();wl.win.x(x);wl.win.y(vector.win.y()+margin*3+vector.win.height());wl.sort();}},onOpen:function onOpen(){var wl=warp.lists.user.layouts.Warp;if(wl){var x=vector.win.x();wl.win.x(x);wl.win.y(vector.win.y()+margin*3+vector.win.height());wl.sort();}}});var loadingList={};history.el.addEventListener('click',function(){warp.lists.user.layouts.Warp.sort();});vector.process=async function(subject){async function processLayout(layout){async function handlePositive(insName){var app;if(!layout.instances[insName]){loadingList[insName]=true;app=await layout.app(insName);delete loadingList[insName];}else app=layout.instances[insName];try{app.inspected=subject;if(!app.win.minimized){app.inspect(subject);app.win.el.classList.remove('op3');}else{if(layout.data.apps[app.name].default){app.win.restore();app.win.el.classList.remove('op3');app.inspect(subject);}app.win.el.classList.add('op3');}app.show();currentlyActive.push(app);}catch(err){layout.edit(insName);confirm("\n                    <small>\n                        Inspect failed for app ".concat(insName,"!\n                        <br>\n                        ").concat(err,"\n                        <br>\n                        The app code is opened in the console, execute it to update after editing the errors\n                        <br>\n                        Remove app ").concat(insName," from layout for this session?\n                    </small>\n                    "),function(){delete layout.instances[insName];layout.remove(insName);});throw new Error(err);}return app;}var currentlyActive=[];var positivesPromises=[];var noInspectorsPositive=true;await layout.show();each(layout.data.apps,function(insName,inspectorApp){if(layout.instances[insName]){if(layout.instances[insName].clean)layout.instances[insName].clean();layout.instances[insName].hide();layout.instances[insName].win.el.classList.add('op3');}each(inspectorApp.brands,async function(index,brandName){if(brandName=='All'||brandName=='Native'){if(brandName=='All'||window.native)positivesPromises.push(handlePositive(insName));}else{each(detectedBrands,async function(inde,detectedType){each(detectedType,async function(ind,posBrandName){if(brandName==posBrandName){noInspectorsPositive=false;positivesPromises.push(handlePositive(insName));}});});}});});setTimeout(layout.sort,10);return Promise.all(positivesPromises);}if(vector.paused)return;warp.inspected=subject;var detectedBrands=warp.test(subject);var wl=warp.lists.user.layouts.Warp;wl.win.hide();var layoutPromises=[processLayout(warp.lists.user.layouts.Warp)];var x=vector.win.x();wl.win.x(x);wl.win.y(vector.win.y()+margin*3+vector.win.height());wl.show();x=x-5;each(warp.lists.user.layouts,function(name,layout){if(!layout.paused&&!layout.inspect&&layout.name!='Warp'){layout.win.hide();layoutPromises.push(processLayout(layout));layout.win.x(x-165*(layoutPromises.length-1));layout.win.y(vector.win.y());if(!main.preferences.get('Vector','hide Layout managers during inspection'))layout.show();}});Promise.all(layoutPromises);warp.trigger('afterInspect',detectedBrands);var inHistory=false;each(warp.lists.user.history,function(ind,historyItem){if(historyItem===subject){inHistory=true;}});if(!inHistory){currentHistory=0;warp.lists.user.history.unshift(subject);}render();};vector.paused=true;vector.toggle=function(state){if(state!==undefined)if(state)vector.paused=true;if(vector.paused){vector.win.locked(false);vector.paused=false;vector.el.querySelector('.pause use').classList.remove('danger');return;}vector.paused=true;vector.win.locked(true);vector.el.querySelector('.pause use').classList.add('danger');};function render(){var el=vector.el;var it=warp.dom.node('item',{},{data:warp.inspected,brands:['All'],recive:function recive(dropped){warp.inspect(dropped);}});el.querySelector('.inspected').innerHTML='';el.querySelector('.inspected').append(it);warp.gui.animate.shake(it);if(history.visible)history.open();}async function init(){var el=vector.el;el.innerHTML="\n        <div class=\"inspected\"></div>\n        <button class=\"c2 clear back\"><</button>\n        <button class=\"c2 clear forward\">></button>\n        <button class=\"c2 clear pause\" onclick=\"warp.vector.toggle()\">\n            <svg class=\"icon\"  >\n                <use href=\"#icon-media-pause\"></use>\n            </svg>\n        </button>\n        <button class=\"c2 clear\" onclick=\"main.preferences.select('Vector')\">\n             <svg  class=\"icon\"  >\n                <use href=\"#icon-settings\"></use>\n             </svg>\n        </button>\n\n        <input type=\"text\" class=\"c8 search mt5 hidden\" onblur=\"\"  placeholder=\"search...\" />\n        <div class=\"search hidden\"></div>\n        \n        <div class=\"history\"></div>\n        ";el.querySelector('.back').addEventListener('click',function(e){if(currentHistory==warp.lists.user.history.length-1){currentHistory=0;}else currentHistory++;warp.inspect(warp.lists.user.history[currentHistory]);});el.querySelector('.forward').addEventListener('click',function(e){if(currentHistory==0){currentHistory=warp.lists.user.history.length-1;}else currentHistory--;warp.inspect(warp.lists.user.history[currentHistory]);});el.querySelector('.history').append(history.el);if(!warp.lists.user.layouts.Warp)fetch('storage/profiles/_1/_0/_0/100000001/public/Warp.layout?v='+Date()).then(function(resp){return resp.text();}).then(function(data){var f={name:'Warp.layout',path:'Warp.layout',type:'layout',data:data};if(gui.storage('user').username=='pozder.dario@gmail.com')f.drive=warp.user.public;new Warp.Manager(f);});var ctx={'show':function show(){if(vector.paused)vector.toggle();warp.inspect(warp);},'new layout':async function newLayout(){var name=await input('','Name for new layout');name=safeName(name);var l=new Warp.Manager({name:name,path:name+'.layout',drive:warp.user.private});l.show();l.needsUpdate();},'unload all layouts':async function unloadAllLayouts(e){var promises=[];for(var _name6 in warp.lists.user.layouts){promises.push(warp.lists.user.layouts[_name6].unloadAll());}await Promise.all(promises);for(var _name7 in warp.lists.user.layouts){if(_name7!='Warp'){var m=warp.lists.user.layouts[_name7];await m.unloadAll();delete warp.lists.user.layouts[_name7];m.win.destroy();}}warp.inspect(warp.inspected);},'Console <f12>':async function ConsoleF12(){warp.console.show();}};main.context.add(vector.el,ctx,'Vector');try{var js=await warp.user.drive.read('start.js');warp.eval(js);}catch(e){}main.context.add(document.body,ctx,'Vector');return;}init().then(function events(){warp.on('body','a["inspect"]','click',function(el){warp.inspect(warp.eval(el.getAttribute('inspect')));});warp.on('body','a["eval"]','click',function(el){warp.eval(el.getAttribute('eval'));});document.body.addEventListener('click',function(){if(main.preferences.get('Vector','allowFullScreen')){warp.gui.full(true);}},true);document.body.addEventListener('keydown',function keyDown(evt){if(evt.ctrlKey||evt.metaKey){switch(String.fromCharCode(evt.which).toLowerCase()){case's':event.preventDefault();warp.editor.save();break;case'f':event.preventDefault();break;case'g':break;case'q':event.preventDefault();warp.inspect(warp.apps.editor.aceEdit.getSelectedText());break;case'a':event.preventDefault();break;case'e':event.preventDefault();warp.openConsole('warp.explicit(\'\');');break;}}if(evt.keyCode==123||evt.keyCode==121){if(main.preferences.get('Vector','f12Console')){evt.preventDefault();warp.console.show();}else{toast('<small>Opening Developer Tools, if you want warp\'s console click here <br><button class=\'primary xs\' onclick=\'warp.console.show()\'>console</button></small>',10000);}}if(evt.keyCode==21||evt.keyCode==-96){evt.preventDefault();toast('f5 pressed');warp.reset();}if(evt.keyCode==9){}if(evt.keyCode==116){}if(evt.keyCode==17){}else if(evt.keyCode==8){}else if(evt.keyCode==46){}else if(evt.keyCode==37){}else if(evt.keyCode==39){}});vector.win.caption('Vector');toast('<h1>Welcome</h1>');});}Warp.Manager=function Manager(file){var man=this;man.instances={};man.forwardOriented={};var saveButton;var checkPropNames=warp.constructors.check;function render(){var detailsVisible=false;var drawers={};function renderDetails(){if(!detailsVisible){var appsContext={'edit source':function editSource(inspector){man.edit(inspector.name);},'load/refresh':function loadRefresh(inspector){man.load(inspector.name);},'explicit':function explicit(inspector){man.explicit(inspector.name,false);},'clone':function clone(inspector){input('','clone name').then(function(cloneName){man.clone(inspector.name,cloneName);});},'remove':function remove(inspector){man.remove(inspector.name);},'open folder':function openFolder(inspector){}};drawers={apps:warp.gui.items(Object.keys(man.data.apps).length+' Apps',man.data.apps,{context:appsContext},{'usePrefs':false,onOpen:function onOpen(drawer){man.sort();var b=warp.dom.node('button',{click:function click(){man.create('App');}},{class:'c6 o1 m5'});b.textContent='...create new App';drawer.body.prepend(b);drawers.fileTypes.close();drawers.brands.close();},onClose:function onClose(drawer){man.sort();}}),brands:warp.gui.items(Object.keys(man.forwardOriented).length+' Brands',man.forwardOriented,{context:false},{'usePrefs':false,onOpen:function onOpen(drawer){man.sort();var b=warp.dom.node('button',{click:function click(){man.create('Brand');}},{class:'c6 o1 m5'});b.textContent='...create new Brand';drawer.body.prepend(b);drawers.apps.close();drawers.fileTypes.close();},onClose:function onClose(drawer){man.sort();}}),fileTypes:warp.gui.items(Object.keys(man.data.fileTypes).length+' FileTypes',man.data.fileTypes,{context:false},{'usePrefs':false,onOpen:function onOpen(drawer){man.sort();var b=warp.dom.node('button',{click:function click(){man.create('FileType');}},{class:'c6 o1 m5'});b.textContent='...create new FileType';drawer.body.prepend(b);drawers.apps.close();drawers.brands.close();},onClose:function onClose(drawer){man.sort();}})};var slot=warp.dom.node('slot',{},{recive:async function recive(dropped){var what='';if(dropped.manager==man)return error('Can\'t copy or clone from same layout!');if(await warp.is(dropped,'App'))man.new(dropped.name,{brands:dropped.brands,deps:dropped.deps}).then(function(){man.data.apps[dropped.name].folder=dropped.folder;render();setTimeout(function(){warp.editor.set(warp.un.json(man.data.apps[dropped.name].folder[dropped.name+'.js']).toString());},200);});if(await warp.is(dropped,'Brand'))what='Brand';if(await warp.is(dropped,'FileType'))what='FileType';},text:'drop to add or remove',brands:['App','FileType','Brand']});slot.classList.add('mb5');slot.classList.add('mt10');man.el.append(slot);man.el.append(drawers.apps.el);man.el.append(drawers.brands.el);drawers.fileTypes.el.classList.add('mb5');man.el.append(drawers.fileTypes.el);man.el.append(gui.item(man.data.events.onLoad,{'text':'onLoad','brands':['Function'],'confirmText':'Replace onLoad function?','confirm':function confirm(newFun){man.data.events.onLoad=newFun;man.needsUpdate();},'click':function click(e){warp.edit({'name':man.data.name+'.onLoad.js','type':'js','drive':false,'path':man.data.name+'.onLoad.js',data:man.data.events.onLoad.toString(),commit:function commit(file){eval("\n                                man.data.events.onLoad = ".concat(file.data,"\n                                man.needsUpdate();\n                                "));}});}}));man.el.append(gui.item(man.data.events.beforeLoad,{'text':'beforeLoad','brands':['Function'],'confirmText':'Replace beforeLoad function?','confirm':function confirm(newFun){man.data.events.beforeLoad=newFun;man.needsUpdate();},'click':function click(e){warp.edit({'name':man.data.name+'.beforeLoad.js','type':'js','drive':false,'path':man.data.name+'.beforeLoad.js',data:man.data.events.beforeLoad.toString(),commit:function commit(file){eval("\n                                 man.data.events.beforeLoad = ".concat(file.data,"\n                                 man.needsUpdate();\n                                "));}});}}));var div=warp.dom.node('div');div.innerHTML="\n            \n            <div class=\"c2 small mt5\" > \n                Folder\n            </div>\n            <input type=\"text\" class=\"c6 mt5\" value=\"layouts/".concat(man.data.name,"\" placeholder=\"layout data folder\" />\n        ");man.el.append(div);detailsVisible=true;man.sort();}else{render();man.sort();}}man.el.innerHTML="\n        <button class=\"mb5 save primary\">Save</button>\n        \n        <button class=\"c2 clear create shadow\" warp=\"App\" drawer=\"apps\" > \n            <small>Apps</small>\n            <br> ".concat(Object.keys(man.data.apps).length,"\n        </button>\n        <button class=\"c2 clear create shadow\" warp=\"Brand\" drawer=\"brands\">\n            <small>Brands</small>\n            <br> ").concat(Object.keys(man.forwardOriented).length,"\n        </button>\n         <button class=\"c2 clear create shadow\" warp=\"FileType\" drawer=\"fileTypes\">\n            <small>Types</small>\n            <br> ").concat(Object.keys(man.data.fileTypes).length,"\n        </button>\n        <button class=\"c1 pause clear hxs\">\n             <svg class=\"icon\">\n                <use href=\"#icon-media-pause\"></use>\n             </svg>\n        </button>\n        \n        <button class=\"c1 details clear hxs\">\n             <svg class=\"icon\">\n                <use href=\"#icon-settings\"></use>\n             </svg>\n        </button>\n        ");saveButton=man.el.querySelector('.save');saveButton.addEventListener('click',saveFile);if(!man.needsSave){warp.dom.hide(saveButton);}var detailsButton=man.el.querySelector('.details');detailsButton.addEventListener('click',renderDetails);var createButtons=man.el.querySelectorAll('button.create');createButtons.forEach(function(button){button.addEventListener('click',function(){if(drawers[this.getAttribute('drawer')]){drawers[this.getAttribute('drawer')].open();}else{renderDetails();drawers[this.getAttribute('drawer')].open();}});});man.sort();}man.needsUpdate=function(){man.needsSave=true;man.show();man.sort();warp.dom.show(saveButton);};man.create=async function(what){what=what[0].toUpperCase()+what.slice(1);toast("\n        <div class=\"small tl\">\n            code for creating a Warp ".concat(what," is in the console!\n        </div>"),4000);var minimalRequired=warp.constructors.required(what);function replaceLast(str,endchar){while(str.endsWith(endchar)&&str!==''&&endchar!==''){str=str.slice(0,-1);}return str;}var objectCode=objToStr(minimalRequired);objectCode=replaceLast(objectCode,'}');objectCode=replaceLast(objectCode,'\n');objectCode=objectCode.trim();what=what.toLowerCase();if(what=='filetype')what='fileType';var f={data:"//console code for creating a warp ".concat(what,"\n//commit with ctrl+s or click on the <Commit>\nwarp.").concat(what,"(").concat(objectCode,"\n  manager : \"").concat(man.data.name,"\"\n});\n            "),name:'create a '+what+'.js',drive:false,type:'js',path:'create a '+what+'.js'};await warp.edit(f);warp.editor.beautify();};man.delete=man.remove;man.app=async function(name,appProps){if(appProps){return man.new(name,appProps);}if(man.instances[name]){return man.instances[name];}if(man.data.apps[name]){return man.load(name);}return false;};man.brand=async function(name,data){if(data){checkPropNames('Brand',data);data.manager=man;man.forwardOriented[name]=data;if(!man.data.brands[data.family]){man.data.brands[data.family]={};}man.data.brands[data.family][name]=data;if(!warp.lists.user.brands[data.family])warp.lists.user.brands[data.family]={};warp.lists.user.brands[data.family][name]=data;man.needsUpdate();render();return man.forwardOriented[name];}else return man.forwardOriented[name];};man.fileType=async function(name,data){if(data){checkPropNames('FileType',data);data.manager=man;man.data.fileTypes[name]=data;warp.lists.user.fileTypes[name]=data;man.needsUpdate();render();return man.data.fileTypes[name];}else return man.data.fileTypes[name];};man.new=async function(name,appProps){checkPropNames('App',appProps);appProps=extend(warp.constructors.list.App,appProps);appProps.name=name;var constructorName=safeName(name);eval("\n                man.data.apps['".concat(constructorName,"'] = {\n                    'name': '").concat(constructorName,"',\n                    'brands': [],\n                    'deps' : [],\n                    'description' : '',\n                    'folder' : {},\n                    'manager' : man,\n                    'constructor' : \n                    function ").concat(constructorName,"(){\n                            let app = this; \n                            this.inspect = ").concat(appProps.inspect.toString().replace('inspect',''),"\n                        }\n                }\n            "));extend(man.data.apps[constructorName],appProps);var fileName=constructorName+'.js';man.data.apps[constructorName].folder[fileName]=warp.do.json(man.data.apps[constructorName].constructor);delete man.data.apps[constructorName].constructor;delete man.data.apps[constructorName].inspect;delete man.data.apps[constructorName].init;delete man.data.apps[constructorName].clean;man.data.apps[constructorName].manager=man;man.edit(name);man.needsUpdate();render();warp.editor.beautify();return await man.load(name);};man.explicit=async function(name){return man.data.apps[name];};man.remove=async function(name){if(_typeof(name)==='object'){var removeBrand=function removeBrand(brand){delete man.forwardOriented[brand.name];delete man.data.brands[brand.family][brand.name];if(!Object.values(man.data.brands[brand.family]).length)delete man.data.brands[brand.family];man.needsUpdate();delete warp.lists.user.brands[brand.family][brand.name];render();return true;};var removeFileType=function removeFileType(fileType){delete man.data.fileTypes[fileType.type];delete warp.lists.user.fileTypes[fileType.type];man.needsUpdate();render();return true;};if('family'in name)return removeBrand(name);if('type'in name)return removeFileType(name);}if(man.data.apps[name]){delete man.data.apps[name];}if(man.instances[name]){man.instances[name].hide();man.instances[name].destroy();delete man.instances[name];}man.needsUpdate();render();return true;};man.load=async function(name){var previouslyInspected=null;if(man.instances[name]){previouslyInspected=man.instances[name].inspected;await man.unload(name);return man.load(name);}if(Array.isArray(man.data.apps[name].deps)){await warp.load(man.data.apps[name].deps);}man.instances[name]=function(){var cons=warp.un.json(man.data.apps[name].folder[name+'.js']);var ins;try{ins=new cons();}catch(err){warp.inspect(err);}ins=extend(ins,new App({name:name,winOpts:{width:160,activateOnShow:false,backdrop:false,height:'auto',minHeight:100,close:false,allowMinimize:true,class:'inspector',onShow:function onShow(win){win.caption(name);},onMinimize:function onMinimize(win){man.sort();},onRestore:function onRestore(win){ins.inspect(warp.inspected);man.sort();}}}));ins.win.minimize();ins.manager=man;return ins;}();var app=man.instances[name];if(app.init)app.init();var context={'inspect':function inspect(){warp.inspect(man.data.apps[name]);},'inspect instance':function inspectInstance(){warp.inspect(app);},'load/refresh':function loadRefresh(){man.load(name);},'edit source':function editSource(){man.edit(name);},'clone':function clone(){input('','clone name').then(function(cloneName){man.clone(name,cloneName);});},'remove':function remove(){man.remove(name);}};warp.dom.context.add(app.win.el,context,'App : '+name);return app;};man.unload=async function(name){if(man.instances[name]){if(man.instances[name].clean)man.instances[name].clean();man.instances[name].win.destroy();delete man.instances[name];}return true;};man.unloadAll=async function(){var promises=[];for(var _name8 in man.instances){promises.push(man.unload(_name8));}each(man.data.fileTypes,function(i,type){if(warp.lists.user.fileTypes[i])delete warp.lists.user.fileTypes[i];});each(man.data.brands,function(familyName,brands){each(brands,function(brandName,brand){if(warp.lists.user.brands[familyName][brandName])delete warp.lists.user.brands[familyName][brandName];});});return Promise.all(promises);};man.refresh=async function(name){if(!man.instances.name){return man.load(name);}else await man.unload(name);man.instances[name]=function(){var cons=warp.un.json(man.data.apps[name].folder[name+'.js']);var ins;try{ins=new cons();}catch(err){warp.inspect(err);throw new Error('Construct failed on inspector : '+name);}ins=extend(ins,new App({name:name,winOpts:{width:160,activateOnShow:false,backdrop:false,height:'auto',minHeight:100,close:false,allowMinimize:true,class:'inspector',onMinimize:function onMinimize(win){man.sort();},onRestore:function onRestore(win){man.sort();}}}));ins.win.minimize();ins.layout=man;ins.show();return ins;}();var context={'inspect':function inspect(){warp.inspect(man.data.apps[name]);},'load/refresh':function loadRefresh(){man.load(name);},'edit source':function editSource(){man.edit(name);},'clone':function clone(){input('','clone name').then(function(cloneName){man.clone(name,cloneName);});},'remove':function remove(){man.remove(name);}};warp.dom.context.add(man.instances[name].win.el,context,'App : '+name);return man.instances[name];};man.edit=async function(name){var f={path:'app  '+man.name+'.'+name+'.js',type:'js',name:'app  '+man.name+'.'+name+'.js',data:warp.un.json(man.data.apps[name].folder[name+'.js']).toString(),commit:async function commit(file){var cons;eval('cons = '+file.data);man.data.apps[name].folder[name+'.js']=warp.do.json(cons);man.needsUpdate();if(man.instances[name]){await man.unload(name);await man.load(name);man.instances[name].show();}},drive:false};warp.edit(f);return f;};man.clone=async function(name,cloneName){man.new(cloneName,{}).then(function(){man.data.apps[cloneName]={constructor:warp.un.json(man.data.apps[name].folder[name+'.js'])};render();});};man.explicit=async function(name,subject){await man.app(name).inspect(subject);};async function saveFile(){if(!file){input(man.data.name+'.layout','input a path for new layout file').then(function(filename){warp.user.drive.write(filename,warp.do.json(man.data)).then(function(){return toast('layout saved');});});}for(var _name9 in man.data.apps){if(man.data.apps[_name9].layout)delete man.data.apps[_name9].layout;if(man.data.apps[_name9].manager)delete man.data.apps[_name9].manager;}for(var family in man.data.brands){for(var _name10 in man.data.brands[family]){if(man.data.brands[family][_name10].manager)delete man.data.brands[family][_name10].manager;}}for(var _name11 in man.data.fileTypes){if(man.data.fileTypes[_name11].manager)delete man.data.fileTypes[_name11].manager;}delete man.data.manager;var d;try{d=warp.do.json(man.data);}catch(err){throw new Error('warp.do.json failed on save() for layout '+name);}await file.drive.write(file.path,d);toast('layout saved');for(var _name12 in man.data.apps){man.data.apps[_name12].layout=man;}extendAllWithManager(man);man.data.manager=man;man.needsSave=false;man.sort();render();return true;}async function destroyManager(){await man.unloadAll();delete warp.lists.user.layouts[man.data.name];man.win.destroy();return true;}man.destroy=async function(){await man.unloadAll();delete warp.lists.user.layouts[man.data.name];man.win.destroy();return true;};async function reloadManager(){await man.unloadAll();construct();return true;}async function runAppInspection(appName,subject){var app=man.instances[appName];app.inspected=subject;try{app.inspect(subject);}catch(err){man.edit(name);confirm("\n                    <small>\n                        Inspect failed for app ".concat(name,"!\n                        <br>\n                        ").concat(err,"\n                        <br>\n                        The app code is opened in the console, execute it to update after editing the errors\n                        <br>\n                        Remove app ").concat(name," from layout for this session?\n                    </small>\n                    "),async function(){await man.unload(name);await man.remove(name);});}app.show();return app;}man.sort=async function(){var margin=5;var w=160+margin;var currX=man.win.x();var currY=man.win.y()+man.win.height()+margin;var prev=false;for(var ind in man.instances){if(man.instances[ind].win.visible()&&man.instances[ind].win.el.classList.contains('inspector')){var _app2=man.instances[ind];if(prev){currY=currY+prev.win.height()+margin;}if(currY>warp.gui.height-300){currX=currX+w;currY=man.win.y()+man.win.height();}_app2.win.x(currX);_app2.win.y(currY);prev=_app2;}}};function extendAllWithManager(man){each(man.data.apps,function(i,app){app.manager=man;});each(man.data.fileTypes,function(i,type){type.manager=man;warp.lists.user.fileTypes[i]=type;});each(man.data.brands,function(familyName,brands){each(brands,function(brandName,brand){brand.manager=man;man.forwardOriented[brandName]=brand;});if(!warp.lists.user.brands[familyName]){warp.lists.user.brands[familyName]=brands;}else{extend(warp.lists.user.brands[familyName],brands);}});}function construct(){function parseFile(file){man.data={name:file.name,type:'dom',deps:[],apps:{},brands:{},fileTypes:{},events:{beforeLoad:function beforeLoad(layout){},onLoad:function onLoad(layout){}}};if(file&&file.data!=null){man.data=warp.un.json(file.data);}if(file&&file.data==null){Object.assign(man.data,file.data);}man.name=man.data.name;}parseFile(file);extend(man,new App({name:man.data.name,winOpts:{width:160,backdrop:false,height:'auto',close:false,class:'inspector',activateOnShow:false,onDrag:function onDrag(draggable){each(man.instances,function(index,i){i.win.x(i.win.x()+draggable.deltaX);i.win.y(i.win.y()+draggable.deltaY);});}}}));if(warp.lists.user.layouts[man.data.name]){confirm(man.data.name+' is already loaded. Destroy and reload?',async function(){await warp.lists.user.layouts[man.data.name].destroy();construct();});return;}if(man.data.events.beforeLoad)man.data.events.beforeLoad(man);warp.lists.user.layouts[man.data.name]=man;extendAllWithManager(man);if(file.drive){man.win.caption('Layout : '+man.data.name);}else man.win.caption('Layout : '+man.data.name+'(readonly)');render();warp.dom.context.add(man.el,{'create new app':function createNewApp(){input('NewApp','input a CamelCase name for new app').then(function(name){man.new(name,{}).then(function(){render();});});},'inspect layout data':function inspectLayoutData(){warp.inspect(man.data);},'inspect Manager':function inspectManager(){warp.inspect(man);},'publish':function publish(){},'save':function save(){saveFile();},'unload all':function unloadAll(){reloadManager();},'edit in Editor':function editInEditor(){warp.editor.edit(file);},'unload all and destroy':function unloadAllAndDestroy(){if(man.data.name=='Warp'){confirm('Are you sure? <br><br> Unloading Warp layout will leave you without basic Brands,Apps and FileTypes!',function(){if(Object.keys(warp.lists.user.layouts).length==1){alert('There are no layouts loaded, Vector inspecting has been paused');warp.paused=true;warp.vector.hide();}destroyManager();});return;}destroyManager();}},'Layout : '+man.data.name);setTimeout(function(){man.win.options('onHide',function(win){for(var _name13 in man.instances){man.instances[_name13].hide();}});},200);if(man.data.events.onLoad)man.data.events.onLoad(man);}construct();return man;};Warp.Dom=function Dom(warp){var _dom=this;var pngLoaded=false;var pdfLoaded=false;var editorLoaded=false;var helpers={findUp:function findUp(el,className){while(el.parentNode){el=el.parentNode;if(el.classList&&el.classList.contains(className))return el;}return null;},isVisible:function isVisible(el,holder){holder=holder||el.parentNode;var _el$getBoundingClient=el.getBoundingClientRect(),top=_el$getBoundingClient.top,bottom=_el$getBoundingClient.bottom,height=_el$getBoundingClient.height;var holderRect=holder.getBoundingClientRect();return top<=holderRect.top?holderRect.top-top<=height:bottom-holderRect.bottom<=height;},top:function top(el){var rect=el.getBoundingClientRect();return rect.top;},height:function height(arg1,arg2){if(!arg1&&!arg2){return window.innerHeight;}if(arg2){arg1.style.height=arg2+'px';return arg1;}else{return arg1.offsetHeight;}},width:function width(arg1,arg2){if(!arg1&&!arg2){return window.innerWidth;}if(arg2){arg1.style.width=arg2+'px';return arg1;}else{return arg1.offsetWidth;}},dims:function dims(arg1,arg2){if(!arg1&&!arg2){return{width:window.innerWidth,height:window.innerHeight};}if(arg2){arg1.style.width=arg2.width+'px';arg1.style.height=arg2.height+'px';return arg1;}else{return{width:arg1.offsetWidth,height:arg1.offsetHeight};}},center:function center(el,parent,offsetTop){if(!offsetTop)offsetTop=0;var h=_dom.height(el);var parentH=0;if(parent){parentH=_dom.height(el.parentNode);}else{parentH=_dom.height();}el.style.marginTop=parentH/2-h/2-offsetTop+'px';return el;},insert:function insert(el,referenceNode){referenceNode.parentNode.insertBefore(el,referenceNode.nextSibling);return el;},remove:function remove(el){var p=el.parentNode;p.removeChild(el);return p;},closest:function closest(el,selector){if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}return i>-1;};}for(;el&&el!==document;el=el.parentNode){if(el.matches(selector))return el;}return null;},loading:function loading(el,state){if(state!=undefined&&!state){el.classList.remove('loading');return el;}el.classList.add('loading');return el;},toggle:function toggle(el){if(el.classList.contains('hidden')){el.classList.remove('hidden');}else{el.classList.add('hidden');}return el;},disable:function disable(el,state){el.classList.add('disabled');return el;},enable:function enable(el){el.classList.remove('disabled');return el;},hide:function hide(el,state){el.classList.add('hidden');return el;},show:function show(el){el.classList.remove('hidden');return el;},stringify:function stringify(el){return new XMLSerializer().serializeToString(el);},activate:function activate(el){if(_dom.active)_dom.active.classList.remove('active');el.classList.add('active');_dom.active=el;},computed:function computed(el,prop){return window.getComputedStyle(el,null).getPropertyValue(prop);}};_dom.clickedWhere=function(e){var el=e;if(e.target)el=e.target;var rect=el.getBoundingClientRect();var x,y;if(e){x=parseInt(e.clientX-rect.left);y=parseInt(e.clientY-rect.top);}else{x=parseInt(rect.width/2);y=parseInt(rect.height/2);}return{x:x,y:y};};this.log=function(text,lev){if(lev){throw new Error('dom',text);}else{console.log('dom',text);}};var options={shorthandSelect:'$'};this.toPng=function(node,jpg){return new Promise(function(resolve,reject){if(!pngLoaded)warp.do.loadJS('https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js').then(function(){function hideOverflow(element){function isOverflowing(el){return el.scrollWidth>el.clientWidth||el.scrollHeight>el.clientHeight;}function processElement(el){if(isOverflowing(el)){el.style.overflow='hidden';el.style.scrollbarWidth='none';}Array.from(el.children).forEach(function(child){processElement(child);});}processElement(element);}hideOverflow(node);if(jpg){domtoimage.toJpeg(node,{quality:0.95}).then(function(dataUrl){if(!Boolean(dataUrl)){reject('There seems to be a problem with domtopng');throw new Error('toJpg failed');}var img=new Image();img.src=dataUrl;resolve(img);});}else domtoimage.toPng(node).then(function(dataUrl){if(!Boolean(dataUrl)){reject('There seems to be a problem with domtopng');throw new Error('toPng failed');}var img=new Image();img.src=dataUrl;resolve(img);});});});};function RichEditor(){var app=extend(this,new App({name:'richEditor',winOpts:{caption:'Rich editor',height:100,width:200}}));app.el.innerHTML="\n                                <style>\n                                .rich-editor button{  \n                                    border-radius:2px;\n                                }\n                                </style>\n                                <div class=\"rich-editor\">\n                                    <button class=\"xs strong tmd m5 clear b\">b</button>\n                                    <button class=\"xs ti tmd m5 clear i\">i</button>\n                                    <button class=\"xs ti m5 ml10 primary finish\">Finish</button>\n                                </div>";}var editor;setTimeout(function(){editor=new RichEditor();},300);this.edit=function(node){var blur;return new Promise(function(resolve,reject){node.setAttribute('contentEditable',true);editor.show();node.focus();var userSelect=helpers.computed(node,'userSelect');node.style.userSelect='text';blur=node.addEventListener('blur',function(event){finish();});function finish(){removeEventListener('blur',blur);node.setAttribute('contentEditable',false);_dom.hidePopup();node.style.userSelect=userSelect;resolve(node.innerHTML);}});};this.toPdf=async function(node,fileName){if(!pdfLoaded){await warp.do.loadJS('https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js');pdfLoaded=true;return _dom.toPdf(node,fileName);}node.style.fontFamily='Verdana, Arial';var col=node.style.color;node.style.color='black';var pdf=html2pdf().set({filename:fileName+'.pdf'}).from(node);pdf.save();node.style.color=col;node.style.fontName='initial';return pdf;};_dom.underPointer=function(el){var rect=el.getBoundingClientRect();return rectContains(rect,gui.pointer('x'),gui.pointer('y'));};var nodes={'slot':{attrs:{},events:{},fun:function fun(events,attrs){attrs=extend({data:false,recive:false,brands:[],el:false,text:false,confirmText:'Do you really want to drop here?',confirm:false},attrs,true);var el;if(attrs.el){el=attrs.el;el.setAttribute('brands',attrs.brands.toString());el.classList.add('slot');}else{el=_dom.node('div',{},{class:'slot default',brands:attrs.brands.toString()});if(attrs.text){el.textContent=attrs.text;}else el.textContent=attrs.brands.join(' , ');el.addEventListener('mouseenter',function(e){e.preventDefault();if(!this.querySelector('svg'))_dom.addPopup(this,'this is a Slot, it can recive : <h3>'+this._warp.brands.join(' , ')+'</h3>');});}if(attrs.confirm){attrs.recive=function(data){confirm(attrs.confirmText,function(){attrs.confirm(data);});};}Object.defineProperty(el,'_warp',{enumerable:false,writable:true,value:attrs});return el;}},'item':{attrs:{'brand':'forced brand, can be string a nme of brand, or object with brand data','data':'data to create item from'},events:{'click':'performed on user click, a default is to inspect the data'},fun:function fun(events,attrs){function item(data,userOpts){var options={text:'',click:function click(subject){warp.inspect(subject);},context:{'inspect data':function inspectData(){warp.inspect(data);},'edit brand':async function editBrand(){var family=false;var brand=warp.test(data);family=Object.keys(brand)[0];brand=Object.values(brand)[0];brand=brand[brand.length-1];brand=await warp.brand(brand);var clone=Object.assign({},brand);clone.manager=brand.manager.name;var str=objToStr(clone);var f={type:'js',name:'Editing brand '+brand.name,drive:false,path:false,data:"warp.brand(".concat(str,")")};warp.open(f);warp.editor.beautify();}},brand:false};if(userOpts)if(userOpts.context){Object.assign(options.context,userOpts.context);delete userOpts.context;}options=Object.assign(options,userOpts);warp.constructors.check('Item',options);var brandName=warp.test(data);var family=Object.keys(brandName)[0];brandName=Object.values(brandName)[0];brandName=brandName[brandName.length-1];if(!options.text)options.text=brandName;var slotOpts=extend(userOpts);slotOpts.text=false;var slotEl=_dom.node('slot',{},slotOpts);warp.brand(brandName).then(function(brand){var badge='';if(userOpts&&userOpts.click)badge="\n                     <rect fill=\"rgba(20,20,20,0.6)\" stroke=\"rgba(10,10,10,0.9)\" x=\"1\" y=\"1\" width=\"8\" height=\"8\" rx=\"4\" ry=\"4\"></rect>\n                     <text  fill=\"var(--primaryBg)\" dy=\"0\" text-anchor=\"middle\" x=\"5\" y=\"7\"  style=\"font-size:6px\">C</text>\n                  ";slotEl.innerHTML="\n                    <svg viewBox=\"0 0 146 22\" class=\"inline item fl\">\n                            <rect fill=\"".concat(brand.colors.body.bg,"\" width=\"100%\" height=\"100%\" rx=\"1\" ry=\"1\"></rect>\n                            <text class=\"caption\" fill=\"").concat(brand.colors.body.color,"\" dy=\"0\" text-anchor=\"end\" x=\"100%\" y=\"14\" dx=\"-5\">").concat(options.text,"</text>\n                            <path fill=\"").concat(brand.colors.label.bg,"\"  d=\"m 0 0 l 50 0 l -10 22 l -50 0 l 0 -22 l 0 0 z\"></path>\n                            <text class=\"label\" fill=\"").concat(brand.colors.label.color,"\"  dy=\"0\" text-anchor=\"start\" x=\"6\" y=\"14\">").concat(brand.short,"</text>\n                            ").concat(badge,"\n                    </svg>\n                    ");slotEl.querySelector('svg').addEventListener('click',function(e){warp.dom.activate(this.parentNode);options.click(data);});Object.defineProperty(slotEl.querySelector('svg'),'_warp',{enumerable:false,writable:true,value:{brand:brandName,data:data}});if(options.context){var _loop8=function _loop8(_name14){var fun=options.context[_name14];options.context[_name14]=function(){fun(data);};};for(var _name14 in options.context){_loop8(_name14);}main.context.add(slotEl,options.context,'Item data');}});return slotEl;}attrs=extend({'data':false},attrs,true);var el;if(attrs.el){el=attrs.el;var dummy=item(attrs.data,attrs);warp.inspect(dummy._warp);Object.defineProperty(el,'_warp',{enumerable:false,writable:true,value:{data:attrs.data,brand:dummy._warp.brand}});}else el=item(attrs.data,attrs);return el;}},'file':{attrs:{},events:{},fun:function fun(events,attrs){if(!attrs)attrs={};attrs=extend({path:false,type:false,color:false,size:false},attrs);var el=warp.dom.node('div',{},{'class':attrs.type+' fs file'});var name=attrs.path.split('/').at(-1).split('.');name.pop();name=name.join('.');el.innerHTML="\n            ".concat(name,"\n            <div style=\"background-color:").concat(attrs.color,"\" class=\"rect\">\n                <div class=\"size\">\n                    ").concat(attrs.size,"\n                </div>\n                <div style=\"color:").concat(attrs.color,";\" class=\"type\" >\n                        ").concat(attrs.type.split(' ')[1]?attrs.type.split(' ')[1]:'',"\n                </div>\n            </div>");return el;}},'folder':{attrs:{},events:{},fun:function fun(events,attrs){if(!attrs)attrs={};attrs=extend({'path':false,drive:false},attrs);var el=warp.dom.node('div',{},{'class':'fs folder'});el.innerHTML="\n            ".concat(attrs.path.split('/').at(-1).split('.')[0],"\n            <br>\n                <svg>\n                    <use href=\"#icon-folder\"/>\n                </svg>\n                <div class=\"size\">\n                    ").concat(parseInt(attrs.size),"\n                </div>\n           ");return el;}},'drive':{attrs:{},events:{},fun:function fun(events,attrs){if(!attrs)attrs={};attrs=extend({drive:false},attrs);var cl='o2';if(attrs.drive.read)cl='';var el=warp.dom.node('div',{},{'class':'fs drive'});var driveNameCaption=attrs.drive.name;if(attrs.drive.type=='Public'||attrs.drive.type=='Private'){driveNameCaption=gui.storage('profiles.'+driveNameCaption);if(driveNameCaption)driveNameCaption=driveNameCaption.name;}el.innerHTML="\n            <div class=\"name\">".concat(driveNameCaption,"</div>\n                <svg fill=\"grey\" class=\"").concat(cl," ").concat(attrs.drive.read?'':'op3',"\">\n                    <use href=\"#icon-drive\"/>\n                </svg>\n              <div class=\"type\"> ").concat(attrs.drive.type,"</div>\n           ");if(!driveNameCaption)warp.api.call('profiles/read',attrs.drive.name).then(function(prof){el.queryselector('.name').textContent=prof.name;});return el;}},'colorInput':{attrs:{class:'','data':'the color'},events:{},fun:function fun(events,attrs){attrs=extend({class:'','data':'white'},attrs,true);var el=warp.dom.node('input',events,{type:'text','class':attrs.class});el.value=attrs.data;el.style.backgroundColor=attrs.data;el.addEventListener('mouseup',async function(){var rect=this.getBoundingClientRect();var x=rect.left+window.scrollX;var y=rect.top+window.scrollY;this.value=await warp.gui.picker.select(this.value,x,y-350);this.style.backgroundColor=this.value;});return el;}}};this.node=function(node,events,attrs){if(typeof node==='string'){var _name15=node;if(nodes[node]){node=nodes[node].fun(events,attrs);if(attrs&&attrs.context)main.context.add(node,attrs.context,_name15);return node;}node=document.createElement(node);if(attrs&&attrs.context)main.context.add(node,attrs.context,_name15);}if(events){for(name in events){node.addEventListener(name,events[name]);}}if(attrs){for(name in attrs){node.setAttribute(name,attrs[name]);}}return node;};this.select=function(el){if(!Boolean(el)){throw new Error('dom.select recived false or null');return false;}function arr(subject){if(subject.length==0){return null;}if(subject.length==1){return subject[0];}return subject;}if(_typeof(el)=='object'){if(_instanceof(el,NodeList)){return arr(Array.from(el));}if(_instanceof(el,HTMLElement)||_instanceof(el,SVGElement)){return el;}return arr(Array.from(el));}if(typeof el=='string'){var q=document.querySelectorAll(el);return arr(Array.from(q));}if(typeof el=='array'){return arr(el);}else{return el;}};this.on=function(selector,event,childSelector,handler){function isSelector(el,selector){return(el.matches||el.matchesSelector||el.msMatchesSelector||el.mozMatchesSelector||el.webkitMatchesSelector||el.oMatchesSelector).call(el,selector);}var elements=document.querySelectorAll(selector);[].forEach.call(elements,function(el,i){el.addEventListener(event,function(e){if(isSelector(e.target,childSelector)){handler(e);}});});};function chain(result){return result;}function init(){var _loop9=function _loop9(_name16){if(_dom[_name16]){console.log(new Error('dom function is ovwerrruning something in dom'));}_dom[_name16]=function(arg1,arg2,arg3){if(arg1){arg1=_dom.select(arg1);if(arg1.forEach){if(arg1.length>1){arg1.forEach(function(el){return helpers[_name16](el,arg2,arg3);});return chain(arg1,arg2,arg3);}else{return chain(arg1[0],arg2,arg3);}}else{return chain(helpers[_name16](arg1,arg2,arg3));}}else{return chain(helpers[_name16]());}};};for(var _name16 in helpers){_loop9(_name16);}window[options.shorthandSelect]=_dom.select;_dom.context=new _dom.Context();}init();setTimeout(function(){if(!warp.gui.mobile()){var dragged={el:false,parent:false,position:'starting position',slots:[],arrows:[],closestArrow:false,closestLen:false};warp.on('pointer.dragStart',function(data){warp.gui.layers.helpers.instances=[];dragged.el=helpers.findUp(data.event.target,'item');if(dragged.el){dragged.slots=warp.gui.el.querySelectorAll('*[brands]');dragged.arrows=[];if(dragged.slots[0])dragged.slots.forEach(function(el,i){if(helpers.isVisible(el)&&el._warp.recive){if(el._warp.brands.includes(dragged.el._warp.brand)||el._warp.brands.includes('All')){var rect=el.getBoundingClientRect();var x=rect.x+rect.width/2;var y=rect.y+rect.height/2;if(x&&y){var arrow=warp.gui.layers.helpers.create({name:'line-'+i,width:2,fill:'black',x1:data.pointer.x,y1:data.pointer.y,x2:x,y2:y},'Arrow');arrow.slot=el;dragged.arrows.push(arrow);}}}});dragged.el.style.position='absolute';dragged.parent=dragged.el.parentNode;dragged.position=dragged.el.getBoundingClientRect();warp.gui.layers.blockers.el.append(dragged.el);}});warp.on('pointer.drag',function(data){if(dragged.el){var p=data.pointer;gsap.to(dragged.el,{duration:0,x:p.x,y:p.y});if(dragged.closestArrow)dragged.closestArrow.slot.classList.remove('active');dragged.closestArrow=false;dragged.closestLen=false;dragged.arrows.forEach(function(arrow,i){arrow.from(p.x,p.y);if(!dragged.closestArrow){dragged.closestArrow=arrow;dragged.closestLen=arrow.length();arrow.fill='cyan';warp.dom.activate(dragged.closestArrow.slot);}else{var len=arrow.length();if(len<dragged.closestLen){dragged.closestArrow.fill='grey';dragged.closestLen=len;dragged.closestArrow=arrow;arrow.fill='cyan';warp.dom.activate(arrow.slot);}else arrow.fill='grey';}});warp.gui.popup(dragged.closestArrow.slot,' This Slot can recive <h3>'+dragged.closestArrow.slot._warp.brands.join(' , ')+'</h3>');}else dragged.arrows.forEach(function(arrow){return arrow.destroy();});});warp.on('pointer.dragEnd',function(data){dragged.arrows.forEach(function(arrow){return arrow.destroy();});if(dragged.el){var el=dragged.el;var parent=dragged.parent;if(dragged.closestArrow.slot){var dest=dragged.closestArrow.slot.getBoundingClientRect();gsap.to(el,{duration:0.2,x:dest.x,y:dest.y,opacity:0,scale:1,onComplete:function onComplete(){parent.innerHTML='';parent.append(el);el.style.position='relative';el.setAttribute('style','opacity:1');}});dragged.closestArrow.slot._warp.recive(el._warp.data);warp.gui.animate.shake(dragged.closestArrow.slot);}else gsap.to(el,{duration:0.2,x:dragged.position.x,y:dragged.position.y,opacity:1,scale:1,onComplete:function onComplete(){parent.append(el);el.style.position='relative';el.setAttribute('style','opacity:1');}});}_dom.hidePopup();});}},100);};Warp.Dom.prototype.Context=function(){var app=this;var list={};function show(pos){var width=warp.dom.width(app.el);var height=warp.dom.height(app.el);var maxX=warp.dom.width()-width-10;var maxY=warp.dom.height()-height-10;if(pos.x>maxX)pos.x=maxX;if(pos.y>maxY)pos.y=maxY;gsap.to(app.el,{x:pos.x+10,y:pos.y,duration:0});gsap.to(app.el,{x:pos.x,y:pos.y,opacity:1,delay:0.02,duration:0.1});}function hide(){gsap.to(app.el,{opacity:0});app.el.style.display='none';}function create(pos,el){app.el.innerHTML='';var drawers={};var first=false;var DOMDrawer={};var original=el;function elName(el){return el.nodeName+'.'+el.classList.toString().replace(' ','.');}function getParents(elem){var parents=[];while(elem.parentNode&&elem.parentNode.nodeName.toLowerCase()!='body'){elem=elem.parentNode;parents.push(elem);}return parents;}var cap=elName(el);DOMDrawer[cap]=function(){warp.inspect(original);};if(el.ctxFuncs){first=el.ctxFuncs;}if(el.nodeName==='INPUT'||el.nodeName==='TEXTAREA'){drawers['Clipboard']={'paste':function paste(){warp.clipboard.read().then(function(text){if(el.setRangeText){el.setRangeText(text);}else{el.focus();document.execCommand('insertText',false,text);}});}};}var selection=document.getSelection();if(selection){if(!drawers['Clipboard'])drawers['Clipboard']={};drawers['Clipboard'].copy=function(){warp.clipboard.write(selection.toString()).then(function(text){});};}var parents=getParents(el);parents.forEach(function(parent){var cap='Document';if(parent.classList){cap=elName(parent);}DOMDrawer[cap]=function(){warp.inspect(parent);};if(parent.ctxFuncs){for(var parDrawer in parent.ctxFuncs){if(drawers[parDrawer]){Object.assign(drawers[parDrawer],parent.ctxFuncs[parDrawer]);}else{drawers[parDrawer]=parent.ctxFuncs[parDrawer];}}}});if(main.envVars.loggedIn){var user=warp.gui.storage('user');var menu=warp.dom.node('div',{},{class:'mb5',style:'height:26px; margin-top:-30px;'});menu.innerHTML="\n        <style>\n      .menu-btn, .menu-btn :hover {\n                    text-align:center;\n                    padding:0px;           \n                    width:25px;\n                    height:25px;\n                    background-color:rgba(0,0,0,.7);\n                    border:none;\n          }\n           .menu-btn svg {\n              width:20px;\n                    fill:rgb(200,200,200)!important\n          }\n            </style>\n            <div class=\"small hxs hidden\">\n                                <span>\n                                 ".concat(user.username," \n                                 </span>\n                                <button class=\"menu-btn fr mt-5 mb-5\" onclick=\"warp.logout()\" title=\"Log out\">\n                                    <svg class=\"icon\" style=\"width:15px\">\n                                        <use href=\"#icon-delete\"></use>\n                                    </svg>\n                                </button>\n                                 \n            </div>\n\n                              \n                                <button class=\"menu-btn\" style=\"margin-left:-5px\" onclick=\"warp.user.private.apps[0].show()\" title=\"Private drive\">\n                                    <svg class=\"icon\" style=\"width:15px\">\n                                        <use href=\"#icon-drive\"></use>\n                                    </svg>\n                                </button>\n                                \n                                <button class=\"menu-btn\" onclick=\"main.search.show()\" title=\"Search for profiles\">\n                                    <svg class=\"icon\" style=\"width:15px\">\n                                        <use href=\"#icon-search\"></use>\n                                    </svg>\n                                </button>\n                                \n                                <button class=\"menu-btn\" onclick=\"main.conversations.show()\" title=\"Conversations\">\n                                    <svg class=\"icon\">\n                                        <use href=\"#icon-chat\"></use>\n                                    </svg>\n                                </button>\n                                \n                                <button class=\"menu-btn\" onclick=\"main.contacts.show()\" title=\"Contacts\">\n                                    <svg class=\"icon\">\n                                        <use href=\"#icon-avatar\"></use>\n                                    </svg>\n                                </button>\n                                \n                                <button class=\"menu-btn\" onclick=\"main.you.show()\" title=\"Account settings\">\n                                   <svg class=\"icon\" style=\"width:15px\">\n                                        <use href=\"#icon-settings\"></use>\n                                    </svg>\n                                </button>\n                                \n                                <button class=\"menu-btn\" style=\"margin-right:-5px\" onclick=\"main.nottApp.show()\" title=\"Activity\">\n                                   <svg class=\"icon\" style=\"width:15px\">\n                                        <use href=\"#icon-calendar\"></use>\n                                    </svg>\n                                </button>\n        ");menu.querySelectorAll('button').forEach(function(el){return el.addEventListener('click',hide);});app.el.append(menu);}if(first){for(var drawer in first){var dr=new gui.Drawer(drawer,{'class':'ctx-drawer','size':'xs',usePrefs:true,name:'context.'+drawer});var funcs=first[drawer];var _loop10=function _loop10(_name17){var fun=funcs[_name17];if(typeof fun==='string'){dr.body.append(fun);}else if(typeof fun==='function'){btn=warp.dom.node('button',{click:function click(){fun();hide();}},{'class':'ctx default xs'});btn.textContent=_name17;dr.body.append(btn);}else{dr.body.append(fun);}};for(var _name17 in funcs){var btn;_loop10(_name17);}app.el.append(dr.el);}}for(var _drawer in drawers){var _dr=new gui.Drawer(_drawer,{'class':'ctx-drawer','size':'xs',usePrefs:true,name:'context.'+_drawer});var _funcs=drawers[_drawer];var _loop11=function _loop11(_name18){var fun=_funcs[_name18];if(typeof fun==='string'){_dr.body.append(fun);}else if(typeof fun==='function'){btn=warp.dom.node('button',{click:function click(){fun();hide();}},{'class':'ctx default xs'});btn.textContent=_name18;_dr.body.append(btn);}else{_dr.body.append(fun);}};for(var _name18 in _funcs){_loop11(_name18);}app.el.append(_dr.el);}gui.layers['blockers'].el.appendChild(app.el);app.el.style.display='inline-block';show(pos);}this.add=function add(el,funcs,drawerName){if(el.ctxFuncs){if(el.ctxFuncs[drawerName]){Object.assign(el.ctxFuncs[drawerName],funcs);}el.ctxFuncs[drawerName]=funcs;}else{el.ctxFuncs={};el.ctxFuncs[drawerName]=funcs;}if(el.nodeName==='BODY'){el=warp.gui.el.parentNode;if(el.ctxFuncs){if(el.ctxFuncs[drawerName]){Object.assign(el.ctxFuncs[drawerName],funcs);}el.ctxFuncs[drawerName]=funcs;}else{el.ctxFuncs={};el.ctxFuncs[drawerName]=funcs;}}};this.hide=hide;function construct(){app.show=false;app.el=document.createElement('div');app.el.setAttribute('class','ctx');document.body.addEventListener('contextmenu',function(e){e.preventDefault();create({x:e.clientX,y:e.clientY},e.target);},false);document.body.addEventListener('mousedown',function(e){function classInParents(element,cls){if(!element.classList)return false;if(element.classList.contains(cls))return true;if(element.parentNode){return element.parentNode&&classInParents(element.parentNode,cls);}else return false;}if(e.button===0){if(!classInParents(e.target,'ctx')){hide();}}},true);return app;}construct();};var ListApp=function ListApp(options){var app=this;var list=false;var userWinOptions=false;if(options.winOpts){userWinOptions=options.winOpts;}options=Object.assign({name:false,editor:false,renderList:false,renderItem:function renderItem(data){if(!data){data={big:'default item',fistSmall:'change this',medium:'main.date.format(item.created)',secondSmall:'main.date.format(item.updated)'};}else{data={big:data.name,fistSmall:data.id,medium:main.date.format(data.created),secondSmall:main.date.format(data.updated)};}return gui.listItem(data);},onSelect:function onSelect(data){if(app.editor){app.log('defaultOnSelect : editor is present');app.editor.edit(data);return;}else{app.log('defaultOnSelect : editor not used/present, selected item data :');app.log(data);}app.log(data);},'new':false,debug:true},options);options.winOpts={beforeHide:function beforeHide(){app.onSelect=options.onSelect;},onShow:function onShow(w){list.style.height=w.content.offsetHeight+'px';list.style.maxHeight=w.content.offsetHeight+'px';},draggable:true,backdrop:false,backdropCloses:false,showCentered:true,backdropOpacity:0,scrollable:false};if(userWinOptions){if(userWinOptions.beforeHide){app.log('ListApp '+app.name+' was instanced with winOpts.beforeHide, this would overrun apps onHide event wich is essential',1);}options.winOpts=Object.assign(options.winOpts,userWinOptions);}app=Object.assign(this,new warp.factory.App({name:options.name,winOpts:options.winOpts}));app.listEl=app.el.querySelector('.list');list=app.listEl;this.onSelect;this.type='ListApp';this.loaded=false;var scope=[];this.scope=function(prop,val){if(prop){if(val!==null||val!==undefined){scope[prop]=val;return true;}return scope[prop];}return scope;};function render(){app.clear();for(var id in scope){list.appendChild(app.renderItem(scope[id]));}}this.renderItem=function(data,editor){var el=options.renderItem(data);el.addEventListener('click',function(){app.onSelect(data);});return el;};this.add=function(data){var finished=function finished(){render(app);};if(!Array.isArray(data)){scope.push(data);finished();}else{scope=data;finished();}};this.remove=function(itemData){scope.forEach(function(listItem,i){if(listItem.id==itemData.id)scope.splice(i,1);});render(app);};this.select=function(newOnSelect){if(typeof newOnSelect!='function'){throw new Error(' newOnSelect');}app.onSelect=newOnSelect;app.win.options('backdrop',true);app.win.options('showCentered',true);app.win.show();};this.clear=function(){list.innerHTML='';};this.load=function(data){if(!data)app.log('List app \''+app.name+'\' did not recive data in app.load()! Load is the process of adding data. data should be already downloaded',1);return new Promise(function(resolve,reject){app.busy(true);app.loaded=true;app.add(data);app.busy(false);resolve();});};this.update=function(){render();};function construct(app){if(!options['name']){return new Error('App options contain no name');}app.name=options.name;if(app.name in main){app.log(options['name']+' app  already exists in main app, continuing overwriting : ');return new Error('app  already exists');}var buttonNew="\n\n<button class=\"btn new round raised primary inverted\"  style=\"position:absolute; top:40px; right:10px\" loc>\n            <svg class=\"icon\">\n                     <use href=\"#icon-create\">\n                     </use>\n             </svg>\n        \n</button>";if(!options.new){buttonNew='';}var buttonSearch="\n<button class=\"btn btn-link btn-sm mt-5 icon\" loc>\n            <svg class=\"icon ml-5 center\">\n                     <use href=\"#icon-search\">\n                     </use>\n             </svg>\n</button>";buttonSearch='';app.html("\n        <div class=\"list\">\n        </div>\n        ".concat(buttonNew,"  ").concat(buttonSearch,"\n    "));if(options.new){app.new=options.new;app.el.querySelector('.new').addEventListener('click',app.new);}list=app.el.querySelector('.list');app.renderList=render;if(options.renderList){render=options.renderList;app.renderList=render;}app.listEl=list;app.onSelect=options.onSelect;if(options.editor){app.editor=options.editor;}app.debug=options.debug;if(options.init){app.init=options.init;app.init(app);}return app;}return construct(this);};var EditApp=function EditApp(options){options=Object.assign({name:'profile',store:'profiles',render:function render(){this.el.innerHTML="\n            <h2> ".concat(this.name,"</h2>\n        ");}},options);var app=Object.assign(this,new App({name:options.name,winOpts:{close:true,beforeShow:function beforeShow(w){},draggable:true}}));app.load=function(data){this.scope=data;this.render();};app.edit=function(id){var _this4=this;if(id.id){this.load(id);this.win.show();}else{store[options.store].get(id).then(function(data){_this4.load(data);_this4.win.show();});}};app.save=function(){this.busy(true);console.log(app.scope);app.log('saving : '+warp.do.json(app.scope));store[options.store].set(app.scope).then(this.busy(false));return;};app.update=function(prop,val){if(val===undefined||val===null){this.log('val arg is null or undefined',1);return;}if(val===false){val=0;}if(val===true){val=1;}this.scope[prop]=val;this.save();};app.render=options.render;return app;};var Plans=function Plans(){var app=this;Object.assign(this,new App({name:'plans',win:true}));this.selected=2;this.select=function(planId){var old=document.querySelector('.plan-table.raised');if(old)old.classList.remove('raised');app.selected=planId;app.hide();main.account.showReg();};this.header=function(plan){};this.body=function(plan){};this.renderPlan=function(plan){function calculatePrice(caption,price,country){price=parseInt(price);if(caption=='monthly'||caption==''){price=price;}if(caption=='quorterly')price=price/100*90;if(caption=='yearly')price=price/100*80;price=price.toFixed(2);var currency=builder.data.currencyes[country.currency];price=price*currency.rates.EUR.buy;price=price.toFixed(2);if(caption=='Price'||caption===''){caption=='';}return"\n<div class=\"text-left mt15 mb10\" style=\"display:block\">\n".concat(caption,"\n    <div class=\"pull-right\" style=\"display:inline-block\">\n        <div class=\"curr price\">\n        <small>").concat(currency.entity,"/<span loc>month</span></small>\n        <br>\n        ").concat(price,"\n        </div> \n    </div>\n</div>\n");}var finalHTML='';var items='';var i=0;for(var itemText in plan.items){if(plan.items[itemText]===true||plan.items[itemText]===false){if(plan.items[itemText]===true){items=items+"<li>".concat(itemText," </li>");}else{items=items+"<li  class=\"n-a\">".concat(itemText," </li>");}}else{var cls='';if(i==3){items=items+"<span class=\"hidden details\">";}if(i>2){cls="";}items=items+"<li class=\"".concat(cls,"\">").concat(itemText," : <span style=\"float:right\"> ").concat(plan.items[itemText],"</span></li>");}i++;}items=items+"</span>";if(plan.id=='4'){items='';'';}var price='';if(plan.price===0){price=plan.price.toFixed(2)+"&euro;/month";}if(plan.price===false){price='Negotiable';}if(plan.price!==false&&plan.price!==0){price=plan.price.toFixed(2)+"&euro;/month";}var btnSelect='';if(plan.id=='4'){finalHTML=finalHTML+"\n                                <div class=\"col-lg-24 col-md-24 col-sm-24 col-xs-24 hidden\">";btnSelect="<button class=\"btn btn-primary btn-block btn-lg mt10\" onclick=\"main.contact.show('Sales contact')\">Enquire Sales</button>";}if(plan.id=='3'){finalHTML=finalHTML+"\n                                <div class=\"col-lg-8 col-md-8 col-sm-offset-6 col-sm-12 col-xs-24\">";btnSelect="<button class=\"btn btn-primary btn-block btn-lg mt10\" onclick=\"main.plans.select(".concat(name,")\">Select ").concat(plan.title,"</button>");}if(plan.id=='1'||plan.id=='2'){finalHTML=finalHTML+"\n                                <div class=\"col-lg-8 col-md-8 col-sm-12 col-xs-24\">";btnSelect="<button class=\"btn btn-primary btn-block btn-lg mt10\" onclick=\"main.plans.select(".concat(name,")\">Select ").concat(plan.title,"</button>");}finalHTML=finalHTML+"\n                              \n                                    <div class=\"plan-table\" id=\"plan-".concat(plan.id,"\">\n                                        <div class=\"plan-header\">\n                                             ").concat(calculatePrice('',plan.price,country),"\n                                            <div class=\"title mt20 loc\">\n                                                ").concat(plan.title,"\n                                           \n                                            </div>\n                                            <div class=\"punch mt5 mb5 pb5 loc\">\n                                                \"").concat(plan.punchline,"\"\n                                            </div>\n                                             \n                                        </div>\n                                     \n                                        <div class=\"plan-body \">\n                                            <ul class=\"plan-table-ul \">\n                                                ").concat(items,"\n                                            </ul>\n                                       \n                                        </div>\n                                       <div class=\"m15\">\n                                        <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-").concat(plan.id," .details')\" >details...</button>\n                              \n                                        <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-").concat(plan.id," .prices')\" >Discounts...</button>  \n                                        <div class=\"prices m10 hidden\">\n                                                    ").concat(calculatePrice('monthly',plan.price,country),"\n                                                    ").concat(calculatePrice('quorterly',plan.price,country),"\n                                                    ").concat(calculatePrice('yearly',plan.price,country),"\n                                            </div>\n                                        </div>\n                                        ").concat(btnSelect,"\n                                    </div>\n                                </div>\n                                 ");return finalHTML;};function construct(){if(main.data){if(main.data.plans){for(var id in main.data.plans){app[id]=main.data.plans[id];}}else{warp.fetch(main.envVars.url+'resources/data/plans.json').then(function(blob){blob.json().then(function(data){for(var _id in data){app[_id]=data[_id];}});});}}else{warp.fetch(main.envVars.url+'resources/data/plans.json').then(function(blob){blob.json().then(function(data){for(var _id2 in data){app[_id2]=data[_id2];}});});}app.el.innerHTML="\n        \n<div class=\"col-lg-8 col-md-8 col-sm-12 col-xs-24\">\n    <div class=\"plan-table\" id=\"plan-1\">\n        <div class=\"plan-header\">\n\n            <div class=\"text-left mt15 mb10\" style=\"display:block\">\n\n                <div class=\"pull-right\" style=\"display:inline-block\">\n                    <div class=\"curr price\">\n                        <small>&#163;/<span loc>month</span></small>\n                        <br>\n                        0.00\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"title mt20 loc\">\n                Free\n            </div>\n            <div class=\"punch mt5 mb5 pb5 loc\">\n                \"Create Orders and keep track\"\n            </div>\n        </div>\n\n        <div class=\"plan-body \">\n            <ul class=\"plan-table-ul \">\n                <li class=\"\">Trial period : <span style=\"float:right\"> n/a</span></li><li class=\"\">Invitations : <span style=\"float:right\"> 2</span></li><li class=\"\">Orders/month : <span style=\"float:right\"> 15</span></li><span class=\"hidden details\"><li class=\"\">Max draft orders : <span style=\"float:right\"> 5</span></li><li class=\"\">Number of teams : <span style=\"float:right\"> 1</span></li><li class=\"\">Max team members : <span style=\"float:right\"> 2</span></li><li class=\"\">Can be member of teams : <span style=\"float:right\"> 2</span></li><li class=\"\">Storage size : <span style=\"float:right\"> 100</span></li></span>\n            </ul>\n        </div>\n        <div class=\"m15\">\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-1 .details')\">details...</button>\n\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-1 .prices')\">Discounts...</button>\n            <div class=\"prices m10 hidden\">\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    quorterly payment -10%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            0.00\n                        </div>\n                    </div>\n                </div>\n\n\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    yearly payment -20%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            0.00\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <button class=\"btn btn-primary btn-block btn-lg mt10 disabled\" onclick=\"alert('You can register free plan omly with an Invitation from a Dalwia member')\">Select Free</button>\n        <small>* Available only through Invitation. 'Basic' and 'Pro' plans get a number of Invitations to send.</small>\n\n    </div>\n</div>\n\n<div class=\"col-lg-8 col-md-8 col-sm-12 col-xs-24\">\n\n    <div class=\"plan-table\" id=\"plan-2\">\n        <div class=\"plan-header\">\n            <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                <div class=\"pull-right\" style=\"display:inline-block\">\n                    <div class=\"curr price\">\n                        <small>&#163;/<span loc>month</span></small>\n                        <br>\n                        85.50\n                    </div>\n                </div>\n            </div>\n            <div class=\"title mt20 loc\">\n                Basic\n            </div>\n            <div class=\"punch mt5 mb5 pb5 loc\">\n                \"Open your lab to your clients\"\n            </div>\n        </div>\n        <div class=\"plan-body \">\n            <ul class=\"plan-table-ul \">\n                <li class=\"\">Trial period : <span style=\"float:right\"> 6</span></li><li class=\"\">Invitations : <span style=\"float:right\"> 25</span></li><li class=\"\">Orders/month : <span style=\"float:right\"> 100</span></li><span class=\"hidden details\"><li class=\"\">Max draft orders : <span style=\"float:right\"> 5</span></li><li class=\"\">Number of teams : <span style=\"float:right\"> 3</span></li><li class=\"\">Max team members : <span style=\"float:right\"> 5</span></li><li class=\"\">Can be member of teams : <span style=\"float:right\"> 3</span></li><li class=\"\">Storage size : <span style=\"float:right\"> 5000</span></li></span>\n            </ul>\n        </div>\n        <div class=\"m15\">\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-2 .details')\">details...</button>\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-2 .prices')\">Discounts...</button>\n            <div class=\"prices m10 hidden\">\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    quorterly payment -10%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            76.95\n                        </div>\n                    </div>\n                </div>\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    yearly payment -20%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            68.40\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n        <button class=\"btn btn-primary btn-block btn-lg mt10\" onclick=\"main.plans.select(2)\">Select Basic</button>\n    </div>\n</div>\n\n<div class=\"col-lg-8 col-md-8 col-md-offset-0 col-sm-offset-6 col-sm-12 col-xs-24\">\n\n    <div class=\"plan-table\" id=\"plan-3\">\n        <div class=\"plan-header\">\n\n            <div class=\"text-left mt15 mb10\" style=\"display:block\">\n\n                <div class=\"pull-right\" style=\"display:inline-block\">\n                    <div class=\"curr price\">\n                        <small>&#163;/<span loc>month</span></small>\n                        <br>\n                        161.10\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"title mt20 loc\">\n                Pro\n\n            </div>\n            <div class=\"punch mt5 mb5 pb5 loc\">\n                \"Open your lab to the world\"\n            </div>\n\n        </div>\n\n        <div class=\"plan-body \">\n            <ul class=\"plan-table-ul \">\n                <li class=\"\">Trial period : <span style=\"float:right\"> 6</span></li><li class=\"\">Invitations : <span style=\"float:right\"> 50</span></li><li class=\"\">Orders/month : <span style=\"float:right\"> 250</span></li><span class=\"hidden details\"><li class=\"\">Max draft orders : <span style=\"float:right\"> 20</span></li><li class=\"\">Number of teams : <span style=\"float:right\"> 5</span></li><li class=\"\">Max team members : <span style=\"float:right\"> 15</span></li><li class=\"\">Can be member of teams : <span style=\"float:right\"> 5</span></li><li class=\"\">Storage size : <span style=\"float:right\"> 20000</span></li></span>\n            </ul>\n\n        </div>\n        <div class=\"m15\">\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-3 .details')\">details...</button>\n\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-3 .prices')\">Discounts...</button>\n            <div class=\"prices m10 hidden\">\n\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    quorterly payment -10%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            144.99\n                        </div>\n                    </div>\n                </div>\n\n\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    yearly payment -20%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            128.88\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n        <button class=\"btn btn-primary btn-block btn-lg mt10\" onclick=\"main.plans.select(3)\">Select Pro</button>\n    </div>\n</div>\n\n<div class=\"col-lg-24 col-md-24 col-sm-24 col-xs-24 hidden\">\n\n    <div class=\"plan-table\" id=\"plan-4\">\n        <div class=\"plan-header\">\n\n            <div class=\"text-left mt15 mb10\" style=\"display:block\">\n\n                <div class=\"pull-right\" style=\"display:inline-block\">\n                    <div class=\"curr price\">\n                        <small>&#163;/<span loc>month</span></small>\n                        <br>\n                        NaN\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"title mt20 loc\">\n                Corporate\n\n            </div>\n            <div class=\"punch mt5 mb5 pb5 loc\">\n                \"Organizing a big lab or a clinic?  Please contact us for quotation\"\n            </div>\n\n        </div>\n\n        <div class=\"plan-body \">\n            <ul class=\"plan-table-ul \">\n\n            </ul>\n\n        </div>\n        <div class=\"m15\">\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-4 .details')\">details...</button>\n\n            <button class=\"btn btn-default btn-sm btn-block\" onclick=\"warp.dom.toggle('#plan-4 .prices')\">Discounts...</button>\n            <div class=\"prices m10 hidden\">\n\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    quorterly payment -10%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            NaN\n                        </div>\n                    </div>\n                </div>\n\n\n                <div class=\"text-left mt15 mb10\" style=\"display:block\">\n                    yearly payment -20%\n                    <div class=\"pull-right\" style=\"display:inline-block\">\n                        <div class=\"curr price\">\n                            <small>&#163;/<span loc>month</span></small>\n                            <br>\n                            NaN\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n        <button class=\"btn btn-primary btn-block btn-lg mt10\" onclick=\"main.contact.show('Sales contact')\">Enquire Sales</button>\n    </div>\n</div>";}construct();};var Account=function Account(){var app=this;var service=main.service;var loginInProcess=false;window.selectedCountry=0;this.loggedIn=false;Object.assign(app,new App({name:'account',winOpts:{'name':'account-win','centerBody':true,'keepCentered':true,'backdrop':true}}));var showEl=function showEl(sel){var els=app.el.querySelectorAll(sel);els.forEach(function(e){e.classList.remove('hidden');e.style.display='block';});};var hideEl=function hideEl(sel){var els=app.el.querySelectorAll(sel);els.forEach(function(e){e.style.display='none';e.classList.add('hidden');});};this.logIn=function(){app.busy(true);var username,pass;username=app.el.querySelector('.user-name').value;pass=app.el.querySelector('.user-pass').value;warp.api.call('users/login',{'username':username,'password':pass}).then(function(recived){app.busy(false);if(recived===false){app.loggedIn=false;toast('Wrong credentials!');return;}localStorage.clear();app.log('Local storage has been cleared');app.postLogin(recived);});return;};this.refreshPage=function(){window.location.reload();};this.postLogin=function(recived){hideEl('button.login');showEl('button.logout');hideEl('button.reg');main.envVars.loggedIn=true;app.loggedIn=true;warp.user.afterLogin(recived);app.hide();};this.logOut=function(){return new Promise(function(resolve,reject){if(main.envVars.loggedIn){warp.api.call('users/logout').then(function(recived){var id=localStorage.getItem('userId');localStorage.clear();localStorage.setItem('userId',id);resolve();if(app.worker){app.worker.postMessage('refreshPage');}else app.refreshPage();});}else{var id=localStorage.getItem('userId');localStorage.clear();localStorage.setItem('userId',id);resolve();if(app.worker){app.worker.postMessage('refreshPage');}else app.refreshPage();}});};this.register=function(){var usr=app.el.querySelector('.user-name').value;var pass=app.el.querySelector('.user-pass').value;if(!main.plans.selected){error("\n            Please select a subscription plan before registrating...\n            <br/>\n            \n            <button class=\" mt20 mla mra\" onclick=\"main.account.hide(); $('#section-plans').scrollIntoView(true);\">Select plan</button>\n            \n            ");return;}if(!Boolean(window.selectedCountry)){error('Please select the Country you work from.');return;}var passAgain=app.el.querySelector('.user-pass-again').value;if(pass!=passAgain){error('Your passwords dont match!');return;}app.el.classList.add('disabled');app.busy(true);warp.api.call('users/validateUsername',{'username':usr}).then(function(recived){if(recived){app.validatePass(pass,function(){toast('we are registering, please wait');warp.api.call('users/register',{'username':usr,'password':pass,'plan':main.plans.selected,'country':window.selectedCountry}).then(function(id){if(!id){error('something went wrong!');return;}app.el.classList.remove('disabled');toast('registration is success!');app.win.hide();app.busy(false);app.logIn();});});}else{app.busy(false);app.el.classList.remove('disabled');error(" Username is not an email address, or it is already used!");}});};this.validatePass=function(pass,onTrue){warp.api.call('users/validatePass',{'password':pass}).then(function(recived){if(recived!==true){app.busy(false);error(" Password is not valid! Your password failed at : <br><br><ul><li> ".concat(recived.join('</li><li>')," </li></ul>"));}else{onTrue();}});return;};this.remind=function(){var usr=app.el.querySelector('.user-name').value;app.busy(true);warp.api.call('users/sendPass',{'username':usr}).then(function(recived){app.busy(false);if(recived===false){warp.gui.animate.shake($('.user-name'));toast('This is not an e-mail address!');return;}else{alert('If a user account is registered with '+usr+', a password reminder will be delivered in a few moments...');app.el.querySelector('.user-name').value='';app.hide();}});};this.changePass=function(){var oldPass=app.el.querySelector('.user-pass').value;var pass=app.el.querySelector('.user-new-pass input').value;app.validatePass(pass,function(){app.busy(true);warp.api.call('users/changePass',{'oldPassword':oldPass,'password':pass}).then(function(res){app.busy(false);if(!res){toast('This is not your old password!');return;}toast('Password changed');app.hide();});});};this.hide=function(){loginInProcess=false;app.win.hide();};this.regProceed=function(){if(!window.selectedCountry){toast('Please select your country');warp.gui.animate.shake($('.reg-country select'));return;}hideEl('.reg-country');showEl('.reg-msg');showEl('.user-name');hideEl('.user-new-pass');hideEl('.login-msg');showEl('.user-pass');showEl('.user-pass-again');hideEl('.btn-login');hideEl('a.forgot');hideEl('.btn-reminder');showEl('.btn-create-account');hideEl('.btn-change');hideEl('.show-reg');hideEl('.forgot-msg');if(main.plans.selected){app.el.querySelector('.selected-plan-title').textContent=main.plans[main.plans.selected].title;}};this.showLogin=function(){if(app.loggedIn){confirm('Log out?',function(){app.logOut();});return;}function show(){loginInProcess=true;hideEl('.reg-msg');showEl('.login-msg');showEl('.user-name');hideEl('.user-new-pass');showEl('.user-pass');hideEl('.user-pass-again');showEl('.btn-login');showEl('a.forgot');hideEl('.btn-reminder');hideEl('.show-reg');hideEl('.btn-create-account');hideEl('.btn-change');hideEl('.forgot-msg');app.win.show();app.el.querySelector('.user-name').focus();}if(app.win.visible()){app.win.hide().then(app.win.show());}else{show();}};this.detectCountry=function(){var el=app.el.querySelector('.reg-msg select');el.classList.add('loading');warp.api.call('countries/detect/').then(function(rec){el.classList.remove('loading');el.value=rec.cca3;window.selectedCountry=rec.cca3;});};this.showReg=function(){function show(){showEl('.reg-country');showEl('.reg-msg');hideEl('.user-name');hideEl('.user-new-pass');hideEl('.login-msg');hideEl('.user-pass');hideEl('.user-pass-again');hideEl('.btn-login');hideEl('a.forgot');hideEl('.btn-reminder');hideEl('.btn-create-account');hideEl('.btn-change');hideEl('.show-reg');hideEl('.forgot-msg');if(main.plans.selected){app.el.querySelector('.selected-plan-title').textContent=main.plans[main.plans.selected].title;}app.win.show();}if(main.plans.selected){app.el.querySelector('.btn-account-plan').textContent=main.plans[main.plans.selected].title;}else{}if(app.win.visible()){app.win.hide(function(){show();});}else{show();}};this.showChange=function(){function show(){hideEl('.reg-msg');hideEl('.login-msg');app.el.querySelector('.user-new-pass input').value='';hideEl('.user-name');showEl('.user-new-pass');showEl('.user-pass');hideEl('.user-pass-again');hideEl('.btn-login');hideEl('a.forgot');hideEl('.btn-reminder');hideEl('.btn-create-account');showEl('.btn-change');hideEl('.show-reg');hideEl('.forgot-msg');app.win.show();}if(app.win.visible()){app.win.hide(function(){show();});}else{show();}};this.showForgot=function(){function show(){hideEl('.reg-msg');hideEl('.login-msg');hideEl('.user-pass');hideEl('.user-pass-again');hideEl('.btn-login');hideEl('a.forgot');showEl('.btn-reminder');showEl('.forgot-msg');hideEl('.btn-change');hideEl('.show-reg');app.win.show();}show();};function construct(){var fakeLogin=warp.dom.node('form');fakeLogin.innerHTML="\n        <input type=\"text\" id=\"username\" value=\"\"  autocomplete=\"new-user\"  autocomplete=\"section-blue shipping street-address\" style=\"display:none\">\n        <input type=\"password\" id=\"password\" value=\"\" autocomplete=\"new-password\" style=\"display:none\">\n    ";fakeLogin.style.display='none';document.body.prepend(fakeLogin);var dom=warp.dom.node('div');dom.setAttribute('class','login form');dom.innerHTML=" \n                <div class=\"reg-msg hidden tl\">\n                    <button class=\"btn-block btn-account-plan hidden\" onclick=\"main.account.hide()\">\n                        <span class=\"cap-first\" loc>select subscription plan</span>\n                    </button>\n                    <h3 class=\"cap-first\" style=\"font-size:20px\" loc>Registration</h3>\n                    <p class=\"cap-first\" loc>\n                        Sign up now to secure your spot on our waitlist and be first in line to experience our features.\n                    </p>\n                    <p class=\"cap-first hidden\" loc>\n                        You are registering with plan <span class=\"selected-plan-title strong\">\n                        </span>!\n                    </p>\n                    <div class=\"reg-country\">\n                        <p>\n                            Please select your country!\n                        </p>\n                        <select oninput=\"window.selectedCountry=this.value\" class=\"hmd w100\">\n                            <option value=\"0\" loc style=\"opacity:0.7\">select your country</option>\n                            <option value=\"AFG\">Afghanistan</option>\n                            <option value=\"ALB\">Albania</option>\n                            <option value=\"DZA\">Algeria</option>\n                            <option value=\"ASM\">American Samoa</option>\n                            <option value=\"AND\">Andorra</option>\n                            <option value=\"AGO\">Angola</option>\n                            <option value=\"AIA\">Anguilla</option>\n                            <option value=\"ATA\">Antarctica</option>\n                            <option value=\"ATG\">Antigua and Barbuda</option>\n                            <option value=\"ARG\">Argentina</option>\n                            <option value=\"ARM\">Armenia</option>\n                            <option value=\"ABW\">Aruba</option>\n                            <option value=\"AUS\">Australia</option>\n                            <option value=\"AUT\">Austria</option>\n                            <option value=\"AZE\">Azerbaijan</option>\n                            <option value=\"BHS\">Bahamas</option>\n                            <option value=\"BHR\">Bahrain</option>\n                            <option value=\"BGD\">Bangladesh</option>\n                            <option value=\"BRB\">Barbados</option>\n                            <option value=\"BLR\">Belarus</option>\n                            <option value=\"BEL\">Belgium</option>\n                            <option value=\"BLZ\">Belize</option>\n                            <option value=\"BEN\">Benin</option>\n                            <option value=\"BMU\">Bermuda</option>\n                            <option value=\"BTN\">Bhutan</option>\n                            <option value=\"BOL\">Bolivia</option>\n                            <option value=\"BIH\">Bosnia and Herzegovina</option>\n                            <option value=\"BWA\">Botswana</option>\n                            <option value=\"BVT\">Bouvet Island</option>\n                            <option value=\"BRA\">Brazil</option>\n                            <option value=\"IOT\">British Indian Ocean Territory</option>\n                            <option value=\"VGB\">British Virgin Islands</option>\n                            <option value=\"BRN\">Brunei</option>\n                            <option value=\"BGR\">Bulgaria</option>\n                            <option value=\"BFA\">Burkina Faso</option>\n                            <option value=\"BDI\">Burundi</option>\n                            <option value=\"KHM\">Cambodia</option>\n                            <option value=\"CMR\">Cameroon</option>\n                            <option value=\"CAN\">Canada</option>\n                            <option value=\"CPV\">Cape Verde</option>\n                            <option value=\"BES\">Caribbean Netherlands</option>\n                            <option value=\"CYM\">Cayman Islands</option>\n                            <option value=\"CAF\">Central African Republic</option>\n                            <option value=\"TCD\">Chad</option>\n                            <option value=\"CHL\">Chile</option>\n                            <option value=\"CHN\">China</option>\n                            <option value=\"CXR\">Christmas Island</option>\n                            <option value=\"CCK\">Cocos (Keeling) Islands</option>\n                            <option value=\"COL\">Colombia</option>\n                            <option value=\"COM\">Comoros</option>\n                            <option value=\"COK\">Cook Islands</option>\n                            <option value=\"CRI\">Costa Rica</option>\n                            <option value=\"HRV\">Croatia</option>\n                            <option value=\"CUB\">Cuba</option>\n                            <option value=\"CUW\">Cura\xE7ao</option>\n                            <option value=\"CYP\">Cyprus</option>\n                            <option value=\"CZE\">Czechia</option>\n                            <option value=\"COD\">DR Congo</option>\n                            <option value=\"DNK\">Denmark</option>\n                            <option value=\"DJI\">Djibouti</option>\n                            <option value=\"DMA\">Dominica</option>\n                            <option value=\"DOM\">Dominican Republic</option>\n                            <option value=\"ECU\">Ecuador</option>\n                            <option value=\"EGY\">Egypt</option>\n                            <option value=\"SLV\">El Salvador</option>\n                            <option value=\"GNQ\">Equatorial Guinea</option>\n                            <option value=\"ERI\">Eritrea</option>\n                            <option value=\"EST\">Estonia</option>\n                            <option value=\"SWZ\">Eswatini</option>\n                            <option value=\"ETH\">Ethiopia</option>\n                            <option value=\"FLK\">Falkland Islands</option>\n                            <option value=\"FRO\">Faroe Islands</option>\n                            <option value=\"FJI\">Fiji</option>\n                            <option value=\"FIN\">Finland</option>\n                            <option value=\"FRA\">France</option>\n                            <option value=\"GUF\">French Guiana</option>\n                            <option value=\"PYF\">French Polynesia</option>\n                            <option value=\"ATF\">French Southern and Antarctic Lands</option>\n                            <option value=\"GAB\">Gabon</option>\n                            <option value=\"GMB\">Gambia</option>\n                            <option value=\"GEO\">Georgia</option>\n                            <option value=\"DEU\">Germany</option>\n                            <option value=\"GHA\">Ghana</option>\n                            <option value=\"GIB\">Gibraltar</option>\n                            <option value=\"GRC\">Greece</option>\n                            <option value=\"GRL\">Greenland</option>\n                            <option value=\"GRD\">Grenada</option>\n                            <option value=\"GLP\">Guadeloupe</option>\n                            <option value=\"GUM\">Guam</option>\n                            <option value=\"GTM\">Guatemala</option>\n                            <option value=\"GGY\">Guernsey</option>\n                            <option value=\"GIN\">Guinea</option>\n                            <option value=\"GNB\">Guinea-Bissau</option>\n                            <option value=\"GUY\">Guyana</option>\n                            <option value=\"HTI\">Haiti</option>\n                            <option value=\"HMD\">Heard Island and McDonald Islands</option>\n                            <option value=\"HND\">Honduras</option>\n                            <option value=\"HKG\">Hong Kong</option>\n                            <option value=\"HUN\">Hungary</option>\n                            <option value=\"ISL\">Iceland</option>\n                            <option value=\"IND\">India</option>\n                            <option value=\"IDN\">Indonesia</option>\n                            <option value=\"IRN\">Iran</option>\n                            <option value=\"IRQ\">Iraq</option>\n                            <option value=\"IRL\">Ireland</option>\n                            <option value=\"IMN\">Isle of Man</option>\n                            <option value=\"ISR\">Israel</option>\n                            <option value=\"ITA\">Italy</option>\n                            <option value=\"CIV\">Ivory Coast</option>\n                            <option value=\"JAM\">Jamaica</option>\n                            <option value=\"JPN\">Japan</option>\n                            <option value=\"JEY\">Jersey</option>\n                            <option value=\"JOR\">Jordan</option>\n                            <option value=\"KAZ\">Kazakhstan</option>\n                            <option value=\"KEN\">Kenya</option>\n                            <option value=\"KIR\">Kiribati</option>\n                            <option value=\"UNK\">Kosovo</option>\n                            <option value=\"KWT\">Kuwait</option>\n                            <option value=\"KGZ\">Kyrgyzstan</option>\n                            <option value=\"LAO\">Laos</option>\n                            <option value=\"LVA\">Latvia</option>\n                            <option value=\"LBN\">Lebanon</option>\n                            <option value=\"LSO\">Lesotho</option>\n                            <option value=\"LBR\">Liberia</option>\n                            <option value=\"LBY\">Libya</option>\n                            <option value=\"LIE\">Liechtenstein</option>\n                            <option value=\"LTU\">Lithuania</option>\n                            <option value=\"LUX\">Luxembourg</option>\n                            <option value=\"MAC\">Macau</option>\n                            <option value=\"MDG\">Madagascar</option>\n                            <option value=\"MWI\">Malawi</option>\n                            <option value=\"MYS\">Malaysia</option>\n                            <option value=\"MDV\">Maldives</option>\n                            <option value=\"MLI\">Mali</option>\n                            <option value=\"MLT\">Malta</option>\n                            <option value=\"MHL\">Marshall Islands</option>\n                            <option value=\"MTQ\">Martinique</option>\n                            <option value=\"MRT\">Mauritania</option>\n                            <option value=\"MUS\">Mauritius</option>\n                            <option value=\"MYT\">Mayotte</option>\n                            <option value=\"MEX\">Mexico</option>\n                            <option value=\"FSM\">Micronesia</option>\n                            <option value=\"MDA\">Moldova</option>\n                            <option value=\"MCO\">Monaco</option>\n                            <option value=\"MNG\">Mongolia</option>\n                            <option value=\"MNE\">Montenegro</option>\n                            <option value=\"MSR\">Montserrat</option>\n                            <option value=\"MAR\">Morocco</option>\n                            <option value=\"MOZ\">Mozambique</option>\n                            <option value=\"MMR\">Myanmar</option>\n                            <option value=\"NAM\">Namibia</option>\n                            <option value=\"NRU\">Nauru</option>\n                            <option value=\"NPL\">Nepal</option>\n                            <option value=\"NLD\">Netherlands</option>\n                            <option value=\"NCL\">New Caledonia</option>\n                            <option value=\"NZL\">New Zealand</option>\n                            <option value=\"NIC\">Nicaragua</option>\n                            <option value=\"NER\">Niger</option>\n                            <option value=\"NGA\">Nigeria</option>\n                            <option value=\"NIU\">Niue</option>\n                            <option value=\"NFK\">Norfolk Island</option>\n                            <option value=\"PRK\">North Korea</option>\n                            <option value=\"MKD\">North Macedonia</option>\n                            <option value=\"MNP\">Northern Mariana Islands</option>\n                            <option value=\"NOR\">Norway</option>\n                            <option value=\"OMN\">Oman</option>\n                            <option value=\"PAK\">Pakistan</option>\n                            <option value=\"PLW\">Palau</option>\n                            <option value=\"PSE\">Palestine</option>\n                            <option value=\"PAN\">Panama</option>\n                            <option value=\"PNG\">Papua New Guinea</option>\n                            <option value=\"PRY\">Paraguay</option>\n                            <option value=\"PER\">Peru</option>\n                            <option value=\"PHL\">Philippines</option>\n                            <option value=\"PCN\">Pitcairn Islands</option>\n                            <option value=\"POL\">Poland</option>\n                            <option value=\"PRT\">Portugal</option>\n                            <option value=\"PRI\">Puerto Rico</option>\n                            <option value=\"QAT\">Qatar</option>\n                            <option value=\"COG\">Republic of the Congo</option>\n                            <option value=\"ROU\">Romania</option>\n                            <option value=\"RUS\">Russia</option>\n                            <option value=\"RWA\">Rwanda</option>\n                            <option value=\"REU\">R\xE9union</option>\n                            <option value=\"BLM\">Saint Barth\xE9lemy</option>\n                            <option value=\"SHN\">Saint Helena, Ascension and Tristan da Cunha</option>\n                            <option value=\"KNA\">Saint Kitts and Nevis</option>\n                            <option value=\"LCA\">Saint Lucia</option>\n                            <option value=\"MAF\">Saint Martin</option>\n                            <option value=\"SPM\">Saint Pierre and Miquelon</option>\n                            <option value=\"VCT\">Saint Vincent and the Grenadines</option>\n                            <option value=\"WSM\">Samoa</option>\n                            <option value=\"SMR\">San Marino</option>\n                            <option value=\"SAU\">Saudi Arabia</option>\n                            <option value=\"SEN\">Senegal</option>\n                            <option value=\"SRB\">Serbia</option>\n                            <option value=\"SYC\">Seychelles</option>\n                            <option value=\"SLE\">Sierra Leone</option>\n                            <option value=\"SGP\">Singapore</option>\n                            <option value=\"SXM\">Sint Maarten</option>\n                            <option value=\"SVK\">Slovakia</option>\n                            <option value=\"SVN\">Slovenia</option>\n                            <option value=\"SLB\">Solomon Islands</option>\n                            <option value=\"SOM\">Somalia</option>\n                            <option value=\"ZAF\">South Africa</option>\n                            <option value=\"SGS\">South Georgia</option>\n                            <option value=\"KOR\">South Korea</option>\n                            <option value=\"SSD\">South Sudan</option>\n                            <option value=\"ESP\">Spain</option>\n                            <option value=\"LKA\">Sri Lanka</option>\n                            <option value=\"SDN\">Sudan</option>\n                            <option value=\"SUR\">Suriname</option>\n                            <option value=\"SJM\">Svalbard and Jan Mayen</option>\n                            <option value=\"SWE\">Sweden</option>\n                            <option value=\"CHE\">Switzerland</option>\n                            <option value=\"SYR\">Syria</option>\n                            <option value=\"STP\">S\xE3o Tom\xE9 and Pr\xEDncipe</option>\n                            <option value=\"TWN\">Taiwan</option>\n                            <option value=\"TJK\">Tajikistan</option>\n                            <option value=\"TZA\">Tanzania</option>\n                            <option value=\"THA\">Thailand</option>\n                            <option value=\"TLS\">Timor-Leste</option>\n                            <option value=\"TGO\">Togo</option>\n                            <option value=\"TKL\">Tokelau</option>\n                            <option value=\"TON\">Tonga</option>\n                            <option value=\"TTO\">Trinidad and Tobago</option>\n                            <option value=\"TUN\">Tunisia</option>\n                            <option value=\"TUR\">Turkey</option>\n                            <option value=\"TKM\">Turkmenistan</option>\n                            <option value=\"TCA\">Turks and Caicos Islands</option>\n                            <option value=\"TUV\">Tuvalu</option>\n                            <option value=\"UGA\">Uganda</option>\n                            <option value=\"UKR\">Ukraine</option>\n                            <option value=\"ARE\">United Arab Emirates</option>\n                            <option value=\"GBR\">United Kingdom</option>\n                            <option value=\"USA\">United States</option>\n                            <option value=\"UMI\">United States Minor Outlying Islands</option>\n                            <option value=\"VIR\">United States Virgin Islands</option>\n                            <option value=\"URY\">Uruguay</option>\n                            <option value=\"UZB\">Uzbekistan</option>\n                            <option value=\"VUT\">Vanuatu</option>\n                            <option value=\"VAT\">Vatican City</option>\n                            <option value=\"VEN\">Venezuela</option>\n                            <option value=\"VNM\">Vietnam</option>\n                            <option value=\"WLF\">Wallis and Futuna</option>\n                            <option value=\"ESH\">Western Sahara</option>\n                            <option value=\"YEM\">Yemen</option>\n                            <option value=\"ZMB\">Zambia</option>\n                            <option value=\"ZWE\">Zimbabwe</option>\n                            <option value=\"0\" loc=\"\" style=\"opacity:0.7\">select your country</option>\n                            <option value=\"ALA\">\xC5land Islands</option>\n                        </select>\n                        <button class=\"btn-block sm warning mt20 hidden\" \n                        onclick=\"main.account.detectCountry()\">\n                            <span class=\"cap-first\" loc>autodetect</span>\n                        </button>\n                        <p class=\"tj\">\n                            <span class=\"tb cap-first text-warning\" loc>Reminder : </span>\n                            <br>\n                            <p class=\"cap-first tj\" loc>account functionality heavily relies on your geographical location.\n                            you will not be able to change the country of your account later on.</p>\n                        </p>\n                        <button loc class=\"block mt20\" onclick=\"main.account.regProceed()\"> Proceed                 </button>\n                    </div>\n                </div>\n                <div class=\"user-new-pass tl\">\n                    <h2 loc class=\"cap-first\">Password setup</h2>\n                    <p loc class=\"cap-first text-justify\">\n                        Password has to be at least 8 characters. At least one has to be capitalised and at least one has to be a number\n                    </p>\n                    <span class=\"cap-first\" loc>Please enter new password</span>\n                      <form class=\"form\">\n                    <input type=\"password\" placeholder=\"new password\"  autocomplete=\"new-password\"  class=\"user-new-pass w100\" loc />\n                      </form>\n                    <br>\n                    <span loc class=\"cap-first text-justify\">Please enter old password to confirm </span>\n                </div>\n                <div class=\"tl login-msg\">\n                    <h1 style=\"font-size:35px\">Sign in</h1>\n                    <p loc class=\"tmd cap-first\">\n                        Please provide your credentials\n                    </p>\n                </div>\n                <div class=\"forgot-msg hidden tl\">\n                    <h2 class=\"cap-first\" loc>Password recovery</h2>\n                    <p>\n                        <span class=\"cap-first\" loc>Please enter e-mail address You used for account registration!</span>\n                    </p>\n                </div>\n                <form class=\"form\">\n                    <input type=\"text\" placeholder=\"your e-mail\" class=\"user-name block w100\" autocomplete=\"off\" autocapitalize=\"off\" autocorrect=\"off\" loc />\n                    <input type=\"password\" placeholder=\"your password\"  autocomplete=\"new-password\"  class=\"user-pass block w100\" loc />\n                    <a class=\" forgot fr mt10 mb20 tr block cap-first\" onclick=\"main.account.showForgot()\" loc=\"forgot your password?\">forgot your password?</a>\n                    <input type=\"password\" placeholder=\"your password again\"  autocomplete=\"new-password-again\"  class=\"user-pass-again w100 hidden\" loc />\n                </form>\n                <button class=\" btn-login w50 mt15\" onclick=\"main.account.logIn()\" loc>Sign in</button>\n                <button class=\"hidden mt20 btn-reminder block\" onclick=\"main.account.remind()\" loc> send me my password </button>\n                <button class=\"hidden link mt20 btn-reminder block\" onclick=\"main.account.hide(); setTimeout( main.account.showLogin,500)\" loc> Sign in </button>\n                <div class=\"show-reg\">\n                    <p class=\"text-center hidden\">\n                        or\n                    </p>\n                    <button class=\" primary  btn-block \" onclick=\"main.account.showReg()\" loc>Register</button>\n                </div>\n                <button class=\" primary btn-create-account hidden block mt20\" onclick=\"main.account.register()\" loc>create account</button>\n                <button class=\" primary block btn-change\" onclick=\"main.account.changePass()\" loc>Save password</button>\n            ";app.el.appendChild(dom);if(main.envVars.loggedIn){app.postLogin();}else{showEl('button.login');showEl('button.reg');hideEl('button.logout');}app.el.querySelector('.user-name').addEventListener('keypress',function(event){if(event.keyCode==13){app.el.querySelector('.user-pass').focus();}},true);app.el.querySelector('.user-pass').addEventListener('keypress',function(event){if(event.keyCode==13){if(loginInProcess){app.logIn();}}},true);if(window.SharedWorker){app.worker=new SharedWorker('resources/js/account.shared.js').port;app.worker.start();app.worker.onmessage=function(e){app[e.data[0]]();};}main.context.add(document.body,{'Log in/out':function LogInOut(){main.account.showLogin();}},'Account');return app;}return construct();};var DateApp=function DateApp(){var app=this;app.current=false;app.today=new Date();var timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone;function changeTimeZone(date,timeZone){if(typeof date==='string'){return new Date(new Date(date).toLocaleString('hr-HR',{timeZone:timeZone}));}return new Date(date.toLocaleString('hr-HR',{timeZone:timeZone}));}function respond(date){try{return date.toLocaleDateString('hr-HR').replaceAll(' ','');}catch(err){return date;}}app.normalize=function(subject,asDateTime){if(typeof subject=='string'){var t;if(!asDateTime){t=subject.split(/[- :]/);return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5]));}else{t=subject.split(/[- :]/);return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5]));}}if(typeof subject==='number'){return new Date(subject);}return subject;};app.link=function(date,onClick){date=app.normalize(date);var a=warp.dom.node('a');a.textContent=app.format(date);if(onClick){a.addEventListener('click',function(){onClick(app.serverFormat(date));});}return a;};app.format=function(date,asDateTime){if(date==''||date==false||date==undefined||date==null||date=='0000-00-00 00:00:00'){return'<span loc>Date not set</span>';}date=app.normalize(date,asDateTime);return respond(date);};app.serverFormat=function(date){date=app.normalize(date);return date.toISOString().slice(0,19).replace('T',' ');};app.tense=function(date){date=app.normalize(date);var diffInMs=date-app.today;return Math.ceil(diffInMs/(1000*60*60*24));};app.daysFromNow=function(daysFrom,noFormat){daysFrom=parseInt(daysFrom);var date=new Date();var final=new Date(date.getTime()+daysFrom*24*60*60*1000);if(noFormat){return final;}else{return respond(final);}};app.time=function(date){var time=date.slice(10,19);return time.replace('T',' ');};app.daysFrom=function(date,daysFrom,noFormat){daysFrom=parseInt(daysFrom);date=app.normalize(date);var final=new Date(date.getTime()+daysFrom*24*60*60*1000);if(noFormat){return final;}else{return respond(final);}};app.monthsFrom=function(date,monthsFrom,noFormat){monthsFrom=parseInt(monthsFrom);date=app.normalize(date);var final=new Date(date.getTime()+monthsFrom*30*24*60*60*1000);if(noFormat){return final;}else{return respond(final);}};function init(){warp.do.loadJS('https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.js');}init();};var Setup=function Setup(){var app=Object.assign(this,new warp.factory.App({name:'setup',winOpts:{beforeShow:function beforeShow(w){try{warp.dom.remove('.wp-site-blocks');}catch(e){}fetch(main.envVars.url+'resources/html/setup.html').then(function(response){return response.text();}).then(function(t){w.body.innerHTML=t;});}}}));app.items={name:false,last:false,type:1,terms:false};function validate(){var fails=false;for(var it in app.items){if(fails===false){if(app.items[it]===false){fails=it;}}}if(fails){if(fails=='last'){fails='name';}alert('Please enter all required data :  '+fails+' is missing');return false;}return true;}app.finished=function(){app.win.body.innerHTML="\n        \n        <div class=\"m20\">\n            <h3 class=\"mtxl\">Congratulations on joining!</h3>\n            \n             <p class=\"hidden\" loc>\n               Earn points for rewards by referring friends, joining our community, and sharing on social media. \n            </p>\n            \n              <p loc class=\"mt20\">\n            <span class=\"text-warning\">    Reminder : </span> <br>\n               Keep an eye on your inbox for your confirmation email to complete the process.\n            </p>\n            <button loc class=\"btn btn-primary cap mla mra mt10\" onclick=\"warp.dom.disable(this); main.account.logOut()\">Reload</button>\n        </div>\n        ";};app.save=function(){if(!validate()){return;}var userData=gui.storage('user');var saveData={'id':userData.id,'name':app.items.name+' '+app.items.last,'type':app.items.type,'public':1};warp.api.call('profiles/update',saveData).then(function(recived){warp.api.call('users/activate',{'referal':app.items.referal}).then(function(recived){if(recived){app.finished();}else alert('An error occured');});});};};var Contact=function Contact(options){options=Object.assign({'title':'Contact us'},options);var app=Object.assign(this,new App({winOpts:{'class':'text-left'},name:'contact'}));function q(selector){return app.el.querySelector(selector);}app.el.innerHTML="\n<div class=\"contact center tl mt20 mb20\" style=\"width:300px;\">\n    <div class=\"row\">\n        <div class=\"col-md-24\">\n            <h2 class=\"capf mt30\" loc>Contact us</h2>\n            <div class=\"form mb20\">\n                <input type=\"text\" class=\"title block w100 hidden\" placeholder=\"Title\" loc>\n                <input type=\"text\"   class=\"name block w100\" placeholder=\"Your Name\" loc>\n                <input type=\"email\"  class=\"email block w100\" required=\"required\" placeholder=\"Your Email\" loc>\n                <textarea  required=\"required\" class=\"message block w100 mt10\" \n                rows=\"5\" placeholder=\"message\" loc></textarea>\n                <div class=\"text-center block w100 mt10\">\n                    <p loc>Please add these numbers :</p>\n                    <span class=\"numberA\">5</span>\n                    <span> + </span>\n                    <span class=\"numberB\">5</span> =\n                    <input type=\"text\" class=\"result\" class=\"int\" required=\"required\" />\n                </div>\n                <button class=\"block mt20\" loc onclick=\"main.contact.post()\">Send message</button>\n            </div>\n        </div>\n    </div>\n</div>    \n    ";function validateEmail(subject){if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(subject)){return true;}return false;}this.post=function(){var address=q('.email').value;if(validateEmail(address)){if(parseInt(q('.numberA').textContent)+parseInt(q('.numberB').textContent)!=parseInt(q('.result').value)){error('Please add the numbers for security reasons to continue...');return;}warp.api.call('users/contact',{'email':address,'subject':q('.title').value,'message':q('.message').value}).then(function(res){alert('Message sent');app.hide();});}else{error('This is not an e-mail address, please fix!');}};this.show=function(){q('.numberA').textContent=Math.floor(Math.random()*9)+1;q('.numberB').textContent=Math.floor(Math.random()*9)+1;q('.result').value='';q('.title').value=options.title;q('.message').value='';app.win.show();};};var Menu=function Menu(){var app=this;Object.assign(this,new App({name:'menu',winOpts:{beforeHide:function beforeHide(w){if(main.home)main.home.win.activate();}}}));app.toggle=function(){if(app.visible){app.hide();return;}app.show();};app.add=function(text,fun){if(!fun){var sep=warp.dom.node('div',{},{'class':' separator pull-left mt20 mb5 upper w100'});sep.textContent=text;app.contentEl.appendChild(sep);return;}var a=warp.dom.node('button',{click:fun},{'class':'btn btn-link cap pull-right'});a.textContent=text;app.contentEl.appendChild(a);};app.show=function(){app.win.show();var links=app.contentEl.querySelectorAll('.btn');gsap.set(app.contentEl,{opacity:0});gsap.set(links,{'x':0,opacity:1});gsap.to(app.contentEl,{duration:0.2,opacity:1,onComplete:function onComplete(){}});gsap.from(links,{duration:0.2,'x':-50,'opacity':0,ease:Back.easeOut,stagger:0.1,onComplete:function onComplete(){}});};app.hide=function(){app.win.hide();};function loadMenuItems(){app.add('account');app.add('Log out',function(){main.menu.hide();main.home.win.hide().then(main.account.logOut());});app.add('Refresh',function(){main.menu.hide();main.home.win.hide().then(location.reload());});app.add('Hallway',function(){main.conversation.select('00000000000000');});app.add(main.data.product.name);}function init(){app.el.innerHTML="\n             <div class=\"body\">\n             </div>\n    ";app.el.classList.add('menu');app.contentEl=app.el.querySelector('.body');var isChrome=navigator.userAgent.includes('Chrome')&&navigator.vendor.includes('Google Inc');if(isChrome){var defferedPrompt;app.contentEl.innerHTML="\n                <div class=\"separator fl mt20 mb5 upper w100\">\n                    App\n                 </div>   \n                 <button class=\"btn btn-link cap pull-right disabled install\">\n                    Install\n                 </button>";var addbtn=app.el.querySelector('.btn.install');window.addEventListener('beforeinstallprompt',function(event){addbtn.classList.remove('disabled');event.preventDefault();defferedPrompt=event;addbtn.addEventListener('click',function(event){defferedPrompt.prompt();defferedPrompt.userChoice.then(function(choice){if(choice.outcome==='accepted'){var windowObjectReference=window.open('http://www.dalwia.com/','dalwia');addbtn.classList.add('disabled');popup('App is installed!');}defferedPrompt=null;});});});}loadMenuItems();}init();};var Web=function Web(){var app=Object.assign(this,new warp.factory.App({name:'web',winOpts:{backdrop:false,scale:true,keepCentered:false,beforeShow:function beforeShow(w){w.height(window.innerHeight/100*90);w.width(window.innerHeight/100*90*0.8);}}}));if(!warp.gui.mobile()){var w=app.win;var oldw=w.width();var ratio=w.height()/oldw;w.height(window.innerHeight-200);w.width(oldw*ratio);}function setHTML(str,title){if(title===undefined)title='';app.el.classList.add('text');var size='tlg';if(window.innerHeight<1000)size='tmd';app.el.innerHTML="\n            <div style=\"padding:50px\" class=\"".concat(size,"\">\n            <h1 class=\"m5 mtxl\">").concat(title,"</h1>\n             <div class=\"\">\n                ").concat(str,"\n            </div> \n            </div>\n            ");app.el.querySelectorAll('.aligncenter').forEach(function(el){el.classList.remove('aligncenter');el.classList.add('center');});app.win.caption('<img class="fl round " style="height:20px" src="resources/images/logo.svg"/>');app.win.show();}this.show=function(htmlName){fetch(main.envVars.url+'resources/html/'+htmlName+'.html?v='+main.envVars.version).then(function(response){return response.text();}).then(function(data){setHTML(data);});};this.fromHtml=setHTML;this.showFromPath=function(path){app.win.show();fetch(main.envVars.url+path+'?v='+main.envVars.version).then(function(response){return response.text();}).then(function(data){setHTML(data);});};};var Router=function Router(routes){var app=this;if(!routes)routes={login:function login(){if(!main.envVars.loggedIn)main.account.showLogin();window.history.replaceState('Warp','Title','/');},register:function register(){if(!main.envVars.loggedIn)setTimeout(function(){main.account.showReg();window.history.replaceState('Warp','Title','/');},1000);}};var urlParams=new URLSearchParams(window.location.search);if(urlParams.has('r')&&routes[urlParams.get('r')]){setTimeout(function(){routes[urlParams.get('r')]();},200);}};var Docs=function Docs(){var app=Object.assign(this,new warp.factory.App({name:'docs',winOpts:{onShow:function onShow(w){}}}));};if('main'in window!==true)window.main={};Object.assign(main,{'envVars':{},'data':{},'init':function init(){return new Promise(function(resolve,reject){Warp.create({name:'warp',api:{url:main.envVars.url+'api/'},debug:true}).then(function(warp){var mainDiv=document.querySelector('.main');if(!mainDiv){mainDiv=warp.dom.node('div');}mainDiv.setAttribute('class','main web hidden');warp.gui.warpEl.prepend(mainDiv);if(!main.envVars.loggedIn){mainDiv.classList.remove('hidden');}api=warp.api.call;toJson=warp.do.json;fromJson=warp.un.json;main.context=warp.dom.context;main.date=new DateApp();main.setup=new Setup();main.web=new Web();main.contact=new Contact();main.plans=new Plans();main.search=new Search();main.account=new Account();main.serviceWorker=new Warp.Bridge(window,main.envVars.url+'service.worker.js');main.bridge=main.serviceWorker;main.docs=new Docs();main.profile=new Profile();main.router=new Router();resolve();});});}});var Search=function Search(){var app=this;Object.assign(this,new App({name:'search',winOpts:{close:true,onShow:function onShow(win){app.clear();win.el.querySelector('input').focus();win.el.querySelector('input').select();},draggable:true,backdrop:false}}));this.select=function(fun,text){app.itemClick=fun;if(text)alert(text);app.win.show();};this.hide=function(){app.itemClick=app.defaultItemClick;app.win.hide();};this.show=function(searchType){if(!searchType)searchType='profiles';app.win.show();};this.clear=function(searchType){app.listEl.innerHTML='';};this.scope={};this.scope['profiles']={name:'profiles',fun:function fun(text){if(text==app.text||text.length<3||!Boolean(text)||text==''){if(text!=app.text){clearTimeout(app.timeout);app.timeout=false;app.listEl.innerHTML='';}return;}app.text=text;app.listEl.innerHTML='';app.listEl.classList.add('loading');clearTimeout(app.timeout);app.timeout=false;app.timeout=setTimeout(function(){app.listEl.classList.add('loading');warp.api.call('search/search/',{text:text,entity:'profiles'}).then(function(result){app.listEl.classList.remove('loading');if(result){app.listEl.innerHTML='';result.forEach(function(profile){localStorage['profiles.'+profile.id]=JSON.stringify(profile);app.listEl.appendChild(warp.gui.profile.list(profile.id,false,app.itemClick));});}});app.timeout=false;},app.waitTime);},resultItem:function resultItem(data){}};this.register=function(seachOption){app.scope[seachOption.name]=seachOption;};this.defaultItemClick=function(profile){main.profile.edit(profile);};this.itemClick=app.defaultItemClick;this.waitTime=300;this.text='';this.timeout=false;this.title='';function render(){app.html(" \n        <div class=\"hmd\">\n            <img class=\"ml20 mb-10 mt10 hlg fl round\" src=\"../../resources/images/logo.svg\"/>   \n            <button class=\"round sm default clear fr mr15 mt25 hidden\">\n                <svg class=\"icon \">\n                    <use href=\"#icon-settings\"></use>\n                </svg>\n           </button>\n       \n            <button class=\"hidden round sm default inverted clear fr mr25 mt25 ml-20\">\n                <svg class=\"icon \">\n                    <use href=\"#icon-close\"></use>\n                </svg>\n            </button>\n            <input loc class=\"fr mr20 mt20 search\" type=\"text\" placeholder=\"search ".concat('profiles',"\"/>\n        </div>\n        <div class=\"\">\n         <br>\n        <div class=\"list mt20\" style=\"min-height:100px; max-height:350px\">\n        </div>\n        </div>\n            <p loc class=\"mla mra inline-block\" style=\"width:200px\">\n                        Cant find the person or a team? You can invite them\n            </p>\n                     <br>\n                     <button loc class=\"primary\" onclick=\"main.invitations.show()\" >\n                        Invitations\n                     </button>\n    "));var input=app.query('input.search');app.event(input,'keyup',function(){app.scope['profiles'].fun(this.value);});app.event(input,'focus',function(){this.select();});app.listEl=app.el.querySelector('.list');warp.dom.height(app.listEl,warp.dom.top(app.el.querySelector('input'))+warp.dom.height(app.el.querySelector('input')));}render();};var Preferences=function Preferences(opts){var app=this;function render(prefName){function prefSet(pref){var html='<h3>'+pref+'</h3>';for(var _name19 in app.scope[pref]){html+=single(_name19);}return html;}function single(name,val){return"\n                <label class=\"hxs tl mr20 ml20 ripple\" style=\"display:block;cursor:pointer\">\n                    ".concat(name," :\n                   <input class=\"fr\" type='checkbox' onclick=\"main.preferences.set('").concat(prefName,"','").concat(name,"', this.checked )\"  ").concat(Boolean(app.scope[prefName][name])?'checked':'',">\n              \n                </label>");}var html='';if(prefName){html+=prefSet(prefName);}else{for(var pref in app.scope){html+=prefSet(pref);}}app.el.innerHTML=html;}app=Object.assign(app,new App({winOpts:{},name:'preferences'}));app.el.classList.add('tl');app.scope=gui.storage('user.prefs');if(!app.scope)app.scope={};app.lastPrefs=warp.do.json(app.scope);app.get=function(appName,name){if(appName!==undefined&&name!==undefined){if(appName in app.scope!==true){app.scope[appName]={};app.scope[appName][name]=null;return undefined;}if(name in app.scope[appName]!==true){app.scope[appName][name]=null;return undefined;}return app.scope[appName][name];}if(appName!==undefined&&!name){if(appName in app.scope!==true){app.scope[appName]={};return undefined;}return app.scope[appName];}if(!appName&&!name){return app.scope;}};app.set=function(appName,name,value){if(appName in app.scope!==true){app.scope[appName]={};}app.scope[appName][name]=value;gui.storage('user.prefs',app.scope);return true;};app.check=function(){var changed=false;if(app.lastPrefs!=warp.do.json(app.scope)){changed=true;}if(changed){app.save();}};app.save=function(){gui.storage('user.prefs',app.scope);app.lastPrefs=warp.do.json(app.scope);if(!warp.native){warp.api.call('profiles/prefs',{data:app.lastPrefs}).then(function(){app.log('Prefs saved');});}else{warp.invoke('Installation','Settings',['preferences',app.lastPrefs]);}};setInterval(function(){app.check();},30000);app.select=function(prefName){render(prefName);app.win.show();};if(warp.user)warp.user.preferences=function(appName,prop,val){if(val==undefined)return app.get(appName,prop);return app.set(appName,prop,val);};return app;};var Profile=function Profile(){function render(){var profile=app.scope,contactBtn='',settBtn,chatBtn;if(!profile.logo){profile.logo=main.envVars.url+'resources/images/man.png';}var style="  \n            <style>\n                    .avatar {  \n                            background-image:url('".concat(profile.logo,"');\n                            background-color: #a1a1a1;\n                            border: 10px solid #e1e1e1;\n                            width: 220px;  \n                            height: 220px; \n                            margin-left: auto;  \n                            margin-right: auto; \n                    }\n                    .profile-btn{\n                        margin:2px;\n                        background-color:none;\n                        color: white!important;\n                        fill :white;\n                        opacity:0.8;\n                        text-align:center;\n                        width:76px;\n                        padding:0px;\n                    }\n                     .profile-btn div{\n                        display:block!important;\n                        margin:0px;\n                        text-align:center!important;\n                    }\n                    .profile-btn .icon{\n                        display:inline-block;\n                        margin-left:auto!important;\n                        margin-right:auto!important;\n                            height:40px;\n                            width:40px;\n                    }\n            </style>\n            ");app.el.innerHTML=style+"\n           <button class=\"default fr mr20 round op6 clear settings\"  onclick=\"main.profileEditor.inspect(".concat(profile.id,");\">\n                <svg class=\"icon\">\n                    <use href=\"#icon-settings\"></use>\n                </svg>\n            </button>\n            <div class=\"image round mt20 mb10 avatar\">\n            </div>\n\n            <div class=\"cf\" >\n                <div class=\"row\" >\n                    <div class=\"inline-block\">\n                        <h2 class=\"name inline-block mb10 mt5 tl\">\n                            <span class=\"small block\" style=\"color:#e1e1e1;\">\n                                ").concat(empty(profile.prefix),"\n                            </span>\n                            <span>\n                                ").concat(empty(profile.name),"\n                            </span>\n                        </h2>\n                        <div class=\"form ml20 mr20 tj\">").concat(empty(profile.about),"</div>\n                    </div>\n                </div>\n            </div>\n  \n  <div class=\"mtmd\">\n  \n            <button class=\"profile-btn chat  hxl clear\" onclick=\"main.profile.chat.start()\">\n                    <svg class=\"icon\">\n                        <use href=\"#icon-chat\"></use>\n                    </svg>\n                         <div class=\"mt5\">Chat</div>\n            </button>\n            \n            <button class=\"profile-btn wall hxl clear \"   title=\"Wall\">\n                <svg class=\"icon\">\n                    <use href=\"#icon-avatar\" ></use>\n                </svg>\n               <div class=\"mt5\">Wall</div>\n            </button>\n            \n            <button class=\"profile-btn public hxl clear\"   title=\"Public drive\">\n                <svg class=\"icon\" style=\"height:33px; width:33px;\">\n                    <use href=\"#icon-drive\" ></use>\n                </svg>\n               <div class=\"mt5\">Public</div>\n            </button>\n            \n            <button class=\"profile-btn priv hxl clear hidden \"   title=\"Private drive\">\n                <svg class=\"icon\" style=\"height:33px; width:33px;\">\n                    <use href=\"#icon-drive\" ></use>\n                </svg>\n               <div class=\"mt5\">Private</div>\n            </button>\n            \n             <br>\n            <button class=\"m10 link contact\">\n                   Remove contact\n            </button>\n    </div>\n            ");settBtn=app.query('.settings');chatBtn=app.query('.chat');contactBtn=app.query('.contact');if(profile.type!=1||profile.id==main.data.user.id)contactBtn.classList.add('hidden');if(profile.user==main.data.user.username){app.query('.priv').classList.remove('hidden');}if(!main.envVars.loggedIn)settBtn.classList.add('hidden');if(main.envVars.loggedIn&&main.data.user.username!=profile.user){settBtn.classList.add('hidden');if(app.contact.is(main.data.user.id,profile.id)){contactBtn.innerHTML='Remove contact';app.event(contactBtn,'click',function(){main.profile.contact.remove(main.data.user.id,profile.id);});}else{contactBtn.innerHTML='Add contact';app.event(contactBtn,'click',function(){main.profile.contact.add(main.data.user.id,profile.id);});}}else{chatBtn.classList.add('hidden');}app.el.classList.add('tc');app.query('.public').addEventListener('click',function(){openDrive('public');});app.query('.wall').addEventListener('click',function(){var w=new WallApp(profile.id);w.show();});if(profile.id==main.data.user.id){app.query('.priv').addEventListener('click',function(){warp.user.private.apps[0].show();});}else if(profile.user==main.data.user.username){app.query('.priv').addEventListener('click',function(){openDrive('private');});}}async function openDrive(which){var drive;var profile=app.scope;if(main.data.user&&main.data.user.id!=profile.id){drive=new ProfileDrive({profile:app.scope.id,url:'https://bemjax.com/storage/profiles/'+which+'.php'});await drive.auth('guest','guest');}else drive=warp.user.public;var driveApp=new Warp.Drive.App({drive:drive});setTimeout(function(){driveApp.show();},200);}var app=Object.assign(this,new EditApp({name:'profile',store:'profiles',render:render}));app.chat={start:async function start(){var me=await store.profiles.get(main.data.user.id);var name=me.name+' & '+app.scope.name;main.conversations.new(name).then(function(room){room.addProfile(app.scope);});}};app.public=function(val){app.scope=main.profileEditor.scope;app.scope.public=Boolean(val);app.save();var msg='';if(val){msg='Profile is now public and visible to search';}else{msg='Profile is now private, does nbot show up on search';}toast(msg);};app.vat={save:function save(){app.scope=main.profileEditor.scope;main.profiles.read(main.data.user.id,function(profile){var vat=app.scope.vat;var cca3=profile.country;if(main.country.isEU(cca3)){main.country.vat(cca3,vat,function(result){if(Boolean(result)&&result.valid){main.country.get(cca3,function(country){alert('Your VAT seems to be OK, Registered in '+country.name);});app.save();}else{main.country.get(cca3,function(country){error("\n                                <p>\n                                VAT is not saved. It seems that this VAT number is not a registered company in your country, ".concat(country.name,".\n                                </p>\n                                <p>\n                                Please enter a new VAT or cancel to continue using old value.\n                                </p>\n                                "));});}});}else{app.save();}});},check:function check(){}};app.saveVAT=app.vat.save;app.contact={add:function add(profileId,contactId){warp.api.call('profiles/addContact',{profile:profileId,contact:contactId}).then(function(res){if(res){var index=app.scope.contacts.indexOf(profileId);if(index!==-1)app.scope.contacts.push(profileId);toast('Contact added');render();}});},remove:function remove(profileId,contactId){warp.api.call('profiles/removeContact',{profile:profileId,contact:contactId}).then(function(res){if(res){var index=app.scope.contacts.indexOf(profileId);if(index!==-1){app.scope.contacts.splice(index,1);}toast('Contact removed');render();}});},is:function is(profileId,contactId){var old=gui.storage('profiles.'+profileId);if(old.contacts.includes){return old.contacts.includes(contactId);}else{app.log('contacts not array '+old.id,1);app.log(old.contacts);Object.values(old.contacts).includes(contactId);return;}}};return app;};var You=function You(){var app=this;var wrap,personalWrap;personalWrap=warp.dom.node('div',{},{'class':''});Object.assign(this,new App({name:'you',winOpts:{}}));this.render=function(){warp.api.call('profiles/read/',{id:main.data.user.id}).then(function(res){var profile=res[0];gui.storage('profiles.'+main.data.user.id,profile);personalWrap=warp.dom.node('div',{},{'class':''});personalWrap.appendChild(gui.listSeparator('Personal Profile'));var listItem=gui.profile.list(profile.id,false,function(data){main.profileEditor.inspect(data.id);});personalWrap.appendChild(listItem);var header=" \n\n<div class=\"mt15 ml15 tl\">\n    <span class=\"\">\n        ".concat(main.data.user.username,"\n    </span>\n</div>\n<div class=\"list mt5 \">\n\n</div>\n        ");var excerpt='';var btnText='';app.el.innerHTML=header;personalWrap.classList.add('mt20');app.el.appendChild(personalWrap);var sep=gui.listSeparator('Your Invitations');sep.classList.add('mtmd');app.el.appendChild(sep);var nrOfInv=Object.keys(main.invitations.scope).length;var maxInv=main.data.plans[main.data.user.plan]['items']['Invitations'];if(profile.members.length>1){excerpt='You used <strong>'+nrOfInv+'/'+maxInv+'</strong> Invitations';btnText='Invite your Client or Team member';}else{excerpt='You used <strong>'+nrOfInv+'/'+maxInv+'</strong> Invitations';btnText='Invite Client or Employee!';}if(nrOfInv==maxInv)excerpt+=' <p class=\'m20 text-justify\'> <strong class=\'text-danger\'>Warning : </strong>You reached maximum number of Invitations for plan '+main.data.plans[main.data.user.plan]['title']+'. If you need to invite more users you will need to <a href=\'#\' onclick=\'main.billing.show()\'>upgrade</a> to a higher Plan!</p>';excerpt+="\n            <br>\n            <button class=\"sm\" onclick=\"main.contacts.show()\">view ".concat(profile.contacts.length," Contacts</button>");var sp=warp.dom.node('p');sp.innerHTML=excerpt;app.el.appendChild(sp);var btnInvite=warp.dom.node('button',{click:function click(){main.invitations.new();}},{'class':'block center default  sm  mt5 mb20'});btnInvite.textContent='Invite Client or Employee';app.el.appendChild(btnInvite);btnInvite=warp.dom.node('button',{click:function click(){main.invitations.show();}},{'class':' block center sm default mt5 mb20'});btnInvite.textContent='Manage Invitations';app.el.appendChild(btnInvite);var rese=gui.listSeparator('Password reset');rese.classList.add('mt20');app.el.appendChild(rese);var btn=warp.dom.node('button',{click:function click(){main.account.showChange();}},{'class':'btn btn-sm btn-default  mt10 mb20'});btn.textContent='Change your password';app.el.appendChild(btn);app.el.appendChild(warp.dom.node('div',{},{'class':'mblg'}));});};this.load=function(){app.render();};var init=function init(){app.load();warp.on('api.teams.create,api.teams.delete,api.teams.update',function(team){main.data.user.profiles.push(team.id);gui.storage('user',main.data.user);app.load();});warp.on('api.profiles.update',function(profile){if(main.data.user.id==profile.id){app.render();}});warp.on('api.invitations.create',function(inv){app.render();});main.menu.add('Your '+main.data.product.name,function(){main.you.show();});};init();};var ProfileEditor=function ProfileEditor(){function render(){var profile=app.scope;var productsTab="\n                    <button class=\"sm link clear pr0\" onclick=\"main.products.select(function(prod){ main.product.edit(prod)},main.data.user.id)\">Products</button> \n                   ";productsTab='';if(profile.type==0||profile.type==2){productsTab='';}var header="\n                <div class=\"row mt5 mb5 tabs\">\n                    <button class=\"fr sm default clear disabled pr0\">General</button>\n                    <button class=\"fr sm link clear pr0 hidden\" onclick=\"warp.editors.date(null,'set burn', function(date){main.profileEditor.setBurn(date)})\">Burn date</button>\n                    <button class=\"fr sm link clear pr0 hidden\" onclick=\"main.teams.inspect(main.profileEditor.inspected)\">Structure</button>\n                    <button class=\"fr sm link clear pr0\" onclick=\"warp.editors.address(main.profileEditor.scope, { onComplete: function(adr){  Object.assign(main.profileEditor.scope,adr); main.profileEditor.save();}, caption:'Profile : '+main.profileEditor.scope.name  })\">Location</button>\n                    ".concat(productsTab,"\n                </div>\n                ");var type="\n                <div class=\"mtxs hidden\">\n                    <div class=\"small\">\n                        Profile type\n                    </div>\n                    <div class=\"cap-first\">\n                       ".concat(main.data.profileTypes[profile.type].name,"\n                    </div>\n                  \n                </div>\n                ");var pref=profile.prefix;var name="\n        \n                <div class=\"mt10 w50 inline-block\">\n                      <div class=\"small m5 ml10 op7\">\n                        Prefix or titule\n                      </div>\n                     <input type=\"text\"  class=\"w100 prefix block cap sm m5 ml10 mr0\" scope=\"prefix\" oninput=\"main.profileEditor.scope.prefix = this.value\" value=\"".concat(empty(pref),"\" placeholder=\"prefix\" loc />\n                </div>\n                \n                <div class=\"mt10 w50 inline-block fl \">\n                    <div class=\"small m5 ml0  op7\" >\n                        Name\n                    </div>\n                    \n                    <input  type=\"text\" scope=\"name\" oninput=\"main.profileEditor.scope.name = this.value\" \n                        class=\"w100 name sm cap block m5 ml0 mr20\" value=\"").concat(empty(profile.name),"\" placeholder=\"name\" loc />\n                </div>\n                \n                <div class=\"mt5\">\n                  <div class=\"small m5 op7\">\n                        About :\n                  </div>\n                  <textarea scope=\"about\" oninput=\"main.profileEditor.scope.about = this.value\" \n                        class=\"block about w100 mb10\" placeholder=\"About\" loc>").concat(profile.about,"</textarea>\n                </div>\n                ");var publ="\n              \n                <div class=\"mt5 w50 inline-block\">\n                      <div class=\"small m5 ml10 op7\">\n                        Eu VAT\n                      </div>\n                      <input type=\"text\"  class=\"w100 prefix block cap sm m5 ml10 mr0\" scope=\"vat\" oninput=\"main.profileEditor.scope.vat = this.value\" class=\"fr vat sm mb10\" value=\"".concat(empty(profile.vat),"\" placeholder=\"VAT\"  loc />\n\n                         <div class=\"m5 ml10 small op7 mt10\"> \n                                Enter your EU VAT number,  if you wish to use Reverse Charge option on invoices\n                        </div> \n                  </div>\n                \n                <div class=\"mt5 w50 inline-block fl\">\n                  <div class=\"small m5 ml0 op7\">\n                        Visibility\n                      </div>\n                            <label loc=\"\" class=\"block mt10 check ripple\">Profile is visibile <input \n                                scope=\"public\" \n                                type=\"checkbox\" \n                                oninput=\"main.profileEditor.scope.public=this.checked\"\n                                ").concat(profile.public?'checked':''," class=\"m5 mt0\" />\n                            </label>\n                                     \n                            <div class=\"m5 small mt10 op7\"> \n                                Visible profiles can be contacted by users, or found in search\n                            </div>          \n               </div>\n  \n                 \n  \n              \n              \n                \n                ");var avatar="                    \n                    <div class=\"tc\">\n                        <img src=\"".concat(profile.logo,"\" \n                        style=\"background-color: #d3d3d3; width: 150px; height: 150px;\" class=\"round\" />\n                        <br>\n                        <button class=\"mt-10 xs select-avatar\" >\n                            Select avatar\n                        </button>\n                    </div>");var subs="";var vat="\n                <div class=\"r  mt10 mb15 burn tc\">\n                </div>\n                ";var deleteButton="<button class=\"sm mt5 danger del inline-block disabled\" >Delete</button>";if(main.profileEditor.scope.parent!='000000000'){deleteButton="<button class=\"sm mt5 danger del inline-block disabled\" >Delete</button>";}var save="\n                <div class=\"mt20\">\n                ".concat(deleteButton,"\n                    <button class=\"mt10 s1 mr5 sm\" onclick=\"main.profileEditor.save()\">Save</button>\n                    <button class=\"mt10 mr5 sm\" onclick=\"main.profile.edit('").concat(main.profileEditor.scope.id,"')\">View</button>\n                    \n                </div>\n                ");var about="";app.html("\n                    <div class=\"settings cf tl ml10 mr10\">\n                        ".concat(header+type+name+publ+vat+avatar+subs+about+save,"\n                    </div>\n       "));var avatarButton=app.el.querySelector('.select-avatar');avatarButton.addEventListener('click',async function(){var file=await warp.user.private.apps[0].select('Select image for avatar');var url=file.drive.url+file.drive.path;profile.logo=url;app.save();});var features=warp.gui.drawer('Features',{size:'md',class:'ml10 mr10 mt15 mb0 dark tl',beforeOpen:function beforeOpen(){},onOpen:async function onOpen(d){d.body.innerHTML='';d.body.classList.add('pt15');var addButton=warp.dom.node('button',{click:function click(){app.win.menu.show({'Search for Published ProfileApps on Warp':function SearchForPublishedProfileAppsOnWarp(){},'Select feature from a Drive':function SelectFeatureFromADrive(){}});}},{class:'xs inline-block m10 mtmd fr'});addButton.textContent='Add';d.body.append(warp.dom.node('br'));d.body.append(addButton);addButton.scrollIntoView();each(defaultFeatures,function(index,featureName){var fEl=warp.dom.node('div',{click:function click(){}},{class:'m5 pl10 block hmd'});fEl.textContent=featureName;var btn=warp.dom.node('button',{click:function click(){}},{class:'xs inline-block fr mt-5'});btn.textContent='Add';if(profile.features.includes(featureName)){btn.textContent='x';}fEl.append(btn);d.body.prepend(fEl);});}});app.el.append(features.el);var team=warp.gui.drawer('Team Members',{size:'md',class:'ml10 mr10 mt0 mb15 dark',beforeOpen:function beforeOpen(){},onOpen:async function onOpen(d){d.body.innerHTML='';var create=warp.dom.node('button',{click:function click(){app.win.menu.show({'Create a new Team':function CreateANewTeam(){alert('not implemented here');},'Add from existing Team':function AddFromExistingTeam(){main.team.select(function(pr){main.teams.add(app.scope.id,pr.id);});},'Add User':function AddUser(){main.contacts.select(function(pr){main.teams.add(app.scope.id,pr.id);});}});}},{class:'xs inline-block  m15 mtmd fr'});create.textContent='Add';d.body.append(warp.dom.node('br'));d.body.append(create);each(profile.members,async function(index,id){try{var el=warp.gui.profile.list(id);el.addEventListener('click',function(){main.profile.edit(id);});d.body.prepend(el);}catch(e){}});create.scrollIntoView();}});app.el.append(team.el);}var defaultFeatures=['Public','Private','Wall'];var app=Object.assign(this,new App({name:'profileEditor',winOpts:{beforeShow:function beforeShow(){if(!app.inspected)app.inspect(main.data.user.id);},draggable:true,backdrop:false}}));app.inspected=false;app.inspect=function(profileId){app.inspected=profileId;store.profiles.get(profileId).then(function(profile){if(!profile){wap.inspect(profile);app.error('nothing in store in ');return;}app.scope=profile;render();app.win.caption('Profile : '+profile.name);app.win.show();});};app.setImage=function(url){url=url.split('/');url[url.length-1]='thumbnails/'+url[url.length-1];url=url.join('/');app.scope.logo=url;app.save();};app.setBurn=function(date){confirm("\n        <h3>\n            Are you sure you want to set the burn date ? \n        </h3> \n        All your data for this profile will be <span class=\"text-danger\">deleted permanently</span> on ".concat(date,"?"),function(){var el=app.el.querySelector('.burn');el.classList.add('danger');el.innerHTML="\n            <div class=\"m5\">The burn date has been set to ".concat(date,"!</div>\n           \n            <button class=\"m5 sm\" onclick=\"main.profileEditor.cancelBurn()\">Cancel burn</button>\n            ");});};app.cancelBurn=function(){var el=app.el.querySelector('.burn');el.classList.remove('danger');el.innerHTML="\n            ";};app.save=function(){store['profiles'].set(main.profileEditor.scope).then(function(){toast('saved');app.inspect(app.inspected);});};return app;};var Home=function Home(){var app=this;var newsList=[];Object.assign(this,new App({name:'home',debug:true,winOpts:{name:'home-window',close:false,headClose:true,draggable:true,backdrop:false,scrollable:false,onShow:function onShow(w){if(gui.mobile())w.headless(true);}}}));app.win.caption(app.name);async function startApps(){function constructList(appsList,del){function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1);}appsList.forEach(function(name){eval("main[name] = new ".concat(capitalize(name),"()"));});}var homeApps=['nottApp','menu','search','upload','preferences','billing','invitations','products','invoices','contacts','conversations','conversation','product','profile','profileEditor','you','geo','teams','team'];constructList(homeApps,true);warp.do.loadJS('../resources/js/start.js?v='+Date()).then(function(){});}app.add=function(data){var b=warp.dom.node('button',{click:data.click},{class:'xl tc'});b.innerHTML="\n                        <svg class=\"icon\">\n                            <use href=\"#icon-".concat(data.icon,"\"></use>\n                        </svg>\n                        <div style=\"margin-left:0px\">").concat(data.text,"</div>\n                        ");app.el.querySelector('.form.icons').append(b);};function construct(){warp.fetch(main.envVars.url+'resources/data/compiled.json').then(function(blob){blob.json().then(function(data){Object.assign(main.data,data);app.html("\n          <style>\n            .icons  {   \n                  \n                    width:220px;\n                    height:auto;\n                    margin-left:auto;\n                    margin-right:auto;\n                    margin-top:125px;\n                  \n          }\n           .icons > button.xl {   \n           text-align:center;\n                    display:inline-block;\n                    background-color:var(--pageBg);\n                    color:var(--defaultColor);\n                    padding-left:25px;\n                    font-size:1em;\n                    width:100px;\n                    height:auto;\n                    margin-top:20px;\n                    margin-bottom:20px;\n                    margin-left:auto;\n                    margin-right:auto;\n                    border:transparent;\n                    border-radius:50px;\n                    overflow:visible;\n          }\n           .icons > button.xl > svg{\n                    display:block;\n                    width:50px;\n                    height:50px;\n                    fill:var(--defaultBg);\n                    margin-bottom:8px;\n                    margin-left: 0px;\n            }\n          </style>\n            <div class=\"icons form\">\n            \n            \n                                <button class=\"xl tc\" onclick=\"main.you.show()\">\n                                   <svg class=\"icon\">\n                                        <use href=\"#icon-avatar\"></use>\n                                    </svg>\n                                     <div style=\"margin-left:-3px\">   Account</div>\n                                    \n                                </button>\n                                \n                                 <button class=\"xl tc hidden\" onclick=\"main.nottApp.show()\">\n                                   <svg class=\"icon\">\n                                        <use href=\"#icon-calendar\"></use>\n                                    </svg>\n                                    Activity\n                                </button>\n        \n                                <button class=\"xl tc\" onclick=\"main.search.show()\">\n                                    <svg class=\"icon\">\n                                        <use href=\"#icon-search\"></use>\n                                    </svg>\n                                    \n                                 <div style=\"margin-left:2px\">   Search</div>\n                                </button>\n                                \n                                <button class=\"xl tc\" onclick=\"main.conversations.show()\">\n                                    <svg class=\"icon\">\n                                        <use href=\"#icon-chat\"></use>\n                                    </svg>\n                                     <div style=\"margin-left:0px\">Rooms</div>\n                                </button>\n                                \n                                <button class=\"xl tc\" onclick=\"main.contacts.show()\">\n                                    <svg class=\"icon\">\n                                        <use href=\"#icon-avatar\"></use>\n                                    </svg>\n                                    <div style=\"margin-left:-5px\">Contacts</div>\n                                </button>\n                                \n            </div>\n           \n                                <button class=\"gr fr inverted primary round mt10 mr10\" onclick=\"main.menu.show()\" style=\"position:fixed;bottom:10px;right:10px\">\n                                    <svg class=\"icon\">\n                                        <use href=\"#icon-menu\"></use>\n                                    </svg>\n                                </button>\n           \n                ");var m=$('.main');if(m)m.classList.add('hidden');startApps();});});}construct();};var Contacts=function Contacts(){function loadUserContactsProfiles(){gui.storage('profiles.'+main.data.user.id,false);store.profiles.get(main.data.user.id).then(function(result){if(result.contacts.length){warp.api.call('profiles/read',result.contacts).then(function(res){app.load(res);});}else{app.listEl.innerHTML="\n                <div class=\"mtmd ml20\">No contacts yet</div>\n                <div class=\"mt20 block tj center\" style=\"width:200px\">\n                     <p loc=\"\">\n                        Search for existing users by name or e-mail address\n                     </p>\n                     <button loc=\"\" class=\"primary\" onclick=\"main.search.show()\">\n                        Search\n                     </button>\n                </div>\n                <div class=\"mt20 block tj center\" style=\"width:200px\">\n                     <p loc=\"\">\n                        ..or You can invite the person to become a user. You are also giving them a free Basic account\n                        so you can collaborate!\n                     </p>\n                     <button loc=\"\" class=\"primary\" onclick=\"main.invitations.show()\">\n                        Invitations\n                     </button>\n                </div>\n                    ";}});}var app=Object.assign(this,new ListApp({name:'contacts',winOpts:{beforeShow:function beforeShow(){loadUserContactsProfiles();}},renderItem:function renderItem(profile){var el=store.profiles.item(profile.id);return el;},onSelect:function onSelect(profile){store.profiles.get(profile.id).then(function(contactsProfile){main.profile.edit(contactsProfile);});},new:function _new(){main.search.show();},init:function init(){loadUserContactsProfiles();},search:{name:'contacts',fun:async function fun(str){alert('seraching for string');var results={};return results;},item:function item(resultItem){app.renderItem(resultItem);}}}));return this;};var Billing=function Billing(){var app=Object.assign(this,new App({'name':'billing',winOpts:{beforeShow:function beforeShow(){render();}}}));function render(){for(var id in main.invoices.scope){var invoice=main.invoices.scope[id];if(!Boolean(invoice.payed))app.userOwes=true;}var disabled='';var msg='';if(app.userOwes){disabled='disabled';msg='<div loc class="strong mb20 text-danger">You have unpaid invoices</div>';}var prices=app.calculatePrices(plan,app.currency);var total=(app.quantity*prices[app.quantity]).toFixed(2);app.prices=prices;app.el.innerHTML="\n<h3 class=\"tl m10\">\n    Billing\n</h3>\n<div class=\"separator hxs pl15 pt5 cap-first mb5 mtmd\">\n    <span>\n        Past payments\n    </span>\n</div>\n".concat(msg,"\n<button onclick=\"main.invoices.show()\">\n    Manage Invoices\n</button>\n<div class=\"separator hxs pl15 pt5 cap-first mtmd\">\n    <span loc>\n        Current plan and expiration date :\n    </span>\n</div>\n<h2>").concat(plan.title,"</h2>\nExpires : ").concat(main.date.format(main.data.user.expires),"\n<a class=\"btn btn-link hidden\">Upgrade / Change</a>\n\n");app.el.innerHTML=app.el.innerHTML+"\n<div class=\"separator hxs pl15 pt5 cap-first mtmd\">\n    <span>\n        New payment :\n    </span>\n</div>\n<div class=\"form m20 tl div-create-invoice ".concat(disabled,"\" style=\"max-width:250px\">\n    <p>\n        Invoice type:<br />\n        <small>\n            Your profile data will be used for Invoicing\n        </small>\n    </p>\n    <div class=\"radio m5\">\n        <label class=\"ripple ml10\">\n            <input type=\"radio\" name=\"billing-vat\" value=\"0\" oninput=\"main.billing.set('vat',this.value)\" />\n            <span>Personal\n                <br />\n                <small class=\"ml5\">\n                    Choose this option if You need an invoice made out to You, personaly\n                </small>\n            </span>\n        </label>\n        <label class=\"ripple mt20 ml10\">\n            <input type=\"radio\" name=\"billing-vat\" value=\"1\" oninput=\"main.billing.checkProfileVAT(main.data.user.id)\" />\n            <span>Business  <small> (Includes Your VAT Number)  </small>\n                <br />\n                <small class=\"ml5\">\n                    Choose this option if You need a invoice with VAT, for Your Teams legal entity\n                </small>\n            </span>\n        </label>\n    </div>\n</div>\n<div class=\"cf div-create-invoice ").concat(disabled,"\">\n    <div class=\"row\">\n        <div class=\"radio m5 col-md-12  tl\" style=\"width:auto\">\n            <p class=\"mt20\">\n                Options &amp; discounts:<br />\n            </p>\n            <label class=\"ripple ml10\" onclick=\"main.billing.set('quantity',1)\">\n                <input type=\"radio\" name=\"billing-quantity\" value=\"1\" />\n                pay for\n                <span> 1 month </span>\n                <br>\n                <span class=\"small\">\n                    <span class=\"strong billing-1\">").concat(prices['1'],"</span> ").concat(prices.currency," / month\n                </span>\n            </label>\n            <label class=\"ripple mt20 ml10\" onclick=\"main.billing.set('quantity',4)\">\n                <input type=\"radio\" name=\"billing-quantity\" value=\"4\" />\n                pay for 4 months with discount -10%\n                <br>\n                <span class=\"small\">\n                    <span class=\"strong billing-4\">").concat(prices['4'],"</span> ").concat(prices.currency," / month\n                </span>\n            </label>\n            <label class=\"ripple mt20 ml10\" onclick=\"main.billing.set('quantity',12)\">\n                <input type=\"radio\" name=\"billing-quantity\" value=\"12\" />\n                pay for\n                12 months with discount -20%\n                <br>\n                <span class=\"small\">\n                    <span class=\"strong billing-12\">").concat(prices['12'],"</span> ").concat(prices.currency," / month\n                </span>\n            </label>\n        </div>\n        <div class=\"m5 user-confirmation  tl\">\n            <p>\n                You will be paying <span class=\"strong billing-total\">").concat(total," </span> \u20AC\n                <select class=\"billing-currency hidden\" onchange=\"main.billing.set('currency' ,this.options[this.selectedIndex].value)\" style=\"width:100px\">\n                    <option value=\"EUR\">EUR</option>\n                    <option value=\"USD\" class=\"hidden\">USD</option>\n                    <option value=\"GBP\" class=\"hidden\">GBP</option>\n                    <option value=\"HRK\" class=\"hidden\">HRK</option>\n                </select>\n                for\n                <br>\n                <span class=\"cap-first\"> ").concat(main.data.product.name,"</span> <span class=\"cap-first strong\"> ").concat(plan.title,"</span> services until <span class=\"strong\"> ").concat(main.date.monthsFrom(main.data.user.expires,app.quantity),"</span>\n                <br>\n                <p class=\"small\">\n                    All prices are exclusive of VAT.\n                    <br>\n                    VAT charges depend of Your country of residence.\n                </p>\n                <div class=\"text-center m20\">\n                    <p class=\"tj\">\n                        By clicking 'Click to confirm' button You confirm that You have read, understand and agree to ").concat(main.data.product.name," <a class=\"cap-first\" href=\"#\" onclick=\"main.web.show('terms')\" loc>\n                            Terms of use</a> and <a href=\"#\" onclick=\"main.web.show('privacy')\" class=\"cap-first\" loc>privacy policy</a>.\n                        After clicking you can proceed to payment.\n                    </p>\n                    <button class=\"primary center mb20\" onclick=\"main.billing.createInvoice()\">\n                        Click to confirm\n                    </button>\n                </div>\n            </p>\n        </div>\n    </div>\n</div>\n<div class=\"cf\">\n    <div class=\"row next-payment hidden m20 tl\">\n        <div class=\"small m5 mb10\">\n            After clicking this button, a Monri Payment Gateway\n            window will open so You can finish payment\n        </div>\n    </div>\n</div>\n    ");$('input[name=billing-vat][value=\''+app.vat+'\']').setAttribute('checked','checked');$('input[name=billing-quantity][value=\''+app.quantity+'\']').setAttribute('checked','checked');app.el.querySelector('.billing-currency').value=prices.currency;};app.gateway=new App({'name':'invoice'});app.quantity=1;app.vat=0;app.prices={};app.currency='EUR';var plan=main.data.plans[main.data.user.plan];app.plan=plan;app.userOwes=false;app.rates={'EUR':1};app.set=function(prop,val){app[prop]=val;app.render();};app.calculatePrices=function(plan,currencyName){var currency=app.rates[currencyName];var price=parseFloat(plan.price);price=price/currency;var data={1:price.toFixed(2),4:(price/100*90).toFixed(2),12:(price/100*80).toFixed(2),currency:currencyName};return data;};app.checkProfileVAT=function(profileId){store.profiles.get(profileId).then(function(data){if(!Boolean(data.vat)){error("\n                Your profile doesnt have a VAT number. \n                Add VAT in Your Profile settings and try again.\n                <br><br>\n                <button class=\"primary center\" onclick=\"warp.gui.error.hide(); main.profile.edit(main.data.user.id); \">Edit profile settings</button> ");main.billing.set('vat',0);}else{main.billing.set('vat',1);}});};app.createInvoice=function(){warp.api.call('invoices/create',{currency:app.currency,price:app.prices[app.quantity],quantity:app.quantity,plan:plan.id,profile:main.data.user.id,vat:app.vat}).then(function(invoice){main.invoices.load();app.startLightbox('Make a payment',invoice,function(formEl){var wr=document.body.querySelector('.next-payment');wr.appendChild(formEl);warp.dom.enable('.next-payment');warp.dom.show('.next-payment');warp.dom.disable('.div-create-invoice');warp.dom.hide('.user-confirmation');app.win.el.querySelector('.body').scrollTo(0,app.win.el.querySelector('.body').scrollHeight);setTimeout(function(){try{document.querySelector('.next-payment button').click();warp.dom.disable('.next-payment button');}catch(err){}},100);});});};app.startLightbox=function(btnCaption,invoice,onComplete){store.profiles.get(invoice.profile).then(function(profile){warp.api.call('invoices/env').then(function(envData){var btnCol=getComputedStyle(document.documentElement).getPropertyValue('--primaryBg');function attrs(el,attrs){for(var key in attrs){el.setAttribute(key,attrs[key]);}}var info=invoice.id+' - Subscription '+plan.title+' plan';var scriptEl=document.createElement('script');var formEl=document.createElement('form');attrs(scriptEl,{'src':envData.src,'class':'lightbox-button','data-authenticity-token':envData.token,'data-amount':invoice.amount.replace('.',''),'data-currency':invoice.currency,'data-order-number':invoice.id,'data-order-info':info,'data-digest':invoice.hash,'data-transaction-type':'purchase','data-ch-full-name':gui.toTitleCase(profile.name),'data-ch-zip':' ','data-ch-phone':' ','data-ch-email':main.data.user.username,'data-ch-address':gui.empty(profile.address1)+' '+gui.empty(profile.nr),'data-ch-city':gui.empty(profile.city),'data-ch-country':gui.empty(profile.country),'data-language':'en','data-custom-params':'{"submit_on_trx_failure":"false"}'});scriptEl.onload=function(){var btn=formEl.querySelector('button');btn.setAttribute('class','btn btn-primary primary');btn.querySelector('span').innerHTML=btnCaption;btn.querySelector('span').style.backgroundColor=btnCol;btn.style.backgroundColor=btnCol;};formEl.appendChild(scriptEl);onComplete(formEl);});});};var queryString=window.location.search;var urlParams=new URLSearchParams(queryString);if(urlParams.get('transaction_response')){app.busy(true);var tr=warp.un.json(urlParams.get('transaction_response'));warp.api.call('invoices/confirm',{id:tr.order_number}).then(function(newExpDate){app.log(newExpDate);window.history.pushState('','',window.location.pathname);alert("\n                Your subscription plan has been payed and service expiration prolonged!\n                <br>\n                Your account expires ".concat(main.date.format(newExpDate),".\n                <br>\n            "));main.data.user.expires=newExpDate;main.you.render();main.invoices.load();app.render();app.busy(false);});}};var Conversations=function Conversations(){var loaded=false,list=false,toolbar=false;var app=Object.assign(this,new warp.factory.App({name:'conversations',win:true,winOpts:{backdrop:false,draggable:true,scrollable:false,class:'rooms',beforeShow:function beforeShow(w){if(!loaded){refreshList();}else render();},onResize:function onResize(w){}}}));var apps={};var search={show:function show(){var input=app.el.querySelector('input.search');warp.dom.show(input);gsap.to(input,{duration:0.2,x:0,opacity:1,ease:Bounce.easeOut});input.focus();},hide:function hide(){setTimeout(function(){var input=app.el.querySelector('input.search');gsap.to(input,{duration:0.3,x:0,opacity:0});input.value='';app.el.querySelectorAll('.list .item').forEach(function(el){warp.dom.show(el);});},500);},filter:function filter(str){app.el.querySelectorAll('.list .item').forEach(function(el){if(!el.textContent.toLowerCase().includes(str.toLowerCase())){warp.dom.hide(el);}else warp.dom.show(el);});}};var docked=false;function dock(){if(docked){docked=false;}else docked=true;onResize();render();}app.dock=dock;function onResize(){var h=warp.dom.height(app.win.body)-list.offsetTop+warp.dom.height(app.win.head)+'px';app.el.style.height=warp.dom.height(app.win.body)+'px';app.el.style.maxHeight=warp.dom.height(app.win.body)+'px';list.style.height=h;list.style.maxHeight=h;}function del(chatId){confirm('Delete room?',function(){if(apps[chatId])apps[chatId].hide();warp.api.call('conversations/delete',{id:chatId}).then(function(res){});},function(){});}function remove(profile,chatId){warp.api.call('conversations/removeProfile',{profile:profile,conversation:chatId}).then(function(res){app.win.menu.hide();});}function refreshList(){warp.user.drive.read('conversations.json').then(function(t){t=fromJson(t);main.data.user.conversations=t;search.hide();render();});}function render(){var fromPrefs=main.preferences.get('conversations');function item(chat,chatData){var ctx={'delete':function _delete(){del(chat);},'rename':function rename(){toast('not implemented yet');}};var item=warp.dom.node('div',{},{'class':'item hlg'});var str='';var image=main.data.user.profile.logo;main.data.user.conversations[chat].participants.forEach(function(profile){var data=gui.storage('profiles.'+profile);if(data){str=str+data.name.split(' ')[0]+', ';if(profile!=main.data.user.id)image=data.logo;}});str=str.slice(0,-2);var old=fromPrefs[chat];if(!old)old={total:0,last:'',read:0};item.innerHTML="\n        <div class=\"prof-wrapper mr5\" style=\"overflow:visible\">\n            <div class=\"prof-image\" style=\"margin-left:5px; background-image : url('".concat(image,"')\"></div>\n        </div>\n         \n        <div class=\"lines ml5 col\">\n            <div class=\"line\">\n                <div class=\"fl  cap tmd\">\n                    ").concat(chat.split('-')[1],"\n                </div>\n            </div>\n            <div class=\"line\">\n                <span class=\"fl tsm ti \" style=\"opacity:0.8\">\"").concat(old.last,"\" </span>\n                <span class=\"fr tsm hidden\"> ").concat(str," </span>\n            </div>\n        </div>\n        \n       <button class=\"primary round mt20 mr10 fr xs inverted\">\n            <svg class=\"icon\">\n                <use href=\"#icon-menu-dots\"></use>\n           </svg>\n        </button>\n        ");main.context.add(item,ctx,'Room');item.addEventListener('click',function(e){if(e.target.nodeName==='BUTTON'){app.win.menu.show(ctx);return;}if(apps[chat]){apps[chat].select(chat);}else{apps[chat]=new Conversation({id:chat,title:item.querySelector('.fl.cap').textContent});apps[chat].select(chat);}});return item;}app.win.caption('rooms');list.innerHTML="";if(typeof main.data.user.conversations=='string')main.data.user.conversations=JSON.parse(main.data.user.conversations);for(var chat in main.data.user.conversations){list.append(item(chat,main.data.user.conversations[chat]));}if(docked){try{warp.dom.show('.toolbar img');}catch(err){}warp.dom.hide(app.win.head);app.win.x(1);app.win.y(1);app.win.height(warp.gui.height+2);var h=warp.dom.height(app.win.body)-list.offsetTop+warp.dom.height(app.win.head)+'px';list.style.height=h;list.style.maxHeight=h;warp.dom.hide(app.win.close);}else{if(!gui.mobile()){warp.dom.show(app.win.head);app.win.x(100);app.win.y(100);app.win.height(600);var _h=warp.dom.height(app.win.body)-list.offsetTop+warp.dom.height(app.win.head)+'px';list.style.height=_h;list.style.maxHeight=_h;}}}app.delete=function(id){return new Promise(function(resolve,reject){if(apps[id])apps[id].hide();warp.api.call('conversations/delete',{id:id}).then(function(res){});});};app.new=function(name){return new Promise(function(resolve,reject){warp.api.call('conversations/create',{id:name}).then(function(createdId){apps[createdId]=new Conversation({id:createdId,title:createdId.split('-')[1]});apps[createdId].select(createdId);resolve(apps[createdId]);});});};function construct(){var ctx={'dock':dock};main.context.add(app.el,ctx,'Rooms');app.el.innerHTML="\n            <div class=\"tl toolbar hmd\">\n                    <img src=\"resources/images/logo.svg\" class=\"hidden fl hsm m10 mt5 mr5 round mb5 \" />\n                    <button class=\"fl xs m10 ml5\" onclick=\"  input('Room'+Object.keys(main.data.user.conversations).length, 'Name for new room').then(name => { main.conversations.new(name).then(room=> room.addProfile());});\"  title=\"Create new room\" style=\"\">\n                         New room\n                    </button>\n                    <button class=\"fr xs round m10 search\"  title=\"Search conversation\" style=\"z-index:2\">\n                                <svg class=\"icon\">\n                                         <use href=\"#icon-search\">\n                                         </use>\n                                 </svg>\n                    </button>\n                    <input type=\"text\"  class=\"xs fr m10 search mr0\" style=\"z-index:1;width: auto; \" placeholder=\"filter\"  />\n            </div>\n            <div class=\"list\">\n            \n            </div>\n";app.el.querySelector('button.search').addEventListener('click',function(){search.show();});app.el.querySelector('input.search').addEventListener('blur',function(){search.hide();});app.el.querySelector('input.search').addEventListener('input',function(){search.filter(this.value);});toolbar=app.el.querySelector('.toolbar');list=app.el.querySelector('.list');search.hide();warp.on('news.conversations',function(nott){refreshList();switch(nott.action){case'added':warp.user.notify('You were added to room  "'+nott.id+'"    ');break;case'removed':warp.user.notify('You were removed from room  "'+nott.id+'"  ');break;case'delete':warp.user.notify('Room '+nott.id+' deleted ');break;case'new':warp.user.notify('Room '+nott.id+' recived a message ');break;}});window.addEventListener('resize',function(){onResize();render();});return app;}return construct();};var store=new function Store(){var app=this;this.profiles={loading:[],get:function get(id,elm){if(elm){if(!app.profiles.list[id]){app.profiles.list[id]=[elm];return app.profiles.get(id);}else{app.profiles.list[id].push(elm);return app.profiles.get(id);}}else{return new Promise(function(res,rej){if(Array.isArray(id)){var result={};warp.api.call('profiles/read',{id:id}).then(function(profiles){profiles.forEach(function(profileData){if(!Boolean(profileData.logo)){profileData.logo=main.envVars.url+'resources/images/man.png';}app.profiles.scope[id]=profileData;gui.storage('profiles.'+id,profileData);result[profileData.id]=profileData;});res(result);});}else{var profData=gui.storage('profiles.'+id);if(!profData){warp.api.call('profiles/read',{id:id}).then(function(profileData){profileData=profileData[0];if(!Boolean(profileData.logo)){profileData.logo=main.envVars.url+'resources/images/man.png';}app.profiles.scope[id]=profileData;gui.storage('profiles.'+id,profileData);if(app.profiles.list[id]){app.profiles.list[id].forEach(function(elem){elem.innerHTML=app.profiles.inline(id).innerHTML;});delete app.profiles.list[id];}else{warp.log('app : no elements for '+id);}res(profileData);});}else{res(profData);}}});}},set:function set(data){if(!data.id){console.log(data);throw new Error('no id in store.profiles.set');}else{return new Promise(function(resolve,rej){warp.api.call('profiles/update',data).then(function(res){app.profiles.update(data);resolve(data);});});}},update:function update(data){if(!data.id){throw new Error('no id in store.profiles.update');}else{return new Promise(function(resolve,rej){var oldData=gui.storage('profiles.'+data.id);data=Object.assign(oldData,data);gui.storage('profiles.'+data.id,data);resolve(data);});}},scope:{},list:{},inline:function inline(id){var el=warp.dom.node('span',{},{class:'profile'});el.innerHTML='temp';var cashed=gui.storage('profiles.'+id);if(!cashed){app.profiles.get(id,el);}else{if(!Boolean(cashed.logo))cashed.logo=main.envVars.url+'resources/images/man.png';el.innerHTML="\n                    <span class='image' style=\"background-image : url('".concat(cashed.logo,"')\"></span>\n                    <a href=\"#\">").concat(cashed.name,"</a> \n        ");el.querySelector('a').addEventListener('click',function(){store.profiles.get(id).then(function(data){main.profile.edit(data);});});}el.style.marginLeft='0.3em';el.style.marginRight='0.3em';return el;},a:function a(id){var el=warp.dom.node('a');el.appendChild(store.profiles.inline(id));return el;},item:function item(id){var el=warp.dom.node('div',{},{'class':'item hlg'});var cashed=gui.storage('profiles.'+id);if(!cashed){if(app.profiles.list[id]){}else{app.profiles.get(id).then(function(){el.innerHTML=gui.profile.list(id).innerHTML;});}return el;}if(cashed){el.innerHTML=gui.profile.list(cashed.id).innerHTML;}return el;}};function test(){function test(tests){tests={'get one profile data, not stored, from string arg':async function getOneProfileDataNotStoredFromStringArg(){var subjectId='100000001';gui.storage('profiles.'+subjectId,false);var data=await app.profiles.get(subjectId);if(data.id==subjectId)return'pass';return data;},'get object of profiles from array arg':async function getObjectOfProfilesFromArrayArg(){var subjectId='100000001';gui.storage('profiles.'+subjectId,false);var data=await app.profiles.get(['100000002',subjectId]);if(_typeof(data['100000001'])=='object'){if(Array.isArray(data['100000001'].contacts)){return'pass';}else{console.log('data[\'100000001\'].contacts not an array');}}else{console.log('data[\'100000001\'] is not an object');}return data;},'get one profile item el, not stored':async function getOneProfileItemElNotStored(){var subjectId='100000001';gui.storage('profiles.'+subjectId,false);var el=await app.profiles.item(subjectId);setTimeout(function(){console.log(el);},1000);if(el.nodeName=='DIV')return'pass';return data;},'get several item els, for same profile, not stored':async function getSeveralItemElsForSameProfileNotStored(){var subjectId='100000002';gui.storage('profiles.'+subjectId,false);var _loop12=function _loop12(){var el=app.profiles.item(subjectId);setTimeout(function(){console.log(el);},500+i*100);};for(var i=0;i<2;i++){_loop12();}return'pass';},'check stored updating':async function checkStoredUpdating(){var subjectId='100000002';gui.storage('profiles.'+subjectId,false);var data=await app.profiles.get(subjectId);if(gui.storage('profiles.'+subjectId).id==subjectId)return'pass';return data;}};var fails={};var promises=[];var _loop13=function _loop13(_name20){try{t=tests[_name20]();promises.push(t);t.then(function(result){if(result!=='pass')fails[_name20]=result;});}catch(err){fails[_name20]=err;}};for(var _name20 in tests){var t;_loop13(_name20);}Promise.all(promises).then(function(r){var num=Object.keys(fails).length;if(num){console.clear();console.error(num+' Store tests failed ',fails);for(var f in fails){console.error(f,fails[f]);}}});}test(this.tests);}setTimeout(function(){},1000);}();var newStore=new function NewStore(){var store=this;this.profiles={loading:{},get:function get(id){return new Promise(function(resolve,reject){if(Array.isArray(id)){id.forEach(function(profileId){if(!store.profiles.loading[profileId])store.profiles.loading[profileId]=true;});}api('profiles/read',{id:id}).then(function(data){data.forEach(function(profile){gui.storage('profiles.'+profile.id,profile);delete store.profiles.loading[profile.id];});resolve(data);});});},inline:function inline(id){var el=warp.dom.node('span',{},{class:'profile-'+id});var cashed=gui.storage('profiles.'+id);if(!cashed){el.innerHTML='loading '+id;if(!store.profiles.loading[id]){store.profiles.loading[id]=true;api('profiles/read',{id:id}).then(function(data){data=data[0];gui.storage('profiles.'+data.id,data);document.querySelectorAll('.profile-'+data.id).forEach(function(elm){elm.innerHTML="\n        <span class='round inline-block' style=\"background-size:contain;  margin-left:0.15em; margin-right:0.01em; margin-bottom:-0.22em; width:1em; height:1em; background-image : url('".concat(data.logo,"')\">\n         </span>\n         ").concat(data.name,"\n        ");});});}}else{el.innerHTML="\n        <span class='round inline-block' style=\"background-size:contain;  margin-left:0.15em; margin-right:0.01em; margin-bottom:-0.22em; width:1em; height:1em; background-image : url('".concat(cashed.logo,"')\">\n         </span>\n         ").concat(cashed.name,"\n        ");}el.style.marginLeft='0.3em';el.style.marginRight='0.3em';return el;}};}();var Upload=function Upload(){var app=Object.assign(this,new warp.factory.App({name:'upload',win:true}));var loaded=false;var order=false;var listEl=false;function load(){listEl.innerHTML='';app.log('reading from server');warp.api.call('profiles/uploads').then(function(resArray){resArray.forEach(function(url){add(main.envVars.url+url);});app.win.show();});}function resizeImage(file,maxWidth,maxHeight,compressionRatio,imageEncoding,returnType){var start=performance.now;function dataURItoBlob(dataURI){var byteString;if(dataURI.split(',')[0].indexOf('base64')>=0)byteString=atob(dataURI.split(',')[1]);else byteString=unescape(dataURI.split(',')[1]);var mimeString=dataURI.split(',')[0].split(':')[1].split(';')[0];var ia=new Uint8Array(byteString.length);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i);}return new Blob([ia],{type:mimeString});}if(!returnType){returnType='File';}if(!imageEncoding){imageEncoding=file.type;}if(!imageEncoding)imageEncoding='image/jpeg';if(!compressionRatio){compressionRatio=0.9;}return new Promise(function(resolve,reject){var reader=new FileReader(),canvas=document.createElement('canvas'),context=null,imageObj=new Image(),blob=null;canvas.width=maxWidth;canvas.height=maxHeight;canvas.style.visibility='hidden';document.body.appendChild(canvas);context=canvas.getContext('2d');if(file.type.match('image.*')){reader.readAsDataURL(file);}else{throw new Error('resize : Provided argument is not an image file');}reader.onload=function(){var data=this.result;imageObj.src=data;};reader.onerror=function(){throw new Error('resize : FileReader() error');};imageObj.onload=function(){if(this.width==0||this.height==0){throw new Error('resize : Image is empty');}else finish();};imageObj.onerror=function(){throw new Error('resize : Image()  error');};function finish(){context.clearRect(0,0,maxWidth,maxHeight);context.drawImage(imageObj,0,0,imageObj.width,imageObj.height,0,0,maxWidth,maxHeight);blob=dataURItoBlob(canvas.toDataURL(imageEncoding,compressionRatio));document.body.removeChild(canvas);var newFile=new File([blob],file.name,{type:imageEncoding});console.log('Difference : '+parseInt(file.size-newFile.size)/1024+'KB');console.log('Time : '+parseInt(performance.now-start)+'ms');switch(returnType){case'File':resolve(newFile);break;case'blob':break;default:}}});}function add(url){app.log(url);var split=url.split('/');var imgFile=split[split.length-1];if(imgFile=='.'||imgFile=='..'||imgFile=='thumbnails')return;var thumbFile='thumbnails/'+split[split.length-1];split[split.length-1]=thumbFile;var thumbUrl=split.join('/');var item=warp.dom.node('div',{},{class:'item hlg'});item.addEventListener('click',function(){app.current=url;clickFunction(app.current);});item.innerHTML="\n                <div class=\"image\"  style=\"background-image : url('".concat(thumbUrl,"')\">\n         \n                </div>\n                <div class=\"lines col\">\n                    <div class=\"line\">\n                        <div class=\"fl small\" style=\"overflow:hidden; text-overflow:hidden; max-width:200px; max-height:35px\">\n                            ").concat(imgFile,"\n                        </div>\n                        <div class=\"fr small hidden\">\n                            ","\n                        </div>\n                    </div>\n                    <div class=\"line\">\n                         <div class=\"fl text-medium\">\n                              ","\n                         </div>\n                         <div class=\"fr small hidden\">\n                              ","\n                         </div>\n                    </div>\n                </div>\n                <button class=\"btn btn-link round mt10 fr clear\">\n                       <svg class=\"icon\">\n                          <use href=\"#icon-angle-right\"></use>\n                       </svg>\n                </button>\n            ");listEl.appendChild(item);}function defaultClick(url){alert('Selected image is '+url);app.hide();}var clickFunction=defaultClick;this.upload=async function upload(){if(!order){}var input=app.el.querySelector('#file-upload');input.setAttribute('accept','*');input.click();return;};this.capture=async function capture(){if(!order){}var input=$('#file-upload');input.setAttribute('accept','image/jpeg');input.setAttribute('capture','environment');input.click();return;};function isImage(s){if(s.endsWith('.jpg')||s.endsWith('.jpeg')||s.endsWith('.jfif')||s.endsWith('.png')||s.endsWith('.bmp')||s.endsWith('.webp')){return true;}return false;}this.select=function(userClick,text,orderData){clickFunction=defaultClick;if(userClick)clickFunction=userClick;if(orderData)order=orderData;if(text){app.el.querySelector('.text').innerHTML=text;}if(loaded){app.win.show();}else{load();}};function render(){app.show=undefined;app.html("\n        <p class=\"mtmd mb10 center text\" style=\"width:200px\">\n            custom message passed in app.select()\n        </p>\n        <input type=\"file\" id=\"file-upload\" style=\"display:none\" accept=\"image/jpeg\">\n        <div class=\"mt10 mb20 center\" style=\"width:320px\">\n        <button onclick=\"main.upload.capture()\" class=\"sm ml20 mr20 cap-first fl\" loc>with camera</button>\n        \n         <button onclick=\"main.upload.upload()\" class=\"sm ml20 mr20 cap-first fr\" loc>from device</button>\n        </div>\n        <div class=\"separator hxs ml20\">\n            Uploads\n        </div>\n        <div class=\"list uploads-list mblg\">\n        </div>\n    ");listEl=app.el.querySelector('.uploads-list');app.el.querySelector('#file-upload').addEventListener('change',function(){function uploadFile(f){var formData=new FormData();formData.append('file',f);var orderId;if(order){orderId=order.id;}else{orderId=0;}formData.append('order',orderId);fetch(main.envVars.url+'/api/profiles/upload/',{method:'POST',body:formData}).then(function(response){return response.text();}).then(function(path){add(main.envVars.url+path.trim());toast('The file has been uploaded successfully.');});}if(this.files[0].size>400000&&isImage(this.files[0].name)){resizeImage(this.files[0],1024,768).then(function(resizedFile){return uploadFile(resizedFile);});}else uploadFile(this.files[0]);});}render();};var Invitations=function Invitations(){var o={name:'invitations',winOpts:{beforeShow:function beforeShow(){}},editor:new Invitation(),renderItem:function renderItem(item,editor){var status,email;if(item.status===0)status='draft';if(item.status===1)status='sent';if(item.status===2)status='accepted';var template="\n                <div class=\"lines col\">\n\n                    <div class=\"line\">\n                        <div class=\"fl\">\n                          <span class=\"small\" loc>Email : </span>   ".concat(empty(item.email),"\n                        </div>\n                     \n                    </div>\n    \n                    <div class=\"line\">\n                        <div class=\"fl text-medium\">\n                         <span class=\"small\" loc>Status : </span> <span class=\"text-capitalize cap-first\">").concat(status," </span>\n                        </div>\n                        <div class=\"fr small\">\n                            <small loc>updated : </small>  \n                            ").concat(main.date.format(item.updated),"\n                        </div>\n                    </div>\n    \n                </div>\n                           \n                <button class=\"btn btn-link round mt10 fr clear\">\n                       <svg class=\"icon\">\n                          <use href=\"#icon-angle-right\"></use>\n                       </svg>\n                </button>\n                ");var itemEl=warp.dom.node('div');itemEl.setAttribute('class','item hlg');itemEl.innerHTML=template;return itemEl;},renderList:function renderList(){app.clear();var nrOfInv=app.scope().length;var maxInv=main.data.plans[main.data.user.plan]['items']['Invitations'];app.listEl.innerHTML="\n        <div class=\"m20 hidden\">\n            You are using ".concat(nrOfInv," of ").concat(maxInv," invitations \n        </div>\n        ");for(var invitation in app.scope()){app.listEl.appendChild(app.renderItem(app.scope(invitation)));}},search:{name:'invitations',fun:async function fun(str){alert('searching in invitations');var results={};return results;},item:function item(resultItem){app.renderItem(resultItem);}},new:function _new(){warp.api.call('invitations/create',{}).then(function(invitation){app.add(invitation);app.editor.edit(app.scope(app.scope.length-1));});},init:function init(){}};var app=new ListApp(o);app.el.innerHTML='<h2 class=\'mtxl mb20\'>Disabled</h2> <p>Follow Development profile for changes in service.</p>';return app;};var Conversation=function Conversation(options){if(!options)options={};options=Object.assign({windowed:true,id:'00000000000000',title:'Hallway',clear:false},options);var app=this,isReplying=false,isEditing=false,interval=false,messages=[],msgsEl,inputEl,intervalTime=5000,previousMsg,previousSetEl,menuVisible=false;Object.assign(app,new warp.factory.App({name:'conversation-'+options.id,win:true,winOpts:{class:'chat',close:true,topClose:true,backdropCloses:false,backdrop:false,backdropOpacity:0,draggable:true,scrollable:false,beforeShow:function beforeShow(w){scaleGui();},onShow:function onShow(w){warp.dom.hide(w.el.querySelector('button.close'));warp.dom.show(w.head.querySelector('button'));if(!options.clear)warp.dom.hide(w.body.querySelector('button.kill'));},beforeHide:function beforeHide(w){if(interval)clearInterval(interval);},menuHide:function menuHide(w){var act=w.body.querySelector('.entry.active');if(act)act.classList.remove('active');}}}));app.count=false;var reactions={'1':{name:'Like',image:'https://bemjax.com/resources/images/emoji/thumb-up.svg'},'2':{name:'Love',image:'https://bemjax.com/resources/images/emoji/heart.svg'},'3':{name:'HaHa',image:'https://bemjax.com/resources/images/emoji/laughing-face.svg'},'4':{name:'Wow',image:'https://bemjax.com/resources/images/emoji/wow.svg'},'5':{name:'Sad',image:'https://bemjax.com/resources/images/emoji/sad-face.svg'},'6':{name:'Thank you',image:'https://bemjax.com/resources/images/emoji/thank-you.svg'},'7':{name:'Fuck you',image:'https://bemjax.com/resources/images/emoji/finger-middle.svg'}};var messageTypes={0:{'name':'normal'},1:{'name':'react'},2:{'name':'reply'},3:{'name':'delete'},4:{'name':'edit'},5:{'name':'file'},6:{'name':'system','desc':'adds and removes renames and such can be reported here'}};async function queryWhisper(data,useInhouse){if(useInhouse){var aiApi=new Warp.Api({url:'https://ai.bemjax.com/api/',debug:true,default:function _default(result){console.log(result);}},warp);return await aiApi.call('models/whisper/',{});}var response=await fetch('https://prqcrrlabs0ix2jm.eu-west-1.aws.endpoints.huggingface.cloud',{headers:{Authorization:"Bearer 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"},method:'POST',body:data});var result=await response.json();return result;}function insertAfter(referenceNode,newNode){referenceNode.parentNode.insertBefore(newNode,referenceNode.nextSibling);}function query(s){return app.win.content.querySelector(s);}function event(s,event,handler){if(typeof s=='string'){s=query(s);}s.addEventListener(event,handler);}function encrypt(str){return CryptoJS.AES.encrypt(str,'xdt27vrK').toString();}function decrypt(str){return CryptoJS.AES.decrypt(str,'xdt27vrK').toString(CryptoJS.enc.Utf8);}function react(index,reaction){app.say(reaction,1,index);}function showReply(msg){inputEl.value='';isReplying=msg.index;var helper=query('.helper');warp.dom.show(helper);helper.innerHTML="      \n        Reply to:\n                      <div class=\"caption  rounded p5\">\n                      ".concat(decrypt(msg.text),"\n                      \n                      <button class=\"default fr round inverted xs  mt-10 p0 block\">\n                            <svg class=\"icon m0\">\n                            <use href=\"#icon-close\"></use>\n                            </svg>\n                        </button>\n                    </div>");event('.helper button','click',function(){hideReply();});scaleInput();inputEl.focus();inputEl.classList.add('active');}function hideReply(){var helper=query('.helper');isReplying=false;inputEl.value='';helper.innerHTML="";warp.dom.hide(helper);inputEl.classList.remove('active');scaleInput();}function scaleGui(){var w=app.win;gsap.to(w.el.querySelector('button.close.raised'),{x:100});var room=w.el.querySelector('.room');var h=w.height()-warp.dom.height(w.head)-warp.dom.height(room.querySelector('.bottom'))-7;msgsEl.style.maxHeight=h+'px';room.querySelector('textarea').style.width=app.win.width()-80+'px';inputEl.focus();if(!options.clear)warp.dom.hide(w.body.querySelector('button.kill'));room.style.height=w.height()-warp.dom.height(w.head);}function scaleInput(){warp.dom.height(inputEl,50);warp.dom.height(inputEl,inputEl.scrollHeight);scaleGui();}function showEdit(msg){isEditing=msg.index;inputEl.value=msg.decrypted;var helper=query('.helper');warp.dom.show(helper);helper.innerHTML="      \n        Editing:\n         <button class=\"default fr round inverted xs  mt-10 p0 block\">\n                            <svg class=\"icon m0\">\n                            <use href=\"#icon-close\"></use>\n                            </svg>\n                        </button>\n        ";event('.helper button','click',function(){hideEdit();});scaleInput();inputEl.focus();inputEl.classList.add('active');}function hideEdit(){var helper=query('.helper');isEditing=false;inputEl.value='';helper.innerHTML="";warp.dom.hide(helper);inputEl.classList.remove('active');scaleInput();}function del(msg){function removedom(){query('#i-'+msg.index).innerHTML='<span class=\'ti small\' style=\'opacity:0.7\'>message deleted</span>';}app.busy(true);setTimeout(function(){app.busy(false);app.menu.show({'for me':function forMe(){removedom();},'for all':function forAll(){confirm('Really delete message for all, are you sure?',function(){removedom();});}});},100);}function _clearMessages(){app.win.busy(true);warp.api.call('conversations/clear',{id:options.id}).then(function(res){setTimeout(function(){app.select(options.id,options.title);setTimeout(function(){app.say('cleared the room',6);},300);},100);});}function intervalFun(){if(app.win.visible){warp.api.call('conversations/diff',{id:options.id,index:app.count}).then(function(res){if(!res)return;if(res<0){app.select(options.id);return;}res=res.slice(0,-1);res=fromJson('['+res+']');res.forEach(function(m){m.index=app.count+1;app.count=app.count+1;if(m.profile!=main.data.user.id){warp.sound.play('resources/sounds/message.mp3');var decrypted=decrypt(m.text);var old=main.preferences.get('conversations',options.id);if(!old)old={total:0,read:0,last:''};old.last=decrypted.slice(0,30);main.preferences.set('conversations',options.id,old.last);if(main.preferences.get('conversations','autoplay voice'))if(decrypted.includes('audio/ogg')){warp.sound.play(decrypted);}warp.user.notify('New message from '+m.profile,decrypted);}addMsg(m);});});}}function load(){app.busy(true);clearInterval(interval);interval=false;previousMsg=false;previousSetEl=false;app.count=1;messages=[];interval=setInterval(intervalFun,intervalTime);app.win.caption(options.title);warp.api.call('conversations/read',{id:options.id}).then(function(res){app.count=1;msgsEl.innerHTML='';res=res.slice(0,-2);res=fromJson('['+res+']');res.forEach(function(m){m.index=app.count+1;app.count=app.count+1;addMsg(m);});app.busy(false);main.preferences.get('conversations','autoplay voice');var old=main.data.user.conversations[options.id];if(old){old.read=app.count;old.total=app.count;}});}function addMsg(msg){function findUrls(str){if(msg.type===5){return str;}if(str.includes('audio/ogg')){var _name21='audio'+parseInt(Math.random()*143*Math.random());window[_name21]=new Audio(str);return"<button class=\"xs round inverted p0\"  onclick=\"window.".concat(_name21,".play();return false\">\n                            <svg class=\"icon m0 mt5\">\n                            <use href=\"#icon-media-play\"></use>\n                            </svg>\n                </button>");}function isUrl(s){if(s.startsWith('http')){var pattern=new RegExp('^(https?:\\/\\/)?'+'((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+'((\\d{1,3}\\.){3}\\d{1,3}))'+'(\\:\\d+)?'+'(\\/[-a-z\\d%@_.~+&:]*)*'+'(\\?[;&a-z\\d%@_.,~+&:=-]*)?'+'(\\#[-a-z\\d_]*)?$','i');return pattern.test(s);}}function isPath(s){if(s.startsWith('data:'))return false;if(s.startsWith('<')||s.endsWith('>'))return false;var pattern=new RegExp('^[^/]+/[^/].*$|^/[^/].*$');return pattern.test(s);}function embedFile(s){}function embedURL(url){function abbreviate(url){var last=url.replace(/.*\/\/[^\/]*/,'');if(last.length>10){last='/....'+last.slice(-7);}return new URL(url).hostname+last;}return'<br><a target="_blank" href="'+url+'">'+abbreviate(url)+'</a><br>';}str=str.split(' ');str.forEach(function(word,i){if(isPath(word)||isUrl(word)){str[i]=embedURL(word);}});return str.join(' ');}function createSetEl(){var myClass='';if(msg.profile==main.data.user.id){myClass='my';}var setEl=warp.dom.node('div',{},{class:myClass+' set set-'+msg.profile});setEl.innerHTML="\n            <div class=\"mb5 small\">\n                <div class=\"name\"> \n                </div>\n                <span class=\"fr mt-10\" style=\"opacity:0.5;font-size:0.6em;\"> ".concat(msg.t.split(' ')[0],"</span>\n             </div>");var nameEl=store.profiles.inline(msg.profile);nameEl.style.marginLeft='0px';setEl.querySelector('.name').prepend(nameEl);return setEl;}function createMsgEl(){var newEl=warp.dom.node('div',{},{class:'entry',id:'i-'+msg.index});var reactions=warp.dom.node('div',{},{class:'mb5'});var decrypted=findUrls(decrypt(msg.text));{var myClass2='set';if(msg.profile==main.data.user.id){myClass2='my set';}reactions.innerHTML="\n        <div class=\"rounded\" style=\"background-color:rgba(0,0,0,0.9); padding :10px\"> \n        <div class=\"mt10 mb10 ".concat(myClass2," hidden\" style=\" padding:10px; border-radius:12px;\">\n           <span class=\"tsm\">").concat(store.profiles.inline(msg.profile).innerHTML,"</span>\n           <br>\n           <br>\n            <span class=\"ti entry\" style=\"overflow-wrap: anywhere;\">").concat(decrypted,"</span>\n        </div>\n      \n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em;\" reaction=\"1\">\n               <img src=\"https://bemjax.com/resources/images/emoji/thumb-up.svg\"/>\n        </button>\n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em\" reaction=\"2\">\n           <img src=\"https://bemjax.com/resources/images/emoji/heart.svg\"/> \n        </button>\n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em\" reaction=\"3\">\n            <img src=\"https://bemjax.com/resources/images/emoji/laughing-face.svg\"/>    \n        </button>\n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em;\" reaction=\"4\">\n            <img src=\"https://bemjax.com/resources/images/emoji/wow.svg\"/>     \n        </button>\n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em\" reaction=\"5\">\n            <img src=\"https://bemjax.com/resources/images/emoji/sad-face.svg\"/>   \n        </button>\n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em\" reaction=\"6\">\n           <img src=\"https://bemjax.com/resources/images/emoji/thank-you.svg\"/>  \n        </button>\n        <button class=\"round xs m0 p0 clear react\" style=\"font-size:1.4em\" reaction=\"7\">\n            <img src=\"https://bemjax.com/resources/images/emoji/finger-middle.svg\"/>  \n        </button>\n        \n          </div>\n       \n        ");reactions.querySelectorAll('button.react').forEach(function(btn){btn.addEventListener('click',function(){react(msg.index,btn.getAttribute('reaction'));});});var ctx={'reply':function reply(){msg.decrypted=decrypted;showReply(msg);},'copy text':function copyText(){warp.clipboard.write(decrypt(msg.text));},'inspect':function inspect(){warp.inspect(decrypt(msg.text));},'delete':function _delete(){del(msg);}};if(main.data.user.id==msg.profile){Object.assign(ctx,{'edit':function edit(){msg.decrypted=decrypted;showEdit(msg);}});}if(msg.type==2){Object.assign(ctx,{'reply':function reply(){msg.decrypted=decrypted;msg.index=msg.reference;showReply(msg);}});}main.context.add(newEl,Object.assign({},ctx),'Message');ctx.reactions=reactions;newEl.addEventListener('click',function(e){if(e.target.nodeName!='DIV')return;app.menu.show(ctx);if(msgsEl.querySelector('.active'))msgsEl.querySelector('.active').classList.remove('active');newEl.classList.add('active');},true);}newEl.innerHTML="\n            ".concat(decrypted,"\n            <div class=\"tr time small mb-5\" style=\"opacity:0.5; font-size:0.6em\"> ").concat(msg.t.split(' ')[1],"</div>\n            ");if(msg.type===5){newEl.innerHTML="\n           \n            <div class=\"tr time small mb-5\" style=\"opacity:0.5; font-size:0.6em\"> ".concat(msg.t.split(' ')[1],"</div>\n            ");var _file=new Warp.File(decrypted);newEl.prepend(warp.item(_file,{text:_file.name}));}return newEl;}var dupe=false;messages.forEach(function(m){if(m.text==msg.text&&m.t==msg.t&&m.profile==msg.profile){dupe=true;return;}});if(dupe){app.log('dupe:'+msg.text,1);return;}messages.push(msg);function normal(){msg.text=msg.text.replaceAll('\n','<br>');var newEl=createMsgEl();var dontBrake=false;dontBrake=previousSetEl&&previousMsg&&previousMsg.profile==msg.profile;if(dontBrake){var lastTime=previousMsg.t.split(' ')[1].split(':');var thisTime=msg.t.split(' ')[1].split(':');if(lastTime[0]!=thisTime[0])dontBrake=false;if(Math.abs(lastTime[1]-thisTime[1])>5)dontBrake=false;lastTime=previousMsg.t.split(' ')[0].split('-');thisTime=msg.t.split(' ')[0].split('-');if(lastTime[2]!=thisTime[2]){dontBrake=false;var dayBreak=warp.dom.node('span',{},{style:'height:25px; margin:35px ',class:'inline-block ti small'});dayBreak.innerHTML=msg.t.split(' ')[0];msgsEl.append(dayBreak);}}if(dontBrake){previousSetEl.append(newEl);previousMsg=msg;msgsEl.scrollTo(0,msgsEl.scrollHeight);}else{var setEl=createSetEl(msg);setEl.style.marginTop='10px';setEl.append(newEl);msgsEl.append(setEl);msgsEl.scrollTo(0,msgsEl.scrollHeight+50);previousSetEl=setEl;previousMsg=msg;var ctx={'copy all':function copyAll(){warp.clipboard.write(newEl.textContent);},'inspect all':function inspectAll(){warp.inspect(newEl.textContent);}};main.context.add(newEl,ctx,'Message set');}if(main.data.user.conversations[options.id]){main.data.user.conversations[options.id].total=msg.index-1;main.data.user.conversations[options.id].read=msg.index-1;}}function reaction(){var el=msgsEl.querySelector('#i-'+msg.reference);var icon=warp.dom.node('img',{},{id:'#i-'+msg.index,class:'round',style:' float:right; margin-top:-18px; margin-bottom:0px; width:20px; height:20px',src:reactions[decrypt(msg.text)].image});gsap.to(icon,{duration:0,opacity:0,y:-30,scale:3});gsap.to(icon,{duration:0.6,opacity:1,y:0,scale:1,ease:Bounce.easeOut});insertAfter(el,icon);}function reply(){var ref=document.querySelector('.reply-'+msg.reference+':last-child');if(!ref)ref=msgsEl.querySelector('#i-'+msg.reference);var dom=createSetEl();dom.classList.add('reply');dom.classList.add('reply-'+msg.reference);if(msg.profile===main.data.user.id){}dom.append(createMsgEl());gsap.to(dom,{duration:0,opacity:0,x:-30,scale:1});dom.classList.add('ml20');insertAfter(ref,dom);msgsEl.scrollTo(0,msgsEl.scrollHeight);gsap.to(dom,{duration:0.6,opacity:1,x:0,scale:1,ease:Bounce.easeOut});}function edit(){var ref=msgsEl.querySelector('#i-'+msg.reference);ref.innerHTML=decrypt(msg.text)+" \n            <span class=\"fr time mb-5 \" style=\"font-size:0.6em\"> \n                <a href=\"#\" class=\"\" >edited</a>  \n                <span class='' style=\"opacity:0.5; \"> on : ".concat(msg.t.split(' ')[1],"  </span>\n            </span> ");ref.querySelector('a').addEventListener('click',function(e){e.preventDefault();var referencedMessage=messages[msg.reference];var time=" <div class=\"tr time\" style=\"font-size:0.8em;\"> <a href=\"#\">edited  </a>  <span class='ti' style=\"opacity:0.5;\"> on : ".concat(referencedMessage.t.split(' ')[1],"  </span>   </div> ");if(!referencedMessage.reference){time=" <div class=\"tr time\" style=\"font-size:0.6em;\">   <span class='ti' style=\"opacity:0.5;\">  ".concat(referencedMessage.t.split(' ')[1],"  </span>   </div> ");}alert("<h3>Original message</h3><div class=\"tr time\" style=\"font-size:0.8em;\">   <span class='ti' style=\"opacity:0.5;\">  ".concat(referencedMessage.t.split(' ')[1],"  </span>   </div>")+decrypt(referencedMessage.text));});gsap.to(ref,{duration:0,opacity:0,x:-30,scale:1});gsap.to(ref,{duration:0.6,opacity:1,x:0,scale:1,ease:Bounce.easeOut});}function system(){var el=warp.dom.node('div',{},{class:'m5 mt20 mb20 ti small'});var decrypted="<span> ".concat(findUrls(decrypt(msg.text)),"</span>");el.innerHTML=decrypted;el.prepend(store.profiles.inline(msg.profile));previousMsg=msg;previousSetEl=false;msgsEl.append(el);msgsEl.scrollTo(0,msgsEl.scrollHeight);}switch(msg.type){case undefined:normal();break;case 1:reaction();break;case 2:reply();break;case 4:edit();break;case 5:normal();break;case 6:system();break;}}async function addProfile(profile){warp.api.call('conversations/addProfile',{profile:profile.id,conversation:options.id}).then(function(res){app.say('added '+'<a href="#" onclick="main.profile.edit('+profile.id+')">'+profile.name+'</a>',6);});}async function removeProfile(profile){if(!profile.id)profile=await store.profiles.get(profile);warp.api.call('conversations/removeProfile',{profile:profile.id,conversation:options.id}).then(function(res){toast('removed '+profile.name);app.say('removed '+profile.name,6);});}function deleteRoom(id){confirm('Delete room?',function(){main.conversations.delete(id).then(function(){toast('Deleted');});},function(){});}app.addProfile=function(profile){if(profile){addProfile(profile);return;}toast('Select a contact to add to room');main.contacts.select(function(profile){main.contacts.hide();addProfile(profile);});};app.removeProfile=function(profileId){if(profileId){removeProfile(profileId);return;}var dom=warp.dom.node('div',{},{class:'',style:'background-color:rgba(0,0,0,0.3); padding:10px; border-radius:10px'});var participants={'header':dom};main.data.user.conversations[options.id].participants.forEach(function(profile){var data=gui.storage('profiles.'+profile);if(data){var wrapper=warp.dom.node('div',{},{class:'m20',style:'width:auto'});var prof=store.profiles.inline(profile);wrapper.append(prof);var removeBtn=warp.dom.node('button',{click:function click(){removeProfile(profile);}},{class:'xs fr round mt-5'});removeBtn.textContent='x';wrapper.append(removeBtn);dom.append(wrapper);}});app.win.menu.show(participants);};app.select=function(chatId,title){if(!chatId)chatId=options.id;options.id=chatId;if(title){options.title=title;app.win.caption(title);}load();app.show();};app.say=function(text,type,referenceMessage){if(inputEl.value==''&&text==undefined){inputEl.focus();return;}if(text==undefined){text=inputEl.value;inputEl.value='';inputEl.textContent='';scaleInput();inputEl.focus();}var msg={profile:main.data.user.id,t:main.date.serverFormat(new Date()),text:text};app.count++;msg.index=app.count;msg.text=encrypt(msg.text);if(isReplying){type=2;referenceMessage=isReplying;}if(isEditing){type=4;referenceMessage=isEditing;}if(type)msg.type=type;if(referenceMessage!==undefined)msg.reference=referenceMessage;addMsg(msg);warp.api.call('conversations/say',{msg:JSON.stringify(msg),id:options.id}).then(function(res){var old=main.data.user.conversations[options.id];if(!old)old={total:0,read:0,last:''};old.read=app.count;old.total=app.count;old.last=text.slice(0,30);main.preferences.set('conversations',options.id,old);inputEl.classList.remove('active');if(isReplying)hideReply();if(isEditing)hideEdit();});};app.voice=async function(){var blob=await warp.sound.record();var reader=new FileReader();reader.onload=function(){var dataURL=reader.result;app.say(dataURL);};reader.readAsDataURL(blob);queryWhisper(blob).then(function(response){app.say('<div style="font-size:0.8em; display:inline-block; padding:5px; opacity:0.8"><strong>\'\'</strong>'+response.text+'<strong>\'\'</strong></div>');});};function construct(){app.html("\n            <div class=\"room\">\n                <div class=\"messages\">\n                </div>\n                <div class=\"bottom\">\n                    <div class=\"helper m5 txs tl hidden\">\n                    </div>\n                    <textarea placeholder=\"your message\"></textarea>\n                    <button class=\"say primary round fr mr10 mt5 inverted\">\n                        <svg class=\"icon\">\n                            <use href=\"#icon-plane\"></use>\n                        </svg>\n                    </button>\n                    <div class=\"btns-menu \">    \n                    </div>\n                </div>\n            </div>\n            <button class=\"sm danger inverted mt5 raised fr tc kill hidden\" style=\"position: absolute; right:10px; z-index: 10;\">\n            clear\n            </button>\n            ");msgsEl=app.el.querySelector('.messages');inputEl=app.el.querySelector('textarea');inputEl.value='';function createBtnsMenu(){query('.btns-menu').innerHTML=" \n                        \n                        <button class=\"stagg search default round inverted fr p0 m5\">\n                            <svg class=\"icon m0\">\n                            <use href=\"#icon-search\"></use>\n                            </svg>\n                        </button>\n                        \n                        <button class=\"stagg media default round inverted fr p0 m5\">\n                            <svg class=\"icon m0\">\n                            <use href=\"#icon-attachment\"></use>\n                            </svg>\n                        </button>\n                        \n                        <button class=\"stagg voice default round inverted tsm p0 block m5\" >\n                            <svg class=\"icon m0\">\n                            <use href=\"#icon-speak\"></use>\n                            </svg>\n                        </button>\n                       <button class=\"stagg add default round inverted tsm p0 block m5\" style=\"color:white\">\n                           Add\n                        </button>\n                        <button class=\"stagg remove default round inverted tsm p0 block m5\" style=\"color:white\">\n                          Remove\n                        </button>\n                        <button class=\"stagg del default round inverted tsm p0 block m5\" style=\"color:white\">\n                            Clear\n                        </button>\n                        \n                        <button class=\"default round menu inverted sm m5 p0 block\">\n                            <svg class=\"icon m0\">\n                            <use href=\"#icon-menu-dots\"></use>\n                            </svg>\n                        </button>\n                    ";gsap.to(query('.btns-menu .stagg'),{duration:0,opacity:0});query('.btns-menu').style.height='auto';query('.btns-menu').addEventListener('mouseleave',function(){menuVisible=false;setTimeout(function(){if(!menuVisible){warp.dom.hide(app.el.querySelectorAll('.btns-menu .stagg'));gsap.to(app.el.querySelector('.btns-menu'),{duration:0.4,css:{'height':'auto'}});}},300);});query('.btns-menu').addEventListener('mousemove',function(){menuVisible=true;});warp.dom.hide(app.el.querySelectorAll('.btns-menu .stagg'));query('.media').addEventListener('click',async function(){var file=await warp.user.drive.apps[0].select('Select a file to add to conversation...',{disable:['folder']});confirm('Encrypt "<span class="ti">'+file.name+'</span>" and add  to this conversation?',function(){file.toJson().then(function(str){return app.say(str,5);});});});query('.voice').addEventListener('click',function(){app.voice();});query('.add').addEventListener('click',function(){main.contacts.select(function(profile){main.contacts.hide();addProfile(profile);});});query('.remove').addEventListener('click',function(){app.removeProfile();});query('.del').addEventListener('click',function(){confirm('Delete all messages in room?',_clearMessages);});event('.search','click',function(){toast('not implemented');});query('button.menu').addEventListener('click',function(){menuVisible=true;warp.dom.show(app.el.querySelectorAll('.btns-menu .stagg'));gsap.to(app.el.querySelector('.btns-menu'),{duration:0.3,css:{'height':'auto'}});gsap.to('.btns-menu .stagg',{duration:0,opacity:1});gsap.from(query('.btns-menu .stagg'),{duration:0.31,stagger:0.2,y:50,opacity:0});});}createBtnsMenu();event('.say','click',function(){app.say();});event('.kill','click',function(){confirm('<h3>Are you sure?</h3> If you press\'OK\' all the messages in this conversation will be deleted, for everyone!',function(){_clearMessages();});});msgsEl=app.el.querySelector('.messages');inputEl=app.el.querySelector('textarea');inputEl.value='';event(inputEl,'keydown',function(e){scaleInput();if(e.key==='Enter'||e.keyCode==13){if(!warp.gui.mobile()){e.preventDefault();app.say();}}});event(inputEl,'input',function(){scaleInput();});event(inputEl,'change',function(){scaleInput();});warp.do.loadJS('https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js');var ctxFunctions={'clear messages':function clearMessages(){confirm('Delete all messages in room?',_clearMessages);},'inspect room':function inspectRoom(){warp.inspect(app);},'inspect messages':function inspectMessages(){warp.inspect(messages);}};main.context.add(app.el,ctxFunctions,'Room');return app;}return construct();};var Product=function Product(){function $(selector){return app.el.querySelector(selector);}function ev(selector,type,fun){var el;if(typeof selector!='string'){el=selector;}else{el=$(selector);}el.addEventListener(type,fun);}function calcColor(hue){var saturation=83,lightness=40,alpha=1;return"hsla(".concat(hue,",").concat(saturation,"%,").concat(lightness,"%,").concat(alpha,")");};function render(){var product=app.scope;app.html("\n<div class=\"container-fluid tl mt10 ml20 mr20\">\n    <div class=\"row mtmd\">\n        <div class=\"col-xs-10 small\">\n            Add product name as it will appear on lists\n        </div>\n        <div class=\"col-xs-14\">\n            <input value=\"".concat(product.name,"\"  type=\"text\" class=\"block name w100 sm\"  placeholder=\"name\" loc />\n        </div>\n    </div>    \n    \n    <div class=\"row mt20\">\n        <div class=\"col-xs-10 small\">\n            Add short name. Short name is used on colored list items.\n        </div>\n        <div class=\"col-xs-14\">\n            <input  value=\"").concat(product.shortName,"\"  type=\"text\" class=\"block short-name w100 sm\" placeholder=\"short name\" loc />\n        </div>\n    </div>\n    \n    <div class=\"row mt20\">\n        <div class=\"col-xs-10 small\">\n            Move the slider to set this products color.\n            <div class=\"fr m5 color-box hidden\" style=\"width:30px;height:30px;background-color: ").concat(product.color,"\"></div>\n        </div>\n        <div class=\"col-xs-14\">\n            <input  class=\"mla mra mt10 sm color\" type=\"range\" value=\"").concat(product.color.split('(')[1].split(',')[0],"\" style=\"background-color: ").concat(product.color,"\" min=\"0\" max=\"360\"/>\n        </div>\n    </div>    \n    \n    <div class=\"row mt20\">\n        <div class=\"col-xs-10 small\">\n            Enter production price. Only you can see the production price.\n        </div>\n        <div class=\"col-xs-14\">\n               <input type=\"number\" min=\"0.00\" step=\"0.01\" class=\"block name w100 man-price sm\" value=\"").concat(parseFloat(product.prodPrice).toFixed(2),"\" placeholder=\"production price\" loc />\n        </div>\n    </div>\n        \n    <div class=\"row mt20\">\n        <div class=\"col-xs-10 small\">\n           Set final product price per one item of quantity. \n        </div>\n        <div class=\"col-xs-14\">\n            <input  type=\"number\" min=\"0.00\" step=\"0.01\" class=\"block name price w100 sm\" value=\"").concat(parseFloat(product.price).toFixed(2),"\" placeholder=\"price\" loc />\n        </div>\n    </div>\n        \n    <div class=\"row mt20\">\n        <div class=\"col-xs-10 small\">\n            Product type\n        </div>\n        <div class=\"col-xs-14\">\n            <select  class=\"type capitalized w100 sm\">\n                <option value=\"0\" loc>product</option>\n                <option value=\"1\" loc>service</option>\n                <option value=\"2\" loc>combined</option>\n            </select>\n        </div>\n    </div>\n        \n    <div class=\"row mt20\">\n        <div class=\"col-xs-10 small\">\n            Product category \n        </div>\n        <div class=\"col-xs-14\">\n            <select class=\"category capitalized w100 sm\">\n                <option value=\"1\" loc>fixed</option>\n                <option value=\"2\" loc>movable</option>\n            </select>\n        </div>\n    </div>\n    <div style=\"position: absolute; bottom: 0px; width:100%; left:0px;\">\n        <button class=\" m10 default delete\">\n            Delete\n        </button>\n        <button class=\" m10 primary save\">\n            Save\n        </button>\n    </div>   \n    \n</div>\n"));ev('.save','click',function(){app.save();});ev('.name','input',function(){app.scope.name=this.value;});ev('.short-name','input',function(){app.scope.shortName=this.value;});ev('.color','input',function(){var col=calcColor(this.value);app.scope.color=col;this.style.backgroundColor=col;this.style.backgroundSize=(this.value-this.min)*100/(this.max-this.min)+'% 100%';});ev('.price','input',function(){app.scope.price=this.value;});ev('.man-price','input',function(){app.scope.prodPrice=this.value;});ev('.type','change',function(){app.scope.type=this.options[this.selectedIndex].value;});ev('.category','change',function(){app.scope.category=this.options[this.selectedIndex].value;});$('.type').selectedIndex=app.scope.type;$('.category').selectedIndex=app.scope.category;}var app=Object.assign(this,new warp.factory.App({name:'product',win:true,winOpts:{close:true,beforeShow:function beforeShow(w){render(w);}}}));app.save=function(){app.hide();var forSave={};Object.assign(forSave,app.scope);app.busy(true);delete forSave.created;delete forSave.updated;warp.api.call('products/update',forSave).then(function(res){app.busy(false);app.edit(forSave);main.products.renderList();});};app.edit=function(data){app.scope=data;app.show();};return app;};var Invitation=function Invitation(){var app=Object.assign(this,new warp.factory.App({name:'invitation',winOpts:{beforeShow:function beforeShow(win){render();}}}));app.send=function(){if(!app.validateEmail()){toast('This is not an email, please fix!');return;}app.hide();app.save().then(function(){warp.api.call('invitations/send',{id:app.scope.id}).then(function(result){app.scope.status=1;Object.assign(app.scopeReference,app.scope);main.invitations.renderList();toast('Invitation has been sent');});});};app.save=function(){return new Promise(function(resolve,rej){warp.api.call('invitations/update',app.scope).then(function(result){Object.assign(app.scopeReference,app.scope);main.invitations.renderList();toast('Invitation saved');resolve();});});};app.edit=function(invitation){app.hide();app.scope={};app.scope=Object.assign(app.scope,invitation);app.scopeReference=invitation;app.show();};app.validateEmail=function(email){if(!email)email=app.scope.email;return String(email).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);};function render(){var invitation=app.scope;var status='';var sent='';var team='team (optional)';if(invitation.status=='0')status='draft';if(invitation.status=='1')status='sent';if(invitation.status=='2')status='accepted';if(invitation.sent=='0000-00-00 00:00:00'){sent='not sent yet';}else{sent=main.date.format(invitation.sent);}if(!Boolean(invitation.message)){invitation.message="\nHi,\nJoin my contacts on ".concat(main.data.product.name," platform!\n");}if(Boolean(gui.empty(invitation.team))){team=gui.storage('profiles.'+invitation.team)['name'];}var buttons="\n    <button class=\"fl primary block m5\" onclick=\"main.invitations.editor.send()\">\n        Send\n    </button> \n    <button class=\"fl default m5\"  onclick=\"main.invitations.editor.save()\">\n        Save\n    </button>\n";if(invitation.status=='1')buttons="\n    <button class=\"fl primary block m5 disabled\">\n        Already sent\n    </button> \n";app.el.innerHTML="\n<div class=\"mla mra form center text-left mt20\" style=\"max-width:250px\">\n        \n        <span class=\"strong\">Status : </span> ".concat(status," \n        <br>\n        <p class=\"text-justify\" loc >\n            Please enter e-mail address and name (optional) of the person You are inviting.\n           <span class=\"underline\"> ").concat(main.data.product.name," is completly free </span> for the person You are inviting\n        </p>\n\n        <input type=\"text\" oninput=\"main.invitations.editor.scope.email = this.value\" class=\"block w100\" \n        placeholder=\"e-mail address\" value=\"").concat(gui.empty(invitation.email),"\" loc />\n       \n        <div oninput=\"main.invitations.editor.scope.team = this.value\" class=\"block w100\" \n        placeholder=\"team (optional)\" >").concat(team," \n        \n        <button class=\"sm ml5 selectTeam\">Select Team</button>\n        \n        </div>\n        \n        <input type=\"text\" oninput=\"main.invitations.editor.scope.name = this.value\" class=\"block w100\"\n        value=\"").concat(gui.empty(invitation.name),"\" placeholder=\"name (optional)\" loc />\n    \n        <textarea oninput=\"main.invitations.editor.scope.message = this.value\" class=\"block mb20 w100\" loc>").concat(invitation.message,"</textarea>\n        ").concat(buttons,"\n</div>");app.el.querySelector('button.selectTeam').addEventListener('click',function(){main.team.select(function(prof){main.invitations.editor.scope.team=prof.id;main.team.hide();render();});});}return app;};var Products=function Products(){var app=new ListApp({name:'products',cash:true,onSelect:function onSelect(itemData){main.product.edit(itemData);},renderList:function renderList(){app.clear();function createCatDrawer(){var el=warp.dom.node('div');el.style.maxHeight='300px';el.classList.add('list');return el;}var catEls={1:createCatDrawer(),2:createCatDrawer()};for(var id in app.scope){var cat=app.scope[id].category;var itemEl=app.renderItem(app.scope[id]);itemEl.innerHTML="\n            <div class=\"image round\" style=\"background-color : ".concat(app.scope[id]['color'],";line-height: 0.6em; font-size:1.1em\">\n            ").concat(app.scope[id]['shortName'],"\n            </div>\n            ")+itemEl.innerHTML;catEls[cat].appendChild(itemEl);}for(var _cat in catEls){var separator=new warp.gui.Drawer(main.products.cats[_cat].name,{parent:app.listEl,name:'category.'+main.products.cats[_cat].name,dom:catEls[_cat],size:'md'});if(catEls[_cat].childElementCount){separator.caption("".concat(main.products.cats[_cat].name," <span style=\"font-weight:normal\">  ").concat(catEls[_cat].childElementCount,"  Products </span>"));}else{separator.caption("".concat(main.products.cats[_cat].name," <span style=\"font-weight:normal\">  0 Products </span>"));}}},new:function _new(){app.busy(true);warp.api.call('products/create').then(function(newProduct){app.add(newProduct);app.busy(false);main.product.edit(newProduct);app.renderList();});},init:function init(){if(main.data.user.profile.type==1)warp.api.call('products/read/',{profile:main.data.user.id}).then(function(res){app.load(res);});},search:{name:'products',fun:async function fun(str){alert('seraching for '+str+'in products');var results={};return results;},item:function item(resultItem){app.renderItem(resultItem);}}});app.cats={1:{name:'fixed'},2:{name:'movable'}};app.select=function(newOnSelect,profileId){if(profileId=='0'){profileId=false;}app.show();warp.api.call('products/read/',{profile:profileId}).then(function(res){app.clear();app.load(res);if(!app.win.visible())app.win.show();setTimeout(function(){app.onSelect=newOnSelect;},300);});};return app;};var Invoice=function Invoice(){var app=new warp.factory.App({name:'invoice',winOpts:{beforeShow:function beforeShow(w){render();}}});var company=function company(data){return"\n        \n<p>\n          \n            <strong>".concat(data.fullName,"</strong>\n            <br>\n            <span>OIB: ").concat(data.VAT," </span><br>\n            <span>").concat(data.address.address1+' '+data.address.nr," </span><br>\n            <span>").concat(data.address.postal+', '+data.address.city,"</span><br>\n            <span>").concat(data.address.country,"</span><br> \n            <span>VAT ID: ").concat(data.VATInternational,"</span><br>\n            <span>SWIFT : ").concat(data.bankAccounts[0]['SWIFT'],"</span><br>\n            <span>IBAN : ").concat(data.bankAccounts[0]['IBAN'],"</span><br> \n</p>\n            \n            \n            ");};var address=function address(data){if(Boolean(data.address1))return'';return"\n<p>\n            <span>".concat(data.address1+' '+data.nr," </span><br>\n            <span>").concat(data.city,"</span><br>\n            <span>").concat(data.country,"</span><br>\n</p>\n            ");};app.scope=false;app.edit=function(invoiceData){app.scope=invoiceData;app.show();};function render(){var invoiceDom=function invoiceDom(invoice){return new Promise(function(resolve,reject){warp.api.call('countries/isEu',main.data.user.cca3).then(function(res){var isEu=res;var profile=warp.gui.storage('profiles.'+main.data.user.id);var legal='';var vat='';var total='';if(Boolean(invoice.vat)){vat='VAT ID : '+profile.vat;if(isEu){legal='Usluga je osloboena plaanja PDV-a po lanku 17. stavak 1 Zakona o Porezu na dodanu vrijednost';}else{legal='Usluga je osloboena plaanja PDV-a po lanku 17. stavak 1 Zakona o Porezu na dodanu vrijednost';}if(main.data.user.cca3=='HRV'){legal='';}}if(!Boolean(invoice.vat)){vat='VAT ID : ';if(isEu){legal='Usluga je osloboena plaanja PDV-a po lanku 17. stavak 2 Zakona o Porezu na dodanu vrijednost';}else{legal='';}if(main.data.user.cca3=='HRV'){legal='';}}legal=legal+"\n        <br>\n        <br>\n        Ra\u010Dun je izra\u0111en elektronski na ra\u010Dunalu i kao takav valjan je bez potpisa i pe\u010Data\n        <br>\n        <p class=\"mt50 tc\" style=\"opacity:0.7\">\n            Slice Secure j.d.o.o.  -  Zagreb, Vrbje 1c  -   Upisan kod Trgova\u010Dkog suda u Zagrebu  -   MBS:081532618 \n            <br>\n            Temeljni kapital dru\u0161tva HRK 100,00 upla\u0107en u cijelosti -  Osoba ovla\u0161tena za zastupanje : Tibor Kordi\u0107\n            <br>\n            Poslovna banka: Raiffeisen bank - SWIFT: RZBHHR2X - IBAN : HR2324840081135356417 \n        </p>\n        ";var invoiceHeader="\n                <div class=\"mt10 mb20 tr\" >\n                     ".concat(main.date.format(invoice.created,true)," ").concat(main.data.company.address.city,", ").concat(main.data.company.address.country,"\n                     <br>\n                     ").concat(main.date.time(invoice.created),"\n                </div>\n                \n                <div class=\" mt5 tl invoice-company\">\n                    ").concat(company(main.data.company),"\n                </div>\n                \n                <h2 class=\"mt50 tc strong \">\n                    Invoice #").concat(invoice.id,"\n                </h2>\n                \n                <div class=\"mt20 mb20 tl  invoice-buyer  invoice-company\" style=\"width:250px\">\n                    Invoice number : ").concat(invoice.id," <br>\n                    Delivery date : ").concat(main.date.format(invoice.created,true)," <br>\n                    Invoice date : ").concat(main.date.format(invoice.created,true)," <br>\n                    Invoice time : ").concat(main.date.time(invoice.created)," <br>\n                    Account ID : ").concat(profile.id," <br>\n                    <br>\n                    Bill to : <strong class='tu'> ").concat(profile.name," </strong> <br> \n                    <div class=\"invoice-vat\">\n                        ").concat(vat,"\n                    </div>\n                    ").concat(profile.address1+' '+profile.nr," <br>\n                    ").concat(profile.city," <br>\n                    ").concat(profile.country," <br>\n                </div>");resolve("\n            <div class=\"m10 small\" >\n                 \n                 ".concat(invoiceHeader,"\n                \n                <div class=\"tl mt20 mb20 invoice-products\" >\n                    ").concat(productsTable(invoice),"\n                </div>\n                \n                <div class=\"mt50 tl  invoice-legal\">\n                    ").concat(legal,"\n                </div>\n            \n            </div>\n            "));});});};var productsTable=function productsTable(invoice){var productsData=warp.un.json(invoice.products);var total=0;var table=warp.dom.node('table',{},{'class':''});var header=warp.dom.node('tr');header.innerHTML=" \n            <th class=\"tl\">Service</th>\n            <th class=\"tr\">Price</th>\n            <th class=\"tc\">Quantity</th>\n            <th class=\"tr\">Amount</th>\n            ";table.appendChild(header);for(var id in productsData){var product=productsData[id];var row=warp.dom.node('tr');row.innerHTML=" \n            <td>".concat(main.data.plans[product.id].title,"</td>\n            <td class=\"tr\">").concat(kn(product.price*product.quantity,invoice.currency),"</td>\n            <td class=\"tc\">").concat(product.quantity,"</td>\n            <td class=\"tr\">").concat(kn(product.price*product.quantity,invoice.currency),"</td>\n            ");total=total+product.price*product.quantity;table.appendChild(row);}var footer='';if(invoice.tax){footer="\n            <tr>\n                <td></td>\n                <td></td>\n                <td class=\"tr tb ti small\">SUBTOTAL : </td>\n                <td class=\"tr\">".concat(kn(parseFloat(invoice.total),invoice.currency),"</td>\n               \n            </tr> \n            <tr>\n                <td></td>\n                <td></td>\n                <td class=\"tr tb ti small\"> VAT(25%) : </td>\n                <td class=\"tr\">").concat(kn(parseFloat(invoice.tax),invoice.currency),"</td>\n               \n            </tr>\n            <tr>\n                <td></td>\n                <td></td>\n                <td class=\"tr tb ti small\">TOTAL : </td>\n                <td class=\"tr\">").concat(kn(parseFloat(invoice.amount),invoice.currency),"</td>\n               \n            </tr>\n            ");}else{footer=" \n             <tr>\n                <td></td>\n                <td></td>\n                <td class=\"tr tb ti small\">SUBTOTAL : </td>\n                <td class=\"tr\">".concat(kn(parseFloat(invoice.total),invoice.currency),"</td>\n               \n        \n            </tr> \n            <tr>\n                <td></td>\n                <td></td>\n                <td class=\"tr tb ti small\"> VAT(25%) : </td>\n                <td class=\"tr\">").concat(kn('0.00',invoice.currency),"</td>\n               \n            </tr>\n            <tr>\n                <td></td>\n                <td></td>\n                <td class=\"tr tb ti small\">TOTAL : </td>\n                <td class=\"tr\">").concat(kn(parseFloat(invoice.total),invoice.currency),"\n                </td>\n            </tr>       \n            ");}return'<table class="mt20">'+table.innerHTML+footer+'</table>';};var kn=function kn(val,curr){var hrk='';val=parseFloat(val);if(curr=='HRK'){val=val.toFixed(2)+' HRK';}else{val=val.toFixed(2)+' '+curr;hrk=' <br><span style="opacity:0.8; display:none">'+(parseFloat(val)*main.billing.rates[curr]).toFixed(2)+' HRK</span>';}return'<span class=\'curr\'>'+val+hrk+'</span>';};var invoice=app.scope;invoiceDom(invoice).then(function(domString){app.el.innerHTML="\n            <div class=\"mt20\">\n                <button class=\"btn btn-danger inverted btn-sm\" onclick=\"warp.dom.toPdf($('.invoice-dom'),'".concat('Slice Secure invoice '+invoice.id,"')\">\n                    <svg class=\"icon hxl\" >\n                        <use href=\"#icon-pdf\"></use>\n                    </svg>\n                </button>\n                <button class=\"sm\" onclick=\"warp.display($('.invoice-dom').innerHTML)\">\n                    Display\n                </button>\n            </div>\n            <div class=\"invoice-dom\"> \n               ").concat(domString,"\n            </div>\n    ");if(!Boolean(invoice.payed)){api('invoices/read/',{'id':invoice.id}).then(function(resp){main.billing.startLightbox('Make payment',resp[0],function(form){form.setAttribute('class','text-danger tb m20');form.prepend('Not yet payed for!');app.el.prepend(form);});});}});}return app;};var Orders=function Orders(){var app=new ListApp({name:'orders',renderList:function renderList(){app.listEl.innerHTML='';var byMe=new warp.gui.Drawer('Ordered by me',{name:'ordersByMe',parent:app.listEl,size:'md'});var fromMe=new warp.gui.Drawer('Ordered from me',{name:'ordersFromMe',parent:app.listEl,size:'md'});function createStatusDrawer(status){var el=warp.dom.node('div');el.style.maxHeight='300px';el.style.overflowY='scroll';el.classList.add('list');return el;}var byMeEls={0:createStatusDrawer(0),1:createStatusDrawer(1),2:createStatusDrawer(2),3:createStatusDrawer(3),4:createStatusDrawer(4),5:createStatusDrawer(5),6:createStatusDrawer(6),7:createStatusDrawer(7)};var fromMeEls={0:createStatusDrawer(0),1:createStatusDrawer(1),2:createStatusDrawer(2),3:createStatusDrawer(3),4:createStatusDrawer(4),5:createStatusDrawer(5),6:createStatusDrawer(6),7:createStatusDrawer(7)};for(var orderIndex in app.scope){var status=app.scope[orderIndex].status;var itemEl=app.renderItem(app.scope[orderIndex]);if(app.scope[orderIndex].orderer!==main.data.user.id){fromMeEls[status].appendChild(itemEl);}else{byMeEls[status].appendChild(itemEl);}}for(var status in byMeEls){var separator=void 0;if(byMeEls[status].childElementCount){separator=warp.gui.listSeparator('<span class="strong">'+main.data.orderStatuses[status].name+'</span> : <span> '+byMeEls[status].childElementCount+' </span>');separator.classList.add('mt5');byMe.body.appendChild(separator);byMe.body.appendChild(byMeEls[status]);}else{}}for(var status in fromMeEls){var separator=void 0;if(fromMeEls[status].childElementCount){separator=warp.gui.listSeparator('<span class="strong">'+main.data.orderStatuses[status].name+'</span> : <span> '+fromMeEls[status].childElementCount+' </span>');separator.classList.add('mt5');fromMe.body.appendChild(separator);fromMe.body.appendChild(fromMeEls[status]);}else{}}},renderItem:function renderItem(item){if(item.orderer=='0'){item.orderer=false;}if(item.orderly=='0'){item.orderly=false;}var itemEl=warp.dom.node('div');itemEl.setAttribute('class','item hlg');var ordererEl;if(!Boolean(item.orderer)){ordererEl='<div>NOT SET</div>';}else{ordererEl=warp.gui.profile.small(item.orderer,true);}var orderlyEl;if(!Boolean(item.orderly)){orderlyEl='<div>NOT SET</div>';}else{orderlyEl=warp.gui.profile.small(item.orderly,true);}var deadline=main.date.format(item.due);if(deadline=='<span loc>Date not set</span>'){deadline='<span loc>not set</span>';}var template='\n                <div class="lines col mr0">\n\n                    <div class="line mt0 mr-15" style="height:33px">\n                       \n                        <div class="pull-left">\n                                <span  style="opacity:0.6;font-size:0.6em"> Ordered by</span> \n                                <br>\n                                <span  style="font-size:0.8em">'.concat(ordererEl,'</span>\n                                 \n                        </div>\n                        <div class="pull-left  small inline-block mt5 " style="width:60px;">\n                            <span style="opacity:0.6; font-size:0.8em" loc>created : </span>\n                            <br>\n                            \n                            ').concat(main.date.format(item.created),'\n                       </div>\n                        <div class="pull-right  small inline-block mt5 " style="width:60px;">\n                            <small style="opacity:0.6; font-size:0.8em" loc>deadline : </small>\n                            <br>\n                            ').concat(deadline,'\n                       </div>\n                    \n                    </div>\n    \n                    <div class="line mt0 mr-15  hsm">\n                    \n                        <div class="pull-left ">\n                                <span  style="opacity:0.6;font-size:0.6em"> Ordered from</span> \n                                <br>\n                                <span  style="font-size:0.8em">').concat(orderlyEl,'</span>\n                        </div>\n                        \n                       <div class="pull-right  small inline-block mt5 " style="width:80px">\n                            <span style="opacity:0.8; font-size:0.8em" loc>\n                            Products : ').concat(Object.keys(item.products).length,'\n                            </span>\n                       </div>\n                    </div>\n\n                </div>\n                <button class="btn btn-link sm ml-5 mr5  round mt10 pull-right clear">\n                       <svg class="icon">\n                          <use href="#icon-angle-right"></use>\n                       </svg>\n                </button>\n                ');itemEl.innerHTML=template;return itemEl;},new:function _new(){warp.api.call('orders/create').then(function(order){app.add(order);app.renderList(app);app.editor.edit(order);});},search:{name:'orders',fun:async function fun(str){alert('seraching for '+str+'in orders');var results={};return results;},item:function item(resultItem){app.renderItem(resultItem);}},init:function init(appInst){appInst.busy(true);warp.api.call('orders/read').then(function(orders){var profiles=[];orders.forEach(function(order,index){if(order.orderer=='0'){order.orderer=false;}if(order.orderly=='0'){order.orderly=false;}if(Boolean(order.orderer))if(profiles.indexOf(order.orderer)===-1){profiles.push(order.orderer);}if(Boolean(order.orderly))if(profiles.indexOf(order.orderly)===-1){profiles.push(order.orderly);}if(!Boolean(order.products)){app.log('products malformed');app.log(order.products);order.products={};}});newStore.profiles.get(profiles).then(function(profs){appInst.load(orders);});});var url='https://ide.bemjax.com/users/1/1/111111111/projects/dalwia/sources/js/orderVendor/?random='+new Date().toString();warp.do.loadJS(url).then(function(data){appInst.editor=new Order();main.order=appInst.editor;appInst.busy(false);});}});return app;};var OrderSelector=function OrderSelector(){var vis=Object.assign(this,new warp.factory.App({name:'vis',winOpts:{beforeHide:function beforeHide(){if(window.vis)env.paused=true;},onShow:function onShow(w){if(window.vis)env.paused=false;w.caption('Products on Order #'+main.order.scope.id);}}})),role,closed=true,env,materials;Object.assign(this,{patientWin:new warp.factory.App({name:'patientWin',winOpts:{beforeShow:function beforeShow(w){if(main.order.scope.name==null)main.order.scope.name='';w.body.innerHTML="\n<style> \n   .patient input, .patient select {\n            height: 35px;\n            min-height: 35px;\n            padding-left: 10px;\n           width: 100%;\n        margin-bottom: 10px;\n        }\n</style>\n<div class=\"patient container-fluid tl mt20 ml20 mr20\">\n    <h2 class=\"mt20 mb20\">Patient data</h2>\n    <div class=\"row mtmd\">\n        <div class=\"col-xs-10 small\">patient name</div>\n        <div class=\"col-xs-14\">\n            <input type=\"text\" value=\"".concat(gui.empty(main.order.scope.name),"\" oninput=\"main.order.scope.name = this.value\" class=\"sm name\" placeholder=\"patient name - optional\" loc />\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-xs-10 small\">patient age in years</div>\n        <div class=\"col-xs-14\">\n            <input type=\"number\" value=\"").concat(main.order.scope.age,"\" oninput=\"main.order.scope.age = this.value\" class=\"sm age\" placeholder=\"age in years\" loc />\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-xs-10 small\">gender</div>\n        <div class=\"col-xs-14\">\n            <select oninput=\"main.order.scope.gender = this.options[this.selectedIndex].value\" class=\"sm gender capitalized fr\">\n                <option value=\"f\" loc>female</option>\n                <option value=\"m\" loc>male</option>\n            </select>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-xs-10 small\">ISO/TR 28642 Teeth color</div>\n        <div class=\"col-xs-14\">\n            <select oninput=\"main.order.scope.color = this.options[this.selectedIndex].value;\" placeholder=\"color\" class=\"sm color fr\">\n                <option value=\"0\" loc>select</option>\n                <option value=\"A1\">A1</option>\n                <option value=\"A2\">A2</option>\n                <option value=\"A3\">A3</option>\n                <option value=\"A4\">A4</option>\n                <option value=\"B1\">B1</option>\n                <option value=\"B2\">B2</option>\n                <option value=\"B3\">B3</option>\n                <option value=\"B4\">B4</option>\n                <option value=\"C1\">C1</option>\n                <option value=\"C2\">C2</option>\n                <option value=\"C3\">C3</option>\n                <option value=\"C4\">C4</option>\n                <option value=\"D1\">D1</option>\n                <option value=\"D2\">D2</option>\n                <option value=\"D3\">D3</option>\n            </select>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-xs-10 small\">There are risks or extra sanitary precautions</div>\n        <div class=\"col-xs-14\">\n            <select oninput=\"main.order.scope.risk = this.options[this.selectedIndex].value;\" placeholder=\"risk\" class=\"sm risk fr\">\n                <option value=\"0\">No</option>\n                <option value=\"1\">Yes</option>\n            </select>\n        </div>\n    </div>\n     <div class=\"row\">\n        <button class=\"mt10 primary fr sm\" onclick=\"main.order.save(); vis.patientWin.hide()\">\n            Save\n        </button>\n    </div>\n</div>\n    ");vis.patientWin.win.el.querySelector('.gender').value=main.order.scope.gender;vis.patientWin.win.el.querySelector('.color').value=main.order.scope.color;vis.patientWin.win.el.querySelector('.risk').value=main.order.scope.gender;}}}),ani:{closeJaws:function closeJaws(){if(closed)return;gsap.to(vis.upperJaw.position,{duration:0,'y':0,'z':0});gsap.to(vis.upperJaw.rotation,{duration:0,'x':0});gsap.to(vis.lowerJaw.rotation,{duration:0,'x':0.3});closed=true;gsap.to(vis.lowerJaw.rotation,{duration:0.6,'x':0});},openJaws:function openJaws(){if(!closed)return;gsap.to(vis.upperJaw.rotation,{duration:0,'x':0});gsap.to(vis.lowerJaw.rotation,{duration:0,'x':0});closed=false;gsap.to(vis.lowerJaw.rotation,{duration:0.6,'x':0.3});},toggleJaws:function toggleJaws(){if(closed){vis.ani.openJaws();return;}vis.ani.closeJaws();return;}},order:false,changed:false,product:{item:function item(data){var size=20;return"\n    <span style=\"cursor:pointer \" class=\"inline-block ripple\">\n         <span class=\"round ml0 tc inline-block\"  style=\"\n                 font-size: ".concat(size/2,"px; \n                 line-height: ").concat(size,"px; \n                 background-color : ").concat(data.color,";  \n                 height: ").concat(size,"px; \n                 width: ").concat(size,"px;  \n                 color: white;\n         \">").concat(data.shortName,"\n         </span>\n         <span class=\"small\"  style=\"max-width:60px; text-overflow:ellipsis; white-space:nowrap; overflow : hidden\" >\n            ").concat(data.name,"\n         </span>\n    </span>\n            ");}},tooth:{selected:false,select:function select(name){if(Boolean(vis.tooth.selected)){env.scene.getObjectByName(vis.tooth.selected).material=materials.tooth;}if(!name){vis.tooth.selected=false;render();return;}warp.gui.animate.blurIn(vis.el.querySelector('.name'));vis.tooth.selected=name;render();}},load:function load(data){env.paused=false;if(!data){vis.win.hide();vis.log('no id or data provided for the order',1);return;}if(_instanceof(data.products,Array)){vis.log('malformed products in loaded order....');if(!data.products.length){data.products={};console.log('...but fixed');}else{console.log('NOT FIXED');}}main.order.scope=data;if(main.data.user.id==data.orderer)role='orderer';if(main.data.user.id==data.orderly)role='orderly';vis.tooth.select(false);main.order.product.selected=false;render();vis.ani.openJaws();env.camera.position.set(-30,-20,100);env.controls.update();}});function render(){var oldpause=env.paused;env.paused=true;var btnAddProd="\n<button class=\"xs clear link mb0 \" onclick=\"main.order.product.add(false)\" \n       style=\"font-size:12px; padding-left:2px; padding-right:2px; margin-top:3px; float:right; margin-right:5px\">\n                        Add \n                        <span class=\"round\"  style=\"background-color : ".concat(main.order.product.selected.color,"; \n                        height: 20px; width: 20px; font-size: 10px; line-height: 20px;  text-align:center; display: inline-block; color: white; padding-left: 0px; font-weight:normal\">\n                             ").concat(main.order.product.selected.shortName,"\n                         </span> \n</button>\n                    ");if(vis.tooth.selected){env.scene.getObjectByName(vis.tooth.selected).material=materials.selected;vis.el.querySelector('.info .name').innerHTML=vis.tooth.selected;if(main.order.product.selected)vis.el.querySelector('.add').style.display='inline-block';if(Object.keys(main.order.scope.products).length){var prodStr='';for(var productId in main.order.scope.products){if(main.order.scope.products[productId].teeth.includes(vis.tooth.selected)){prodStr=prodStr+'<div class="mt5 mb5">'+vis.product.item(main.order.scope.products[productId])+'<button class="xs round tc " style="margin:3px;width:15px;height:15px; padding:0px; margin:0px;"  onclick="main.order.product.remove('+productId+')" >X</button></div>';if(main.order.product.selected.id==productId){}}}vis.el.querySelector('.info .tooth-products').innerHTML="\n               <div>\n                  ".concat(prodStr,"\n                </div>\n                \n            ");}else{if(!main.order.product.selected)vis.el.querySelector('.info .tooth-products').innerHTML="\n                <div>\n                </div>\n             \n            ";}}else{vis.el.querySelector('.add').style.display='none';name="\n            <span style=\"font-weight:normal; font-size:12px; color:black; opacity:0.8, text-decoration:none\">\n                none\n            </span>\n        ";vis.el.querySelector('.info .name').innerHTML=name;vis.el.querySelector('.info .tooth-products').innerHTML=name;}if(main.order.product.selected){var item=vis.product.item(main.order.product.selected);vis.el.querySelector('.selected-product-item').innerHTML=item;}vis.el.querySelector('.products').innerHTML="";var _loop14=function _loop14(_productId){var prodRow=warp.dom.node('div',{},{class:'ripple inline-block tl mt5 mb5 ',style:'min-height: 20px; width:100%; text-overflow:ellipsis; white-space:nowrap; overflow:hidden;'});prodRow.innerHTML="\n            <span onclick=\"main.order.product.select(main.order.scope.products['".concat(_productId,"'])\"> \n                ").concat(vis.product.item(main.order.scope.products[_productId]),"\n            </span>\n              \n            <div class=\"small teeth-list\">\n                <span class=\"small\"> \n                    Teeth : ( ").concat(main.order.scope.products[_productId].teeth.length," ) \n                </span>\n            </div>\n            \n            ");main.order.scope.products[_productId].teeth.forEach(function(tooth){var cl='';if(tooth==vis.tooth.selected)cl='text-primary';prodRow.querySelector('.teeth-list').innerHTML=prodRow.querySelector('.teeth-list').innerHTML+"\n                <a class=\"inline-block m5 upper ".concat(cl," bold\" onclick=\"main.order.product.selector.tooth.select('").concat(tooth,"')\">\n                    ").concat(tooth,"\n                </a>,\n            ");});vis.el.querySelector('.products').appendChild(prodRow);};for(var _productId in main.order.scope.products){_loop14(_productId);}if(!Object.keys(main.order.scope.products).length){vis.el.querySelector('.products').innerHTML="\n            <div class=\"text-center mt20\">\n                No products added to the order yet!<br><br> \n                Select a product, then select a tooth.\n            <button class=\"fl xs ml5 mr5 mt20 mb5 link inverted inline\" onclick=\"main.order.product.select()\">\n                    Product... \n            </button>\n            \n            </div>";}vis.el.querySelector('.add').innerHTML=btnAddProd;vis.win.show();env.paused=oldpause;}this.render=render;function construct(){function setupScene(){env.scene=new THREE.Scene();var scene=env.scene;scene.background=null;var l=new THREE.AmbientLight(new THREE.Color('rgb(255,250,255)'),0.5);l.castShadow=false;l.name='Ambient Light';scene.add(l);env.controls.target.set(0,-5,0);env.controls.screenSpacePanning=false;env.controls.minAzimuthAngle=-1;env.controls.maxAzimuthAngle=1;env.controls.minPolarAngle=0.6;env.controls.maxPolarAngle=2;env.controls.rotateSpeed=0.5;env.camera.position.set(-30,-20,100);env.controls.enableZoom=false;env.controls.enablePan=false;env.controls.zoomIn(5);env.controls.update();}var style="\n        <style>\n            .t{   \n                font-size:0.6em\n            }\n            .vis {\n        /* Permalink - use to edit and share this gradient: https://colorzilla.com/gradient-editor/#dbfdfb+0,eafcfb+23,feffff+100 */\n        background: linear-gradient(tobottom,#a3dbec 0%,#fff 100%);\n    \n            overflow: hidden;\n  /*   margin-top:30px;*/\n            margin-left: 10px;\n            margin-right: 10px\n        }\n            .info {\n            border-radius: 6px 6px 12px 12px;\n            display: inline-block;\n            background-color: rgba(255, 255, 255, 0.9);\n            position: absolute;\n            top: 100px;\n            right: 20px;\n            text-align: left;\n            padding: 5px;\n            min-height: 130px!important;\n            width: 130px;\n        }\n            .info > .name {\n            font-weight: bold!important;\n            text-transform: uppercase;\n            margin-left: 5px;\n            width:50px;\n            float:left;\n            font-size: 1.8em;\n        }\n            .info > .products {\n            font-weight: normal;\n            font-size: 10px;\n        }\n            .wrapper {\n            background: rgb(255, 255, 255, 0.7);\n            background: radial-gradient(circle, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0) 100%);\n            /*   margin-left:-40px*/\n        }\n            .selected-product {\n            width: 130px;\n            text-overflow: visible;\n            overflow: show\n        }\n        .products{\n          \n            width:80%;\n            margin-left: auto;\n            margin-right: auto\n        }\n         \n            .wrapper > canvas {\n            margin-left: -10px\n        }\n        </style>";var gui="\n                   <div class=\"selected-product mb-5 mt20 ml20 tl\" style=\"\">\n                        <div class=\"t mb5\">\n                            SELECTED PRODUCT :\n                        </div>\n                        <div class=\"selected-product-item mt0\" onclick=\"main.order.product.select()\">\n                        </div>\n                    </div>\n                    \n     \n            <div class=\"vis\">\n                <div class=\"info raised-sm\">\n\n                    <div class=\"t mt5\">\n                        SELECTED TOOTH :\n                    </div>\n                    <div class=\"v name text-primary\">\n                        ul1\n                    </div>\n                    <div class=\"add\"></div>\n                    <div class=\"t mb0 mtsm\" >\n                        PRODUCTS ON TOOTH :\n                    </div>\n                    <div class=\"tooth-products\">\n                    </div>\n\n                </div>\n                <div class=\"wrapper inline-block fl\">\n                </div>\n         </div>\n         <div class=\"mb10 mt10\">Ordered products :</div>\n       \n        <div class=\"products\">\n        </div>\n    ";gui=style+gui;window.vis=vis;var bodyW=warp.dom.width(main.home.win.body)*0.67;env=new Env3({width:bodyW-20,height:bodyW*0.7,scene:true});vis.el.innerHTML=gui;vis.el.querySelector('.vis .wrapper').appendChild(env.el);vis.upperJaw=false;vis.lowerJaw=false;vis.jaws=false;vis.teeth={};vis.lights=[];var axes=[];var materialsSafe={bone:new THREE.MeshPhongMaterial({color:new THREE.Color('rgb(255,234,187)'),transparent:false,opacity:1,emissive:0,reflectivity:0}),tooth:new THREE.MeshPhongMaterial({color:new THREE.Color('rgb(250,250,250)'),transparent:false,opacity:1,emissive:0,reflectivity:0}),selected:new THREE.MeshPhongMaterial({color:new THREE.Color('#002e6e'),transparent:false,opacity:1,emissive:0,reflectivity:0}),product:new THREE.MeshPhongMaterial({color:new THREE.Color('rgb(2,135,255)'),transparent:false,opacity:1,emissive:0,reflectivity:0}),axis:new THREE.MeshPhongMaterial({color:new THREE.Color('rgb(0,90,255)'),transparent:false,opacity:1,emissive:0,reflectivity:0})};var materialsHigh={bone:new THREE.MeshPhongMaterial({color:new THREE.Color('rgb(220,190,170)'),transparent:true,opacity:1}),selected:new THREE.MeshPhysicalMaterial({color:new THREE.Color('#002e6e'),transparent:false,opacity:1,emissive:1,roughness:0.1,metalness:0.2,reflectivity:0.3,clearcoat:0.93,clearcoatRoughness:0.3}),tooth:new THREE.MeshPhysicalMaterial({color:new THREE.Color('rgb(250,250,250)'),transparent:false,opacity:1,emissive:1,roughness:0.1,metalness:0.2,reflectivity:0.6,clearcoat:0.93,clearcoatRoughness:0.3}),axis:new THREE.MeshPhongMaterial({color:new THREE.Color('rgb(0,90,255)'),transparent:true,opacity:0.8})};function colorFromCss(cssVar){return new THREE.Color(getComputedStyle(document.documentElement).getPropertyValue('--'+cssVar));}var materialsCSS={bone:new THREE.MeshPhongMaterial({color:colorFromCss('bone'),transparent:true,opacity:1}),tooth:new THREE.MeshPhysicalMaterial({color:colorFromCss('tooth'),transparent:true,opacity:0.93,emissive:1,roughness:0.1,metalness:0.2,reflectivity:0.1,clearcoat:0.93,clearcoatRoughness:0.3}),selected:new THREE.MeshPhysicalMaterial({color:colorFromCss('selected'),transparent:false,opacity:1,emissive:1,roughness:0.1,metalness:0.2,reflectivity:0.3,clearcoat:0.93,clearcoatRoughness:0.3}),axis:new THREE.MeshPhongMaterial({color:colorFromCss('axis'),transparent:true,opacity:0.8}),visBg:new THREE.MeshPhongMaterial({color:colorFromCss('visBg'),transparent:true,opacity:0.1})};materials=materialsSafe;var loader=new THREE.GLTFLoader();env.el.addEventListener('mousedown',function(){var raycaster=new THREE.Raycaster();var mouse=new THREE.Vector2();var bounds=env.renderer.domElement.getBoundingClientRect();mouse.x=(event.clientX-bounds.left)/env.renderer.domElement.clientWidth*2-1;mouse.y=-((event.clientY-bounds.top)/env.renderer.domElement.clientHeight)*2+1;raycaster.setFromCamera(mouse,env.camera);var newArray=[];for(var _name22 in vis.teeth){newArray.push(vis.teeth[_name22].obj);}var intersects=raycaster.intersectObjects(newArray,true);if(intersects.length>0){var dist=false;var closestIndex=0;var ind=0;intersects.forEach(function(insect){if(!dist){dist=insect.distance;}else{if(insect.distance<dist){closestIndex=ind;}}ind++;});vis.tooth.select(intersects[closestIndex].object.name);}});loader.load(main.envVars.url+'resources/3d/low-poly.gltf',function(gltf){setupScene();gltf.scene.children.forEach(function(ob){env.scene.add(ob);});vis.lowerJaw=env.scene.getObjectByName('lowerJaw',true);vis.upperJaw=env.scene.getObjectByName('upperJaw',true);vis.jaws=env.scene.getObjectByName('jaws',true);vis.lowerJaw.traverse(function(ob){ob.material=materials.tooth;if(ob.name.includes('ll')||ob.name.includes('lr')||ob.name.includes('ul')||ob.name.includes('ur')){vis.teeth[ob.name]={obj:ob,items:{}};}if(ob.name.includes('a')&&ob.name!='mandible'&&ob.name!='maxilla'){ob.material=materials.axis;axes.push(ob);}if(ob.name=='mandible'||ob.name=='maxilla'){ob.material=materials.bone;}});vis.upperJaw.traverse(function(ob){ob.material=materials.tooth;if(ob.name.includes('ll')||ob.name.includes('lr')||ob.name.includes('ul')||ob.name.includes('ur')&&ob.name!='maxilla'){vis.teeth[ob.name]={obj:ob,items:{}};}if(ob.name.includes('a')&&ob.name!='mandible'&&ob.name!='maxilla'){ob.material=materials.axis;axes.push(ob);}if(ob.name=='mandible'||ob.name=='maxilla'){ob.material=materials.bone;}});env.scene.traverse(function(obj){if(obj.type=='AmbientLight'||obj.type=='SpotLight'||obj.type=='DirectionalLight'||obj.type=='PointLight'){}},true);env.paused=true;delete vis.teeth.maxilla;});return vis;}alert('yes i am alive');};var Order=function Order(){var app=this,referenceMode=false,needsSave=false,dummy=false,statuses={'0':{'name':'draft','validate':function validate(order){var fields={'orderly':function orderly(order){if(!Boolean(order.orderly)){return'Select a production team to order from';}return true;},'products':function products(order){if(!Object.keys(order.products).length){return'Add products to this Order from the production Team\'s product list';}return true;},'due':function due(order){if(!Boolean(order.due)||order.due=='00-00-0000 00:00:00'){return'Select a deadline for Order';}return true;}};var final='';for(var field in fields){var res=fields[field](order);if(res!==true){final=final.toString()+'<br>'+res;}}if(final=='')return true;return true;},'operator':'orderer','description':'Orderer created an order'},'1':{'name':'requested','validate':function validate(order){return true;},'operator':'orderly','description':'\n            Orderer entered minimal order specification (products, note) and price/deadline feedback\n            is requested from a production team .\n            Production team  gets notified that input is needed.\n            If production team confirms, order is promoted to 3.\n            If production team  made changes in specs order is promoted to 2.\n            '},'2':{'name':'negotiated','validate':function validate(order){return true;},'operator':'all','description':'\n            Orderer confirmed and orderly gets notified.\n            Project is starting.\n            Data entered until this point cannot be changed'},'3':{'name':'ordered','validate':function validate(order){},'operator':'orderly','description':'\n            Orderly team organises production on his side by adding members to Production team,\n            or setting the Production team from his existing teams'},'4':{'name':'dispatched','validate':function validate(order){},'operator':'all','description':'\n            Production is on its way. New docs can be added and comments also. Milestones?\n            Orderer and Production team members get notified.'},'5':{'name':'production','validate':function validate(order){},'operator':'orderly','description':'\n            Orderly team reached final milestone, and product is delivered to Orderer for closing confirmation'},'6':{'name':'finished','validate':function validate(order){},'operator':'orderer','description':'\n       ,\n            or setting the production team from his existing teams'},'7':{'name':'closed','validate':function validate(order){},'operator':'orderly','description':'\n'}};app=Object.assign(this,new warp.factory.App({name:'order',winOpts:{beforeHide:function beforeHide(w){if(needsSave)confirm('You made changes to the Order, save?',app.save,function(){toast('Changes dropped');needsSave=false;});},showCentered:true,onShow:render}}));this.product={selected:false,add:function add(product){if(!product)product=app.product.selected;var id=product.id;if(id===false||id===undefined){console.error('false as product id');return;}if(!scope('products')[id]){scope('products')[id]=product;scope('products')[id].teeth=[];needsSave=true;}if(!scope('products')[id].teeth.includes(app.product.selector.tooth.selected)){scope('products')[id].teeth.push(app.product.selector.tooth.selected);needsSave=true;warp.trigger('app.scope.changed');app.product.selector.render();}},remove:function remove(id){var myIndex=scope('products')[id].teeth.indexOf(app.product.selector.tooth.selected);if(myIndex!==-1){scope('products')[id].teeth.splice(myIndex,1);}if(!scope('products')[id].teeth.length){delete scope('products')[id];}needsSave=true;app.product.selector.render();},select:function select(product){if(!Boolean(scope('orderly'))||scope('orderly')=='0'){toast('No team is selected, please select a Laboratory team from your Contacts...');app.team.select();return;}if(!Boolean(product)){main.products.select(function(pr){app.product.select(pr);},scope('orderly'));return;}warp.gui.animate.blurIn(app.product.selector.el.querySelector('.selected-product-item'));app.product.selected=product;main.products.hide();app.product.selector.render();},show:function show(){app.product.selector.load(scope());app.product.selector.show();}};this.team={add:function add(product){},remove:function remove(id){},select:function select(profile){if(!Boolean(profile)||profile=='0'){main.contacts.select(function(prof){app.team.select(prof);main.contacts.hide();});return;}if(profile.id)profile=profile.id;if(Object.keys(scope('products')).length){confirm('Selecting new production Team will remove all current products from order, proceed?',function(){scope('orderly',profile);scope('products',{});needsSave=true;app.product.selected=false;render();app.product.select(false);});return;}scope('orderly',profile);scope('products',{});needsSave=true;app.product.selected=false;app.product.select(false);render();},show:function show(){}};this.upload={show:function show(){main.upload.select(function(url){main.upload.hide();},'Please select a file to add to Order #'+scope('id'),scope());}};this.chat={start:function start(){var chatId='';var id=Boolean(scope('referal'))?scope('referal'):scope('id');chatId=scope('orderer')+' order '+id;warp.api.call('conversations/create',{id:chatId}).then(function(ind){var c=new Conversation({id:chatId,title:'Order '+scope('id')});c.select(chatId,'Order '+scope('id'));c.win.caption('Order '+scope('id'));});},count:async function chatCount(){var chatId='';var id=Boolean(scope('referal'))?scope('referal'):scope('id');chatId=scope('orderer')+' order '+id;var c=await warp.api.call('conversations/count',{id:chatId});return c;}};this.deadline={select:function select(){warp.editors.date(new Date(),'vcvcv',function(sqlDate){main.order.deadline.set(sqlDate+' 12:00:00');});},'set':function set(date){if(main.date.tense(date)<2){alert('date of delivery cannot be in past or today');return;}scope('due',date);needsSave=true;render();toast('Deadline is set, please save changes');}};this.save=function(){return new Promise(function(resolve,reject){if(scope('products')==[]){app.log('save  malformed products in loaded order. array fixd to object');scope('products',{});}if(_instanceof(scope('products'),Array)){app.log(' save malformed products in loaded order. array NOT FIXED');}app.win.busy(true);warp.api.call('orders/update',scope()).then(function(ok){if(!ok){reject(scope());app.log('Save failed for order '+scope('id'),1);error('Save failed for order '+scope('id'));}resolve(scope());needsSave=false;warp.trigger('api.orders.update',scope());app.el.classList.remove('loading');toast('Order changes saved!');render();Object.assign(app.scope,dummy);main.orders.renderList(main.orders);app.win.busy(false);});});};this.delete=function(){return new Promise(function(resolve,reject){if(parseInt(scope('status'))>1){confirm('Order stage is to high to be deleted!');return;}confirm('Are you sure, you will loose all progress on this draft?',function(){app.win.busy(true);warp.api.call('orders/delete',scope()).then(function(res){app.win.hide();app.win.busy(false);main.orders.remove(scope());toast('Order deleted');resolve(scope());});});});};this.edit=function(data){if(needsSave){confirm('You made changes to this order.<br><br> Save?',function(){app.save().then(function(){return app.edit(data);});});return;}if(Boolean(parseInt(data.reference))){toast('has reference : '+data.reference);api('orders/read',{'profile':data.orderer,'id':data.reference}).then(function(referencedData){referencedData=referencedData[0];referenceMode=data.id;doDataStuff(referencedData);});return;}function doDataStuff(data){app.scope=data;dummy=Object.assign({},data);app.win.caption('Order '+data.id);needsSave=false;app.show();}referenceMode=false;doDataStuff(data);};this.validate=function(silent){var currentStatus=statuses[scope('status')].validate(scope());app.log('currentStatus : '+currentStatus);if(currentStatus===true){return true;}if(!silent)error(currentStatus);return false;};this.advance=function(){var validationResult=app.validate();if(validationResult===true){app.save().then(function(r){var t=toast('Please wait,advancing order to '+statuses[scope('status')+1].name,10000);warp.api.call('orders/advance/',scope()).then(function(result){if(result){scope('status',scope('status')+1);app.edit(scope());t.destroy('Order placed!');}else{app.log('error when advancing '+scope('id'),1);error('error when advancing '+scope('id'));}});});}};function scope(prop,val){if(val!==undefined){dummy[prop]=val;return;}if(prop===undefined)return dummy;return dummy[prop];}function render(){if(!scope())return;var by=warp.gui.profile.small(scope('orderer'),true);var from="\n        <a  href=\"#\" onclick=\"main.order.team.select()\">\n            Select Team...\n        </a>";if(Boolean(scope('orderly'))){from=warp.gui.profile.small(scope('orderly'),true)+"\n        <br>\n        <button class=\"link inverted xs mt-10\"   onclick=\"main.order.team.select()\">\n            Change...\n        </button>";}var deadline="\n        <a  onclick=\"main.order.deadline.select()\">\n            ".concat(main.date.format(scope('due')),"\n        </a>");var saveBtnState='disabled';if(needsSave)saveBtnState='secondary';var style="\n        <style>\n         .order .header .small{   \n             font-size:0.6em;\n             opacity:0.7;\n         }\n            .order .controls{\n            position:absolute;\n            bottom:0px;\n            left:0px\n            }\n            .order > .menu > button{\n            display:inline-block;\n            background-color:var(--pageBg);\n            color:var(--linkColor);\n            padding-left:25px;\n            width:100px;\n            height:100px;\n            margin-top:10px;\n            margin-bottom:10px;\n            margin-left:auto;\n            margin-right:auto;\n            border:transparent;\n            border-radius:50px;\n            }\n            .order > .menu > button > svg{\n            width:50px;\n            height:50px;\n            fill:var(--linkColor);\n            }\n        </style>";app.html(style+"\n        <div class=\"order\">\n        <input type=\"text\" id=\"ref-fix\" class=\"hidden\" value=\"".concat(scope('reference'),"\" placeholder=\"reference\"/>\n            <div class=\"row m10 header tl\">\n                <div class=\"col-xs-14 \">\n                    <div class=\"small mb5\">\n                        ORDERED BY :\n                    </div>\n                    <div>\n                        ").concat(by,"\n                    </div>\n                </div>\n                \n                <div class=\"col-xs-10\">\n                    <div class=\"small mb5\">\n                        DEADLINE :\n                    </div>\n                    <div>\n                        ").concat(deadline,"\n                    </div>\n                </div>\n                \n                <div class=\"col-xs-14  mt10\">\n                    <div class=\"small mb5\">\n                        ORDERED FROM :\n                    </div>\n                    <div>\n                        ").concat(from,"\n                    </div>\n                </div>\n                \n                <div class=\"col-xs-10 mt10\">\n                    <div class=\"small mb5\">\n                        STAGE :\n                    </div>\n                    <div class=\"tb\" style=\"text-transform:uppercase;font-weight:bold!important;\">\n                          ").concat(statuses[scope('status')].name,"\n                    </div>\n                </div>\n                <button class=\" xs link inverted mt10 fr mr10 hidden\" onclick=\"vis.patientWin.show()\">Edit patient data</button>\n            </div>\n\n            <div class=\"menu\">\n            \n                <button class=\"link\" onclick=\"main.order.product.show()\">\n                    <svg class=\"icon\">\n                        <use href=\"#icon-products\">\n                        </use>\n                    </svg>\n                    <div class=\"badge\">\n                        ").concat(Object.keys(scope('products')).length,"\n                    </div>\n                    <br>\n                    Products\n                </button>\n                <br>\n                \n                <button class=\"link\" onclick=\"main.order.chat.start()\">\n                    <svg class=\"icon\">\n                        <use href=\"#icon-chat\">\n                        </use>\n                    </svg>\n                    <div class=\"badge ch\">\n                        0\n                    </div>\n                    <br>\n                        Chat\n                </button>\n                <br>\n                \n                <button class=\"link hidden\" onclick=\"main.order.upload.show()\">\n                    <svg class=\"icon\">\n                        <use href=\"#icon-attachment\">\n                        </use>\n                    </svg>\n                    <div class=\"badge\">\n                        0\n                    </div>\n                    <br>\n                    Uploads\n                </button>\n                \n            </div>\n            \n            <div class=\"tl hxl controls\">\n                <div class=\"ml10 mt5 small\">\n                        Current stage\n                        <span class=\"stage bold\" style=\"text-decoration:uppercase\">\n                            ").concat(statuses[scope('status')].name,"\n                        </span>\n                </div>\n                <button class=\"ml10 mt10 primary advance\" onclick=\"main.order.advance()\">Next stage</button>\n                <button class=\"xs mt10 delete \" onclick=\"main.order.delete()\">Delete</button>\n                <button class=\"xs mt10 save ").concat(saveBtnState,"\" onclick=\"main.order.save()\">Save</button>\n            </div>\n        </div>\n            "));app.chat.count().then(function(nr){app.el.querySelector('.badge.ch').innerHTML=nr;});}function construct(){app.product.selector=new OrderSelector();}construct();return app;};var NottApp=function NottApp(){var app=extend(this,new warp.factory.App({name:'nottApp',winOpts:{onShow:function onShow(w){w.caption('Activity');render();}}}));var list=[];var lastRenderedNott=false;var lastNewsIndex=1;var currentFile=false;async function createFromFile(file){var arr=await file.drive.read(file.path);arr=warp.un.json('['+removeLastOccurence(arr,',')+']');arr.forEach(function(nott){add(nott);});currentFile=file;render();}function removeLastOccurence(str,char){var lastIndexOfL=str.lastIndexOf(char);var removeLastL=str;if(lastIndexOfL!==-1){removeLastL=str.slice(0,lastIndexOfL)+str.slice(lastIndexOfL+1);}return removeLastL;}function add(nott){list.push(nott);}function route(nott){add(nott);if(nott.action=='run'){eval(nott.data);return;}switch(nott.entity){default:warp.trigger('news',nott);warp.trigger('news.'+nott.entity,nott);break;}}this.createFromResponse=function(responseArray){responseArray.forEach(function(nottItems){nottItems=warp.un.json('['+removeLastOccurence(nottItems,',')+']');lastNewsIndex=lastNewsIndex+nottItems.length;nottItems.forEach(function(nott){route(nott);});});gui.storage('notifications',list);if(!currentFile)render();};function createFromStorage(arr){arr.forEach(function(nott){add(nott);});lastNewsIndex=lastNewsIndex+arr.length;render();}function ping(){warp.api.call('users/news',{lastIndex:lastNewsIndex}).then(function(currentNewsIndex){if(lastNewsIndex!=currentNewsIndex){}});}function render(){function dateEl(date){var dateEl=warp.dom.node('span',{},{class:'sm'});if(typeof date=='string'){dateEl.innerHTML=main.date.format(date,true);}else dateEl.innerHTML=main.date.format(date);return dateEl;}function entryEl(data){var div=warp.dom.node('div',{},{style:'border-bottom: 1px solid rgba(193 ,193 ,193,.1);background-color:var(--itemBg)',class:'hxs pt5 small'});div.innerHTML="\n            <div style=\"width:35px\" class=\"ml20 inline-block\">\n                ".concat(main.date.time(data.date).slice(0,-3),"\n            </div>\n            ");var actor='You';if(main.data.user.id!=data.profile){if(!gui.storage('profiles.'+data.profile)){actor=warp.dom.node('span');actor.textContent=data.profile;}else{actor=store.profiles.inline(data.profile);}actor.classList.add('mr5');actor.addEventListener('click',function(){main.profile.edit(data.profile);});}div.append(actor);div.append(', "'+data.entity+'" ,');var targetProfile;if(data.id&&data.entity=='wall'){if(!gui.storage('profiles.'+data.id)){targetProfile=warp.dom.node('span');targetProfile.textContent=data.id;}else{targetProfile=store.profiles.inline(data.id);}targetProfile.classList.add('mr5');targetProfile.classList.add('ml5');targetProfile.addEventListener('click',function(){main.profile.edit(data.id);});}if(targetProfile)div.append(targetProfile);div.append(', "'+data.action+'"');lastRenderedNott=data;return div;}app.el.innerHTML="\n            <button class=\"sm mt-10 clear fr select\">\n              <svg class=\"icon\">\n                    <use href=\"#icon-calendar\">\n                    </use>          \n                </svg>\n            </button>\n            <div class=\"tl ml20 mr20 mb5 mt10\">\n                   Activity log <span class=\"date\"> </span>\n            </div>\n            <div class=\"list inset\" style=\" overflow-y:scroll\">\n            </div>\n ";app.event(app.query('button.select'),'click',function(){warp.user.drive.apps[0].select('Select a .list file from logs','list','logs/week').then(createFromFile);});if(currentFile){var d=currentFile.name.split('.')[0];var dateParts=d.split('-');var jsDate=new Date(dateParts[0],dateParts[1]-1,dateParts[2].substr(0,2));app.el.querySelector('.date').append(dateEl(jsDate));}else app.el.querySelector('.date').append(dateEl(Date.now()));var listEl=app.el.querySelector('.list');createDom(list);function createDom(notts){var sorted={};var reusableDate;notts.forEach(function(nott){reusableDate=nott.date.split(' ')[0];if(sorted[reusableDate]){sorted[reusableDate].push(nott);}else{sorted[reusableDate]=[];sorted[reusableDate].push(nott);}});var today=Object.values(sorted).pop();for(var index in today){listEl.prepend(entryEl(today[index]));}}}function construct(){list=[];var old=gui.storage('notifications');if(old){createFromStorage(old);setInterval(function(){ping();},5000);}else{warp.api.call('users/today').then(function(newsString){old=warp.un.json('['+removeLastOccurence(newsString,',')+']');gui.storage('notifications',old);createFromStorage(old);setInterval(function(){ping();},5000);});}}construct();};function Team(){var app=Object.assign(this,new ListApp({name:'team',winOpts:{beforeShow:function beforeShow(){}},renderItem:function renderItem(profile){var el=store.profiles.item(profile.id);return el;},onSelect:function onSelect(profile){main.profileEditor.inspect(profile.id);},new:function _new(){app.createNew();},init:function init(){render();},search:{name:'members',fun:async function fun(str){var results={};return results;},item:function item(result){app.renderItem(result);}}}));app.inspected=main.data.user.id;function render(){warp.api.call('users/teams').then(function(res){if(res.length){res.forEach(function(pr){return gui.storage('profiles.'+pr.id,pr);});app.load(res);app.log(res);}else{app.listEl.innerHTML="\n                    <div class=\"mtmd ml20\">No Teams yet</div>\n                    <div class=\"mt20 block tj center\" style=\"width:200px\">\n                         <p loc=\"\">\n                            Add a first team\n                         </p>\n                         <button loc=\"\" class=\"primary\" onclick=\"main.team.createNew()\">\n                            Add\n                         </button>\n                    </div>\n                    <div class=\"mt20 block tj center\" style=\"width:200px\">\n                         <p loc=\"\">\n                            ..or You can invite other users to your future structure. \n                            You are also giving them a free Basic account\n                            so you can collaborate!\n                         </p>\n                         <button loc=\"\" class=\"primary\" onclick=\"main.invitations.show()\">\n                            Invitations\n                         </button>\n                    </div>\n                        ";}});}app.createNew=function(){input('Name for new Team').then(function(name){main.teams.new(name,main.data.user.id).then(function(profile){app.inspect(profile.id);});});};app.inspect=function(profileId){render();app.show();};return app;}var Invoices=function Invoices(){var app=new ListApp({name:'invoices',editor:new Invoice(),renderItem:function renderItem(item,editor){var itemEl=warp.dom.node('div');itemEl.setAttribute('class','item hlg');var payed=main.date.format(item.payed);if(main.date.format(item.payed)=='<span loc>Date not set</span>'){payed='<span loc class="strong mb20 text-danger">Not payed</span>';}itemEl.innerHTML="\n\n            \n            <div class=\"lines col\">\n            \n                <div class=\"line\">\n                    <div class=\"fl ml0 bold\">\n                       Invoice ".concat(item.id,"\n                    </div>\n                    \n                      <div class=\"fr cur\">\n                        ").concat(item.amount," ").concat(item.currency,"\n                    </div>\n                </div>\n                <div class=\"line\">\n                <div class=\"fl ml0 small\">\n                       Created : ").concat(main.date.format(item.created),"\n                    </div>\n                    <div class=\"fr small\">\n                        Payed : ").concat(payed,"\n                    </div>\n                </div>   \n              \n            </div>\n            \n            <button class=\"btn btn-link round mt10 fr clear\">\n                       <svg class=\"icon\">\n                          <use href=\"#icon-angle-right\"></use>\n                       </svg>\n            </button>\n");return itemEl;},winOpts:{onShow:function onShow(w){if(!window.pdfLoaded){warp.do.loadJS('https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js').then(function(){window.pdfLoaded=true;warp.api.call('invoices/read').then(function(invoices){app.load(invoices);});});}}}});return app;};function Teams(){var loaded=true;var app=Object.assign(this,new warp.factory.App({name:'teams',win:true,winOpts:{backdrop:false,draggable:true}}));function render(){var parentItem="\n        <div class=\"m5 mtmd tl parent\">\n           <h1>".concat(main.envVars.url.replace('https://','').replace('/',''),"</h1>\n        </div>\n        ");if(app.inspected.parent!='000000000'){parentItem=" \n            <div class=\"m5 mtmd tl parent\" onclick=\"main.teams.inspect('".concat(app.inspected.parent,"')\">\n                Parent : ").concat(gui.profile.list(app.inspected.parent,true),"\n            </div>");}app.html("\n        \n    ".concat(parentItem,"\n    <div class=\"tl m5 profile\" style=\"overflow:visible;\">\n            <div class=\"tr m5\">\n                 ").concat(gui.profile.list(app.inspected.id,true),"\n                <div class=\"tr\" style=\"margin-top:-60px\">\n                    <button class=\"xs inline-block\" onclick=\"main.profileEditor.inspect('").concat(app.inspected.id,"')\">Edit</button>\n                    <br> <br> <br>\n                   \n                </div>\n                <div style=\"margin-left:-20px; margin-top:-80px; width:20px;\n                     height:50px; \n                     border-bottom:1px solid #333; \n                     border-left:1px solid #333; \">\n                </div>\n            </div>\n           \n            <div class=\"m5 members mb20\" style=\"background-color:var(--pageBg); overflow-x:hidden\"> \n            \n            </div>\n            \n            <div class=\"m10 fr\" style=\"width:270px\"> \n                <div class=\"small\">Add new member from...</div>\n                <br>\n                <button class=\"xs fr m5 mtmd fromExisting\" onclick=\"\"  style=\"width:150px\">...an existing Team</button>\n                <button class=\"xs fr m5 mtmd fromNew\" style=\"width:150px\">...a new child Team</button>\n                <button class=\"xs fr m5 fromContacts\"  style=\"width:150px\">...your Contacts</button>\n                <button class=\"xs fr m5 fromInvitation\" style=\"width:150px\">...a new Invititation</button>\n            </div>\n   </div>\n   <svg id=\"rootD3\" class=\"hidden\" style=\"height:300px;overflow:visible; stroke:white\"></svg>\n            "));var drawer=new warp.gui.Drawer(app.inspected.members.length+' members : ',{size:'md',onOpen:function onOpen(dr){dr.body.innerHTML='';warp.api.call('profiles/read',app.inspected.members).then(function(arr){arr.forEach(function(profile){gui.storage('profiles.'+profile.id,profile);dr.body.innerHTML+="\n                                        <div class=\"m5 tl\">\n                                            <button class=\"xs round fr mr20 mt20\" \n                                                onclick=\"main.teams.remove('".concat(main.teams.inspected.id,"','").concat(profile.id,"')\"\n                                                style=\"position:absolute; right:20px; margin-bottom:-30px\">\n                                              X\n                                            </button> \n                                            <span onclick=\"main.teams.inspect('").concat(profile.id,"')\">\n                                                ").concat(gui.profile.list(profile.id,true),"\n                                            </span>\n                                        </div>");});loaded=true;});}});app.el.querySelector('.members').appendChild(drawer.el);app.el.querySelector('button.fromNew').addEventListener('click',function(){toast('Enter the new profile\'s name...');input(app.inspected.name+' child '+app.inspected.members.length).then(function(text){app.new(text,app.inspected.id).then(function(res){app.inspect(app.inspected.id);});});});app.el.querySelector('button.fromExisting').addEventListener('click',function(){main.team.show();main.team.select(function(selected){if(selected.id==app.inspected.id){alert('A profile cant be a child of itself');return;}if(selected.id==app.inspected.parent){alert('This profile cant be a member of team because it is its parent');return;}if(selected.id==main.data.user.id){alert('This is your users profile, it is by default a member of all your Teams');return;}main.team.hide();app.add(app.inspected.id,selected.id);});});app.el.querySelector('button.fromContacts').addEventListener('click',function(){main.contacts.show();main.contacts.select(function(selected){if(selected.id==app.inspected.id){alert('A profile cant be a child of itself');return;}if(selected.id==app.inspected.parent){alert('This profile cant be a member of team because it is its parent');return;}if(selected.id==main.data.user.id){alert('This is your users profile, it is by default a member of all your Teams');return;}main.contacts.hide();app.add(app.inspected.id,selected.id);});});app.el.querySelector('button.fromInvitation').addEventListener('click',function(){main.invitations.show();});app.win.caption('Team structure : '+app.inspected.name);gsap.to(app.el.querySelector('.parent'),{scale:0.6,x:-60,opacity:0.6});gsap.to(app.el.querySelector('.profile'),{scale:0.9,x:15,y:-10});gsap.to(app.el.querySelector('.members'),{opacity:1,y:26});gsap.to(drawer.body,{scale:0.9,opacity:0.9,x:40});app.show();}app.remove=function removeMember(profileId,memberId){confirm('Are you sure you want to remove this member?',function(){warp.api.call('profiles/removeMember',{'profile':profileId,'member':memberId}).then(function(data){toast('Removed!');app.inspect(app.inspected.id);});});};app.add=function addMember(profileId,memberId){confirm('Are you sure you want to add contact as member to "'+profileId+'"?',function(){warp.api.call('profiles/addMember',{'profile':profileId,'member':memberId}).then(function(data){toast('Added!');app.inspect(profileId);});});};app.new=function newTeam(name,parent){return new Promise(function(res,rej){if(!parent||!name)return new Error('Name or parent args are missing');warp.api.call('profiles/create',{'name':name,'parent':parent}).then(function(result){res(result);});});};app.inspect=function(profileId){if(!Boolean(profileId)){return error('no profileId provided in teams.inspect');}loaded=false;warp.api.call('profiles/read',profileId).then(function(data){app.inspected=data[0];gui.storage('profiles.'+app.inspected.id,app.inspected);render();});};return app;}var Camera=function Camera(){var app=this;Object.assign(app,new warp.factory.App({name:'Camera',winOpts:{beforeShow:function beforeShow(){},onHide:function onHide(w){}}}));var video=false,display=false,constraints={deviceId:'Logitech HD Pro Webcam C910 (046d:0821)'};function listDevices(){var sel=app.el.querySelector('select');sel.innerHTML='';navigator.mediaDevices.enumerateDevices().then(function(devices){for(var i=0;i<devices.length;i++){var device=devices[i];if(device.kind==='videoinput'){var option=document.createElement('option');option.value=device.deviceId;option.text=device.label||'camera '+(i+1);if(i==0){option.setAttribute('selected','selected');constraints.deviceId=device.deviceId;}sel.append(option);}}});}function startVideo(){navigator.mediaDevices.getUserMedia({video:true,audio:false}).then(function(stream){video.srcObject=stream;video.play();}).catch(function(err){error(err);});}app.capture=function(scaleFactor){if(scaleFactor==null){scaleFactor=1;}var w=video.videoWidth*scaleFactor;var h=video.videoHeight*scaleFactor;var canvas=document.createElement('canvas');canvas.width=w;canvas.height=h;var ctx=canvas.getContext('2d');ctx.drawImage(video,0,0,w,h);return ctx.getImageData(0,0,w,h);};function render(){app.el.innerHTML="\n        <select class=\"hidden\"></select>\n        <video  autoplay  width=\"100%\"></video>\n        ";video=app.el.querySelector('video');startVideo();listDevices();}render();};var Geo=function Geo(el){var app=this;if(el){app.el=el;}else{app.el=document.createElement('div');app.el.style.height='500px';}var key=main.data.company.google.maps;app.zoomLevel=13;app.options={'disableDefaultUI':true,'zoom':app.zoomLevel,'center':{lat:45.815,lng:15.9819},'backgroundColor':'none','options':{'gestureHandling':'greedy'}};app.map;app.overlay;app.geocoder;app.markers=[];app.oldMarkers=null;app.animationPoly=null;app.animationTimer=null;app.directionsService;app.directionsRenderer;app.ip=function(onFinished){var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){onFinished(JSON.parse(this.responseText));}};xhttp.open('POST','https://ipapi.co/json/',true);xhttp.send();};app.center=function(latLng,offsetX,offsetY){var scale=Math.pow(2,app.map.getZoom());var worldCoordinateCenter=app.map.getProjection().fromLatLngToPoint(latLng);var pixelOffset=new google.maps.Point(offsetX/scale||0,offsetY/scale||0);if(offsetY<0)pixelOffset.y=pixelOffset.y-pixelOffset.y-pixelOffset.y;var worldCoordinateNewCenter=new google.maps.Point(worldCoordinateCenter.x-pixelOffset.x,worldCoordinateCenter.y+pixelOffset.y);var newCenter=app.map.getProjection().fromPointToLatLng(worldCoordinateNewCenter);app.map.setCenter(newCenter);};app.zoom=function(level){app.zoomLevel=level;app.map.setZoom(level);};app.locateMe=function(onFinish){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var pos={lat:position.coords.latitude,lng:position.coords.longitude};onFinish(pos);},function(){onFinish(false);});}else{console.log('Your browser doesnt support geolocation!');}};app.clean=function(onClean){app.oldMarkers=app.markers;app.markers=[];for(var _i4=0;_i4<app.oldMarkers.length;_i4++){app.oldMarkers[_i4].setMap(null);}if(onClean)onClean();};app.address=function(latLng,onComplete){app.geocoder.geocode({'location':latLng},function(results,status){if(status==='OK'){if(results[0]){onComplete(results);}else{onComplete(false);}}else{onComplete(false);console.log('address reverse geocode  failed');}});};app.geocode=function(address,onComplete){return app.geocoder.geocode({'address':address},function(results,status){if(status==='OK'){var myLatLng=results[0].geometry.location;onComplete({lat:myLatLng.lat(),lng:myLatLng.lng()});}else{onComplete(false);console.log('could not geocode : '+address);}});};app.info=function(cont){return new google.maps.InfoWindow({content:cont});};app.marker=function(latLng,userOptions,userMarkerOptions){var options={image:false,click:false,mouseover:false,mouseout:false,mousein:false};if(userOptions)Object.assign(options,userOptions);var markerOpts={map:app.map,position:latLng,draggable:false,label:'',title:'',zIndex:0};if(options.image){Object.assign(markerOpts,{'icon':{url:options.image,scaledSize:new google.maps.Size(40,40)}});}if(userMarkerOptions)Object.assign(markerOpts,userMarkerOptions);var marker=new google.maps.Marker(markerOpts);if(options.click){marker.addListener('click',function(){options.click();});}if(options.mouseover){marker.addListener('mouseover',function(){options.mouseover();});}if(options.mouseout){marker.addListener('mouseout',function(){options.mouseout();});}if(options.mousein){marker.addListener('mousein',function(){options.mousein();});}marker.xy=function(){var proj=app.overlay.getProjection();return proj.fromLatLngToContainerPixel(marker.getPosition());};app.markers.push(marker);return marker;};app.snap=function(pos,onSnap){$.post('https://roads.googleapis.com/v1/snapToRoads?path='+pos.lat+','+pos.lng+'&interpolate=true&key='+key,{},function(recived){var snapped=JSON.parse(JSON.stringify(recived)).snappedPoints[0].location;var r={lat:snapped.latitude,lng:snapped.longitude};onSnap(r);});};app.move=function(latLng,marker){marker.setPosition(latLng);};app.closest=function(point,points){};app.distance=function(p1,p2){var rad=function rad(x){return x*Math.PI/180;};var R=6378137;var dLat=rad(p2.lat-p1.lat);var dLong=rad(p2.lng-p1.lng);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(rad(p1.lat))*Math.cos(rad(p2.lat))*Math.sin(dLong/2)*Math.sin(dLong/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d;};app.animateMarker=function(marker,response,onTick){google.maps.LatLng.prototype.distanceFrom=function(newLatLng){var EarthRadiusMeters=6378137;var lat1=this.lat();var lon1=this.lng();var lat2=newLatLng.lat();var lon2=newLatLng.lng();var dLat=(lat2-lat1)*Math.PI/180;var dLon=(lon2-lon1)*Math.PI/180;var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=EarthRadiusMeters*c;return d;};google.maps.LatLng.prototype.latRadians=function(){return this.lat()*Math.PI/180;};google.maps.LatLng.prototype.lngRadians=function(){return this.lng()*Math.PI/180;};google.maps.Polygon.prototype.Distance=function(){var dist=0;for(var i=1;i<this.getPath().getLength();i++){dist+=this.getPath().getAt(i).distanceFrom(this.getPath().getAt(i-1));}return dist;};google.maps.Polygon.prototype.GetPointAtDistance=function(metres){if(metres==0)return this.getPath().getAt(0);if(metres<0)return null;if(this.getPath().getLength()<2)return null;var dist=0;var olddist=0;for(var i=1;i<this.getPath().getLength()&&dist<metres;i++){olddist=dist;dist+=this.getPath().getAt(i).distanceFrom(this.getPath().getAt(i-1));}if(dist<metres){return null;}var p1=this.getPath().getAt(i-2);var p2=this.getPath().getAt(i-1);var m=(metres-olddist)/(dist-olddist);return new google.maps.LatLng(p1.lat()+(p2.lat()-p1.lat())*m,p1.lng()+(p2.lng()-p1.lng())*m);};google.maps.Polygon.prototype.GetPointsAtDistance=function(metres){var next=metres;var points=[];if(metres<=0)return points;var dist=0;var olddist=0;for(var i=1;i<this.getPath().getLength();i++){olddist=dist;dist+=this.getPath().getAt(i).distanceFrom(this.getPath().getAt(i-1));while(dist>next){var p1=this.getPath().getAt(i-1);var p2=this.getPath().getAt(i);var m=(next-olddist)/(dist-olddist);points.push(new google.maps.LatLng(p1.lat()+(p2.lat()-p1.lat())*m,p1.lng()+(p2.lng()-p1.lng())*m));next+=metres;}}return points;};google.maps.Polygon.prototype.GetIndexAtDistance=function(metres){if(metres==0)return this.getPath().getAt(0);if(metres<0)return null;var dist=0;var olddist=0;for(var i=1;i<this.getPath().getLength()&&dist<metres;i++){olddist=dist;dist+=this.getPath().getAt(i).distanceFrom(this.getPath().getAt(i-1));}if(dist<metres){return null;}return i;};google.maps.Polyline.prototype.Distance=google.maps.Polygon.prototype.Distance;google.maps.Polyline.prototype.GetPointAtDistance=google.maps.Polygon.prototype.GetPointAtDistance;google.maps.Polyline.prototype.GetPointsAtDistance=google.maps.Polygon.prototype.GetPointsAtDistance;google.maps.Polyline.prototype.GetIndexAtDistance=google.maps.Polygon.prototype.GetIndexAtDistance;var markerArray=[];var position;var speed=0.000005,wait=1;var timerHandle=null;var steps=[];var step=3;var tick=200;var eol;var k=0;var stepnum=0;var speed='';var lastVertex=1;if(app.animationPoly){app.animationPoly.setMap(null);app.animationPoly=null;}if(app.animationTimer){clearTimeout(app.animationTimer);}app.animationPoly=new google.maps.Polyline({path:[],strokeColor:'#FF00ff',strokeOpacity:0.4,strokeWeight:3});var route=response.routes[0];startLocation=new Object();endLocation=new Object();var path=response.routes[0].overview_path;var legs=response.routes[0].legs;for(i=0;i<legs.length;i++){if(i===0){startLocation.latlng=legs[i].start_location;startLocation.address=legs[i].start_address;}endLocation.latlng=legs[i].end_location;endLocation.address=legs[i].end_address;var steps=legs[i].steps;for(j=0;j<steps.length;j++){var nextSegment=steps[j].path;for(k=0;k<nextSegment.length;k++){app.animationPoly.getPath().push(nextSegment[k]);}}}app.animationPoly.setMap(app.map);startAnimation();function updatePoly(d){}function animate(d){if(d>eol){marker.setPosition(endLocation.latlng);app.animationPoly.setMap(null);app.animationPoly=null;return;}var p=app.animationPoly.GetPointAtDistance(d);var lastPosn=marker.getPosition();marker.setPosition(p);var heading=google.maps.geometry.spherical.computeHeading(lastPosn,p);if(onTick){onTick();};app.animationTimer=setTimeout(function(){animate(d+step);},tick);}function startAnimation(){eol=app.animationPoly.Distance();setTimeout(function(){animate(50);},10);}};app.displayRoute=function(or,dest,marker,onAnimationTick){directionsService.route({origin:or,destination:dest,travelMode:'WALKING'},function(response,status){if(status==='OK'){if(marker){app.animateMarker(marker,response,onAnimationTick);}else{directionsRenderer.setDirections(response);}}else{window.alert('Directions request failed due to '+status);}});};app.init=function(){if(!app.el){}app.directionsService=new google.maps.DirectionsService();app.directionsRenderer=new google.maps.DirectionsRenderer();app.directionsRenderer.setOptions({suppressMarkers:true});app.map=new google.maps.Map(app.el,app.options);app.directionsRenderer.setMap(app.map);app.overlay=new google.maps.OverlayView();app.overlay.draw=function(){};app.overlay.setMap(app.map);app.geocoder=new google.maps.Geocoder();};function load(){var randTempName='tempMapInit'+Math.floor(Math.random()*10001);window[randTempName]=function(){app.init();delete window[randTempName];};var srcAttr='https://maps.googleapis.com/maps/api/js?key='+key+'&libraries=drawing&callback='+randTempName;var mapScript=document.createElement('script');mapScript.setAttribute('src',srcAttr);mapScript.setAttribute('async','true');mapScript.setAttribute('defer','true');document.body.appendChild(mapScript);}load();};function WallApp(id){if(id===undefined)throw new Error('No profile ID provided for Wall app');(function createDummyEnv(){if(!main.data.user)main.data.user={id:'000000000',username:'test@bemjax.com',profile:{id:'000000000',name:'test user',logo:false,members:[]}};})();var app=extend(this,new ProfileApp({profile:id,name:'Wall',icon:'user'}));var editorEl=warp.dom.node('div',{},{class:'text-editor'});var currentMessage;var menuBtn;var menuItems;var reactions={1:{name:'Like',code:'x1F44D'},2:{name:'Love',code:'x1F60D'},3:{name:'HaHa',code:'x1F604'},4:{name:'Wow',code:'x1F62E'},5:{name:'Sad',code:'x1F622'},6:{name:'Thank You',code:'x1F64F'}};var messages={};var messageTypes={0:{name:'say',render:async function render(msg){var profile=await getProfile(msg.as);var msgSet=warp.dom.node('div',{},{class:'set'});msgSet.innerHTML="\n                                <div class=\"time\">".concat(main.date.format(msg.date)," ").concat(msg.date.split(' ')[1],"</div>\n                                <a class=\"profile\" onclick=\"main.profile.edit('").concat(profile.id,"')\">\n                                    <div class=\"image\" style=\"background-image:url(").concat(profile.logo,")\">\n                                    </div>\n                                    <div class=\"name\">\n                                        ").concat(profile.name.split(' ')[0],"\n                                    </div>\n                                </a>    \n                                <br>\n                                <div class=\"msg msg-").concat(msg.id," mb20 tl\">\n                                    <div class=\"body\">\n                                        ").concat(msg.data,"\n                                    </div>\n                                    <div class=\"reactions\">\n                                    </div>\n                                   <div class=\"replies\">\n                                   </div>\n                                </div>\n                             \n                                ");addHoverEvent(msgSet,msg);msgSet.querySelectorAll('.msg a').forEach(function(el){var url=el.getAttribute('href');if(url&&url!='#'){if(el.getAttribute('onclick'))return;el.setAttribute('href','#');el.addEventListener('click',function(e){e.stopPropagation();warp.tab(url);});}});app.el.querySelector('.messages').prepend(msgSet);return msgSet;},show:function show(msg){editorEl.innerHTML='';var wrapper=warp.dom.node('div',{},{'style':"\n                       margin-left:-60px; \n                       margin-right:-60px; \n                       background-color : rgba(0,0,0,.4)",'class':''});wrapper.append(editorEl);app.menu.show({wrapper:wrapper,Post:function Post(){say(editorEl.innerHTML,0,false,false);}});editorEl.focus();editorEl.setAttribute('contenteditable',true);}},1:{name:'react',render:async function render(msg){if(!msg.reference)throw new Error('no reference in message');var profile=await getProfile(msg.as);var refEl=app.el.querySelector('.msg-'+msg.reference);if(!refEl){error('.msg-'+msg.reference);}var reactionsEl=refEl.querySelector('.reactions');if(!reactionsEl){reactionsEl=warp.dom.node('div',{},{style:'pointer-events:none',class:'reactions'});refEl.append(reactionsEl);}var reactionEl=reactionsEl.querySelector('.reaction-'+msg.data);if(!reactionEl){reactionEl=warp.dom.node('button',{click:function click(e){e.preventDefault();toast(Object.keys(messages[msg.reference].reactions[msg.as]).length+' reactions');}},{style:'font-size:1.4em',class:'clear p0 xs image round reaction-'+msg.data});reactionEl.innerHTML='&#'+reactions[msg.data].code;reactionsEl.append(reactionEl);}else{var badge=reactionEl.querySelector('.badge');if(!badge){badge=warp.dom.node('span',{},{style:'padding-top:2px; width:12px; height:12px; font-size:10px; line-height:12px',class:'p0 warning strong round badge ml-5'});badge.textContent=1;reactionEl.append(badge);}badge.textContent=parseInt(badge.textContent)+1;}},show:false},2:{name:'reply',render:async function render(msg){if(!msg.reference)throw new Error('no reference in message');var profile=await getProfile(msg.as);var refEl=app.el.querySelector('.msg-'+msg.reference);if(!refEl)throw error('cant find message element .msg-'+msg.reference);var repliesEl=refEl.querySelector('.replies');if(!repliesEl)throw error('cant find replies element for .msg-'+msg.reference);var msgEl=warp.dom.node('div',{},{style:'padding-top:5px; width:200px; background-color:rgb(25,32,40); line-height:12px',class:'replie msg msg-'+msg.id});msgEl.innerHTML=msg.data;addHoverEvent(msgEl,msg);repliesEl.append(msgEl);},show:function show(msg){if(!msg)throw new Error('Message argument is missing in replayToMessage');var header=warp.dom.node('div');header.innerHTML="\n                        <div class=\"small p5 pl10 pr10 mb10\" style=\"background-color:rgba(0,0,0,.3)\">\n                                Replying to :\n                                <br> \n                                <span class=\"ti\">".concat(msg.data.substring(0,30),"</span>\n                         </div>");editorEl.setAttribute('contenteditable',true);editorEl.innerHTML='';var wrapper=warp.dom.node('div',{},{'style':"\n               margin-left:-60px; \n               margin-right:-60px; \n               background-color : rgba(0,0,0,.4)",'class':''});wrapper.append(header);wrapper.append(editorEl);app.menu.show({wrapper:wrapper,Reply:function Reply(){say(editorEl.innerHTML,2,false,msg.id);}});editorEl.focus();}},3:{name:'delete',render:async function render(){},show:function show(msg){}},4:{name:'edit',render:async function render(msg){app.el.querySelector('.msg'+msg.id).innerHTML=msg.data;},show:function show(msg){editorEl.innerHTML='';var wrapper=warp.dom.node('div',{},{'style':"\n                       margin-left:-60px; \n                       margin-right:-60px; \n                       background-color : rgba(0,0,0,.4)",'class':''});if(msg){var header=warp.dom.node('div');header.innerHTML="\n                        <div class=\"small p5 pl10 pr10 mb10\" style=\"background-color:rgba(0,0,0,.3)\">\n                                Editing :\n                                <br> \n                                <span class=\"ti\">".concat(msg.data.substring(0,30),"</span>\n                         </div>");wrapper.append(header);editorEl.innerHTML=msg.data;}wrapper.append(editorEl);if(!msg){app.menu.show({wrapper:wrapper,Post:function Post(){say(editorEl.innerHTML,0,false,false);}});}else{app.menu.show({wrapper:wrapper,Save:function Save(){say(editorEl.innerHTML,4,msg.as,msg.id);}});}editorEl.focus();editorEl.setAttribute('contenteditable',true);}},5:{name:'file',render:async function render(){},show:function show(msg){}},6:{name:'system',render:async function render(){},'desc':'adds and removes renames and such can be reported here'},show:function show(msg){}};function addHoverEvent(el,msg){el.addEventListener('mouseenter',function(e){el.append(menuBtn);currentMessage=msg;});}function showMessageMenu(){if(currentMessage&&currentMessage.type!=1)menuItems.reply=function(){app.menu.hide();setTimeout(function(){messageTypes[2].show(currentMessage);},200);};if(true)menuItems.edit=function(){app.menu.hide();setTimeout(function(){messageTypes[4].show(currentMessage);},200);};app.menu.show(menuItems);}function addMessageToScope(msg){messages[msg.id]=msg;if(msg.type==1){if(!messages[msg.reference])throw new Error('Reference message with id : '+msg.reference+' doesn\'t exist in message '+msg.reference);if(!messages[msg.reference].reactions)messages[msg.reference].reactions={};messages[msg.reference].reactions[msg.as]=msg.data;}else if(msg.type==0)msg.reactions={};messageTypes[msg.type].render(msg);}function render(messages){var style="\n                <style>\n                .text-editor {\n                    margin-left: 5px;\n                    margin-right: 5px;\n                    cursor: text;\n                }\n                </style>\n        ";var profile=app.profile;app.el.innerHTML=style+"\n                        \n                <div class=\"wall\">\n                        <div class=\"create hidden\">\n                            <div class=\"fl small  mt10 ml10\" style=\"opacity:0.6; font-size:0.8em\"> NEW POST </div>\n                            <button class=\"inline xs fr cancel mr0 mb5 clear\" onclick=\"warp.dom.hide(this.parentNode)\">X</button>\n                            <div class=\"m10\">\n                                <textarea class=\"block m0 mb10\" placeholder=\"...what are you thinking of?\" onkeypress=\"this.parentNode.parentNode.querySelector('button.post-as').classList.remove('disabled');this.parentNode.parentNode.querySelector('button.post').classList.remove('disabled');\"></textarea>\n                            </div>\n                            <button class=\"m10 xs fr clear hidden\" style=\"margin-top:-30px;\">\n                                <svg class=\"icon\">\n                                    <use href=\"#icon-close\"/>\n                                </svg>\n                            </button>\n                            <button class=\"m10 xs fr mr5 disabled post\">Post as ".concat(main.data.user.profile.name.split(' ')[0],"</button>\n                            <button class=\"m10 xs fr mr5 disabled post-as\">Post as...</button>\n                        </div>\n                        <div class=\"toolbar hmd\">\n                            <div class=\"op3 mt5 mb0 ml10 small tl\">LATEST</div>\n                            <h2 class=\"m0 ml10 fl inline-block op4\">Posts</h2>\n                            <button class=\"m0 ml10 xs fl new hidden\">New</button>\n                        </div>\n                        <div class=\"messages\">\n                        </div>           \n                </div>\n        ");var slot=warp.dom.node('slot',{},{brands:['Layout','Drive','App'],recive:function recive(data){toast('Adding attachment to Wall post');}});slot.setAttribute('class','slot m5 ml10 mt10 hxs fl hidden');var ta=app.el.querySelector('textarea');var btnNew=app.el.querySelector('button.new');app.event(btnNew,'click',function(){messageTypes[0].show();});app.el.querySelector('.create').append(slot);app.el.querySelector('.post').addEventListener('click',function(el){say(ta.value,0,main.data.user.id);ta.value='';warp.dom.disable(app.el.querySelector('.post'));warp.dom.disable(app.el.querySelector('.post-as'));warp.dom.hide(app.el.querySelector('.create'));});app.el.querySelector('.post-as').addEventListener('click',function(el){var ta=app.el.querySelector('textarea');say(ta.value,0,false);ta.value='';warp.dom.disable(app.el.querySelector('.post'));warp.dom.disable(app.el.querySelector('.post-as'));warp.dom.hide(app.el.querySelector('.create'));});ta.style.width=warp.dom.width(app.win.body)-20+'px';ta.style.height='300px';if(main.data.user.username==profile.user||profile.members.includes(main.data.user.id))warp.dom.show(btnNew);each(messages,function(index,message){addMessageToScope(message);});}async function getProfile(id){if(!id)throw new Error('no id in getProfile');var profile=gui.storage('profiles.'+id);if(!profile){profile=await warp.api.call('profiles/read',id);gui.storage('profiles.'+id,profile);}if(!profile){throw new Error('getProfile cant get profile id : '+id);}else return profile;}async function say(data,type,as,reference){if(!as){var t=toast('Post to Wall as ...',20000);main.team.select(function(profile){main.team.hide();app.busy(true);var msg={'type':type,'reference':reference,'data':data,'date':main.date.serverFormat(new Date())};warp.api.call('wall/say',{'wallProfile':app.profile.id,'path':'public/wall.list','as':profile.id,'msg':msg}).then(function(id){app.busy(false);msg.id=id;msg.as=profile.id;msg.profile=main.data.user.id;addMessageToScope(msg);app.menu.hide();t.destroy();});});}else{var msg={'type':type,'reference':reference,'data':data,'date':main.date.serverFormat(new Date())};warp.api.call('wall/say',{'wallProfile':app.profile.id,'path':'public/wall.list','as':as,'msg':msg}).then(function(id){app.busy(false);msg.id=id;msg.as=as;msg.profile=main.data.user.id;addMessageToScope(msg);app.menu.hide();});}}function construct(){editorEl.addEventListener('click',function(e){e.preventDefault();});var reactionsEl=warp.dom.node('div',{},{style:'border-radius :12px; background-color:rgba(35,35,35,0.3);',class:''});menuItems={r:reactionsEl};each(reactions,function(number,reaction){var button=warp.dom.node('button',{click:function click(){if(currentMessage.reactions[main.data.user.id]){toast('you already reacted');return;}say(number,1,main.data.user.id,currentMessage.id);}},{class:'round xs m5 p0 clear react',style:'font-size:1.4em'});button.innerHTML='&#'+reaction.code;reactionsEl.append(button);});menuBtn=warp.dom.node('button',{click:function click(){showMessageMenu();}},{class:'round xs m5 p0 op6',style:'left :'+(app.win.width()/2-12)+'px; position: absolute; bottom:-10px;'});menuBtn.innerHTML="<svg class=\"icon\" style=\"margin-top:3px\" >\n                                            <use href=\"#icon-menu-dots\"/>\n                                        </svg>";warp.api.call('wall/read',{profile:id,path:'public/wall.list'}).then(function(messages){if(Boolean(messages)){messages=messages.trim();messages=messages.slice(0,-1);}else messages='';render(warp.un.json('['+messages+']'));});}construct();}})();